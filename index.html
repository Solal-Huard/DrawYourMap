<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- ==================== PRIMARY SEO META TAGS ==================== -->
    <title>Srndipity - For Those With Eyes to See | Road Trip Planner & Vanlife Adventures</title>
    <meta name="description" content="Srndipity - For those with eyes to see. Disconnect from screens, connect with the road. Discover 200+ epic road trips worldwide, track your vanlife adventures, and learn to see the details in every moment. For travelers who want to be truly present.">
    <meta name="keywords" content="road trip planner, vanlife, travel diary, road trip map, overlanding routes, campervan travel, van life app, road trip ideas, travel tracker, adventure planner, world road trips, scenic drives, camping routes">
    <meta name="author" content="Srndipity">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <link rel="canonical" href="https://srndipity.io/">
    
    <!-- ==================== OPEN GRAPH (Facebook, LinkedIn) ==================== -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Srndipity">
    <meta property="og:title" content="Srndipity - For Those With Eyes to See | Road Trip Planner">
    <meta property="og:description" content="For those with eyes to see. Discover epic road trips worldwide, track your vanlife adventures, and find the hidden gems others miss. 100% free, no signup required.">
    <meta property="og:url" content="https://srndipity.io/">
    <meta property="og:image" content="https://srndipity.io/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Srndipity - Interactive road trip planning tool showing world map with travel routes">
    <meta property="og:locale" content="en_US">
    
    <!-- ==================== TWITTER CARD ==================== -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@Srndipity">
    <meta name="twitter:creator" content="@Srndipity">
    <meta name="twitter:title" content="Srndipity - Road Trip Planner & Vanlife Travel Diary">
    <meta name="twitter:description" content="For those with eyes to see. Discover epic road trips, track your vanlife adventures, find hidden gems others miss. Free for dreamers and wanderers.">
    <meta name="twitter:image" content="https://srndipity.io/twitter-card.jpg">
    <meta name="twitter:image:alt" content="Srndipity road trip planning interface">
    
    <!-- ==================== ADDITIONAL SEO META ==================== -->
    <meta name="theme-color" content="#2D3E33">
    <meta name="msapplication-TileColor" content="#2D3E33">
    <meta name="apple-mobile-web-app-title" content="Srndipity">
    <meta name="application-name" content="Srndipity">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    
    <!-- ==================== GEO & LANGUAGE ==================== -->
    <meta name="geo.region" content="US">
    <meta name="language" content="English">
    <meta http-equiv="content-language" content="en">
    
    <!-- ==================== STRUCTURED DATA (Schema.org) ==================== -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Srndipity",
        "alternateName": ["Srndipity", "Serendipity Roads", "Srndipity.io", "Srndipity Road Trip Planner"],
        "url": "https://srndipity.io",
        "description": "Interactive road trip planner and travel diary for vanlife enthusiasts, overlanders, and adventure seekers. Discover epic routes, track your journeys, and plan your next adventure.",
        "applicationCategory": "TravelApplication",
        "operatingSystem": "Web Browser",
        "browserRequirements": "Requires JavaScript",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "description": "Free to use with optional premium features"
        },
        "featureList": [
            "Interactive world map with country tracking",
            "200+ curated road trip routes worldwide",
            "Vanlife and overlanding route recommendations",
            "Trip difficulty ratings and duration estimates",
            "Budget planning and cost breakdowns",
            "Community reviews and tips",
            "Printable travel posters",
            "Offline-friendly trip details"
        ],
        "screenshot": "https://srndipity.io/screenshot.jpg",
        "softwareVersion": "2.0",
        "author": {
            "@type": "Organization",
            "name": "Srndipity",
            "url": "https://srndipity.io"
        },
        "publisher": {
            "@type": "Organization",
            "name": "Srndipity",
            "logo": {
                "@type": "ImageObject",
                "url": "https://srndipity.io/logo.png"
            }
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "1250",
            "bestRating": "5",
            "worstRating": "1"
        }
    }
    </script>
    
    <!-- Organization Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "Srndipity",
        "url": "https://srndipity.io",
        "logo": "https://srndipity.io/logo.png",
        "description": "For those with eyes to see - The leading platform for road trip planning and vanlife travel tracking",
        "foundingDate": "2024",
        "sameAs": [
            "https://twitter.com/Srndipity",
            "https://instagram.com/srndipity",
            "https://facebook.com/srndipity",
            "https://youtube.com/@srndipity",
            "https://tiktok.com/@srndipity"
        ],
        "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "customer support",
            "email": "hello@srndipity.io"
        }
    }
    </script>
    
    <!-- FAQ Schema for AI Search & Rich Snippets -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "What is Srndipity?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Srndipity - For those with eyes to see - is a free interactive road trip planner and travel diary designed for vanlifers, overlanders, and adventure seekers who want to discover the hidden gems others miss. It features 200+ curated road trip routes worldwide, an interactive map to track visited countries, trip planning tools with budget estimates, and a community of fellow travelers sharing tips and reviews."
                }
            },
            {
                "@type": "Question",
                "name": "How do I plan a road trip with Srndipity?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Simply browse our curated road trips by continent or difficulty level, view detailed route information including waypoints, costs, and must-know tips, then add trips to your wishlist or mark them as completed. Each trip includes duration estimates, budget breakdowns, best seasons to visit, and community reviews."
                }
            },
            {
                "@type": "Question",
                "name": "Is Srndipity free to use?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes! Srndipity is completely free to use. All road trip routes, the interactive map, trip planning features, and community content are available at no cost. We offer an optional premium tier ($4.99/year) for ad-free experience and HD poster downloads."
                }
            },
            {
                "@type": "Question",
                "name": "What are the best road trips for vanlife?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Popular vanlife road trips include Route 66 (USA), the Pan-American Highway, Iceland's Ring Road, Australia's Great Ocean Road, Scotland's North Coast 500, Portugal's Atlantic Coast, and Namibia's Skeleton Coast. Each offers unique camping opportunities, scenic views, and vanlife-friendly infrastructure."
                }
            },
            {
                "@type": "Question",
                "name": "Can I track my travel history on Srndipity?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Yes! The Travel Diary feature lets you mark countries as visited (turning them green on the map), track completed road trips, log your personal journeys with dates, and see statistics like total countries visited and continents explored. Your data is saved locally in your browser."
                }
            },
            {
                "@type": "Question",
                "name": "What overlanding routes does Srndipity feature?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Srndipity features iconic overlanding routes including the Trans-Sahara Highway, Cape Town to Cairo, Carretera Austral (Chile), Silk Road through Central Asia, Mongolia's Gobi Desert crossing, and many more. Each route includes 4x4 requirements, difficulty ratings, and essential preparation tips."
                }
            }
        ]
    }
    </script>
    
    <!-- BreadcrumbList Schema -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://srndipity.io"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Road Trips",
                "item": "https://srndipity.io/#serendipity"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "Travel Diary",
                "item": "https://srndipity.io/#diary"
            }
        ]
    }
    </script>
    
    <!-- ItemList Schema for Road Trips (helps with rich snippets) -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "ItemList",
        "name": "Popular Road Trips for Vanlife Adventures",
        "description": "Curated collection of the world's best road trips for vanlifers and overlanders",
        "numberOfItems": 25,
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "item": {
                    "@type": "TouristTrip",
                    "name": "Route 66 - The Mother Road",
                    "description": "The iconic American road trip from Chicago to Santa Monica",
                    "touristType": "Road Trip Enthusiast"
                }
            },
            {
                "@type": "ListItem",
                "position": 2,
                "item": {
                    "@type": "TouristTrip",
                    "name": "Iceland Ring Road",
                    "description": "Complete circumnavigation of Iceland's stunning landscapes",
                    "touristType": "Vanlife Adventurer"
                }
            },
            {
                "@type": "ListItem",
                "position": 3,
                "item": {
                    "@type": "TouristTrip",
                    "name": "Great Ocean Road",
                    "description": "Australia's most scenic coastal drive",
                    "touristType": "Scenic Drive Lover"
                }
            },
            {
                "@type": "ListItem",
                "position": 4,
                "item": {
                    "@type": "TouristTrip",
                    "name": "North Coast 500",
                    "description": "Scotland's answer to Route 66",
                    "touristType": "Adventure Traveler"
                }
            },
            {
                "@type": "ListItem",
                "position": 5,
                "item": {
                    "@type": "TouristTrip",
                    "name": "Pan-American Highway",
                    "description": "Epic journey from Alaska to Argentina",
                    "touristType": "Overlander"
                }
            }
        ]
    }
    </script>
    
    <!-- ==================== FONTS & STYLES ==================== -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                    colors: {
                        forest: { DEFAULT: '#2D3E33', light: '#3d5247', dark: '#1e2820' },
                        burnt: { DEFAULT: '#E07A5F', light: '#e8927a', dark: '#c9684e' },
                        cream: { DEFAULT: '#F9F7F2', dark: '#ebe8e0' },
                        coral: { DEFAULT: '#E07A5F' },
                    },
                    backdropBlur: { glass: '16px' },
                    borderRadius: { '2xl': '1rem', '3xl': '1.25rem' },
                }
            }
        }
    </script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Leaflet CSS for road maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* ========== SRNDIPITY INC. – GLASSMORPHIC DESIGN SYSTEM ========== */
            --brand-forest: #2D3E33;
            --brand-forest-light: #3d5247;
            --brand-forest-dark: #1e2820;
            --brand-orange: #E07A5F;
            --brand-orange-light: #e8927a;
            --brand-orange-dark: #c9684e;
            --brand-cream: #F9F7F2;
            --brand-cream-dark: #ebe8e0;

            /* Glassmorphic tokens */
            --glass-bg: rgba(255, 255, 255, 0.80);
            --glass-bg-heavy: rgba(255, 255, 255, 0.92);
            --glass-border: rgba(255, 255, 255, 0.35);
            --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            --glass-blur: 16px;

            /* Semantic aliases */
            --srndipity-orange: #E07A5F;
            --srndipity-olive: #2D3E33;
            --srndipity-cream: #F9F7F2;
            --srndipity-cream-dark: #ebe8e0;
            --srndipity-dark: #2D3E33;
            --srndipity-peach: #F9F7F2;
            --srndipity-olive-dark: #1e2820;
            --srndipity-olive-darker: #1e2820;

            --bg-dark: #f1f5f9;
            --bg-dark-true: #1e2820;
            --bg-panel: rgba(255, 255, 255, 0.80);
            --bg-elevated: rgba(255, 255, 255, 0.60);
            --bg-hover: rgba(255, 255, 255, 0.90);

            --safari-cream: #F9F7F2;
            --safari-sand: #ebe8e0;
            --safari-terracotta: #E07A5F;
            --safari-rust: #c9684e;
            --safari-brown: #2D3E33;
            --safari-sage: #3d5247;
            --safari-olive: #2D3E33;
            --safari-gold: #E07A5F;
            --safari-amber: #e8927a;

            --accent-primary: #E07A5F;
            --accent-secondary: #e8927a;
            --accent-glow: rgba(224, 122, 95, 0.25);

            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;

            --border-subtle: rgba(0, 0, 0, 0.06);
            --border-accent: rgba(224, 122, 95, 0.5);
            --border-clean: 1px solid rgba(0, 0, 0, 0.06);

            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --serendipity: #E07A5F;
            --road-primary: #E07A5F;

            --adventure-cream: #F9F7F2;
            --adventure-paper: #F9F7F2;
            --adventure-tan: #ebe8e0;
            --adventure-brown: #2D3E33;
            --adventure-dark: #1e2820;
            --adventure-red: #E07A5F;
            --adventure-orange: #E07A5F;
            --adventure-gold: #E07A5F;
            --adventure-sage: #2D3E33;
            --adventure-forest: #1e2820;

            --vintage-cream: #F9F7F2;
            --vintage-paper: #F9F7F2;
            --vintage-tan: #ebe8e0;
            --vintage-dark: #2D3E33;
            --vintage-brown: #3d5247;
            --vintage-gold: #E07A5F;
            --vintage-red: #c9684e;
            --vintage-orange: #E07A5F;
            --vintage-teal: #2D3E33;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: #f1f5f9;
            color: var(--text-primary);
            overflow: hidden;
            min-height: 100vh;
        }

        /* Brand typography – Inter for everything, weights for hierarchy */
        .logo, .trip-hero-title, .section-title-index, .sidebar-header .logo {
            font-family: 'Inter', system-ui, sans-serif;
            letter-spacing: -0.02em;
            font-weight: 700;
        }

        /* =====================================================
           VINTAGE ROAD TRIP THEME - Serendipity Mode
           ===================================================== */
        
        body.vintage-mode {
            background: var(--vintage-cream);
        }

        body.vintage-mode .sidebar {
            background: var(--vintage-paper);
            border-right: 2px solid var(--vintage-tan);
            box-shadow: 4px 0 20px rgba(74, 63, 53, 0.15);
        }

        body.vintage-mode .sidebar-header {
            background: linear-gradient(135deg, var(--vintage-dark), var(--vintage-brown));
            border-bottom: 3px solid var(--vintage-gold);
            padding: 20px;
        }

        body.vintage-mode .logo {
            color: var(--vintage-cream);
            font-family: 'Georgia', 'Times New Roman', serif;
            letter-spacing: 1px;
        }

        body.vintage-mode .mode-switcher {
            background: var(--vintage-cream);
            border: 2px solid var(--vintage-tan);
            padding: 4px;
        }

        body.vintage-mode .mode-btn {
            color: var(--vintage-brown);
            font-weight: 600;
        }

        body.vintage-mode .mode-btn.active {
            background: var(--vintage-red);
            color: var(--vintage-cream);
            border-radius: 6px;
        }

        body.vintage-mode .sidebar-content {
            background: var(--vintage-paper);
        }

        body.vintage-mode .section-title {
            color: var(--vintage-dark);
            font-family: 'Georgia', serif;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--vintage-tan);
            padding-bottom: 8px;
            margin-bottom: 12px;
        }

        body.vintage-mode .road-trip-card {
            background: var(--vintage-cream);
            border: 1px solid var(--vintage-tan);
            border-left: 4px solid var(--vintage-red);
            box-shadow: 2px 2px 8px rgba(74, 63, 53, 0.1);
            transition: all 0.3s ease;
        }

        body.vintage-mode .road-trip-card:hover {
            transform: translateY(-2px);
            box-shadow: 4px 4px 16px rgba(74, 63, 53, 0.2);
            border-left-color: var(--vintage-orange);
        }

        body.vintage-mode .road-trip-card.active {
            border-left-color: var(--vintage-gold);
            background: linear-gradient(135deg, var(--vintage-cream), rgba(212, 160, 61, 0.1));
        }

        body.vintage-mode .road-trip-card.personal {
            border-left-color: var(--vintage-teal);
        }

        body.vintage-mode .road-trip-card.completed {
            border-left-color: var(--vintage-teal);
            background: linear-gradient(135deg, var(--vintage-cream), rgba(74, 124, 124, 0.1));
        }

        body.vintage-mode .road-trip-name {
            color: var(--vintage-dark);
            font-family: 'Georgia', serif;
            font-weight: 600;
        }

        body.vintage-mode .road-trip-meta {
            color: var(--vintage-brown);
        }

        body.vintage-mode .road-trip-icon {
            font-size: 1.4rem;
        }

        body.vintage-mode .road-tag {
            background: var(--vintage-paper);
            border: 1px solid var(--vintage-tan);
            color: var(--vintage-brown);
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        body.vintage-mode .road-tag.scenic { border-left: 3px solid var(--vintage-teal); }
        body.vintage-mode .road-tag.adventure { border-left: 3px solid var(--vintage-red); }
        body.vintage-mode .road-tag.historic { border-left: 3px solid var(--vintage-gold); }
        body.vintage-mode .road-tag.camping { border-left: 3px solid var(--vintage-orange); }

        body.vintage-mode .difficulty-badge {
            font-family: 'Georgia', serif;
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        body.vintage-mode .difficulty-badge.easy { 
            background: rgba(74, 124, 124, 0.2);
            color: var(--vintage-teal);
        }
        body.vintage-mode .difficulty-badge.moderate { 
            background: rgba(212, 160, 61, 0.2);
            color: var(--vintage-gold);
        }
        body.vintage-mode .difficulty-badge.challenging { 
            background: rgba(224, 122, 57, 0.2);
            color: var(--vintage-orange);
        }
        body.vintage-mode .difficulty-badge.extreme { 
            background: rgba(196, 69, 54, 0.2);
            color: var(--vintage-red);
        }

        body.vintage-mode .btn-serendipity {
            background: var(--vintage-red);
            border: none;
            font-family: 'Georgia', serif;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        body.vintage-mode .btn-serendipity:hover {
            background: var(--vintage-orange);
        }

        body.vintage-mode .btn-secondary {
            background: var(--vintage-cream);
            border: 2px solid var(--vintage-tan);
            color: var(--vintage-brown);
        }

        body.vintage-mode .btn-secondary:hover {
            background: var(--vintage-tan);
            color: var(--vintage-dark);
        }

        body.vintage-mode .section {
            background: transparent;
            border-bottom: 1px dashed var(--vintage-tan);
            padding-bottom: 16px;
            margin-bottom: 16px;
        }

        body.vintage-mode .league-section {
            background: linear-gradient(135deg, rgba(212, 160, 61, 0.1), rgba(196, 69, 54, 0.1));
            border: 2px solid var(--vintage-tan);
            border-radius: 8px;
            padding: 16px;
        }

        body.vintage-mode .league-stat-card {
            background: var(--vintage-cream);
            border: 1px solid var(--vintage-tan);
        }

        body.vintage-mode .league-stat-value {
            color: var(--vintage-red);
            font-family: 'Georgia', serif;
        }

        body.vintage-mode .league-badge {
            background: linear-gradient(135deg, var(--vintage-gold), var(--vintage-orange));
            border: none;
        }

        body.vintage-mode .view-details-btn {
            background: var(--vintage-dark);
            color: var(--vintage-cream);
            font-family: 'Georgia', serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.7rem;
        }

        body.vintage-mode .complete-btn {
            background: var(--vintage-teal);
            color: var(--vintage-cream);
        }

        body.vintage-mode .add-alert-btn {
            background: var(--vintage-cream);
            border: 2px dashed var(--vintage-tan);
            color: var(--vintage-brown);
        }

        body.vintage-mode .add-alert-btn:hover {
            border-color: var(--vintage-red);
            color: var(--vintage-red);
        }

        body.vintage-mode .alert-card {
            background: var(--vintage-cream);
            border: 1px solid var(--vintage-tan);
            border-left: 3px solid var(--vintage-orange);
        }

        body.vintage-mode .community-alerts .section-title::after {
            content: none;
        }

        /* Vintage decorative elements – text watermark removed */
        body.vintage-mode .sidebar::before {
            display: none;
        }

        body.vintage-mode .road-trip-card::before {
            content: '◉';
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--vintage-red);
            font-size: 0.8rem;
        }

        body.vintage-mode .dblclick-hint {
            color: var(--vintage-brown);
            font-style: italic;
            font-family: 'Georgia', serif;
        }

        /* Vintage scroll styling */
        body.vintage-mode .sidebar-content::-webkit-scrollbar {
            width: 8px;
        }

        body.vintage-mode .sidebar-content::-webkit-scrollbar-track {
            background: var(--vintage-paper);
        }

        body.vintage-mode .sidebar-content::-webkit-scrollbar-thumb {
            background: var(--vintage-tan);
            border-radius: 4px;
        }

        body.vintage-mode .road-trip-rating {
            color: var(--vintage-gold);
        }

        body.vintage-mode .personal-badge {
            background: var(--vintage-teal);
        }

        body.vintage-mode .user-created-badge {
            background: var(--vintage-orange);
        }

        /* Vintage Banner */
        .vintage-banner {
            display: none;
        }

        body.vintage-mode .vintage-banner {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(135deg, var(--vintage-dark) 0%, var(--vintage-brown) 100%);
            border-bottom: 4px solid var(--vintage-gold);
            margin: -16px -16px 20px -16px;
            position: relative;
        }

        body.vintage-mode .vintage-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="none" stroke="%23d4a03d" stroke-width="0.5" opacity="0.1"/></svg>') repeat;
            opacity: 0.3;
            pointer-events: none;
        }

        .vintage-banner-content {
            position: relative;
        }

        .vintage-title {
            font-family: 'Georgia', serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--vintage-cream);
            letter-spacing: 4px;
            text-transform: uppercase;
        }

        .vintage-subtitle {
            font-family: 'Georgia', serif;
            font-size: 0.8rem;
            color: var(--vintage-gold);
            font-style: italic;
            margin-top: 4px;
        }

        .vintage-stats {
            display: flex;
            gap: 20px;
            position: relative;
        }

        .vintage-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            background: rgba(245, 240, 230, 0.1);
            border: 1px solid var(--vintage-gold);
            border-radius: 4px;
        }

        .vintage-stat-value {
            font-family: 'Georgia', serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--vintage-cream);
        }

        .vintage-stat-label {
            font-size: 0.65rem;
            color: var(--vintage-gold);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Vintage Tips */
        .vintage-tips {
            display: none;
        }

        body.vintage-mode .vintage-tips {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        body.vintage-mode .reddit-tips {
            display: none;
        }

        body.vintage-mode .travel-stats {
            display: none;
        }

        .vintage-tip {
            display: flex;
            gap: 12px;
            padding: 14px;
            background: var(--vintage-cream);
            border: 1px solid var(--vintage-tan);
            border-left: 4px solid var(--vintage-gold);
            border-radius: 4px;
        }

        .vintage-tip .tip-icon {
            font-size: 1.2rem;
        }

        .vintage-tip .tip-content {
            flex: 1;
        }

        .vintage-tip .tip-text {
            font-family: 'Georgia', serif;
            font-size: 0.85rem;
            color: var(--vintage-dark);
            font-style: italic;
            line-height: 1.5;
        }

        .vintage-tip .tip-source {
            font-size: 0.7rem;
            color: var(--vintage-brown);
            margin-top: 6px;
        }

        /* Map styling for vintage mode */
        body.vintage-mode .map-container {
            border-left: 3px solid var(--vintage-tan);
        }

        body.vintage-mode #roadMap {
            filter: sepia(15%) saturate(90%);
        }

        .container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Sidebar – Floating Glassmorphic Panel over the map */
        .sidebar {
            width: 380px;
            position: absolute;
            top: 16px;
            left: 16px;
            bottom: 16px;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            z-index: 500;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--glass-shadow);
            overflow: hidden;
        }

        .sidebar-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-subtle);
            background: transparent;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar-header::after {
            display: none;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            font-family: 'Inter', system-ui, sans-serif;
            letter-spacing: -0.02em;
        }

        .logo-img {
            display: block;
            max-width: 100%;
            height: auto;
            max-height: 56px;
            width: auto;
            object-fit: contain;
            border-radius: 12px;
        }

        .logo-icon {
            width: 42px;
            height: 42px;
            background: var(--brand-orange);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
        }

        .logo-icon::after {
            display: none;
        }

        .logo-icon.serendipity-mode {
            background: var(--brand-orange);
        }

        .logo-tagline {
            font-size: 0.65rem;
            color: var(--text-muted);
            letter-spacing: 0.5px;
            text-transform: lowercase;
            margin-top: 2px;
        }

        /* Vector icons – no emojis (design system) */
        .icon {
            display: inline-block;
            width: 1.25em;
            height: 1.25em;
            vertical-align: -0.25em;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
        .icon--sm { width: 1em; height: 1em; }
        .icon--lg { width: 1.5em; height: 1.5em; }

        /* Filter Chips – glassmorphic pills */
        .filter-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-chip {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.50);
            border: 1px solid rgba(255, 255, 255, 0.30);
            border-radius: 999px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.25s ease;
            font-weight: 500;
            letter-spacing: 0.01em;
            backdrop-filter: blur(8px);
        }

        .filter-chip:hover {
            background: rgba(255, 255, 255, 0.70);
            border-color: rgba(224, 122, 95, 0.3);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        .filter-chip.active {
            background: var(--brand-orange);
            border-color: var(--brand-orange);
            color: white;
            box-shadow: 0 2px 12px rgba(224, 122, 95, 0.3);
        }

        /* Region cards – discrete glassmorphic grid */
        .region-hint {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }
        .region-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }
        .region-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 16px 10px;
            min-height: 72px;
            background: rgba(255, 255, 255, 0.50);
            border: 1px solid rgba(255, 255, 255, 0.30);
            border-radius: 16px;
            color: var(--text-primary);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease;
            text-align: center;
            backdrop-filter: blur(8px);
        }
        .region-card:hover {
            background: rgba(255, 255, 255, 0.75);
            border-color: rgba(224, 122, 95, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
        }
        .region-card.active {
            background: var(--brand-orange);
            border-color: var(--brand-orange);
            color: white;
            box-shadow: 0 4px 16px rgba(224, 122, 95, 0.3);
        }
        .region-card.active .region-icon { color: white; }
        .region-icon { width: 22px; height: 22px; flex-shrink: 0; color: var(--brand-orange); }
        .region-name { flex: 1; font-size: 0.78rem; }
        .road-trips-list-panel .road-trips-list-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 8px;
        }
        .back-to-regions-btn {
            padding: 8px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.85rem;
            cursor: pointer;
        }
        .back-to-regions-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }
        .road-trips-list-subtitle {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 12px;
        }
        .road-trips-list-toolbar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .road-trips-count {
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .sort-by-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-left: auto;
        }
        .sort-by-select {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.60);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 10px;
            font-size: 0.8rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Inter', system-ui, sans-serif;
        }
        .sort-by-select:hover { border-color: rgba(224, 122, 95, 0.3); }
        .load-more-wrap {
            text-align: center;
            padding: 12px 0;
        }
        .load-more-btn {
            padding: 10px 28px;
            background: rgba(255, 255, 255, 0.60);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 999px;
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.25s ease;
            font-family: 'Inter', system-ui, sans-serif;
        }
        .load-more-btn:hover {
            background: rgba(255, 255, 255, 0.85);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            transform: translateY(-1px);
        }
        .trip-card-save {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            color: var(--text-muted);
            transition: color 0.2s, transform 0.2s;
            z-index: 2;
        }
        .trip-card-save:hover {
            color: var(--brand-orange);
        }
        .trip-card-save.saved {
            color: var(--brand-orange);
        }
        .trip-card-save .icon { width: 1.25rem; height: 1.25rem; }
        .badge-4x4 {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            background: rgba(45, 62, 51, 0.12);
            color: var(--brand-forest);
            margin-left: 6px;
        }
        .badge-4x4 .icon { width: 0.9rem; height: 0.9rem; }
        .road-trips-placeholder {
            padding: 24px 16px;
            text-align: center;
        }
        .placeholder-text {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        /* Season badges */
        .season-badge {
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: auto;
            white-space: nowrap;
        }

        .season-badge.best {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .season-badge.avoid {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .road-trip-card.season-best {
            border-left: 3px solid #22c55e;
        }

        .road-trip-card.season-avoid {
            opacity: 0.7;
        }

        .season-tip {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 4px;
            padding: 4px 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
        }

        /* Travel month selector – glassmorphic */
        .travel-month-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.45);
            border-radius: 14px;
            border: 1px solid rgba(255, 255, 255, 0.30);
            backdrop-filter: blur(8px);
        }

        .travel-month-selector label {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .travel-month-selector select {
            flex: 1;
            padding: 8px 10px;
            background: rgba(255, 255, 255, 0.70);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.8rem;
            cursor: pointer;
            font-family: 'Inter', system-ui, sans-serif;
        }

        body.vintage-mode .travel-month-selector {
            background: var(--vintage-cream);
            border-color: var(--vintage-tan);
        }

        body.vintage-mode .travel-month-selector select {
            background: white;
            color: var(--vintage-dark);
            border-color: var(--vintage-tan);
        }

        body.vintage-mode .season-badge.best {
            background: rgba(34, 139, 34, 0.15);
            color: #228b22;
        }

        body.vintage-mode .season-badge.avoid {
            background: rgba(196, 69, 54, 0.15);
            color: #c44536;
        }

        body.vintage-mode .season-tip {
            background: rgba(139, 115, 85, 0.1);
            color: var(--vintage-brown);
        }

        /* POI Layer Controls – glassmorphic */
        .poi-controls {
            position: absolute;
            bottom: 20px;
            left: 420px;
            z-index: 1000;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-radius: 16px;
            padding: 12px;
            border: 1px solid var(--glass-border);
            max-width: 300px;
            box-shadow: var(--glass-shadow);
        }

        .poi-controls-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .poi-controls-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .poi-controls-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
        }

        .poi-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .poi-toggle {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.50);
            border: 1px solid rgba(255, 255, 255, 0.30);
            border-radius: 999px;
            font-size: 0.7rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.25s ease;
            font-family: 'Inter', system-ui, sans-serif;
        }

        .poi-toggle:hover {
            background: rgba(255, 255, 255, 0.75);
            border-color: rgba(224, 122, 95, 0.3);
        }

        .poi-toggle.active {
            background: var(--brand-orange);
            border-color: var(--brand-orange);
            color: white;
            box-shadow: 0 2px 8px rgba(224, 122, 95, 0.25);
        }

        .poi-toggle .poi-icon {
            font-size: 0.9rem;
        }

        .poi-toggle .poi-count {
            background: rgba(255,255,255,0.2);
            padding: 1px 5px;
            border-radius: 8px;
            font-size: 0.65rem;
        }

        /* POI Markers on map */
        .poi-marker-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            font-size: 0.9rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            border: 2px solid white;
            transition: transform 0.2s;
        }

        .poi-marker-icon:hover {
            transform: scale(1.2);
        }

        .poi-marker-icon.campsite-free {
            background: #22c55e;
        }

        .poi-marker-icon.campsite-paid {
            background: #3b82f6;
        }

        .poi-marker-icon.fuel {
            background: #ef4444;
        }

        .poi-marker-icon.grocery {
            background: #f59e0b;
        }

        .poi-marker-icon.water {
            background: #06b6d4;
        }

        .poi-marker-icon.viewpoint {
            background: #8b5cf6;
        }

        .poi-marker-icon.rest-area {
            background: #6b7280;
        }

        .poi-marker-icon.mechanic {
            background: #dc2626;
        }

        /* POI Popup styling */
        .poi-popup {
            min-width: 200px;
        }

        .poi-popup-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }

        .poi-popup-icon {
            font-size: 1.5rem;
        }

        .poi-popup-title {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .poi-popup-type {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
        }

        .poi-popup-details {
            font-size: 0.8rem;
            color: #444;
        }

        .poi-popup-details p {
            margin: 4px 0;
        }

        .poi-popup-tip {
            margin-top: 8px;
            padding: 6px 8px;
            background: #f0f9ff;
            border-radius: 6px;
            font-size: 0.75rem;
            color: #0369a1;
        }

        .poi-popup-actions {
            margin-top: 10px;
            display: flex;
            gap: 6px;
        }

        .poi-popup-actions a {
            flex: 1;
            padding: 6px;
            text-align: center;
            background: #f3f4f6;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.75rem;
            color: #374151;
        }

        .poi-popup-actions a:hover {
            background: #e5e7eb;
        }

        /* Offline indicator */
        .offline-indicator {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            z-index: 1000;
            display: none;
        }

        .offline-indicator.visible {
            display: block;
        }

        /* POI Legend */
        .poi-legend {
            margin-top: 10px;
            padding-top: 8px;
            border-top: 1px solid var(--border-subtle);
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        /* Mode Tabs - Safari Style */
        .mode-tabs {
            display: flex;
            padding: 12px;
            gap: 8px;
            border-bottom: 2px solid rgba(212, 168, 75, 0.15);
            background: rgba(0, 0, 0, 0.2);
        }

        .mode-tab {
            flex: 1;
            padding: 12px 10px;
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'Georgia', serif;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            letter-spacing: 0.5px;
        }

        .mode-tab:hover {
            background: var(--bg-hover);
            color: var(--safari-cream);
            border-color: var(--safari-gold);
        }

        .mode-tab.active {
            background: linear-gradient(135deg, var(--safari-terracotta), var(--safari-rust));
            border-color: var(--safari-gold);
            color: var(--safari-cream);
            box-shadow: 0 4px 12px rgba(198, 93, 59, 0.3);
        }

        .mode-tab.serendipity.active {
            background: linear-gradient(135deg, var(--safari-terracotta), var(--safari-gold));
            border-color: var(--safari-gold);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            background: transparent;
        }

        .sidebar-merged .sidebar-block {
            margin-bottom: 20px;
        }

        .sidebar-merged .section-title-index {
            font-size: 0.85rem;
            margin-bottom: 12px;
        }

        .sidebar-merged .section-title-index::before {
            content: none;
        }

        .sidebar-content::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-content::-webkit-scrollbar-thumb {
            background: var(--bg-hover);
            border-radius: 3px;
        }

        /* Section */
        .section {
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-secondary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-subtle);
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: none;
        }

        /* Stats – glassmorphic cards */
        .travel-stats {
            background: rgba(255, 255, 255, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.30);
            border-radius: 16px;
            padding: 14px;
            margin-bottom: 12px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            backdrop-filter: blur(8px);
        }

        .stat-box {
            text-align: center;
            padding: 8px 4px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.40);
        }

        .stat-box .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-box .stat-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.04em;
        }

        /* Buttons – Modern rounded with smooth transitions */
        .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 11px 18px;
            border: 1px solid transparent;
            border-radius: 14px;
            font-family: 'Inter', system-ui, sans-serif;
            font-size: 0.82rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.01em;
        }

        .btn-primary {
            background: var(--brand-orange);
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 10px rgba(224, 122, 95, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(224, 122, 95, 0.35);
            background: var(--brand-orange-dark);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.60);
            border: 1px solid rgba(0, 0, 0, 0.08);
            color: var(--text-primary);
            backdrop-filter: blur(8px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.85);
            border-color: rgba(0, 0, 0, 0.12);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .btn-serendipity {
            background: var(--brand-orange);
            color: white;
            font-weight: 600;
            border-color: transparent;
            box-shadow: 0 2px 12px rgba(224, 122, 95, 0.25);
        }

        .btn-serendipity:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(224, 122, 95, 0.35);
            background: var(--brand-orange-dark);
        }

        .btn-group {
            display: flex;
            gap: 8px;
        }

        .btn-group .btn {
            flex: 1;
        }

        /* Selected Display */
        .selected-display {
            background: rgba(255, 255, 255, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.30);
            border-radius: 14px;
            padding: 14px;
            margin-bottom: 16px;
            backdrop-filter: blur(8px);
        }

        .selected-display.has-selection {
            border-color: rgba(224, 122, 95, 0.3);
            box-shadow: 0 4px 16px rgba(224, 122, 95, 0.08);
        }

        .selected-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .selected-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Search */
        .search-select {
            width: 100%;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.60);
            border: 1px solid rgba(0, 0, 0, 0.06);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'Inter', system-ui, sans-serif;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .search-select:focus {
            outline: none;
            border-color: rgba(224, 122, 95, 0.4);
            box-shadow: 0 0 0 3px rgba(224, 122, 95, 0.1);
        }

        /* Map Container – full width, sidebar floats above it */
        .map-container {
            flex: 1;
            width: 100%;
            position: relative;
            background: #0a0a0c;
            overflow: hidden;
        }

        #worldMap {
            width: 100%;
            height: 100%;
            cursor: grab;
            display: block;
            background: #0a0a0c;
        }

        #worldMap:active {
            cursor: grabbing;
        }

        #worldMap path {
            stroke-width: 0.5;
            transition: fill 0.2s, stroke 0.2s, filter 0.15s;
        }

        #worldMap path.road-trip-country {
            fill: #22c55e;
            stroke: #E07A5F;
            stroke-width: 1.2;
        }

        #worldMap path:not(.road-trip-country) {
            stroke: rgba(100, 100, 120, 0.4);
        }

        #worldMap path:hover {
            stroke: var(--accent-primary);
            stroke-width: 1.5;
            filter: brightness(1.25);
            cursor: pointer;
        }

        #worldMap path.road-trip-country:hover {
            stroke: #f0b84a;
            stroke-width: 2;
            filter: brightness(1.15);
        }

        #worldMap path.selected {
            stroke: var(--accent-secondary);
            stroke-width: 2;
            filter: drop-shadow(0 0 8px var(--accent-glow));
        }

        /* Leaflet Road Map */
        #roadMap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            background: #1a1a2e;
        }

        #roadMap.active {
            display: block;
        }

        .leaflet-container {
            background: var(--bg-dark-true);
            font-family: 'DM Sans', sans-serif;
        }

        /* Route lines and markers: clear pointer for clickable map elements */
        .leaflet-interactive {
            cursor: pointer;
        }

        /* Leaflet control styling */
        .leaflet-control-layers {
            background: var(--bg-panel) !important;
            border: 1px solid var(--border-subtle) !important;
            border-radius: 10px !important;
            color: var(--text-primary) !important;
        }

        .leaflet-control-layers-expanded {
            padding: 10px 14px !important;
        }

        .leaflet-control-layers label {
            color: var(--text-primary) !important;
            font-size: 0.85rem;
        }

        .leaflet-popup-content-wrapper {
            background: var(--glass-bg-heavy) !important;
            backdrop-filter: blur(var(--glass-blur)) !important;
            border-radius: 16px !important;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15) !important;
            border: 1px solid var(--glass-border) !important;
        }

        .leaflet-popup-content {
            color: var(--text-primary) !important;
            margin: 12px 14px !important;
            font-family: 'Inter', system-ui, sans-serif !important;
        }

        .leaflet-popup-tip {
            background: var(--glass-bg-heavy) !important;
        }

        .leaflet-control-attribution {
            background: rgba(21, 21, 32, 0.8) !important;
            color: var(--text-muted) !important;
            font-size: 0.65rem !important;
        }

        .leaflet-control-attribution a {
            color: var(--accent-secondary) !important;
        }

        /* Route Tooltip */
        .route-tooltip {
            background: var(--bg-panel) !important;
            border: 1px solid var(--border-subtle) !important;
            border-radius: 10px !important;
            padding: 8px 12px !important;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4) !important;
            font-family: inherit !important;
            color: var(--text-primary) !important;
        }

        .route-tooltip::before {
            border-top-color: var(--bg-panel) !important;
        }

        .leaflet-tooltip-left.route-tooltip::before {
            border-left-color: var(--bg-panel) !important;
        }

        .leaflet-tooltip-right.route-tooltip::before {
            border-right-color: var(--bg-panel) !important;
        }

        /* Zoom Controls – glassmorphic */
        .zoom-controls {
            position: absolute;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 4px;
            z-index: 50;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .zoom-btn:hover {
            background: var(--glass-bg-heavy);
            border-color: rgba(224, 122, 95, 0.3);
            color: var(--brand-orange);
            transform: scale(1.05);
        }

        /* ==================== MERGED SIDEBAR (Map + Road Trips) ==================== */
        .road-trip-card {
            background: rgba(255, 255, 255, 0.55);
            border: 1px solid rgba(255, 255, 255, 0.35);
            border-left: 3px solid var(--brand-orange);
            border-radius: 14px;
            padding: 14px 16px;
            min-height: 68px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(8px);
        }

        .road-trip-card::before {
            content: none;
        }

        .road-trip-card:hover {
            background: rgba(255, 255, 255, 0.80);
            border-color: rgba(224, 122, 95, 0.25);
            border-left-color: var(--brand-orange);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
        }

        .road-trip-card.active {
            background: rgba(224, 122, 95, 0.08);
            border-color: rgba(224, 122, 95, 0.25);
            border-left-color: var(--brand-orange);
            box-shadow: 0 4px 16px rgba(224, 122, 95, 0.1);
        }

        .road-trip-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .road-trip-icon {
            font-size: 1.5rem;
        }

        .road-trip-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .road-trip-meta {
            display: flex;
            gap: 12px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .road-trip-meta span {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .road-trip-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .road-tag {
            padding: 4px 10px;
            background: var(--bg-dark);
            border-radius: 12px;
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .road-tag.toll-free { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .road-tag.scenic { background: rgba(99, 102, 241, 0.2); color: #818cf8; }
        .road-tag.adventure { background: rgba(249, 115, 22, 0.2); color: #f97316; }
        .road-tag.camping { background: rgba(20, 184, 166, 0.2); color: #14b8a6; }
        .road-tag.fourx4 { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .road-tag.wildlife { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .road-tag.historic { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .road-tag.epic { background: rgba(236, 72, 153, 0.2); color: #ec4899; }
        .road-tag.community { background: rgba(244, 114, 182, 0.2); color: #f472b6; }

        /* Enhanced Road Trip Card */
        .road-trip-card {
            position: relative;
            transition: all 0.3s ease;
        }

        .road-trip-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(45, 62, 51, 0.12);
        }

        .road-trip-rating {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            color: var(--brand-orange);
            margin-top: 6px;
        }

        .road-trip-rating .rating-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .difficulty-badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 500;
            margin-left: 8px;
        }

        .difficulty-badge.easy { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .difficulty-badge.moderate { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .difficulty-badge.challenging { background: rgba(249, 115, 22, 0.2); color: #f97316; }
        .difficulty-badge.extreme { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

        .view-details-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 6px 12px;
            font-size: 0.7rem;
            background: var(--accent-primary);
            color: var(--srndipity-dark);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
        }

        .road-trip-card:hover .view-details-btn {
            opacity: 1;
        }

        /* Trip Fullscreen Modal – light background for accessibility */
        .trip-fullscreen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #f8fafc;
            z-index: 10000;
            display: none;
            flex-direction: column;
            overflow: hidden;
        }

        .trip-fullscreen-modal.active {
            display: flex;
        }

        /* Hero Header – Safari palette */
        .trip-hero {
            position: relative;
            min-height: 260px;
            background: linear-gradient(135deg, var(--srndipity-olive-dark) 0%, var(--srndipity-olive) 35%, var(--srndipity-orange) 100%);
            display: flex;
            align-items: flex-end;
            padding: 32px 48px;
            overflow: hidden;
        }

        .trip-hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.3) 50%, rgba(0,0,0,0.15) 100%);
            z-index: 1;
        }

        .trip-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.35);
            backdrop-filter: blur(10px);
            border: 1px solid var(--safari-gold);
            color: var(--safari-cream);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 10;
        }

        .trip-close-btn:hover {
            background: var(--safari-terracotta);
            border-color: var(--safari-cream);
        }

        .trip-hero-content {
            position: relative;
            z-index: 3;
        }

        .trip-hero-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 72px;
            height: 72px;
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid var(--safari-gold);
            border-radius: 16px;
            margin-bottom: 14px;
        }

        .hero-icon {
            font-size: 2.5rem;
        }

        .trip-hero-title {
            font-size: 2.2rem;
            font-weight: 700;
            color: #ffffff;
            margin: 0 0 10px 0;
            font-family: 'Inter', system-ui, sans-serif;
            letter-spacing: -0.02em;
            text-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .trip-hero-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 10px;
        }

        .hero-meta-divider {
            opacity: 0.6;
        }

        .trip-hero-rating {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 14px;
        }

        .hero-stars {
            font-size: 1rem;
            color: #fbbf24;
        }

        .hero-rating-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #fcd34d;
        }

        .hero-reviews-count {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.85rem;
        }

        .trip-hero-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .trip-hero-tags .tag {
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--safari-gold);
            border-radius: 20px;
            color: var(--safari-cream);
            font-size: 0.78rem;
            font-weight: 500;
        }

        /* Navigation Tabs – light, high contrast */
        .trip-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 48px;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
        }

        .trip-nav-tabs {
            display: flex;
            gap: 0;
        }

        .trip-nav-tab {
            padding: 16px 24px;
            background: none;
            border: none;
            color: #64748b;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.25s ease;
            font-family: 'Inter', system-ui, sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .trip-nav-tab:hover {
            color: #0f172a;
            background: #f8fafc;
        }

        .trip-nav-tab.active {
            color: var(--brand-orange);
            border-bottom-color: var(--brand-orange);
            font-weight: 600;
        }

        .trip-nav-actions {
            display: flex;
            gap: 8px;
        }

        .trip-action-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: #f1f5f9;
            border: 1px solid #e2e8f0;
            color: #475569;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .trip-action-btn:hover {
            background: var(--brand-orange);
            color: #ffffff;
            border-color: var(--brand-orange);
        }

        /* Tab Content – light bg, high contrast text */
        .trip-content-container {
            flex: 1;
            overflow-y: auto;
            padding: 32px 60px;
            background: #f8fafc;
            transition: padding 0.4s cubic-bezier(.4,0,.2,1);
        }

        /* Dynamic layout: fullwidth mode for non-overview tabs */
        .trip-content-container.fullwidth-mode {
            padding: 24px 32px;
        }
        .trip-content-container.fullwidth-mode .trip-grid {
            grid-template-columns: 1fr;
            max-width: 1100px;
            margin: 0 auto;
        }

        /* ===== ROUTE FULLSCREEN MODE ===== */
        /* Hero collapses */
        .trip-fullscreen-modal.route-active .trip-hero {
            max-height: 0;
            min-height: 0;
            padding: 0;
            overflow: hidden;
            opacity: 0;
            pointer-events: none;
            transition: max-height 0.45s cubic-bezier(.4,0,.2,1),
                        min-height 0.45s cubic-bezier(.4,0,.2,1),
                        padding 0.45s cubic-bezier(.4,0,.2,1),
                        opacity 0.3s ease;
        }
        /* Content takes all space, zero padding */
        .trip-fullscreen-modal.route-active .trip-content-container {
            padding: 0;
            overflow: hidden;
        }
        /* Route layout fills entire container */
        .trip-fullscreen-modal.route-active .route-tab-layout {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 0;
        }
        /* Map section grows to fill all available space */
        .trip-fullscreen-modal.route-active .route-map-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        .trip-fullscreen-modal.route-active .route-map-header {
            flex-shrink: 0;
            border-radius: 0;
            padding: 10px 20px;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
        }
        .trip-fullscreen-modal.route-active .route-map-section {
            border-radius: 0;
            border: none;
            border-left: none;
        }
        .trip-fullscreen-modal.route-active .route-map-container {
            flex: 1;
            height: auto;
            min-height: 0;
            border-radius: 0;
        }
        .trip-fullscreen-modal.route-active .route-map-legend {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(8px);
            z-index: 800;
            padding: 8px 20px;
            border-top: 1px solid rgba(0,0,0,0.06);
        }
        /* Hide issues and waypoints in fullscreen route */
        .trip-fullscreen-modal.route-active .route-issues-card,
        .trip-fullscreen-modal.route-active .route-card {
            display: none;
        }

        /* ===== ROUTE VARIANTS SYSTEM ===== */
        .variant-bar {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            background: #ffffff;
            border-bottom: 1px solid #e2e8f0;
            flex-shrink: 0;
            flex-wrap: wrap;
        }
        .variant-bar-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            white-space: nowrap;
        }
        .variant-chips {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        .variant-chip {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 14px;
            border-radius: 20px;
            border: 1.5px solid #e2e8f0;
            background: #f8fafc;
            color: #475569;
            font-size: 0.78rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.25s ease;
            font-family: 'Inter', system-ui, sans-serif;
        }
        .variant-chip:hover {
            border-color: #E07A5F;
            color: #E07A5F;
            background: rgba(224,122,95,0.06);
        }
        .variant-chip.active {
            background: linear-gradient(135deg, #E07A5F, #d4694e);
            color: #ffffff;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(224,122,95,0.3);
        }
        .variant-chip .chip-days {
            font-weight: 700;
        }
        .variant-chip .chip-votes {
            font-size: 0.65rem;
            opacity: 0.8;
            display: inline-flex;
            align-items: center;
            gap: 2px;
        }
        .variant-community-switcher {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .variant-community-select {
            padding: 5px 10px;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            font-size: 0.78rem;
            color: #475569;
            font-family: inherit;
            cursor: pointer;
        }
        .variant-community-select:focus {
            outline: none;
            border-color: #E07A5F;
        }
        /* Variant info strip below chips */
        .variant-info-strip {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 8px 20px;
            background: #f8fafc;
            border-bottom: 1px solid #f1f5f9;
            font-size: 0.78rem;
            color: #64748b;
            flex-shrink: 0;
        }
        .variant-info-strip .vi-label {
            font-weight: 600;
            color: #0f172a;
        }
        .variant-info-strip .vi-stat {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .variant-upvote-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 16px;
            border: 1px solid #e2e8f0;
            background: #ffffff;
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-left: auto;
        }
        .variant-upvote-btn:hover {
            border-color: #22c55e;
            color: #22c55e;
            background: rgba(34,197,94,0.06);
        }
        .variant-upvote-btn.upvoted {
            background: #22c55e;
            color: #ffffff;
            border-color: #22c55e;
        }
        /* Ghost route (master route faded when variant active) */
        .leaflet-ghost-route {
            opacity: 0.2 !important;
            stroke-dasharray: 8, 6;
        }
        /* Tab content fills all space in route mode */
        .trip-fullscreen-modal.route-active #tab-route {
            height: 100%;
            display: flex !important;
            flex-direction: column;
        }

        /* Restore hero transition when leaving route */
        .trip-hero {
            transition: max-height 0.45s cubic-bezier(.4,0,.2,1),
                        min-height 0.45s cubic-bezier(.4,0,.2,1),
                        padding 0.45s cubic-bezier(.4,0,.2,1),
                        opacity 0.35s ease;
        }

        .trip-tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .trip-tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Fuel & Grocery Stops */
        .stop-card {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 3px solid var(--accent-primary);
        }

        .stop-card.fuel { border-left-color: #ef4444; }
        .stop-card.grocery { border-left-color: #22c55e; }

        .stop-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }

        .stop-info {
            flex: 1;
        }

        .stop-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .stop-location {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .stop-distance {
            font-size: 0.7rem;
            color: var(--accent-primary);
            margin-top: 2px;
        }

        .stop-tip {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 4px;
            padding: 4px 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        /* Community Tips */
        .community-tip-card {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-subtle);
        }

        .community-tip-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .community-tip-source {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .community-tip-source img {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .community-tip-platform {
            font-size: 0.75rem;
            color: var(--accent-primary);
            font-weight: 600;
        }

        .community-tip-user {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .community-tip-upvotes {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.75rem;
            color: #f59e0b;
        }

        .community-tip-text {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--text-primary);
        }

        /* Warnings */
        .warning-card {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: rgba(239, 68, 68, 0.08);
            border: 1px solid rgba(239, 68, 68, 0.25);
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: #b91c1c;
        }

        /* Best Time Card */
        .best-time-card {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(34, 197, 94, 0.05));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }

        .best-time-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .best-time-header h4 {
            color: #22c55e;
            font-size: 1rem;
            margin: 0;
        }

        .month-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
        }

        .month-chip {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .month-chip.ideal {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .month-chip.avoid {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .best-time-reason {
            font-size: 0.85rem;
            color: #475569;
            line-height: 1.5;
        }

        .events-list {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-subtle);
        }

        .events-list h5 {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .event-item {
            font-size: 0.8rem;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        /* Trip Selection Modal */
        .trip-selection-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10005;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .trip-selection-overlay.active {
            display: flex;
        }

        .trip-selection-modal {
            background: var(--bg-panel);
            border-radius: 16px;
            padding: 24px;
            max-width: 400px;
            width: 90vw;
        }

        .trip-selection-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            text-align: center;
        }

        .trip-selection-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .trip-selection-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .trip-selection-item:hover {
            border-color: var(--accent-primary);
            background: var(--bg-hover);
        }

        .trip-selection-icon {
            font-size: 1.5rem;
        }

        .trip-selection-info h4 {
            font-size: 0.95rem;
            margin: 0 0 2px 0;
        }

        .trip-selection-info p {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin: 0;
        }

        /* ==================== VANLIFE COMMUNITY FEATURES ==================== */
        
        /* Offline Map Download */
        .offline-download-card {
            background: linear-gradient(135deg, #1e3a5f, #0d2137);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .offline-download-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .offline-download-header h3 {
            margin: 0;
            font-size: 1.1rem;
            color: #60a5fa;
        }

        .offline-download-info {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
            line-height: 1.5;
        }

        .offline-download-includes {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .offline-include-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.75rem;
        }

        .download-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .download-btn.downloaded {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }

        .download-progress {
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            margin-top: 12px;
            overflow: hidden;
        }

        .download-progress-bar {
            height: 100%;
            background: #60a5fa;
            border-radius: 2px;
            transition: width 0.3s;
        }

        /* Campsite Booking */
        .campsite-booking-card {
            background: var(--bg-elevated);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 12px;
            border: 1px solid var(--border-subtle);
        }

        .campsite-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            background: linear-gradient(135deg, #2d4a3e, #1a2f26);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .campsite-info {
            padding: 12px;
        }

        .campsite-name {
            font-weight: 600;
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .campsite-location {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .campsite-features {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 10px;
        }

        .campsite-feature {
            font-size: 0.65rem;
            padding: 2px 6px;
            background: var(--bg-dark);
            border-radius: 4px;
            color: var(--text-muted);
        }

        .campsite-price {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .campsite-price-value {
            font-weight: 600;
            color: #22c55e;
        }

        .campsite-book-btn {
            padding: 6px 12px;
            background: var(--accent-primary);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .campsite-book-btn:hover {
            background: var(--accent-secondary);
        }

        /* Community Forum */
        .forum-section {
            margin-top: 24px;
        }

        .forum-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .forum-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .forum-stats {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .new-post-btn {
            padding: 8px 16px;
            background: var(--accent-primary);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .forum-filters {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .forum-filter {
            padding: 6px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }

        .forum-filter:hover,
        .forum-filter.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        /* Forum Post */
        .forum-post {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border-subtle);
        }

        .forum-post-header {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
        }

        .forum-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .forum-post-meta {
            flex: 1;
        }

        .forum-username {
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .forum-badge {
            font-size: 0.6rem;
            padding: 2px 6px;
            background: rgba(224, 122, 57, 0.2);
            color: var(--accent-primary);
            border-radius: 4px;
        }

        .forum-timestamp {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .forum-post-type {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .forum-post-type.question { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .forum-post-type.tip { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .forum-post-type.photo { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .forum-post-type.warning { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .forum-post-type.campsite { background: rgba(34, 197, 94, 0.2); color: #22c55e; }

        .forum-post-content {
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 12px;
        }

        /* Photo Gallery in Posts */
        .forum-photos {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            margin-bottom: 12px;
        }

        .forum-photo {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .forum-photo:hover {
            transform: scale(1.05);
        }

        .forum-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .forum-post-actions {
            display: flex;
            align-items: center;
            gap: 16px;
            padding-top: 12px;
            border-top: 1px solid var(--border-subtle);
        }

        .forum-action {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.8rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: color 0.2s;
        }

        .forum-action:hover {
            color: var(--accent-primary);
        }

        .forum-action.liked {
            color: #ef4444;
        }

        /* Create Post Modal */
        .create-post-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10006;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .create-post-modal.active {
            display: flex;
        }

        .create-post-form {
            background: var(--bg-panel);
            border-radius: 16px;
            width: 90vw;
            max-width: 550px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .create-post-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .create-post-header h3 {
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .create-post-body {
            padding: 20px;
        }

        .post-type-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }

        .post-type-option {
            padding: 8px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .post-type-option:hover,
        .post-type-option.selected {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .post-textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.9rem;
            resize: vertical;
            margin-bottom: 16px;
        }

        .post-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .photo-upload-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 16px;
        }

        .photo-upload-slot {
            aspect-ratio: 1;
            border: 2px dashed var(--border-subtle);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            overflow: hidden;
        }

        .photo-upload-slot:hover {
            border-color: var(--accent-primary);
            background: var(--bg-hover);
        }

        .photo-upload-slot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-upload-slot .add-icon {
            font-size: 1.5rem;
            color: var(--text-muted);
        }

        .location-tag-input {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .location-tag-input input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 0.85rem;
        }

        .location-tag-input input:focus {
            outline: none;
        }

        /* Saved Offline Maps */
        .saved-maps-section {
            margin-top: 20px;
        }

        .saved-map-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .saved-map-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .saved-map-info {
            flex: 1;
        }

        .saved-map-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .saved-map-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .saved-map-actions {
            display: flex;
            gap: 8px;
        }

        .saved-map-btn {
            padding: 6px 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
        }

        .saved-map-btn:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .saved-map-btn.delete:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        /* Grid Layouts */
        .trip-grid {
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 32px;
            transition: grid-template-columns 0.35s ease;
        }

        .trip-main-col, .trip-side-col {
            display: flex;
            flex-direction: column;
            gap: 24px;
            transition: opacity 0.35s ease, max-width 0.35s ease;
        }

        .trip-side-col.hidden-col {
            opacity: 0;
            max-width: 0;
            overflow: hidden;
            padding: 0;
            gap: 0;
        }

        /* Stats Row */
        .trip-stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        /* Stat cards – uniform modern style, high contrast */
        .trip-stat-card {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 20px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 14px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .trip-stat-card .stat-icon {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(224, 122, 95, 0.12);
            border-radius: 12px;
        }

        .trip-stat-card .stat-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: #0f172a;
        }

        .trip-stat-card .stat-label {
            font-size: 0.7rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 2px;
        }

        /* Trip Cards – light bg, clear contrast */
        .trip-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-left: 4px solid var(--accent-primary);
            border-radius: 14px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }

        .trip-card h3 {
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0 14px 0;
            color: #0f172a;
            font-family: 'Inter', system-ui, sans-serif;
        }

        .trip-card.warning-card {
            border-left-color: #f59e0b;
            background: #ffffff;
            border: 1px solid #fde68a;
        }

        .trip-card.recommendations-card {
            border-left-color: #22c55e;
            background: #ffffff;
            border: 1px solid #bbf7d0;
        }

        .trip-description {
            font-size: 1rem;
            line-height: 1.7;
            color: #475569;
        }

        /* Highlights */
        .trip-highlights {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .trip-highlights .highlight-tag {
            padding: 8px 14px;
            background: rgba(224, 122, 95, 0.12);
            border: 1px solid rgba(224, 122, 95, 0.3);
            border-radius: 20px;
            color: #0f172a;
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Must Know */
        .must-know-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .must-know-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 0.9rem;
            color: #475569;
        }

        .must-know-list li:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        /* Recommendations */
        .recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .recommendation-item {
            display: flex;
            gap: 14px;
            padding: 14px;
            background: #f1f5f9;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }

        .recommendation-item .rec-icon {
            font-size: 1.5rem;
        }

        .recommendation-item .rec-title {
            font-weight: 600;
            font-size: 0.9rem;
            color: #0f172a;
        }

        .recommendation-item .rec-desc {
            font-size: 0.8rem;
            color: #64748b;
        }

        /* Booking / Affiliate Links */
        .recommendation-item .rec-booking {
            margin-top: 8px;
        }
        .rec-booking-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            background: linear-gradient(135deg, #E07A5F, #d4694e);
            color: #ffffff;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 20px;
            text-decoration: none;
            transition: all 0.25s ease;
            border: none;
            cursor: pointer;
        }
        .rec-booking-link:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(224, 122, 95, 0.35);
        }
        .rec-booking-link svg, .rec-booking-link i {
            width: 12px;
            height: 12px;
        }
        .rec-affiliate-badge {
            display: inline-block;
            font-size: 0.6rem;
            color: #94a3b8;
            margin-left: 6px;
            font-style: italic;
        }

        /* Expert Local Card */
        /* ==================== BOOKING SECTION – PREMIUM DARK THEME ==================== */
        .bk-container {
            max-width: 1100px;
            margin: 0 auto;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        .bk-hero {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 28px 32px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            margin-bottom: 28px;
        }
        .bk-hero-icon {
            width: 56px; height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, #E07A5F, #d4694e);
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        .bk-hero h2 { margin: 0; font-size: 1.5rem; font-weight: 800; color: #f1f5f9; letter-spacing: -0.02em; }
        .bk-hero p { margin: 4px 0 0; font-size: 0.88rem; color: #94a3b8; }

        /* --- Category Tabs --- */
        .bk-tabs {
            display: flex;
            gap: 6px;
            margin-bottom: 24px;
            padding: 4px;
            background: #1e1e32;
            border-radius: 14px;
            overflow-x: auto;
        }
        .bk-tab {
            flex: 1;
            padding: 10px 16px;
            font-size: 0.78rem;
            font-weight: 600;
            color: #94a3b8;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.25s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            white-space: nowrap;
        }
        .bk-tab:hover { color: #e2e8f0; background: rgba(255,255,255,0.05); }
        .bk-tab.active {
            background: linear-gradient(135deg, #E07A5F, #d4694e);
            color: #fff;
            box-shadow: 0 4px 16px rgba(224, 122, 95, 0.3);
        }
        .bk-tab i, .bk-tab svg { width: 14px; height: 14px; }

        /* --- Section panels --- */
        .bk-section { display: none; }
        .bk-section.active { display: block; }

        /* --- Card Grid --- */
        .bk-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 640px) { .bk-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 960px) { .bk-grid { grid-template-columns: repeat(3, 1fr); } }

        /* --- The Card --- */
        .bk-card {
            background: #1e1e32;
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 18px;
            overflow: hidden;
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .bk-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.35), 0 0 0 1px rgba(224, 122, 95, 0.15);
            border-color: rgba(224, 122, 95, 0.2);
        }
        .bk-card.featured {
            border: 1.5px solid rgba(224, 122, 95, 0.4);
            box-shadow: 0 0 0 1px rgba(224, 122, 95, 0.08), 0 8px 30px rgba(224, 122, 95, 0.08);
        }
        .bk-card.featured:hover {
            box-shadow: 0 20px 50px rgba(224, 122, 95, 0.15), 0 0 0 1px rgba(224, 122, 95, 0.3);
        }

        /* --- Card Image Area --- */
        .bk-card-img {
            position: relative;
            height: 180px;
            overflow: hidden;
            background: #16213e;
        }
        .bk-card-img img {
            width: 100%; height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .bk-card:hover .bk-card-img img { transform: scale(1.08); }
        .bk-card-img::after {
            content: '';
            position: absolute; inset: 0;
            background: linear-gradient(0deg, rgba(30,30,50,0.7) 0%, transparent 60%);
            pointer-events: none;
        }
        .bk-card-img .bk-badge-row {
            position: absolute;
            top: 12px; left: 12px; right: 12px;
            display: flex;
            gap: 6px;
            z-index: 2;
            flex-wrap: wrap;
        }
        .bk-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            font-size: 0.62rem;
            font-weight: 700;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 0.04em;
            backdrop-filter: blur(8px);
        }
        .bk-badge.coup-coeur { background: rgba(239, 68, 68, 0.85); color: #fff; }
        .bk-badge.expert-local { background: rgba(34, 197, 94, 0.85); color: #fff; }
        .bk-badge.best-price { background: rgba(59, 130, 246, 0.85); color: #fff; }
        .bk-badge.sponsored { background: rgba(224, 122, 95, 0.9); color: #fff; }
        .bk-badge.new { background: rgba(139, 92, 246, 0.85); color: #fff; }
        .bk-badge i, .bk-badge svg { width: 10px; height: 10px; }

        .bk-card-price-tag {
            position: absolute;
            bottom: 12px; left: 12px;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(10px);
            color: #fff;
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 700;
            z-index: 2;
        }
        .bk-card-price-tag small {
            font-size: 0.6rem;
            font-weight: 400;
            color: #cbd5e1;
            margin-right: 2px;
        }

        .bk-card-wishlist {
            position: absolute;
            top: 12px; right: 12px;
            width: 34px; height: 34px;
            border-radius: 50%;
            background: rgba(0,0,0,0.45);
            backdrop-filter: blur(8px);
            border: none;
            color: #fff;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 3;
        }
        .bk-card-wishlist:hover { background: rgba(239, 68, 68, 0.7); transform: scale(1.1); }
        .bk-card-wishlist.saved { background: #ef4444; }

        /* --- Card Body --- */
        .bk-card-body {
            padding: 16px 18px 10px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .bk-card-title {
            font-size: 0.95rem;
            font-weight: 700;
            color: #f1f5f9;
            margin: 0 0 6px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .bk-card-desc {
            font-size: 0.78rem;
            color: #94a3b8;
            line-height: 1.5;
            margin: 0 0 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            flex: 1;
        }
        .bk-card-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }
        .bk-stars {
            display: flex;
            align-items: center;
            gap: 3px;
            font-size: 0.78rem;
            font-weight: 700;
            color: #fbbf24;
        }
        .bk-stars .bk-star-count {
            color: #94a3b8;
            font-weight: 400;
            font-size: 0.7rem;
            margin-left: 2px;
        }
        .bk-popularity {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.68rem;
            color: #ef4444;
            font-weight: 600;
        }
        .bk-popularity-dot {
            width: 6px; height: 6px;
            background: #ef4444;
            border-radius: 50%;
            animation: bk-pulse 1.5s infinite;
        }
        @keyframes bk-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* --- Pro Tip --- */
        .bk-protip {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.68rem;
            font-weight: 600;
            color: #E07A5F;
            cursor: pointer;
            padding: 4px 0;
            margin-bottom: 8px;
        }
        .bk-protip i, .bk-protip svg { width: 12px; height: 12px; }
        .bk-protip-bubble {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0; right: 0;
            background: #0f172a;
            border: 1px solid rgba(224, 122, 95, 0.25);
            color: #e2e8f0;
            font-size: 0.72rem;
            font-weight: 400;
            line-height: 1.45;
            padding: 10px 14px;
            border-radius: 12px;
            margin-bottom: 6px;
            z-index: 20;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            white-space: normal;
        }
        .bk-protip-bubble::after {
            content: '';
            position: absolute;
            bottom: -6px; left: 20px;
            width: 12px; height: 12px;
            background: #0f172a;
            border-right: 1px solid rgba(224, 122, 95, 0.25);
            border-bottom: 1px solid rgba(224, 122, 95, 0.25);
            transform: rotate(45deg);
        }
        .bk-protip:hover .bk-protip-bubble,
        .bk-protip.active .bk-protip-bubble { display: block; }

        /* --- Card Footer / CTA --- */
        .bk-card-footer {
            padding: 0 18px 16px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .bk-cta {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            padding: 11px 16px;
            font-size: 0.82rem;
            font-weight: 700;
            color: #fff;
            background: linear-gradient(135deg, #E07A5F, #c9684e);
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .bk-cta:hover {
            background: linear-gradient(135deg, #d4694e, #b85a40);
            box-shadow: 0 8px 24px rgba(224, 122, 95, 0.35);
            transform: translateY(-1px);
        }
        .bk-cta i, .bk-cta svg { width: 14px; height: 14px; }
        .bk-cta-secondary {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            padding: 9px 16px;
            font-size: 0.75rem;
            font-weight: 600;
            color: #94a3b8;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s ease;
            text-decoration: none;
        }
        .bk-cta-secondary:hover { background: rgba(255,255,255,0.08); color: #e2e8f0; border-color: rgba(255,255,255,0.15); }
        .bk-cta-secondary i, .bk-cta-secondary svg { width: 12px; height: 12px; }

        .bk-partner {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 0.62rem;
            color: #64748b;
            font-style: italic;
            padding-top: 2px;
        }
        .bk-partner-icon {
            width: 14px; height: 14px;
            border-radius: 3px;
            background: #fff;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.5rem; font-weight: 800; color: #1e293b;
        }

        /* --- Expert Card (full-width variant) --- */
        .bk-expert-card {
            grid-column: 1 / -1;
            display: flex;
            background: #1e1e32;
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 18px;
            overflow: hidden;
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .bk-expert-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 16px 40px rgba(0,0,0,0.3);
            border-color: rgba(34, 197, 94, 0.2);
        }
        .bk-expert-left {
            width: 260px;
            min-height: 220px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 24px;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            position: relative;
        }
        .bk-expert-avatar {
            width: 72px; height: 72px;
            border-radius: 50%;
            background: linear-gradient(135deg, #E07A5F, #d4694e);
            display: flex; align-items: center; justify-content: center;
            color: #fff;
            font-size: 1.5rem;
            font-weight: 800;
            border: 3px solid rgba(255,255,255,0.2);
        }
        .bk-expert-name {
            font-size: 1.05rem;
            font-weight: 700;
            color: #f1f5f9;
            text-align: center;
        }
        .bk-expert-specialty {
            font-size: 0.72rem;
            color: #94a3b8;
            text-align: center;
        }
        .bk-expert-right {
            flex: 1;
            padding: 22px 24px;
            display: flex;
            flex-direction: column;
            gap: 14px;
        }
        .bk-expert-desc {
            font-size: 0.82rem;
            color: #cbd5e1;
            line-height: 1.55;
        }
        .bk-expert-stats-row {
            display: flex;
            gap: 20px;
        }
        .bk-expert-stat {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.75rem;
            color: #94a3b8;
        }
        .bk-expert-stat strong { color: #f1f5f9; font-weight: 700; }
        .bk-expert-xps {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 4px;
        }
        .bk-expert-xp {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: 12px;
            flex: 1;
            min-width: 200px;
            transition: all 0.2s;
        }
        .bk-expert-xp:hover { background: rgba(255,255,255,0.07); border-color: rgba(224, 122, 95, 0.2); }
        .bk-expert-xp-icon {
            width: 36px; height: 36px;
            border-radius: 10px;
            background: rgba(224, 122, 95, 0.12);
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
        }
        .bk-expert-xp-name { font-size: 0.8rem; font-weight: 600; color: #f1f5f9; }
        .bk-expert-xp-detail { font-size: 0.68rem; color: #64748b; }
        .bk-expert-xp-price { font-size: 0.85rem; font-weight: 700; color: #E07A5F; margin-left: auto; white-space: nowrap; }
        .bk-expert-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
        }

        /* Responsive: expert card stacks on mobile */
        @media (max-width: 768px) {
            .bk-expert-card { flex-direction: column; }
            .bk-expert-left { width: 100%; min-height: auto; padding: 20px; flex-direction: row; gap: 16px; }
            .bk-expert-avatar { width: 56px; height: 56px; font-size: 1.2rem; }
            .bk-expert-xps { flex-direction: column; }
            .bk-expert-xp { min-width: unset; }
        }

        /* --- Copied Toast --- */
        .bk-toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1e1e32;
            color: #f1f5f9;
            padding: 12px 24px;
            border-radius: 14px;
            font-size: 0.82rem;
            font-weight: 600;
            box-shadow: 0 12px 40px rgba(0,0,0,0.5);
            border: 1px solid rgba(224, 122, 95, 0.25);
            z-index: 10000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
        }
        .bk-toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Packing List */
        .packing-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        /* Preparation Tab – visas, vaccines, legal */
        .preparation-layout {
            max-width: 900px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        .preparation-intro h3 {
            margin: 0 0 10px 0;
            font-size: 1.25rem;
        }
        .preparation-intro p {
            margin: 0;
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }
        .preparation-selector-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-left: 4px solid var(--accent-primary);
            border-radius: 12px;
            padding: 18px 20px;
        }
        .preparation-selector-card label {
            display: block;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        .preparation-select {
            width: 100%;
            max-width: 320px;
            padding: 10px 14px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            color: #1e293b;
            font-size: 0.95rem;
            font-family: inherit;
        }
        .preparation-select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        .preparation-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
        }
        .preparation-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            overflow: hidden;
        }
        .preparation-card h4 {
            margin: 0;
            padding: 14px 18px;
            font-size: 1rem;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-subtle);
        }
        .preparation-card-body {
            padding: 16px 18px;
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.55;
        }
        .preparation-card-body ul {
            margin: 0;
            padding-left: 18px;
        }
        .preparation-card-body li {
            margin-bottom: 6px;
        }
        .preparation-disclaimer {
            padding: 16px 20px;
            background: rgba(255, 188, 66, 0.08);
            border: 1px solid rgba(255, 188, 66, 0.25);
            border-radius: 12px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        .preparation-disclaimer p {
            margin: 0 0 12px 0;
        }
        .preparation-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .preparation-links a {
            color: var(--accent-primary);
            text-decoration: none;
            font-weight: 500;
        }
        .preparation-links a:hover {
            text-decoration: underline;
        }
        .prep-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        .prep-badge.ok { background: rgba(90, 112, 34, 0.3); color: #b8d44a; }
        .prep-badge.required { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .prep-badge.recommended { background: rgba(255, 188, 66, 0.25); color: var(--accent-primary); }

        .packing-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: #f1f5f9;
            border-radius: 10px;
            font-size: 0.85rem;
            color: #334155;
        }

        .packing-item.essential {
            border-left: 3px solid var(--warning);
        }

        /* Route Tab – map + issues + waypoints (tour-operator style: large precise map) */
        .route-tab-layout {
            display: flex;
            flex-direction: column;
            gap: 24px;
            max-width: none;
        }

        .route-map-section {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-left: 4px solid var(--accent-primary);
            border-radius: 12px;
            overflow: hidden;
            width: 100%;
        }

        .route-map-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
            padding: 16px 20px;
            background: var(--bg-panel);
            border-bottom: 1px solid var(--border-subtle);
        }

        .route-map-header h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .route-poi-toggles {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .route-poi-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .route-poi-btn:hover {
            border-color: var(--brand-forest);
            color: var(--text-primary);
        }

        .route-poi-btn.active {
            background: rgba(224, 122, 95, 0.12);
            border-color: var(--brand-orange);
            color: var(--brand-orange);
        }

        .route-map-container {
            position: relative;
            min-height: 72vh;
            height: 72vh;
            background: var(--bg-dark-true);
        }

        .trip-detail-map {
            width: 100%;
            height: 100%;
        }

        .route-map-legend {
            padding: 10px 20px;
            font-size: 0.8rem;
            color: var(--text-muted);
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
        }
        .route-map-legend span {
            white-space: nowrap;
        }

        .route-issues-card {
            margin: 0;
        }

        .route-issues-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .route-issues-list li {
            padding: 10px 0;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .route-issues-list li:last-child {
            border-bottom: none;
        }

        .route-card {
            max-width: 100%;
        }

        .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .route-header h3 {
            margin: 0;
        }

        .stops-count {
            padding: 6px 14px;
            background: var(--accent-primary);
            color: var(--srndipity-dark);
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .route-timeline {
            position: relative;
            padding-left: 40px;
        }

        .route-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, var(--accent-primary), var(--serendipity));
            border-radius: 2px;
        }

        .waypoint-item {
            position: relative;
            padding: 20px;
            margin-bottom: 16px;
            background: var(--bg-dark);
            border-radius: 12px;
        }

        .waypoint-item::before {
            content: '';
            position: absolute;
            left: -32px;
            top: 24px;
            width: 16px;
            height: 16px;
            background: var(--accent-primary);
            border: 3px solid var(--bg-elevated);
            border-radius: 50%;
        }

        .waypoint-name {
            font-weight: 600;
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .waypoint-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Budget Tab */
        .budget-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            max-width: 1000px;
        }

        .budget-breakdown, .budget-tips {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 28px;
        }

        .budget-breakdown h3, .budget-tips h3 {
            margin: 0 0 24px 0;
            font-size: 1.2rem;
        }

        .budget-items {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .budget-item {
            display: grid;
            grid-template-columns: 50px 1fr 120px;
            align-items: center;
            gap: 16px;
        }

        .budget-item-icon {
            font-size: 1.8rem;
        }

        .budget-item-label {
            font-size: 0.95rem;
            color: var(--text-secondary);
        }

        .budget-item-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--success);
            text-align: right;
        }

        .budget-item-bar {
            grid-column: 1 / -1;
            height: 6px;
            background: var(--bg-dark);
            border-radius: 3px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 3px;
        }

        .bar-fill.fuel { width: 25%; background: #f97316; }
        .bar-fill.tolls { width: 5%; background: #8b5cf6; }
        .bar-fill.accommodation { width: 45%; background: #3b82f6; }
        .bar-fill.food { width: 25%; background: #22c55e; }

        .budget-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            margin-top: 24px;
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(20, 184, 166, 0.2));
            border-radius: 12px;
            font-weight: 600;
        }

        .budget-total-value {
            font-size: 1.5rem;
            color: var(--success);
        }

        .budget-tips-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .budget-tip {
            padding: 14px 16px;
            background: var(--bg-dark);
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Planning Tab */
        .planning-steps-container {
            max-width: 800px;
        }

        .planning-steps-container h3 {
            margin-bottom: 24px;
        }

        .planning-timeline {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .planning-step {
            display: flex;
            gap: 20px;
            padding: 24px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
        }

        .step-number {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-primary), var(--serendipity));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .step-desc {
            font-size: 0.95rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Community Tab */
        .community-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
        }

        .community-reviews, .community-chat {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 24px;
        }

        .reviews-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .reviews-header h3 {
            margin: 0;
        }

        .reviews-summary {
            text-align: center;
        }

        .big-rating {
            font-size: 2.5rem;
            font-weight: 800;
            color: #fbbf24;
        }

        .reviews-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .review-item {
            padding: 16px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .review-user {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .review-rating {
            color: #fbbf24;
        }

        .review-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .review-date {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .add-review-box {
            padding: 20px;
            background: var(--bg-dark);
            border-radius: 12px;
        }

        .add-review-box h4 {
            margin: 0 0 12px 0;
            font-size: 0.95rem;
        }

        .rating-input {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .rating-star {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .rating-star:hover, .rating-star.active {
            color: #fbbf24;
        }

        .review-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 0.9rem;
            resize: none;
            height: 80px;
            margin-bottom: 12px;
        }

        .review-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .submit-review-btn {
            width: 100%;
            padding: 12px;
            background: var(--accent-primary);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .submit-review-btn:hover {
            background: var(--accent-secondary);
        }

        /* Chat in Community */
        .chat-container {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .chat-header h3 {
            margin: 0;
        }

        .online-badge {
            padding: 6px 12px;
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .chat-messages {
            flex: 1;
            max-height: 280px;
            overflow-y: auto;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .chat-message {
            padding: 12px 14px;
            margin-bottom: 10px;
            background: var(--bg-elevated);
            border-radius: 12px;
            border-left: 3px solid var(--border-subtle);
        }

        .chat-message.question { border-left-color: var(--accent-primary); }
        .chat-message.tip { border-left-color: var(--success); }
        .chat-message.experience { border-left-color: var(--warning); }

        .chat-msg-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .chat-msg-user {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--accent-primary);
        }

        .chat-msg-badge {
            font-size: 0.65rem;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--bg-dark);
        }

        .chat-msg-badge.verified { background: var(--success); color: white; }
        .chat-msg-badge.expert { background: var(--warning); color: var(--bg-dark); }

        .chat-msg-text {
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .chat-msg-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .chat-msg-reactions {
            display: flex;
            gap: 8px;
        }

        .chat-reaction {
            cursor: pointer;
            padding: 2px 8px;
            background: var(--bg-dark);
            border-radius: 10px;
            transition: all 0.2s;
        }

        .chat-reaction:hover {
            background: rgba(99, 102, 241, 0.3);
        }

        .chat-replies {
            margin-top: 10px;
            padding-left: 12px;
            border-left: 2px solid var(--border-subtle);
        }

        .chat-reply {
            padding: 8px 12px;
            margin-top: 8px;
            background: var(--bg-dark);
            border-radius: 8px;
            font-size: 0.85rem;
        }

        .chat-input-section {
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 12px;
        }

        .chat-type-pills {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .chat-pill {
            flex: 1;
            padding: 8px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-pill:hover {
            border-color: var(--accent-primary);
        }

        .chat-pill.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .chat-input-row {
            display: flex;
            gap: 10px;
        }

        .chat-text-input {
            flex: 1;
            padding: 12px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 25px;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .chat-text-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .chat-submit-btn {
            padding: 12px 24px;
            background: var(--accent-primary);
            border: none;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-submit-btn:hover {
            background: var(--accent-secondary);
        }

        .highlight-tag {
            padding: 8px 14px;
            background: linear-gradient(135deg, var(--accent-primary), var(--serendipity));
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .waypoints-timeline {
            position: relative;
            padding-left: 30px;
        }

        .waypoints-timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--accent-primary), var(--serendipity));
        }

        .waypoint-item {
            position: relative;
            padding: 12px 0;
            padding-left: 20px;
        }

        .waypoint-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--accent-primary);
            border-radius: 50%;
            border: 2px solid var(--bg-panel);
        }

        .waypoint-item:first-child::before { background: #22c55e; }
        .waypoint-item:last-child::before { background: #ef4444; }

        .waypoint-name {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .waypoint-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 2px;
        }

        /* Reviews */
        .reviews-section {
            flex: 1;
            margin-bottom: 16px;
        }

        .reviews-section h4 {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .reviews-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .review-item {
            padding: 14px;
            background: var(--bg-dark);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .review-item.owner-review {
            border-left: 3px solid var(--success);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), transparent);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .review-user {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .review-rating {
            color: #fbbf24;
            font-size: 0.8rem;
        }

        .review-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .review-date {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 8px;
        }

        .add-review-section {
            background: var(--bg-dark);
            border-radius: 10px;
            padding: 14px;
            margin-top: 16px;
        }

        .add-review-section h5 {
            font-size: 0.85rem;
            margin-bottom: 10px;
        }

        .rating-input {
            display: flex;
            gap: 4px;
            margin-bottom: 10px;
        }

        .rating-star {
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.2s;
        }

        .rating-star:hover,
        .rating-star.active {
            color: #fbbf24;
        }

        .trip-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn-success {
            background: var(--success);
            color: white;
            border: none;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        /* Cost Section */
        .cost-section {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(20, 184, 166, 0.1));
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 12px;
            padding: 16px;
        }

        .cost-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 16px;
        }

        .cost-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 10px;
        }

        .cost-icon {
            font-size: 1.5rem;
        }

        .cost-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .cost-value {
            font-size: 1rem;
            font-weight: 700;
            color: var(--success);
        }

        .cost-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-dark);
            border-radius: 10px;
            font-weight: 600;
        }

        .total-value {
            font-size: 1.2rem;
            color: var(--success);
        }

        /* Planning Section */
        .planning-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 16px;
        }

        .planning-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .planning-step {
            display: flex;
            gap: 14px;
            padding: 14px;
            background: var(--bg-dark);
            border-radius: 10px;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: var(--accent-primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .step-content {
            flex: 1;
        }

        .step-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 4px;
        }

        .step-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Recommendations Section */
        .recommendations-section {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(249, 115, 22, 0.1));
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 12px;
            padding: 16px;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .recommendation-card {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 12px;
            background: var(--bg-dark);
            border-radius: 10px;
        }

        .recommendation-icon {
            font-size: 1.3rem;
        }

        .recommendation-content {
            flex: 1;
        }

        .recommendation-title {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 2px;
        }

        .recommendation-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Packing Section */
        .packing-section {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 16px;
        }

        .packing-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .packing-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: var(--bg-dark);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .packing-item.essential {
            border-left: 3px solid var(--warning);
        }

        /* Double-click hint */
        .dblclick-hint {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-align: center;
            margin-top: 8px;
            font-style: italic;
        }

        /* Trip Chat Section */
        .trip-chat-section {
            background: var(--bg-dark);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-top: 16px;
            overflow: hidden;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
            border-bottom: 1px solid var(--border-subtle);
        }

        .chat-header h4 {
            margin: 0;
            font-size: 0.9rem;
        }

        .online-count {
            font-size: 0.75rem;
            color: var(--success);
        }

        .chat-messages {
            height: 280px;
            overflow-y: auto;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .chat-message {
            padding: 10px 12px;
            border-radius: 12px;
            background: var(--bg-elevated);
            max-width: 90%;
        }

        .chat-message.question {
            border-left: 3px solid var(--accent-primary);
        }

        .chat-message.tip {
            border-left: 3px solid var(--success);
            background: rgba(34, 197, 94, 0.1);
        }

        .chat-message.experience {
            border-left: 3px solid var(--warning);
            background: rgba(251, 191, 36, 0.1);
        }

        .chat-message.own {
            margin-left: auto;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2));
        }

        .chat-msg-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .chat-msg-user {
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--accent-primary);
        }

        .chat-msg-badge {
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 8px;
            background: var(--bg-dark);
        }

        .chat-msg-badge.verified {
            background: var(--success);
            color: white;
        }

        .chat-msg-badge.expert {
            background: var(--warning);
            color: var(--bg-dark);
        }

        .chat-msg-text {
            font-size: 0.85rem;
            line-height: 1.5;
            color: var(--text-primary);
        }

        .chat-msg-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .chat-msg-reactions {
            display: flex;
            gap: 8px;
        }

        .chat-reaction {
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 10px;
            background: var(--bg-dark);
            transition: all 0.2s;
        }

        .chat-reaction:hover {
            background: var(--bg-elevated);
            transform: scale(1.1);
        }

        .chat-reaction.active {
            background: rgba(99, 102, 241, 0.3);
        }

        .chat-reply-btn {
            cursor: pointer;
            color: var(--accent-primary);
        }

        .chat-reply-btn:hover {
            text-decoration: underline;
        }

        .chat-replies {
            margin-top: 10px;
            padding-left: 12px;
            border-left: 2px solid var(--border-subtle);
        }

        .chat-reply {
            padding: 6px 10px;
            margin-top: 6px;
            background: var(--bg-dark);
            border-radius: 8px;
            font-size: 0.8rem;
        }

        .chat-input-area {
            padding: 12px;
            border-top: 1px solid var(--border-subtle);
            background: var(--bg-elevated);
        }

        .chat-type-selector {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
        }

        .chat-type-btn {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-dark);
            color: var(--text-secondary);
            border-radius: 8px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-type-btn:hover {
            border-color: var(--accent-primary);
        }

        .chat-type-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 8px;
        }

        .chat-input {
            flex: 1;
            padding: 10px 14px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-dark);
            color: var(--text-primary);
            border-radius: 20px;
            font-size: 0.85rem;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .chat-send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-primary);
            border: none;
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chat-send-btn:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
        }

        .road-trip-card.personal {
            border-left: 3px solid var(--success);
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.05), transparent);
        }

        .personal-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            margin-left: 8px;
        }

        /* Rental Provider Card */
        .rental-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .rental-card:hover {
            border-color: var(--accent-primary);
        }

        .rental-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        }

        .rental-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .rental-name a {
            color: var(--accent-secondary);
            text-decoration: none;
        }

        .rental-name a:hover {
            text-decoration: underline;
        }

        .rental-rating {
            font-size: 0.75rem;
        }

        .rental-note {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Camping Site Card */
        .camping-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .camping-card:hover {
            border-color: var(--serendipity);
            transform: translateX(4px);
        }

        .camping-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .camping-name {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .camping-type {
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: 500;
        }

        .camping-type.nwr {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .camping-type.private {
            background: rgba(99, 102, 241, 0.2);
            color: #818cf8;
        }

        .camping-location {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .camping-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
        }

        .camping-price {
            color: var(--success);
            font-weight: 500;
        }

        .camping-facilities {
            color: var(--text-muted);
            font-style: italic;
        }

        /* League System Styles */
        .league-section {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(244, 114, 182, 0.1));
            border: 1px solid rgba(251, 191, 36, 0.2);
            border-radius: 12px;
            padding: 15px;
        }

        .league-stats {
            display: flex;
            gap: 10px;
            margin-bottom: 12px;
        }

        .league-stat-card {
            flex: 1;
            background: var(--bg-elevated);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .league-stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--road-primary);
        }

        .league-stat-label {
            font-size: 0.65rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .league-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-elevated);
            border-radius: 10px;
            padding: 10px 15px;
        }

        .badge-icon {
            font-size: 1.5rem;
        }

        .badge-title {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Leaderboard */
        .leaderboard-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .leaderboard-item.current-user {
            border: 2px solid var(--road-primary);
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), transparent);
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--bg-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .leaderboard-rank.gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; }
        .leaderboard-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); color: #000; }
        .leaderboard-rank.bronze { background: linear-gradient(135deg, #d97706, #b45309); color: #fff; }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .leaderboard-stats {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .leaderboard-badge {
            font-size: 1.2rem;
        }

        .league-tiers {
            border-top: 1px solid var(--border-subtle);
            padding-top: 15px;
            margin-top: 15px;
        }

        .tier-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .tier-item span {
            font-size: 1.2rem;
        }

        /* Create Trip Modal */
        .form-row {
            display: flex;
            gap: 15px;
        }

        .tag-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 6px 10px;
            background: var(--bg-elevated);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .tag-checkbox:has(input:checked) {
            background: var(--accent-primary);
            color: white;
        }

        .tag-checkbox input {
            display: none;
        }

        .waypoint-row {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            align-items: center;
        }

        .waypoint-row .waypoint-name {
            flex: 2;
        }

        .waypoint-row .waypoint-lat,
        .waypoint-row .waypoint-lng {
            flex: 1;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-elevated);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .btn-icon:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }

        /* Country Roads Card */
        .country-roads-card {
            background: var(--bg-elevated);
            border-radius: 10px;
            padding: 12px;
        }

        .country-roads-card h4 {
            margin-bottom: 10px;
            color: var(--serendipity);
        }

        /* Road Trip Completed Badge */
        .trip-completed-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            color: white;
        }

        .road-trip-card {
            position: relative;
        }

        .road-trip-card.completed {
            border-left: 3px solid var(--success);
        }

        .road-trip-card .complete-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            padding: 4px 8px;
            font-size: 0.65rem;
            border-radius: 6px;
            border: 1px solid var(--border-subtle);
            background: var(--bg-hover);
            color: var(--text-secondary);
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s;
        }

        .road-trip-card:hover .complete-btn {
            opacity: 1;
        }

        .road-trip-card .complete-btn:hover {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        /* User-created trip badge */
        .user-created-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            background: var(--serendipity);
            color: white;
            border-radius: 10px;
            font-size: 0.65rem;
            font-weight: 600;
            margin-left: 8px;
        }

        /* ==================== NATIVE ADVERTISING SYSTEM ==================== */
        
        /* Sponsored Badge - Subtle & Transparent */
        .sponsored-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 6px;
            background: rgba(148, 148, 168, 0.15);
            border: 1px solid rgba(148, 148, 168, 0.2);
            border-radius: 4px;
            font-size: 0.55rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-left: auto;
        }

        .sponsored-badge:hover::after {
            content: ' - Paid partnership';
        }

        /* Sponsored Road Trip Card - Blends with regular cards */
        .road-trip-card.sponsored {
            border-left-color: rgba(148, 148, 168, 0.5);
            position: relative;
        }

        .road-trip-card.sponsored::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 24px 24px 0;
            border-color: transparent rgba(148, 148, 168, 0.2) transparent transparent;
        }

        /* Partner Recommendation Card */
        .partner-recommendation {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 14px;
            margin: 12px 0;
            transition: all 0.2s;
        }

        .partner-recommendation:hover {
            border-color: var(--border-accent);
            transform: translateY(-1px);
        }

        .partner-rec-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .partner-rec-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .partner-rec-dismiss {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.9rem;
            padding: 2px;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .partner-rec-dismiss:hover {
            opacity: 1;
        }

        .partner-rec-content {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .partner-rec-icon {
            width: 48px;
            height: 48px;
            background: var(--bg-dark);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .partner-rec-info {
            flex: 1;
            min-width: 0;
        }

        .partner-rec-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .partner-rec-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .partner-rec-cta {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 8px;
            padding: 6px 12px;
            background: var(--bg-hover);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
        }

        .partner-rec-cta:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .partner-rec-brand {
            font-size: 0.6rem;
            color: var(--text-muted);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Contextual Tip from Partner */
        .sponsored-tip {
            display: flex;
            gap: 10px;
            padding: 12px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(99, 102, 241, 0.15);
            border-radius: 10px;
            margin: 10px 0;
        }

        .sponsored-tip-icon {
            font-size: 1.2rem;
        }

        .sponsored-tip-content {
            flex: 1;
        }

        .sponsored-tip-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .sponsored-tip-source {
            font-size: 0.6rem;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .sponsored-tip-source a {
            color: var(--accent-secondary);
            text-decoration: none;
        }

        .sponsored-tip-source a:hover {
            text-decoration: underline;
        }

        /* Traveler's Toolkit - Partner Products */
        .toolkit-section {
            background: rgba(255, 255, 255, 0.45);
            border: 1px solid rgba(255, 255, 255, 0.30);
            border-radius: 16px;
            padding: 14px;
            margin: 12px 0;
            backdrop-filter: blur(8px);
        }

        .toolkit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .toolkit-title {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .toolkit-label {
            font-size: 0.55rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .toolkit-items {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .toolkit-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.50);
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 12px;
            text-decoration: none;
            color: inherit;
            transition: all 0.2s;
        }

        .toolkit-item:hover {
            background: rgba(255, 255, 255, 0.80);
            transform: translateX(2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .toolkit-item-icon {
            font-size: 1.3rem;
        }

        .toolkit-item-info {
            flex: 1;
        }

        .toolkit-item-name {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .toolkit-item-desc {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .toolkit-item-arrow {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        /* In-Content Native Ad (for trip details) */
        .native-ad-inline {
            display: flex;
            gap: 12px;
            padding: 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            margin: 16px 0;
            align-items: center;
        }

        .native-ad-inline-icon {
            width: 44px;
            height: 44px;
            background: var(--bg-dark);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
        }

        .native-ad-inline-content {
            flex: 1;
        }

        .native-ad-inline-title {
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .native-ad-inline-text {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .native-ad-inline-label {
            font-size: 0.55rem;
            color: var(--text-muted);
            text-transform: uppercase;
            margin-top: 4px;
        }

        .native-ad-inline-btn {
            padding: 8px 14px;
            background: var(--bg-hover);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            text-decoration: none;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .native-ad-inline-btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        /* External Links Grid */
        .external-links-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .ext-link-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 12px 8px;
            background: rgba(255, 255, 255, 0.50);
            border: 1px solid rgba(255, 255, 255, 0.30);
            border-radius: 14px;
            text-decoration: none;
            color: var(--text-primary);
            transition: all 0.2s;
        }

        .ext-link-card:hover {
            border-color: rgba(224, 122, 95, 0.25);
            background: rgba(255, 255, 255, 0.80);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        }

        .ext-icon {
            font-size: 1.4rem;
        }

        .ext-name {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Plan Trip Section */
        .plan-trip-section {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(244, 114, 182, 0.1));
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            padding: 15px;
        }

        .mini-title {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        #plannedTripsList .planned-trip-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        #plannedTripsList .planned-trip-item:hover {
            background: var(--bg-hover);
        }

        .planned-trip-item .trip-icon {
            font-size: 1.2rem;
        }

        .planned-trip-item .trip-info {
            flex: 1;
        }

        .planned-trip-item .trip-name {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .planned-trip-item .trip-meta {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        /* Trip Planner Modal */
        .trip-planner-modal {
            display: flex;
            flex-direction: column;
        }

        .planner-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .planner-sidebar {
            width: 320px;
            background: var(--bg-panel);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .planner-tools {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
        }

        .tool-section {
            margin-bottom: 20px;
        }

        .tool-section h4 {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .tool-hint {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 10px;
        }

        .stop-type-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }

        .stop-type-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .stop-type-btn:hover {
            border-color: var(--accent-primary);
        }

        .stop-type-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .stop-type-btn span {
            font-size: 1rem;
        }

        .route-stops-list {
            max-height: 200px;
            overflow-y: auto;
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
        }

        .route-stops-list .empty-hint {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-align: center;
            padding: 20px;
        }

        .route-stop-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin-bottom: 6px;
            font-size: 0.8rem;
            border-left: 3px solid var(--border-subtle);
        }

        .route-stop-item .stop-number {
            width: 22px;
            height: 22px;
            background: var(--bg-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-muted);
        }

        .route-stop-item .stop-icon {
            font-size: 1.1rem;
        }

        .route-stop-item .stop-details {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .route-stop-item .stop-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .route-stop-item .stop-subtitle {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .route-stop-item .stop-delete {
            width: 22px;
            height: 22px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 4px;
            font-size: 1rem;
        }

        .route-stop-item .stop-delete:hover {
            background: var(--danger);
            color: white;
        }

        .nearby-links {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }

        .nearby-btn {
            padding: 8px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nearby-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent-primary);
        }

        .planner-actions {
            padding: 16px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .planner-map-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .planner-map {
            flex: 1;
            background: #1a1a2e;
        }

        .map-instructions {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(21, 21, 32, 0.9);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            border: 1px solid var(--border-subtle);
        }

        .route-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 10px;
            margin-top: 10px;
        }

        .route-stat {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .route-stat .stat-label {
            color: var(--text-muted);
        }

        .route-stat .stat-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .route-info-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: rgba(99, 102, 241, 0.2);
            border-radius: 12px;
            font-size: 0.7rem;
            color: var(--accent-primary);
        }

        /* City Markers & Tooltips for Planner */
        .city-tooltip {
            background: var(--bg-panel) !important;
            border: 1px solid var(--accent-primary) !important;
            border-radius: 10px !important;
            padding: 6px 12px !important;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3) !important;
            font-family: inherit !important;
        }

        .planner-marker.city-stop div {
            background: rgba(99, 102, 241, 0.2);
            border-radius: 50%;
            padding: 4px;
        }

        .leaflet-interactive.city-circle:hover {
            fill-opacity: 0.8 !important;
        }

        .city-list-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .city-list-hint span {
            font-size: 1rem;
        }

        .route-stop-item.city-stop {
            border-left: 3px solid var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        /* Satellite View Modal */
        .satellite-view-modal {
            display: flex;
            flex-direction: column;
        }

        .satellite-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: linear-gradient(135deg, #1a365d, #0f172a);
            border-bottom: 1px solid rgba(59, 130, 246, 0.3);
        }

        .satellite-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .satellite-title h3 {
            margin: 0;
            font-size: 1.1rem;
        }

        .satellite-icon {
            font-size: 1.5rem;
            animation: pulse-glow 2s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .satellite-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .layer-toggle-group {
            display: flex;
            gap: 4px;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px;
            border-radius: 10px;
        }

        .layer-btn {
            padding: 8px 14px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .layer-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .layer-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        .satellite-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .satellite-map {
            flex: 1;
            background: #0a0a12;
        }

        .satellite-info-panel {
            width: 280px;
            background: var(--bg-panel);
            border-left: 1px solid var(--border-subtle);
            padding: 16px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .country-quick-facts h4,
        .country-landmarks h4,
        .satellite-legend h4 {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .quick-fact-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 0.8rem;
        }

        .quick-fact-item .fact-label {
            color: var(--text-secondary);
        }

        .quick-fact-item .fact-value {
            color: var(--text-primary);
            font-weight: 500;
        }

        .landmark-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .landmark-item:hover {
            background: var(--bg-hover);
            transform: translateX(4px);
        }

        .landmark-icon {
            font-size: 1.2rem;
        }

        .landmark-name {
            font-size: 0.8rem;
            font-weight: 500;
        }

        .landmark-type {
            font-size: 0.65rem;
            color: var(--text-muted);
        }

        .legend-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .satellite-actions {
            margin-top: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        /* Vanlifer Info Panel */
        .vanlifer-info {
            background: var(--bg-elevated);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 12px;
        }

        .vanlifer-info h4 {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .info-item {
            background: var(--bg-dark);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }

        .info-item .icon {
            font-size: 1.2rem;
            margin-bottom: 4px;
        }

        .info-item .label {
            font-size: 0.65rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .info-item .value {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .info-item.good .value { color: var(--success); }
        .info-item.warning .value { color: var(--warning); }
        .info-item.bad .value { color: var(--danger); }

        /* Community Alerts */
        .community-alerts {
            margin-top: 16px;
        }

        .alert-item {
            display: flex;
            gap: 10px;
            padding: 12px;
            background: var(--bg-elevated);
            border-radius: 10px;
            margin-bottom: 8px;
            border-left: 3px solid var(--warning);
        }

        .alert-item.danger { border-left-color: var(--danger); }
        .alert-item.info { border-left-color: var(--accent-primary); }
        .alert-item.success { border-left-color: var(--success); }

        .alert-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .alert-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .alert-meta {
            font-size: 0.65rem;
            color: var(--text-muted);
            margin-top: 4px;
        }

        /* Add Alert Button */
        .add-alert-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px dashed var(--border-subtle);
            border-radius: 10px;
            color: var(--text-muted);
            font-family: inherit;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-alert-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }

        /* Alert Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.40);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--glass-bg-heavy);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            width: 450px;
            max-width: 95vw;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 24px 64px rgba(0, 0, 0, 0.12);
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-subtle);
        }

        .modal-header h3 {
            font-size: 1rem;
            font-weight: 600;
        }

        .modal-close {
            width: 32px;
            height: 32px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--danger);
            color: white;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 0.8rem;
            font-weight: 500;
            margin-bottom: 6px;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .form-select {
            width: 100%;
            padding: 10px 12px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        textarea.form-input {
            min-height: 80px;
            resize: vertical;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* ==================== PRINT POSTER STYLES ==================== */
        .poster-modal {
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .poster-preview-container {
            flex: 1;
            overflow: auto;
            padding: 20px;
            background: #2a2a3a;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .poster-canvas {
            background: #f5f0e6;
            width: 600px;
            min-height: 800px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            color: #2c3e50;
            font-family: 'Georgia', serif;
        }

        .poster-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #d4c4a8;
        }

        .poster-title {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
            letter-spacing: 2px;
        }

        .poster-subtitle {
            font-size: 1rem;
            color: #8b7355;
            font-style: italic;
        }

        .poster-stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .poster-stat {
            text-align: center;
            padding: 15px;
            background: rgba(212, 196, 168, 0.3);
            border-radius: 10px;
            border: 1px solid #d4c4a8;
        }

        .poster-stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #c44536;
        }

        .poster-stat-label {
            font-size: 0.75rem;
            color: #8b7355;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .poster-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4a3f35;
            margin: 25px 0 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #d4c4a8;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .poster-trips-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .poster-trip-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.5);
            border-radius: 8px;
            border-left: 4px solid #c44536;
        }

        .poster-trip-icon {
            font-size: 1.5rem;
        }

        .poster-trip-info {
            flex: 1;
        }

        .poster-trip-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: #2c3e50;
        }

        .poster-trip-meta {
            font-size: 0.75rem;
            color: #8b7355;
        }

        .poster-trip-date {
            font-size: 0.7rem;
            color: #8b7355;
            font-style: italic;
        }

        .poster-countries-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .poster-country-tag {
            padding: 6px 12px;
            background: rgba(196, 69, 54, 0.1);
            border: 1px solid #c44536;
            border-radius: 15px;
            font-size: 0.8rem;
            color: #c44536;
        }

        .poster-memories {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .poster-memory {
            aspect-ratio: 4/3;
            background: #d4c4a8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            opacity: 0.5;
            border: 2px dashed #8b7355;
        }

        .poster-memory.has-photo {
            opacity: 1;
            border: none;
            background-size: cover;
            background-position: center;
        }

        .poster-footer {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #d4c4a8;
            text-align: center;
        }

        .poster-footer-text {
            font-size: 0.75rem;
            color: #8b7355;
            font-style: italic;
        }

        .poster-qr-placeholder {
            width: 60px;
            height: 60px;
            background: #2c3e50;
            margin: 10px auto;
            border-radius: 5px;
        }

        .poster-options {
            padding: 15px 20px;
            background: var(--bg-elevated);
            border-top: 1px solid var(--border-subtle);
        }

        .poster-options-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-bottom: 15px;
        }

        .poster-option {
            padding: 15px;
            background: var(--bg-dark);
            border: 2px solid var(--border-subtle);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .poster-option:hover {
            border-color: var(--accent-primary);
        }

        .poster-option.selected {
            border-color: var(--accent-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .poster-option-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .poster-option-name {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .poster-option-price {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .poster-actions {
            display: flex;
            gap: 10px;
        }

        .poster-actions .btn {
            flex: 1;
        }

        /* ==================== AD BANNER STYLES ==================== */
        .ad-banner {
            padding: 12px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(244, 114, 182, 0.1));
            border: 1px dashed var(--border-subtle);
            border-radius: 10px;
            margin: 12px 0;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .ad-banner:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(244, 114, 182, 0.15));
            border-color: var(--accent-primary);
        }

        .ad-banner-label {
            font-size: 0.6rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .ad-banner-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .ad-banner-cta {
            display: inline-block;
            margin-top: 8px;
            padding: 6px 12px;
            background: var(--accent-primary);
            color: white;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .premium-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 3px 8px;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1a1a2e;
            border-radius: 10px;
            font-size: 0.6rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .go-premium-btn {
            background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
            color: #1a1a2e !important;
        }

        .go-premium-btn:hover {
            box-shadow: 0 4px 20px rgba(251, 191, 36, 0.4) !important;
        }

        /* Route Info Popup */
        .route-popup {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 16px;
            min-width: 280px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .route-popup h4 {
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .route-popup p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        /* Marker Icons */
        .custom-marker {
            background: var(--bg-panel);
            border: 2px solid var(--serendipity);
            border-radius: 50%;
            width: 30px !important;
            height: 30px !important;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .custom-marker.alert-marker {
            border-color: var(--warning);
            background: rgba(245, 158, 11, 0.2);
        }

        .custom-marker.danger-marker {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.2);
        }

        .custom-marker.poi-marker {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.2);
        }

        /* Route waypoint markers – grandes étapes vs start/end */
        .route-waypoint-marker {
            background: transparent !important;
            border: none !important;
        }
        .route-marker {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 1rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(0,0,0,0.25);
            border: 2px solid #fff;
        }
        .route-marker.start {
            background: linear-gradient(135deg, var(--srndipity-olive), #4a5d2a);
            color: var(--srndipity-cream);
        }
        .route-marker.end {
            background: linear-gradient(135deg, var(--srndipity-orange), #e5a838);
            color: var(--srndipity-dark);
        }
        .route-marker.etape {
            background: linear-gradient(135deg, var(--accent-primary), var(--safari-amber));
            color: var(--srndipity-dark);
            font-size: 0.85rem;
        }

        /* Reddit Tips */
        .reddit-tips {
            background: linear-gradient(135deg, #ff4500, #ff6b35);
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 16px;
        }

        .reddit-tips h4 {
            color: white;
            font-size: 0.85rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reddit-tip {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
            color: white;
        }

        .reddit-tip:last-child {
            margin-bottom: 0;
        }

        .reddit-tip .tip-text {
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .reddit-tip .tip-source {
            font-size: 0.65rem;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* Country Info for Vanlifers */
        .country-vanlifer-info {
            background: var(--bg-elevated);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .country-vanlifer-header {
            padding: 14px;
            background: linear-gradient(135deg, var(--bg-hover), var(--bg-elevated));
            border-bottom: 1px solid var(--border-subtle);
        }

        .country-vanlifer-header h4 {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .vanlifer-details {
            padding: 14px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-subtle);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-value {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .detail-value.good { color: var(--success); }
        .detail-value.moderate { color: var(--warning); }
        .detail-value.bad { color: var(--danger); }

        /* Hidden content */
        .hidden {
            display: none !important;
        }

        /* ==================== RESPONSIVE - MOBILE ==================== */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            /* Sidebar: bottom sheet on mobile */
            .sidebar {
                position: fixed;
                top: auto;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                max-height: 55vh;
                border-radius: 20px 20px 0 0;
                z-index: 600;
            }

            .sidebar-header {
                padding: 12px 16px;
            }

            .logo-tagline {
                display: none;
            }

            .map-container {
                width: 100%;
                height: 100vh;
            }

            .mode-tabs {
                padding: 8px;
            }

            .mode-tab {
                padding: 10px 8px;
                font-size: 0.75rem;
            }

            .btn {
                padding: 14px 16px;
                font-size: 0.9rem;
            }

            .search-select {
                padding: 14px;
                font-size: 1rem;
            }

            .travel-stats { gap: 8px; }
            .stat-box { padding: 12px 8px; }
            .stat-value { font-size: 1.4rem; }

            .section { margin-bottom: 12px; }
            .section-title { font-size: 0.75rem; }

            .road-trip-card { padding: 14px; }
            .road-trip-header { font-size: 0.9rem; }

            .modal-overlay { padding: 0; }
            .modal { max-width: 100%; max-height: 100%; height: 100%; border-radius: 0; }
            .trip-detail-modal { border-radius: 0; }

            .vintage-stats { display: none; }
            .league-section { display: none; }

            .poi-controls { left: 10px; bottom: 60vh; }

            .zoom-controls { bottom: 60vh; right: 10px; }
            .zoom-btn { width: 40px; height: 40px; }
        }
        
        /* Very small phones */
        @media (max-width: 380px) {
            .sidebar {
                max-height: 55vh;
            }
            
            .map-container {
                height: 45vh;
            }
            
            .stat-value {
                font-size: 1.2rem;
            }
            
            .mode-tab {
                font-size: 0.7rem;
                padding: 8px 6px;
            }
        }

        /* ==================== MEMORY BOOK STYLES ==================== */
        .memory-book-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
            perspective: 2000px;
        }

        .memory-book-modal.active {
            display: flex;
        }

        .memory-book {
            width: 90vw;
            max-width: 900px;
            height: 80vh;
            max-height: 600px;
            position: relative;
            transform-style: preserve-3d;
        }

        .book-container {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transform: rotateX(5deg);
        }

        .book-page {
            position: absolute;
            width: 50%;
            height: 100%;
            background: linear-gradient(135deg, #f5f0e6 0%, #ebe5d9 100%);
            border-radius: 0 8px 8px 0;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            padding: 30px;
            overflow-y: auto;
            transform-origin: left center;
            backface-visibility: hidden;
        }

        .book-page.left {
            left: 0;
            border-radius: 8px 0 0 8px;
            transform-origin: right center;
            background: linear-gradient(135deg, #ebe5d9 0%, #f5f0e6 100%);
        }

        .book-page.right {
            left: 50%;
        }

        .book-spine {
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 20px;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #8b7355, #6b5344, #8b7355);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.4);
            z-index: 10;
        }

        .book-close-btn {
            position: absolute;
            top: -50px;
            right: 0;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .book-close-btn:hover {
            background: var(--danger);
            transform: scale(1.1);
        }

        .page-title {
            font-family: 'Georgia', serif;
            font-size: 1.8rem;
            color: #4a3f35;
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #d4c4a8;
            padding-bottom: 10px;
        }

        .country-flag-large {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 15px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .memory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .memory-card {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 3px 3px 10px rgba(0,0,0,0.15);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
        }

        .memory-card:hover {
            transform: translateY(-10px) rotateX(-5deg) scale(1.05);
            box-shadow: 5px 15px 30px rgba(0,0,0,0.25);
        }

        .memory-card-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
            background: linear-gradient(135deg, #e0d5c5, #d4c4a8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .memory-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .memory-card-content {
            padding: 10px;
        }

        .memory-card-title {
            font-weight: 600;
            font-size: 0.85rem;
            color: #4a3f35;
            margin-bottom: 4px;
        }

        .memory-card-date {
            font-size: 0.7rem;
            color: #8b7355;
        }

        .add-memory-card {
            background: transparent;
            border: 2px dashed #d4c4a8;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            color: #8b7355;
            transition: all 0.3s;
        }

        .add-memory-card:hover {
            border-color: #E07A5F;
            color: #E07A5F;
            transform: translateY(-5px);
        }

        .add-memory-card .plus-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        /* Memory Pop-up Detail View */
        .memory-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            border-radius: 16px;
            padding: 0;
            max-width: 500px;
            width: 90vw;
            max-height: 80vh;
            overflow: hidden;
            z-index: 10002;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .memory-popup.active {
            transform: translate(-50%, -50%) scale(1);
        }

        .memory-popup-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background: linear-gradient(135deg, #e0d5c5, #d4c4a8);
        }

        .memory-popup-content {
            padding: 20px;
        }

        .memory-popup-title {
            font-family: 'Georgia', serif;
            font-size: 1.5rem;
            color: #4a3f35;
            margin-bottom: 8px;
        }

        .memory-popup-date {
            font-size: 0.85rem;
            color: #8b7355;
            margin-bottom: 15px;
        }

        .memory-popup-description {
            font-size: 0.95rem;
            color: #5a4f45;
            line-height: 1.6;
        }

        .memory-popup-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .memory-popup-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0d5c5;
        }

        .memory-popup-actions button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .memory-edit-btn {
            background: #FFBC42;
            color: white;
        }

        .memory-delete-btn {
            background: #f5f0e6;
            color: #c44536;
        }

        /* Add Memory Modal */
        .add-memory-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10003;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .add-memory-modal.active {
            display: flex;
        }

        .add-memory-form {
            background: var(--bg-panel);
            border-radius: 16px;
            padding: 24px;
            width: 90vw;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .add-memory-form h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .photo-upload-area {
            border: 2px dashed var(--border-subtle);
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 16px;
            background: var(--bg-elevated);
        }

        .photo-upload-area:hover {
            border-color: var(--accent-primary);
            background: var(--bg-hover);
        }

        .photo-upload-area.has-photo {
            padding: 0;
            border-style: solid;
        }

        .photo-upload-area img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
        }

        .photo-upload-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .photo-upload-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Country selector for memories */
        .countries-with-memories {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .country-memory-chip {
            padding: 8px 16px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .country-memory-chip:hover,
        .country-memory-chip.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }

        .country-memory-chip .memory-count {
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
            font-size: 0.75rem;
        }

        .no-memories-message {
            text-align: center;
            padding: 40px 20px;
            color: #8b7355;
        }

        .no-memories-message .icon {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Memory book navigation */
        .book-nav {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .book-nav button {
            padding: 10px 20px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .book-nav button:hover {
            background: var(--accent-primary);
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading {
            animation: pulse 1.5s infinite;
        }

        @keyframes slideIn {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .slide-in {
            animation: slideIn 0.3s ease;
        }

        /* File input */
        .hidden-input {
            display: none;
        }
        /* SEO Hidden Content - Visible to crawlers, hidden from users */
        .seo-content {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            overflow: hidden;
        }
        
        /* Skip to content for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--accent-primary);
            color: white;
            padding: 8px 16px;
            z-index: 10000;
            text-decoration: none;
            border-radius: 0 0 4px 0;
        }
        .skip-link:focus {
            top: 0;
        }

        /* ==================== GPX EXPORT SYSTEM ==================== */
        .gpx-export-bar {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
            border: 1px solid #bbf7d0;
            border-radius: 12px;
            margin: 12px 0;
        }
        .gpx-export-bar .gpx-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: #166534;
            white-space: nowrap;
        }
        .gpx-export-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 14px;
            font-size: 0.75rem;
            font-weight: 600;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.25s ease;
            text-decoration: none;
            color: #fff;
        }
        .gpx-export-btn.gpx-file { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .gpx-export-btn.google-maps { background: linear-gradient(135deg, #4285F4, #3367d6); }
        .gpx-export-btn.apple-maps { background: linear-gradient(135deg, #333, #111); }
        .gpx-export-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .gpx-export-btn i, .gpx-export-btn svg { width: 12px; height: 12px; }

        /* ==================== INTERACTIVE PACKING CHECKLIST ==================== */
        .packing-checklist {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 6px;
        }
        .packing-check-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .packing-check-item:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        .packing-check-item.checked {
            background: #f0fdf4;
            border-color: #bbf7d0;
            text-decoration: line-through;
            color: #94a3b8;
        }
        .packing-check-item.checked .packing-checkbox {
            background: #22c55e;
            border-color: #22c55e;
            color: #fff;
        }
        .packing-check-item.essential { border-left: 3px solid var(--brand-orange); }
        .packing-check-item.essential.checked { border-left-color: #22c55e; }
        .packing-checkbox {
            width: 20px;
            height: 20px;
            min-width: 20px;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            transition: all 0.2s;
        }
        .packing-item-label {
            flex: 1;
            font-size: 0.8rem;
            font-weight: 500;
        }
        .packing-buy-link {
            display: none;
            padding: 3px 8px;
            font-size: 0.65rem;
            font-weight: 600;
            background: #ff9900;
            color: #fff;
            border-radius: 10px;
            text-decoration: none;
            white-space: nowrap;
            transition: all 0.2s;
        }
        .packing-check-item:not(.checked) .packing-buy-link { display: inline-flex; }
        .packing-buy-link:hover { background: #e88b00; transform: translateY(-1px); }
        .packing-checklist-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 12px;
            padding: 10px 14px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        .packing-progress {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.78rem;
            font-weight: 600;
            color: var(--text-secondary);
        }
        .packing-progress-bar {
            width: 100px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }
        .packing-progress-fill {
            height: 100%;
            background: var(--brand-orange);
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        .packing-progress-fill.complete { background: #22c55e; }
        .packing-amazon-btn {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 12px;
            font-size: 0.72rem;
            font-weight: 600;
            background: #ff9900;
            color: #fff;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.2s;
        }
        .packing-amazon-btn:hover { background: #e88b00; transform: translateY(-1px); }

        /* ==================== ENHANCED BOOKING BUTTONS ==================== */
        .rec-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }
        .rec-action-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 14px;
            font-size: 0.72rem;
            font-weight: 600;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.25s ease;
            color: #fff;
        }
        .rec-action-btn.book-guide { background: linear-gradient(135deg, #E07A5F, #d4694e); }
        .rec-action-btn.check-avail { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .rec-action-btn.book-hotel { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .rec-action-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .rec-action-btn i, .rec-action-btn svg { width: 12px; height: 12px; }
        .rec-partner-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }
        .rec-partner-badge {
            font-size: 0.6rem;
            color: #94a3b8;
            font-style: italic;
        }

        /* ==================== USER BADGE SYSTEM ==================== */
        .user-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 10px;
            font-size: 0.65rem;
            font-weight: 700;
            border-radius: 12px;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }
        .user-badge.badge-expert {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #92400e;
            border: 1px solid #fcd34d;
        }
        .user-badge.badge-explorer {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .user-badge.badge-local {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #166534;
            border: 1px solid #86efac;
        }
        .user-badge.badge-newcomer {
            background: #f1f5f9;
            color: #64748b;
            border: 1px solid #e2e8f0;
        }
        .user-badge i, .user-badge svg { width: 10px; height: 10px; }
        .variant-creator-info {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: #64748b;
        }

        /* ==================== SEARCH FILTERS (Vehicle, Budget, Weather) ==================== */
        .search-filters-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
            padding-bottom: 8px;
        }
        .filter-tag {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 5px 12px;
            font-size: 0.7rem;
            font-weight: 600;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
        }
        .filter-tag:hover { background: var(--bg-hover); border-color: #cbd5e1; }
        .filter-tag.active {
            background: var(--brand-orange);
            color: #fff;
            border-color: var(--brand-orange);
        }
        .filter-tag i, .filter-tag svg { width: 12px; height: 12px; }
        .budget-filter-row {
            display: flex;
            gap: 6px;
            margin-top: 6px;
        }
        .budget-chip {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            font-size: 0.68rem;
            font-weight: 600;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-secondary);
        }
        .budget-chip:hover { background: var(--bg-hover); }
        .budget-chip.active { background: var(--brand-orange); color: #fff; border-color: var(--brand-orange); }
        .weather-icon-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 8px;
            font-size: 0.65rem;
            font-weight: 600;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 10px;
            color: #1d4ed8;
        }
        .weather-icon-badge.hot { background: rgba(239, 68, 68, 0.1); border-color: rgba(239, 68, 68, 0.2); color: #dc2626; }
        .weather-icon-badge.mild { background: rgba(34, 197, 94, 0.1); border-color: rgba(34, 197, 94, 0.2); color: #16a34a; }
        .weather-icon-badge.cold { background: rgba(59, 130, 246, 0.1); border-color: rgba(59, 130, 246, 0.2); color: #1d4ed8; }

        /* ==================== DRAG & DROP POI ==================== */
        .poi-drag-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(12px);
            border: 1px solid #e2e8f0;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            z-index: 1200;
        }
        .poi-drag-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            background: #f8fafc;
            border: 1px dashed #cbd5e1;
            border-radius: 12px;
            cursor: grab;
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.2s;
            user-select: none;
        }
        .poi-drag-item:hover { background: #fff; border-color: var(--brand-orange); color: var(--brand-orange); }
        .poi-drag-item:active { cursor: grabbing; transform: scale(0.95); }
        .poi-drag-item .poi-drag-icon { font-size: 1.2rem; }
        .poi-placed-count {
            font-size: 0.6rem;
            padding: 1px 6px;
            background: var(--brand-orange);
            color: #fff;
            border-radius: 8px;
            min-width: 16px;
            text-align: center;
        }

        /* ==================== DARK MODE / NIGHT MAP ==================== */
        .night-mode-toggle {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 1100;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #e2e8f0;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        .night-mode-toggle:hover { background: rgba(255,255,255,1); }
        .night-mode-toggle.night-active {
            background: rgba(30, 41, 59, 0.9);
            color: #f1f5f9;
            border-color: rgba(255,255,255,0.2);
        }

        /* ==================== UX: COMPACT STAT CARDS ==================== */
        .trip-stats-row.compact .trip-stat-card {
            padding: 12px 14px;
            gap: 10px;
        }
        .trip-stats-row.compact .stat-icon {
            width: 36px;
            height: 36px;
        }
        .trip-stats-row.compact .stat-value {
            font-size: 0.95rem;
        }

        /* Vehicle tag badges on road trip cards */
        .vehicle-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 8px;
            font-size: 0.6rem;
            font-weight: 700;
            border-radius: 8px;
            text-transform: uppercase;
        }
        .vehicle-badge.van { background: #dbeafe; color: #1e40af; }
        .vehicle-badge.motorcycle { background: #fef3c7; color: #92400e; }
        .vehicle-badge.fourx4 { background: #dcfce7; color: #166534; }
        .vehicle-badge.car { background: #f1f5f9; color: #475569; }

        /* ==================== ROUTE MODULE V2 – NESTED FILTERS ==================== */
        .poi-filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            align-items: center;
        }
        .poi-filter-group {
            position: relative;
        }
        .poi-filter-toggle {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 14px;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            color: var(--text-secondary);
            font-size: 0.78rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .poi-filter-toggle:hover { border-color: #cbd5e1; color: var(--text-primary); }
        .poi-filter-toggle.active { background: rgba(224,122,95,0.12); border-color: var(--brand-orange); color: var(--brand-orange); }
        .poi-filter-toggle.has-sub::after { content: '▾'; font-size: 0.6rem; margin-left: 2px; }
        .poi-filter-toggle i, .poi-filter-toggle svg { width: 14px; height: 14px; }
        .poi-filter-toggle .poi-f-count {
            padding: 1px 7px;
            background: rgba(0,0,0,0.08);
            border-radius: 8px;
            font-size: 0.65rem;
            font-weight: 700;
        }
        .poi-filter-toggle.active .poi-f-count { background: rgba(224,122,95,0.2); }

        .poi-sub-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            min-width: 220px;
            padding: 8px;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 14px;
            box-shadow: 0 12px 36px rgba(0,0,0,0.12);
            z-index: 100;
            animation: poiSubIn 0.15s ease;
        }
        .poi-filter-group.open .poi-sub-menu { display: block; }
        @keyframes poiSubIn { from { opacity: 0; transform: translateY(-6px); } to { opacity: 1; transform: translateY(0); } }
        .poi-sub-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.78rem;
            font-weight: 500;
            color: #334155;
            transition: all 0.15s;
        }
        .poi-sub-item:hover { background: #f1f5f9; }
        .poi-sub-item.active { background: rgba(224,122,95,0.08); color: var(--brand-orange); font-weight: 600; }
        .poi-sub-check {
            width: 18px; height: 18px;
            border: 2px solid #cbd5e1;
            border-radius: 5px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.6rem;
            transition: all 0.15s;
            flex-shrink: 0;
        }
        .poi-sub-item.active .poi-sub-check { background: var(--brand-orange); border-color: var(--brand-orange); color: #fff; }
        .poi-sub-icon { font-size: 1.1rem; }
        .poi-sub-label { flex: 1; }
        .poi-sub-count { font-size: 0.65rem; color: #94a3b8; }

        /* Night-mode compat for all new Route V2 components */
        .night-mode-toggle.night-active ~ .poi-sub-menu,
        .night-active .poi-sub-menu {
            background: #1e1e32;
            border-color: rgba(255,255,255,0.1);
        }
        .night-active .poi-sub-item { color: #e2e8f0; }
        .night-active .poi-sub-item:hover { background: rgba(255,255,255,0.06); }
        .night-active .poi-sub-check { border-color: rgba(255,255,255,0.2); }
        .night-active .poi-filter-toggle { background: rgba(30,41,59,0.8); border-color: rgba(255,255,255,0.1); color: #94a3b8; }
        .night-active .poi-filter-toggle:hover { color: #e2e8f0; }
        .night-active .poi-filter-toggle.active { background: rgba(224,122,95,0.2); }
        .night-active .poi-drag-panel { background: rgba(15,23,42,0.95); border-color: rgba(255,255,255,0.1); }
        .night-active .poi-drag-item { background: rgba(30,41,59,0.8); border-color: rgba(255,255,255,0.1); color: #94a3b8; }

        /* ==================== COMMUNITY VALIDATION (POI Popups) ==================== */
        .poi-popup-v2 { min-width: 260px; font-family: 'Inter', system-ui, sans-serif; }
        .poi-popup-v2 .poi-v2-header {
            display: flex; align-items: center; gap: 10px;
            padding-bottom: 10px; margin-bottom: 10px;
            border-bottom: 1px solid #f1f5f9;
        }
        .poi-v2-icon-wrap {
            width: 40px; height: 40px;
            border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.4rem;
            flex-shrink: 0;
        }
        .poi-v2-title { font-weight: 700; font-size: 0.92rem; color: #0f172a; }
        .poi-v2-type { font-size: 0.68rem; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.03em; }
        .poi-v2-verified {
            display: inline-flex; align-items: center; gap: 3px;
            padding: 2px 8px; border-radius: 8px; font-size: 0.6rem; font-weight: 700;
            background: #dcfce7; color: #166534;
            text-transform: uppercase; letter-spacing: 0.03em;
        }
        .poi-v2-details { font-size: 0.8rem; color: #475569; line-height: 1.5; }
        .poi-v2-details p { margin: 3px 0; }
        .poi-v2-tip {
            margin-top: 8px; padding: 8px 10px;
            background: #f0f9ff; border-radius: 8px; border-left: 3px solid #0ea5e9;
            font-size: 0.75rem; color: #0369a1;
        }
        .poi-v2-vote-row {
            display: flex; align-items: center; gap: 8px;
            margin-top: 10px; padding-top: 10px;
            border-top: 1px solid #f1f5f9;
        }
        .poi-v2-vote-label { font-size: 0.72rem; color: #64748b; font-weight: 500; }
        .poi-v2-vote-btn {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 5px 12px; border: 1px solid #e2e8f0; border-radius: 8px;
            background: #fff; font-size: 0.72rem; font-weight: 600;
            cursor: pointer; transition: all 0.15s; color: #475569;
        }
        .poi-v2-vote-btn:hover { border-color: #cbd5e1; background: #f8fafc; }
        .poi-v2-vote-btn.voted-up { background: #dcfce7; border-color: #86efac; color: #166534; }
        .poi-v2-vote-btn.voted-down { background: #fef2f2; border-color: #fca5a5; color: #991b1b; }
        .poi-v2-vote-count { font-size: 0.65rem; color: #94a3b8; margin-left: auto; }
        .poi-v2-report {
            display: flex; gap: 6px; margin-top: 8px;
        }
        .poi-v2-report-btn {
            flex: 1; padding: 5px; text-align: center; font-size: 0.68rem;
            background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px;
            cursor: pointer; transition: all 0.15s; color: #64748b; font-weight: 500;
        }
        .poi-v2-report-btn:hover { background: #f1f5f9; color: #334155; }
        .poi-v2-actions {
            display: flex; gap: 6px; margin-top: 8px;
        }
        .poi-v2-actions a, .poi-v2-actions button {
            flex: 1; padding: 7px 6px; text-align: center;
            background: #f3f4f6; border-radius: 8px; text-decoration: none;
            font-size: 0.73rem; color: #374151; font-weight: 500;
            border: none; cursor: pointer; transition: all 0.15s;
        }
        .poi-v2-actions a:hover, .poi-v2-actions button:hover { background: #e5e7eb; }

        /* ==================== PREMIUM / PARTNER POI ==================== */
        .poi-marker-icon.premium {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border: 2px solid #fbbf24;
            box-shadow: 0 2px 10px rgba(245,158,11,0.4), 0 0 0 3px rgba(245,158,11,0.15);
            animation: premiumPulse 2s infinite;
        }
        @keyframes premiumPulse {
            0%, 100% { box-shadow: 0 2px 10px rgba(245,158,11,0.4), 0 0 0 3px rgba(245,158,11,0.15); }
            50% { box-shadow: 0 2px 14px rgba(245,158,11,0.6), 0 0 0 6px rgba(245,158,11,0.1); }
        }
        .poi-v2-partner-badge {
            display: inline-flex; align-items: center; gap: 3px;
            padding: 2px 8px; border-radius: 8px; font-size: 0.6rem; font-weight: 700;
            background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e;
            border: 1px solid #fcd34d;
            text-transform: uppercase;
        }
        .poi-v2-book-btn {
            display: flex; align-items: center; justify-content: center; gap: 6px;
            width: 100%; padding: 9px; margin-top: 8px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: #fff; font-size: 0.8rem; font-weight: 700;
            border: none; border-radius: 10px; cursor: pointer;
            transition: all 0.25s; text-decoration: none;
        }
        .poi-v2-book-btn:hover { box-shadow: 0 6px 20px rgba(245,158,11,0.35); transform: translateY(-1px); }

        /* ==================== ADD POI MODAL (Structured) ==================== */
        .add-poi-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 10000;
            display: none; align-items: center; justify-content: center;
        }
        .add-poi-overlay.active { display: flex; }
        .add-poi-modal {
            background: #fff;
            border-radius: 20px;
            width: 420px; max-width: 95vw;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 24px 60px rgba(0,0,0,0.25);
            animation: poiModalIn 0.2s ease;
        }
        @keyframes poiModalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } }
        .add-poi-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 18px 22px; border-bottom: 1px solid #f1f5f9;
        }
        .add-poi-header h3 { margin: 0; font-size: 1.1rem; font-weight: 700; color: #0f172a; }
        .add-poi-close {
            width: 32px; height: 32px; border-radius: 50%;
            border: none; background: #f1f5f9; font-size: 1.1rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            color: #64748b; transition: all 0.15s;
        }
        .add-poi-close:hover { background: #e2e8f0; color: #0f172a; }
        .add-poi-body { padding: 20px 22px; }
        .add-poi-field { margin-bottom: 16px; }
        .add-poi-label {
            display: block; font-size: 0.78rem; font-weight: 600;
            color: #334155; margin-bottom: 6px;
        }
        .add-poi-input, .add-poi-textarea, .add-poi-select {
            width: 100%; padding: 10px 14px;
            border: 1px solid #e2e8f0; border-radius: 10px;
            font-size: 0.88rem; font-family: inherit; color: #0f172a;
            transition: border-color 0.2s;
        }
        .add-poi-input:focus, .add-poi-textarea:focus, .add-poi-select:focus {
            outline: none; border-color: var(--brand-orange);
        }
        .add-poi-textarea { min-height: 70px; resize: vertical; }
        .add-poi-cat-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
        }
        .add-poi-cat-btn {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            padding: 12px 6px; border: 2px solid #e2e8f0; border-radius: 12px;
            background: #fff; cursor: pointer; transition: all 0.15s;
            font-size: 0.72rem; font-weight: 600; color: #64748b;
        }
        .add-poi-cat-btn:hover { border-color: #cbd5e1; }
        .add-poi-cat-btn.selected { border-color: var(--brand-orange); background: rgba(224,122,95,0.06); color: var(--brand-orange); }
        .add-poi-cat-btn .cat-icon { font-size: 1.3rem; }
        .add-poi-address {
            display: flex; align-items: center; gap: 8px;
            padding: 10px 14px; background: #f8fafc; border-radius: 10px;
            border: 1px solid #e2e8f0; font-size: 0.82rem; color: #475569;
            min-height: 42px;
        }
        .add-poi-address i { color: var(--brand-orange); flex-shrink: 0; }
        .add-poi-photo-area {
            display: flex; align-items: center; justify-content: center;
            padding: 20px; border: 2px dashed #e2e8f0; border-radius: 12px;
            cursor: pointer; transition: all 0.15s; text-align: center;
            font-size: 0.8rem; color: #94a3b8; min-height: 80px;
        }
        .add-poi-photo-area:hover { border-color: var(--brand-orange); background: rgba(224,122,95,0.03); }
        .add-poi-photo-area.has-photo { border-style: solid; border-color: #22c55e; color: #166534; background: #f0fdf4; }
        .add-poi-footer {
            display: flex; gap: 10px; padding: 16px 22px; border-top: 1px solid #f1f5f9;
        }
        .add-poi-submit {
            flex: 1; padding: 11px; background: linear-gradient(135deg, #E07A5F, #c9684e);
            color: #fff; font-size: 0.88rem; font-weight: 700;
            border: none; border-radius: 12px; cursor: pointer; transition: all 0.25s;
        }
        .add-poi-submit:hover { box-shadow: 0 6px 20px rgba(224,122,95,0.3); }
        .add-poi-cancel {
            padding: 11px 20px; background: #f1f5f9; color: #475569;
            border: none; border-radius: 12px; cursor: pointer; font-weight: 600;
            font-size: 0.88rem; transition: all 0.15s;
        }
        .add-poi-cancel:hover { background: #e2e8f0; }

        /* ==================== CLUSTER OVERRIDES ==================== */
        .marker-cluster-small { background: rgba(224,122,95,0.25); }
        .marker-cluster-small div { background: rgba(224,122,95,0.7); color: #fff; font-weight: 700; }
        .marker-cluster-medium { background: rgba(224,122,95,0.35); }
        .marker-cluster-medium div { background: rgba(224,122,95,0.8); color: #fff; font-weight: 700; }
        .marker-cluster-large { background: rgba(224,122,95,0.45); }
        .marker-cluster-large div { background: rgba(224,122,95,0.9); color: #fff; font-weight: 700; }
    </style>
</head>
<body>
    <!-- Icon set: vector only, no emojis (Srndipity design system) -->
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" style="position:absolute;width:0;height:0;overflow:hidden;">
        <defs>
            <symbol id="icon-route" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 17l4-4 4 4 6-6"/><path d="M4 7l4 4 4-4 6 6"/></symbol>
            <symbol id="icon-fuel" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v4M6 8h12l2 10H4L6 8z"/><path d="M6 18v2M12 18v2M18 18v2"/></symbol>
            <symbol id="icon-tent" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22L12 2l8 20H4z"/><path d="M12 2v20"/></symbol>
            <symbol id="icon-camera" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="20" height="14" rx="2"/><circle cx="12" cy="13" r="3"/><path d="M16 6l2-2 2 2"/></symbol>
            <symbol id="icon-car" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 17h14v-5H5v5z"/><path d="M5 12l2-4h10l2 4"/><circle cx="7.5" cy="17" r="1.5"/><circle cx="16.5" cy="17" r="1.5"/></symbol>
            <symbol id="icon-flag" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><path d="M4 22V15"/></symbol>
            <symbol id="icon-document" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><path d="M14 2v6h6"/><path d="M16 13H8"/><path d="M16 17H8"/></symbol>
            <symbol id="icon-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></symbol>
            <symbol id="icon-close" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></symbol>
            <symbol id="icon-search" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></symbol>
            <symbol id="icon-prep" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4"/><path d="M8 2v4"/><path d="M3 10h18"/></symbol>
            <symbol id="icon-heart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></symbol>
            <symbol id="icon-heart-filled" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z"/></symbol>
        </defs>
    </svg>
    <!-- Skip Navigation for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Noscript fallback for SEO and non-JS users -->
    <noscript>
        <div style="padding: 40px; max-width: 800px; margin: 0 auto; font-family: sans-serif; line-height: 1.6;">
            <h1>Srndipity - For Those With Eyes to See</h1>
            <p><strong>Srndipity</strong> - For those with eyes to see. The ultimate free tool for planning road trips, tracking your vanlife adventures, and discovering the hidden gems others miss. JavaScript is required for the interactive features.</p>
            
            <h2>What You Can Do With Srndipity</h2>
            <ul>
                <li><strong>Discover Road Trips:</strong> Browse 200+ curated road trip routes from around the world</li>
                <li><strong>Track Your Travels:</strong> Mark countries visited and road trips completed</li>
                <li><strong>Plan Adventures:</strong> View detailed itineraries with costs, difficulty, and tips</li>
                <li><strong>Join the Community:</strong> Read reviews and tips from fellow travelers</li>
            </ul>
            
            <h2>Popular Road Trips</h2>
            <ul>
                <li>Route 66, USA - The iconic Mother Road from Chicago to Santa Monica</li>
                <li>Iceland Ring Road - Complete circumnavigation of Iceland</li>
                <li>Great Ocean Road, Australia - Stunning coastal scenery</li>
                <li>North Coast 500, Scotland - Scotland's answer to Route 66</li>
                <li>Garden Route, South Africa - Wildlife and coastal beauty</li>
                <li>Carretera Austral, Chile - Patagonian wilderness adventure</li>
                <li>Atlantic Road, Norway - Engineering marvel over the sea</li>
                <li>Transfagarasan, Romania - One of the world's best driving roads</li>
            </ul>
            
            <h2>Perfect For</h2>
            <ul>
                <li>Vanlifers planning their next adventure</li>
                <li>Overlanders seeking epic routes</li>
                <li>Road trip enthusiasts discovering new destinations</li>
                <li>Travel bloggers tracking their journeys</li>
                <li>Adventure seekers looking for inspiration</li>
            </ul>
            
            <p>Please enable JavaScript to use Srndipity's interactive features.</p>
        </div>
    </noscript>
    
    <!-- Hidden SEO Content (crawlable but not visible) -->
    <div class="seo-content" aria-hidden="true">
        <h1>Srndipity - For Those With Eyes to See | Road Trip Planner for Vanlife Adventures</h1>
        
        <article>
            <h2>About Srndipity</h2>
            <p>Srndipity - For those with eyes to see. In a world of constant digital distraction, we believe the best adventures happen when you put down the phone and truly see what's before you. Our platform is designed to inspire you to disconnect from algorithms and connect with real experiences - the golden hour light on a mountain road, the unexpected conversation at a roadside diner, the feeling of being truly present in a moment.</p>
            
            <p>This is a free, interactive road trip planning tool for vanlifers, overlanders, and adventure travelers who want to discover the hidden gems others miss. We help you plan the journey, then encourage you to put us away and actually live it.</p>
            
            <p>Whether you're planning a weekend getaway or a year-long van life adventure, Srndipity provides everything you need: detailed route information, budget estimates, difficulty ratings, best seasons to travel, camping spots, and community reviews from travelers who've done the trips.</p>
        </article>
        
        <article>
            <h2>Features for Vanlife Travelers</h2>
            <ul>
                <li>Interactive world map to track visited countries and road trips</li>
                <li>200+ curated road trip routes across all continents</li>
                <li>Vanlife-specific information: wild camping spots, water points, fuel stations</li>
                <li>Trip difficulty ratings from easy to extreme</li>
                <li>Budget breakdowns including fuel, accommodation, food, and tolls</li>
                <li>Best season recommendations for each route</li>
                <li>4x4 and overlanding route requirements</li>
                <li>Community reviews and tips from fellow vanlifers</li>
                <li>Printable travel posters and maps</li>
                <li>Offline-friendly trip details</li>
            </ul>
        </article>
        
        <article>
            <h2>Popular Road Trips by Region</h2>
            
            <h3>North America Road Trips</h3>
            <p>Route 66 (USA), Pacific Coast Highway (California), Alaska Highway, Blue Ridge Parkway, Going-to-the-Sun Road (Montana), Sea to Sky Highway (Canada), Icefields Parkway (Canada)</p>
            
            <h3>Europe Road Trips</h3>
            <p>North Coast 500 (Scotland), Ring Road (Iceland), Atlantic Road (Norway), Transfagarasan (Romania), Amalfi Coast (Italy), Wild Atlantic Way (Ireland), Romantic Road (Germany), Algarve Coast (Portugal)</p>
            
            <h3>South America Road Trips</h3>
            <p>Carretera Austral (Chile), Ruta 40 (Argentina), Death Road (Bolivia), Salar de Uyuni, Pan-American Highway, Amazon Basin routes</p>
            
            <h3>Africa Road Trips</h3>
            <p>Garden Route (South Africa), Skeleton Coast (Namibia), Cape Town to Victoria Falls, Trans-Sahara Highway, Morocco Atlas Mountains, East Africa Safari Circuit</p>
            
            <h3>Asia & Oceania Road Trips</h3>
            <p>Great Ocean Road (Australia), Karakoram Highway (Pakistan), Leh-Manali Highway (India), Silk Road, Mongolia Gobi crossing, New Zealand South Island</p>
        </article>
        
        <article>
<h2>Why Choose Srndipity?</h2>
            <p>For those with eyes to see. In an age of AI-generated itineraries and algorithm-driven recommendations, we offer something different: inspiration to truly see. We believe the best moments aren't found in a feed - they're found when you look up, slow down, and notice the details that make each place unique.</p>

            <p>Our philosophy: Plan with intention, then be present. Use our tools to dream and prepare, then put the screen away and experience the world with fresh eyes. Notice the light. Talk to locals. Find the road that isn't on any map.</p>
            
            <p>Key benefits: 100% free to use, no account required, minimal data collection, designed to be used then put away, focused on inspiring real experiences over endless scrolling.</p>
        </article>

        <article>
            <h2>The Vanlife Community</h2>
            <p>Srndipity is built by vanlifers, for vanlifers - for those with eyes to see. We understand that van life isn't about the perfect Instagram shot; it's about the quiet morning coffee watching the sunrise, the unexpected detour that becomes the highlight of your trip, the freedom of waking up and choosing where to go next.</p>
            
            <p>Our community shares real experiences and practical tips to help you travel deeper - not faster, not further, but with more presence and intention.</p>
        </article>
    </div>

    <main id="main-content" role="main">
    <div class="container">
        <aside class="sidebar" role="complementary" aria-label="Trip planning controls">
            <header class="sidebar-header">
                <div class="logo" role="banner">
                    <img src="assets/logo.png" alt="Srndipity Inc. – Just Look Up" class="logo-img" id="logoImg" />
                </div>
            </header>

            <div class="sidebar-content sidebar-merged">
                <!-- ==================== 1. Travel stats + regions ==================== -->
                <div class="sidebar-block">
                    <div class="travel-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="countriesVisited">0</div>
                            <div class="stat-label">Countries</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="continentsExplored">0</div>
                            <div class="stat-label">Continents</div>
                        </div>
                    </div>
                    <div class="travel-stats" style="margin-top: 8px;">
                        <div class="stat-box">
                            <div class="stat-value" id="routesExplored">0</div>
                            <div class="stat-label">Routes</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="kmTraveled">0</div>
                            <div class="stat-label">Miles</div>
                        </div>
                    </div>
                    <!-- Road Trips: click region OR choose month to open list -->
                    <div class="section">
                        <div class="section-title"><i data-lucide="globe" style="width:16px;height:16px;"></i> Where do you want to go?</div>
                        <p class="region-hint">Click a region to see road trips in that zone</p>
                        <div class="region-cards" id="regionCards">
                            <button type="button" class="region-card" data-region="Europe" onclick="selectRegion('Europe')">
                                <i data-lucide="map-pin" class="region-icon"></i>
                                <span class="region-name">Europe</span>
                            </button>
                            <button type="button" class="region-card" data-region="North America" onclick="selectRegion('North America')">
                                <i data-lucide="map-pin" class="region-icon"></i>
                                <span class="region-name">N. America</span>
                            </button>
                            <button type="button" class="region-card" data-region="South America" onclick="selectRegion('South America')">
                                <i data-lucide="map-pin" class="region-icon"></i>
                                <span class="region-name">S. America</span>
                            </button>
                            <button type="button" class="region-card" data-region="Africa" onclick="selectRegion('Africa')">
                                <i data-lucide="map-pin" class="region-icon"></i>
                                <span class="region-name">Africa</span>
                            </button>
                            <button type="button" class="region-card" data-region="Asia" onclick="selectRegion('Asia')">
                                <i data-lucide="map-pin" class="region-icon"></i>
                                <span class="region-name">Asia</span>
                            </button>
                            <button type="button" class="region-card" data-region="Oceania" onclick="selectRegion('Oceania')">
                                <i data-lucide="map-pin" class="region-icon"></i>
                                <span class="region-name">Oceania</span>
                            </button>
                        </div>
                        <div class="travel-month-selector">
                            <label><i data-lucide="calendar" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Or choose a month</label>
                            <select onchange="setTravelMonth(this.value)" id="travelMonthSelect">
                                <option value="">-- Any month --</option>
                                <option value="0">January</option>
                                <option value="1">February</option>
                                <option value="2">March</option>
                                <option value="3">April</option>
                                <option value="4">May</option>
                                <option value="5">June</option>
                                <option value="6">July</option>
                                <option value="7">August</option>
                                <option value="8">September</option>
                                <option value="9">October</option>
                                <option value="10">November</option>
                                <option value="11">December</option>
                            </select>
                        </div>
                    </div>
                    <!-- Road Trips List (shown when region selected OR month selected) -->
                    <div class="section road-trips-list-panel" id="roadTripsListPanel" style="display: none;">
                        <div class="road-trips-list-header">
                            <button type="button" class="back-to-regions-btn" id="backToRegionsBtn" onclick="backToRegions()" style="display: none;">◀ Back to regions</button>
                            <div class="section-title" id="roadTripsListTitle"><svg class="icon icon--lg" aria-hidden="true"><use href="#icon-route"></use></svg> Road Trips</div>
                        </div>
                        <div class="road-trips-list-subtitle" id="roadTripsListSubtitle"></div>
                        <div class="road-trips-list-toolbar">
                            <span class="road-trips-count"><span id="roadTripsCount">0</span> trips</span>
                            <label class="sort-by-label" for="roadTripsSortBy">Sort by</label>
                            <select id="roadTripsSortBy" class="sort-by-select" aria-label="Sort trips" onchange="renderRoadTrips()">
                                <option value="topRated">Top Rated</option>
                                <option value="shortest">Shortest</option>
                                <option value="newest">Newest</option>
                            </select>
                        </div>
                        <!-- Vehicle Type Filters -->
                        <div class="search-filters-row" id="vehicleFilters">
                            <button class="filter-tag" data-vehicle="all" onclick="setVehicleFilter('all', this)"><i data-lucide="car" style="width:12px;height:12px;"></i> All</button>
                            <button class="filter-tag" data-vehicle="van" onclick="setVehicleFilter('van', this)"><i data-lucide="truck" style="width:12px;height:12px;"></i> Van-Friendly</button>
                            <button class="filter-tag" data-vehicle="motorcycle" onclick="setVehicleFilter('motorcycle', this)"><i data-lucide="bike" style="width:12px;height:12px;"></i> Motorcycle Epic</button>
                            <button class="filter-tag" data-vehicle="fourx4" onclick="setVehicleFilter('fourx4', this)"><svg class="icon" aria-hidden="true" style="width:12px;height:12px;"><use href="#icon-car"></use></svg> 4x4 Required</button>
                        </div>
                        <!-- Budget Filter -->
                        <div class="budget-filter-row" id="budgetFilters">
                            <button class="budget-chip" data-budget="all" onclick="setBudgetFilter('all', this)">All Budgets</button>
                            <button class="budget-chip" data-budget="budget" onclick="setBudgetFilter('budget', this)">💰 Budget</button>
                            <button class="budget-chip" data-budget="moderate" onclick="setBudgetFilter('moderate', this)">💰💰 Moderate</button>
                            <button class="budget-chip" data-budget="luxury" onclick="setBudgetFilter('luxury', this)">💰💰💰 Luxury</button>
                        </div>
                        <div id="roadTripsList" class="road-trips-list-cards"></div>
                        <div id="roadTripsLoadMoreWrap" class="load-more-wrap" style="display: none;">
                            <button type="button" id="roadTripsLoadMoreBtn" class="load-more-btn" onclick="loadMoreTrips()">Load more</button>
                        </div>
                        <p class="dblclick-hint">Double-click any trip for detailed guide</p>
                    </div>
                    <div class="section road-trips-placeholder" id="roadTripsPlaceholder">
                        <p class="placeholder-text">Select a region above or choose a month to see road trips.</p>
                    </div>
                    <!-- Vanlifer Country Info (contextual) -->
                    <div class="country-vanlifer-info" id="vanliferCountryInfo" style="display: none;">
                        <div class="country-vanlifer-header">
                            <h4><i data-lucide="truck" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> <span id="vanliferCountryName">Country</span> – Vanlifer Info</h4>
                        </div>
                        <div class="vanlifer-details">
                            <div class="detail-row">
                                <span class="detail-label"><svg class="icon" aria-hidden="true"><use href="#icon-route"></use></svg> Tolls</span>
                                <span class="detail-value" id="tollInfo">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"><svg class="icon" aria-hidden="true"><use href="#icon-tent"></use></svg> Wild Camping</span>
                                <span class="detail-value" id="campingInfo">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"><svg class="icon" aria-hidden="true"><use href="#icon-fuel"></use></svg> Fuel Cost</span>
                                <span class="detail-value" id="fuelInfo">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"><svg class="icon" aria-hidden="true"><use href="#icon-document"></use></svg> Visa (EU)</span>
                                <span class="detail-value" id="visaInfo">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"><svg class="icon" aria-hidden="true"><use href="#icon-car"></use></svg> Road Quality</span>
                                <span class="detail-value" id="roadQualityInfo">-</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label"><i data-lucide="droplets" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Water Access</span>
                                <span class="detail-value" id="waterInfo">-</span>
                            </div>
                        </div>
                    </div>
                    <div id="routeDetailsPanel" style="display: none;">
                        <div class="section">
                            <div class="section-title"><svg class="icon icon--lg" aria-hidden="true"><use href="#icon-car"></use></svg> Location 4x4 avec tente de toit</div>
                            <div id="rentalProvidersList"></div>
                        </div>
                        <div class="section">
                            <div class="section-title"><i data-lucide="tent" style="width:14px;height:14px;"></i> Campings sur la route</div>
                            <div id="campingSitesList"></div>
                        </div>
                    </div>
                </div>

                <!-- ==================== 2. TRAVELER'S TOOLKIT ==================== -->
                <div class="sidebar-block">
                    <div class="toolkit-section" id="toolkitSection">
                        <div class="toolkit-header">
                            <span class="toolkit-title"><i data-lucide="backpack" style="width:16px;height:16px;margin-right:4px;"></i> Traveler's Toolkit</span>
                            <span class="toolkit-label">Partner picks</span>
                        </div>
                        <div class="toolkit-items" id="toolkitItems"></div>
                    </div>
                </div>

                <div class="section plan-trip-section">
                    <div class="section-title"><i data-lucide="pen-tool" style="width:14px;height:14px;"></i> Plan Your Road Trip</div>
                    <p style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 10px;">Select a country above, then draw your route on the map!</p>
                    <button class="btn btn-serendipity" onclick="openTripPlannerModal()" id="planTripBtn" disabled><i data-lucide="pen-line" style="width:16px;height:16px;"></i> Draw Route on Map</button>
                    <div id="myPlannedTrips" style="margin-top: 12px;">
                        <div class="mini-title"><svg class="icon" aria-hidden="true"><use href="#icon-document"></use></svg> My Planned Trips</div>
                        <div id="plannedTripsList"></div>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title"><i data-lucide="link" style="width:14px;height:14px;"></i> Useful Travel Apps</div>
                    <div class="external-links-grid">
                        <a href="https://www.google.com/maps" target="_blank" class="ext-link-card"><span class="ext-icon"><i data-lucide="map" style="width:20px;height:20px;color:var(--brand-orange);"></i></span><span class="ext-name">Google Maps</span></a>
                        <a href="https://www.ioverlander.com" target="_blank" class="ext-link-card"><span class="ext-icon"><i data-lucide="tent" style="width:20px;height:20px;color:#22c55e;"></i></span><span class="ext-name">iOverlander</span></a>
                        <a href="https://park4night.com" target="_blank" class="ext-link-card"><span class="ext-icon"><i data-lucide="truck" style="width:20px;height:20px;color:#3b82f6;"></i></span><span class="ext-name">Park4Night</span></a>
                        <a href="https://www.gasbuddy.com" target="_blank" class="ext-link-card"><span class="ext-icon"><i data-lucide="fuel" style="width:20px;height:20px;color:#ef4444;"></i></span><span class="ext-name">GasBuddy</span></a>
                        <a href="https://www.booking.com" target="_blank" class="ext-link-card"><span class="ext-icon"><i data-lucide="bed-double" style="width:20px;height:20px;color:#8b5cf6;"></i></span><span class="ext-name">Booking</span></a>
                        <a href="https://maps.me" target="_blank" class="ext-link-card"><span class="ext-icon"><i data-lucide="smartphone" style="width:20px;height:20px;color:#06b6d4;"></i></span><span class="ext-name">Maps.me</span></a>
                    </div>
                </div>

                <div class="section">
                    <div class="section-title"><i data-lucide="save" style="width:14px;height:14px;"></i> Save/Load</div>
                    <div class="btn-group">
                        <button class="btn btn-secondary" onclick="exportData()"><i data-lucide="upload" style="width:14px;height:14px;"></i> Export</button>
                        <button class="btn btn-secondary" onclick="importData()"><i data-lucide="download" style="width:14px;height:14px;"></i> Import</button>
                    </div>
                    <input type="file" id="fileInput" class="hidden-input" accept=".json" onchange="handleImport(event)">
                </div>

                <div class="sponsored-tip" id="sponsoredTip1">
                    <span class="sponsored-tip-icon"><i data-lucide="lightbulb" style="width:18px;height:18px;color:var(--brand-orange);"></i></span>
                    <div class="sponsored-tip-content">
                        <div class="sponsored-tip-text">Planning an overlanding trip? Find free campsites, water points, and fuel stations worldwide.</div>
                        <div class="sponsored-tip-source">
                            <span class="sponsored-badge">Ad</span>
                            Tip from <a href="https://www.ioverlander.com" target="_blank" rel="noopener">iOverlander</a>
                        </div>
                    </div>
                </div>

                <div class="section league-section">
                    <div class="section-title"><i data-lucide="trophy" style="width:14px;height:14px;"></i> Road Trip League</div>
                    <div class="league-stats">
                        <div class="league-stat-card">
                            <div class="league-stat-value" id="completedTripsCount">0</div>
                            <div class="league-stat-label">Completed</div>
                        </div>
                        <div class="league-stat-card">
                            <div class="league-stat-value" id="totalKmCount">0</div>
                            <div class="league-stat-label">Total km</div>
                        </div>
                        <div class="league-stat-card">
                            <div class="league-stat-value" id="userRank">-</div>
                            <div class="league-stat-label">Rank</div>
                        </div>
                    </div>
                    <div class="league-badge" id="leagueBadge">
                        <span class="badge-icon"><i data-lucide="sprout" style="width:16px;height:16px;"></i></span>
                        <span class="badge-title">Beginner Explorer</span>
                    </div>
                    <button class="btn btn-secondary" style="margin-top: 10px; font-size: 0.8rem;" onclick="openLeaderboardModal()"><i data-lucide="crown" style="width:14px;height:14px;"></i> View Leaderboard</button>
                </div>

                <div class="section">
                    <div class="section-title"><i data-lucide="plus-circle" style="width:14px;height:14px;"></i> Create Road Trip</div>
                    <p style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 10px;">Share your own adventure with the community!</p>
                    <button class="btn btn-serendipity" onclick="openCreateTripModal()">+ Create New Trip</button>
                </div>

                <div class="section">
                    <div class="section-title"><i data-lucide="compass" style="width:14px;height:14px;"></i> Explore Country Roads</div>
                    <p style="font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 10px;">Click any country on the map to zoom in and see main highways.</p>
                    <div id="countryRoadsInfo" style="display: none;">
                        <div class="country-roads-card">
                            <h4 id="selectedRoadsCountry">-</h4>
                            <button class="btn btn-secondary" style="font-size: 0.75rem;" onclick="resetRoadMapView()"><i data-lucide="arrow-left" style="width:14px;height:14px;"></i> Back to World View</button>
                        </div>
                    </div>
                </div>

                <div class="section community-alerts">
                    <div class="section-title"><i data-lucide="alert-triangle" style="width:14px;height:14px;"></i> Community Alerts</div>
                    <div id="alertsList"></div>
                    <button class="add-alert-btn" onclick="openAlertModal()">+ Add Road Alert</button>
                </div>
            </div>
        </aside>

        <div class="map-container" id="mapContainer">
            <!-- Loading Indicator -->
            <div class="map-loading" id="mapLoading" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 1000;">
                <div style="margin-bottom: 10px;"><i data-lucide="globe" style="width:48px;height:48px;color:var(--brand-orange);"></i></div>
                <div style="font-size: 1.2rem; color: var(--text-secondary); font-family: Inter, system-ui, sans-serif;">Loading map...</div>
            </div>
            
            <div class="zoom-controls" id="zoomControls">
                <button class="zoom-btn" onclick="zoomIn()" title="Zoom in">+</button>
                <button class="zoom-btn" onclick="zoomOut()" title="Zoom out">−</button>
                <button class="zoom-btn" onclick="resetZoom()" title="Reset">⟲</button>
            </div>
            <!-- D3 World Map -->
            <svg id="worldMap" width="100%" height="100%" viewBox="0 0 2000 1000" preserveAspectRatio="xMidYMid meet"></svg>
            <!-- Leaflet Road Map -->
            <div id="roadMap"></div>
            
            <!-- POI Layer Controls (shown only in Road Trips mode) -->
            <div class="poi-controls" id="poiControls" style="display: none;">
                <div class="poi-controls-header">
                    <span class="poi-controls-title"><i data-lucide="map-pin" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Points of Interest</span>
                    <button class="poi-controls-toggle" onclick="togglePoiPanel()" title="Collapse">−</button>
                </div>
                <div class="poi-toggles" id="poiToggles">
                    <button class="poi-toggle" onclick="togglePoi('campsiteFree', this)" data-type="campsiteFree">
                        <span class="poi-icon"><svg class="icon" aria-hidden="true"><use href="#icon-tent"></use></svg></span>
                        <span>Free Camps</span>
                        <span class="poi-count" id="countCampsiteFree">0</span>
                    </button>
                    <button class="poi-toggle" onclick="togglePoi('campsitePaid', this)" data-type="campsitePaid">
                        <span class="poi-icon"><i data-lucide="tent" style="width:14px;height:14px;"></i></span>
                        <span>Paid Camps</span>
                        <span class="poi-count" id="countCampsitePaid">0</span>
                    </button>
                    <button class="poi-toggle" onclick="togglePoi('fuel', this)" data-type="fuel">
                        <span class="poi-icon"><svg class="icon" aria-hidden="true"><use href="#icon-fuel"></use></svg></span>
                        <span>Fuel</span>
                        <span class="poi-count" id="countFuel">0</span>
                    </button>
                    <button class="poi-toggle" onclick="togglePoi('grocery', this)" data-type="grocery">
                        <span class="poi-icon"><i data-lucide="shopping-cart" style="width:14px;height:14px;"></i></span>
                        <span>Grocery</span>
                        <span class="poi-count" id="countGrocery">0</span>
                    </button>
                    <button class="poi-toggle" onclick="togglePoi('water', this)" data-type="water">
                        <span class="poi-icon"><i data-lucide="droplets" style="width:14px;height:14px;"></i></span>
                        <span>Water</span>
                        <span class="poi-count" id="countWater">0</span>
                    </button>
                    <button class="poi-toggle" onclick="togglePoi('viewpoint', this)" data-type="viewpoint">
                        <span class="poi-icon"><svg class="icon" aria-hidden="true"><use href="#icon-camera"></use></svg></span>
                        <span>Views</span>
                        <span class="poi-count" id="countViewpoint">0</span>
                    </button>
                    <button class="poi-toggle" onclick="togglePoi('restArea', this)" data-type="restArea">
                        <span class="poi-icon"><i data-lucide="square-parking" style="width:14px;height:14px;"></i></span>
                        <span>Rest</span>
                        <span class="poi-count" id="countRestArea">0</span>
                    </button>
                    <button class="poi-toggle" onclick="togglePoi('mechanic', this)" data-type="mechanic">
                        <span class="poi-icon"><i data-lucide="wrench" style="width:14px;height:14px;"></i></span>
                        <span>Service</span>
                        <span class="poi-count" id="countMechanic">0</span>
                    </button>
                </div>
                <div class="poi-legend">
                    <strong>Sur la carte :</strong> <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-car"></use></svg> Départ • <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-flag"></use></svg> Arrivée • 1,2,3… Grandes étapes • Boutons ci‑dessus = <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-fuel"></use></svg> Essence, <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-tent"></use></svg> Camping, Courses, etc.
                </div>
                <div class="poi-legend" style="margin-top: 4px;">
                    <i data-lucide="info" style="width:12px;height:12px;vertical-align:-1px;margin-right:2px;"></i> Données de référence. Vérifier sur Google Maps avant de partir.
                </div>
            </div>
            
            <!-- Offline Indicator -->
            <div class="offline-indicator" id="offlineIndicator">
                <i data-lucide="wifi-off" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Offline Mode - Using cached POI data
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div class="modal-overlay" id="alertModal">
        <div class="modal">
            <div class="modal-header">
                <h3><i data-lucide="siren" style="width:20px;height:20px;vertical-align:-3px;margin-right:6px;color:var(--brand-orange);"></i> Report Road Alert</h3>
                <button class="modal-close" onclick="closeAlertModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Alert Type</label>
                    <select class="form-select" id="alertType">
                        <option value="road_work">Road Work / Closure</option>
                        <option value="hazard">Road Hazard</option>
                        <option value="police">Police Control</option>
                        <option value="fuel">Fuel Station Issue</option>
                        <option value="camping">Camping Spot Update</option>
                        <option value="tip">Helpful Tip</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location / Route</label>
                    <input type="text" class="form-input" id="alertLocation" placeholder="e.g., Route 66, near Flagstaff">
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea class="form-input" id="alertDescription" placeholder="Describe the situation..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="width: auto;" onclick="closeAlertModal()">Cancel</button>
                <button class="btn btn-serendipity" style="width: auto;" onclick="submitAlert()">Submit Alert</button>
            </div>
        </div>
    </div>

    <!-- Leaderboard Modal -->
    <div class="modal-overlay" id="leaderboardModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3><i data-lucide="trophy" style="width:20px;height:20px;vertical-align:-3px;margin-right:6px;color:var(--brand-orange);"></i> Road Trip Leaderboard</h3>
                <button class="modal-close" onclick="closeLeaderboardModal()">×</button>
            </div>
            <div class="modal-body">
                <div class="leaderboard-list" id="leaderboardList">
                    <!-- Populated dynamically -->
                </div>
                <div class="league-tiers">
                    <h4 style="margin: 15px 0 10px; color: var(--text-secondary);">League Tiers</h4>
                    <div class="tier-item"><i data-lucide="sprout" style="width:14px;height:14px;color:#22c55e;"></i> Beginner Explorer (0-2 trips)</div>
                    <div class="tier-item"><i data-lucide="car" style="width:14px;height:14px;color:#3b82f6;"></i> Road Warrior (3-5 trips)</div>
                    <div class="tier-item"><i data-lucide="mountain" style="width:14px;height:14px;color:#8b5cf6;"></i> Adventure Seeker (6-10 trips)</div>
                    <div class="tier-item"><i data-lucide="globe" style="width:14px;height:14px;color:var(--brand-orange);"></i> World Traveler (11-15 trips)</div>
                    <div class="tier-item"><i data-lucide="crown" style="width:14px;height:14px;color:#f59e0b;"></i> Legendary Explorer (16+ trips)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Road Trip Modal -->
    <div class="modal-overlay" id="createTripModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h3><i data-lucide="plus-circle" style="width:20px;height:20px;vertical-align:-3px;margin-right:6px;color:var(--brand-orange);"></i> Create New Road Trip</h3>
                <button class="modal-close" onclick="closeCreateTripModal()">×</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div class="form-group">
                    <label>Trip Name *</label>
                    <input type="text" class="form-input" id="newTripName" placeholder="e.g., Costa Brava Coastal Adventure">
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label>Country *</label>
                        <input type="text" class="form-input" id="newTripCountry" placeholder="e.g., Spain">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Distance (km) *</label>
                        <input type="number" class="form-input" id="newTripDistance" placeholder="e.g., 500">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 1;">
                        <label>Duration *</label>
                        <input type="text" class="form-input" id="newTripDuration" placeholder="e.g., 3-5 days">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Icon (emoji)</label>
                        <input type="text" class="form-input" id="newTripIcon" placeholder="🚗" maxlength="4">
                    </div>
                </div>
                <div class="form-group">
                    <label>Description *</label>
                    <textarea class="form-input" id="newTripDescription" placeholder="Describe what makes this road trip special..."></textarea>
                </div>
                <div class="form-group">
                    <label>Tips for travelers</label>
                    <textarea class="form-input" id="newTripTips" placeholder="Best time to visit, what to pack, warnings..."></textarea>
                </div>
                <div class="form-group">
                    <label>Tags</label>
                    <div class="tag-selector">
                        <label class="tag-checkbox"><input type="checkbox" value="scenic"> Scenic</label>
                        <label class="tag-checkbox"><input type="checkbox" value="adventure"> Adventure</label>
                        <label class="tag-checkbox"><input type="checkbox" value="historic"> Historic</label>
                        <label class="tag-checkbox"><input type="checkbox" value="camping"> Camping</label>
                        <label class="tag-checkbox"><input type="checkbox" value="toll-free"> Toll-Free</label>
                        <label class="tag-checkbox"><input type="checkbox" value="fourx4"> 4x4</label>
                        <label class="tag-checkbox"><input type="checkbox" value="wildlife"> Wildlife</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>Waypoints / Milestones *</label>
                    <p style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 8px;">Add key stops on your route (minimum 2)</p>
                    <div id="waypointsList">
                        <div class="waypoint-row">
                            <input type="text" class="form-input waypoint-name" placeholder="Place name (e.g., Barcelona)">
                            <input type="number" class="form-input waypoint-lat" placeholder="Latitude" step="0.0001">
                            <input type="number" class="form-input waypoint-lng" placeholder="Longitude" step="0.0001">
                            <button class="btn-icon" onclick="removeWaypoint(this)" title="Remove">×</button>
                        </div>
                        <div class="waypoint-row">
                            <input type="text" class="form-input waypoint-name" placeholder="Place name">
                            <input type="number" class="form-input waypoint-lat" placeholder="Latitude" step="0.0001">
                            <input type="number" class="form-input waypoint-lng" placeholder="Longitude" step="0.0001">
                            <button class="btn-icon" onclick="removeWaypoint(this)" title="Remove">×</button>
                        </div>
                    </div>
                    <button class="btn btn-secondary" style="font-size: 0.75rem; margin-top: 8px;" onclick="addWaypoint()">+ Add Waypoint</button>
                    <p style="font-size: 0.65rem; color: var(--text-muted); margin-top: 5px;"><i data-lucide="info" style="width:11px;height:11px;vertical-align:-1px;"></i> Tip: Get coordinates from Google Maps (right-click → "What's here?")</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" style="width: auto;" onclick="closeCreateTripModal()">Cancel</button>
                <button class="btn btn-serendipity" style="width: auto;" onclick="submitNewTrip()"><i data-lucide="send" style="width:14px;height:14px;"></i> Submit Trip</button>
            </div>
        </div>
    </div>

    <!-- Print Travel Poster Modal -->
    <div class="modal-overlay" id="printPosterModal">
        <div class="modal poster-modal">
            <div class="modal-header">
                <h3><i data-lucide="image" style="width:20px;height:20px;vertical-align:-3px;margin-right:6px;color:var(--brand-orange);"></i> Create Your Travel Poster</h3>
                <button class="modal-close" onclick="closePrintPosterModal()">×</button>
            </div>
            
            <div class="poster-preview-container">
                <div class="poster-canvas" id="posterCanvas">
                    <div class="poster-header">
                        <div class="poster-title">MY ADVENTURES</div>
                        <div class="poster-subtitle" id="posterUserName">Explorer's Travel Map</div>
                    </div>
                    
                    <div class="poster-stats-grid">
                        <div class="poster-stat">
                            <div class="poster-stat-value" id="posterCountries">0</div>
                            <div class="poster-stat-label">Countries</div>
                        </div>
                        <div class="poster-stat">
                            <div class="poster-stat-value" id="posterTrips">0</div>
                            <div class="poster-stat-label">Road Trips</div>
                        </div>
                        <div class="poster-stat">
                            <div class="poster-stat-value" id="posterKm">0</div>
                            <div class="poster-stat-label">KM Driven</div>
                        </div>
                    </div>
                    
                    <div class="poster-section-title">Completed Road Trips</div>
                    <div class="poster-trips-list" id="posterTripsList">
                        <div style="text-align: center; color: #8b7355; font-style: italic; padding: 20px;">
                            Complete road trips to see them here!
                        </div>
                    </div>
                    
                    <div class="poster-section-title">Countries Visited</div>
                    <div class="poster-countries-grid" id="posterCountriesList">
                        <div style="color: #8b7355; font-style: italic;">Mark countries as visited to see them here</div>
                    </div>
                    
                    <div class="poster-section-title">Trip Memories</div>
                    <div class="poster-memories" id="posterMemories">
                        <div class="poster-memory"><i data-lucide="camera" style="width:20px;height:20px;opacity:0.4;"></i></div>
                        <div class="poster-memory"><i data-lucide="camera" style="width:20px;height:20px;opacity:0.4;"></i></div>
                        <div class="poster-memory"><i data-lucide="camera" style="width:20px;height:20px;opacity:0.4;"></i></div>
                        <div class="poster-memory"><i data-lucide="camera" style="width:20px;height:20px;opacity:0.4;"></i></div>
                    </div>
                    <p style="font-size: 0.7rem; color: #8b7355; text-align: center; margin-top: 8px;">
                        <span class="premium-badge"><i data-lucide="star" style="width:10px;height:10px;"></i> Premium</span> Upload photos with premium
                    </p>
                    
                    <div class="poster-footer">
                        <div class="poster-qr-placeholder" title="QR code to your digital map"></div>
                        <div class="poster-footer-text">Scan to view my interactive travel map</div>
                        <div class="poster-footer-text" style="margin-top: 10px;">Created with Srndipity • drawmymap.com</div>
                    </div>
                </div>
            </div>
            
            <div class="poster-options">
                <div style="font-size: 0.85rem; font-weight: 600; margin-bottom: 10px;">Choose your format:</div>
                <div class="poster-options-grid">
                    <div class="poster-option selected" onclick="selectPosterOption(this, 'digital')">
                        <div class="poster-option-icon"><i data-lucide="smartphone" style="width:24px;height:24px;"></i></div>
                        <div class="poster-option-name">Digital Download</div>
                        <div class="poster-option-price">Free (with watermark)</div>
                    </div>
                    <div class="poster-option" onclick="selectPosterOption(this, 'hd')">
                        <div class="poster-option-icon"><i data-lucide="monitor" style="width:24px;height:24px;"></i></div>
                        <div class="poster-option-name">HD Download</div>
                        <div class="poster-option-price">$2.99</div>
                    </div>
                    <div class="poster-option" onclick="selectPosterOption(this, 'print')">
                        <div class="poster-option-icon"><i data-lucide="printer" style="width:24px;height:24px;"></i></div>
                        <div class="poster-option-name">Printed Poster</div>
                        <div class="poster-option-price">From $14.99</div>
                    </div>
                </div>
                <div class="poster-actions">
                    <button class="btn btn-secondary" onclick="closePrintPosterModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="downloadPoster()" id="posterDownloadBtn"><i data-lucide="download" style="width:14px;height:14px;"></i> Download Free</button>
                    <button class="btn go-premium-btn" onclick="showPremiumUpgrade()"><i data-lucide="star" style="width:14px;height:14px;"></i> Go Premium - $4.99/year</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Upgrade Modal -->
    <div class="modal-overlay" id="premiumModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-header">
                <h3><i data-lucide="star" style="width:20px;height:20px;vertical-align:-3px;margin-right:6px;color:#f59e0b;"></i> Go Premium</h3>
                <button class="modal-close" onclick="closePremiumModal()">×</button>
            </div>
            <div class="modal-body" style="text-align: center; padding: 30px;">
                <div style="margin-bottom: 15px;"><i data-lucide="gem" style="width:48px;height:48px;color:var(--brand-orange);"></i></div>
                <h2 style="margin-bottom: 10px;">Unlock All Features</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">One-time payment, lifetime access</p>
                
                <div style="text-align: left; background: var(--bg-elevated); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="color: var(--success);">✓</span>
                        <span>Ad-free experience</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="color: var(--success);">✓</span>
                        <span>HD poster downloads (no watermark)</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="color: var(--success);">✓</span>
                        <span>Upload trip photos & memories</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="color: var(--success);">✓</span>
                        <span>Print-ready poster exports</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                        <span style="color: var(--success);">✓</span>
                        <span>Priority access to new road trips</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="color: var(--success);">✓</span>
                        <span>Support indie development ❤️</span>
                    </div>
                </div>
                
                <div style="font-size: 2rem; font-weight: 700; color: var(--accent-primary); margin-bottom: 5px;">$4.99</div>
                <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 20px;">one-time payment</div>
                
                <button class="btn go-premium-btn" style="width: 100%; padding: 16px; font-size: 1rem;" onclick="processPremiumPurchase()">
                    <i data-lucide="star" style="width:16px;height:16px;"></i> Upgrade to Premium
                </button>
                <p style="font-size: 0.7rem; color: var(--text-muted); margin-top: 10px;">
                    Secure payment via Stripe. 30-day money-back guarantee.
                </p>
            </div>
        </div>
    </div>

    <!-- Road Trip Detail Modal - Full Screen Experience -->
    <div class="trip-fullscreen-modal" id="tripDetailModal">
        <!-- Hero Header -->
        <div class="trip-hero" id="tripHero">
            <div class="trip-hero-overlay"></div>
            <button class="trip-close-btn" onclick="closeTripDetailModal()">
                <span>✕</span>
            </button>
            <div class="trip-hero-content">
                <div class="trip-hero-badge" id="tripHeroBadge">
                    <span class="hero-icon" id="tripDetailIcon"><svg class="icon icon--lg" aria-hidden="true"><use href="#icon-route"></use></svg></span>
                </div>
                <h1 class="trip-hero-title" id="tripDetailName">Road Trip Name</h1>
                <div class="trip-hero-meta">
                    <span class="hero-meta-item"><i data-lucide="map-pin" style="width:14px;height:14px;vertical-align:-2px;"></i> <span id="tripDetailCountry">Country</span></span>
                    <span class="hero-meta-divider">|</span>
                    <span class="hero-meta-item"><i data-lucide="ruler" style="width:14px;height:14px;vertical-align:-2px;"></i> <span id="tripDetailDistance">0 km</span></span>
                    <span class="hero-meta-divider">|</span>
                    <span class="hero-meta-item"><i data-lucide="clock" style="width:14px;height:14px;vertical-align:-2px;"></i> <span id="tripDetailDuration">0 days</span></span>
                </div>
                <div class="trip-hero-rating">
                    <span class="hero-stars" id="tripHeroStars">★★★★★</span>
                    <span class="hero-rating-value" id="tripDetailRating">4.8</span>
                    <span class="hero-reviews-count">(<span id="tripReviewsCount">0</span> reviews)</span>
                </div>
                <div class="trip-hero-tags" id="tripHeroTags"></div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="trip-nav">
            <div class="trip-nav-tabs">
                <button class="trip-nav-tab active" data-tab="overview" onclick="switchTripTab('overview')">
                    <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-document"></use></svg> Overview
                </button>
                <button class="trip-nav-tab" data-tab="route" onclick="switchTripTab('route')">
                    <i data-lucide="map" style="width:14px;height:14px;"></i> Route
                </button>
                <button class="trip-nav-tab" data-tab="budget" onclick="switchTripTab('budget')">
                    <i data-lucide="wallet" style="width:14px;height:14px;"></i> Budget
                </button>
                <button class="trip-nav-tab" data-tab="planning" onclick="switchTripTab('planning')">
                    <i data-lucide="clipboard-list" style="width:14px;height:14px;"></i> Planning
                </button>
                <button class="trip-nav-tab" data-tab="preparation" onclick="switchTripTab('preparation')">
                    <svg class="icon icon--sm" aria-hidden="true"><use href="#icon-prep"></use></svg> Préparation
                </button>
                <button class="trip-nav-tab" data-tab="community" onclick="switchTripTab('community')">
                    <i data-lucide="message-circle" style="width:14px;height:14px;"></i> Community
                </button>
                <button class="trip-nav-tab" data-tab="guide" onclick="switchTripTab('guide')">
                    <i data-lucide="book-open" style="width:14px;height:14px;"></i> Guide
                </button>
                <button class="trip-nav-tab" data-tab="booking" onclick="switchTripTab('booking')">
                    <i data-lucide="ticket" style="width:14px;height:14px;"></i> Booking
                </button>
            </div>
            <div class="trip-nav-actions">
                <button class="trip-action-btn" onclick="viewTripOnMap()" title="View on Map"><i data-lucide="map" style="width:16px;height:16px;"></i></button>
                <button class="trip-action-btn" onclick="markCurrentTripCompleted()" title="Mark Done"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-check"></use></svg></button>
                <button class="trip-action-btn" onclick="shareTripLink()" title="Share"><i data-lucide="share-2" style="width:16px;height:16px;"></i></button>
            </div>
        </div>

        <!-- Tab Content Container -->
        <div class="trip-content-container">
            <!-- Overview Tab -->
            <div class="trip-tab-content active" id="tab-overview">
                <div class="trip-grid">
                    <!-- Left Column -->
                    <div class="trip-main-col">
                        <!-- Quick Stats -->
                        <div class="trip-stats-row compact">
                            <div class="trip-stat-card">
                                <div class="stat-icon"><i data-lucide="gauge" style="width:20px;height:20px;color:var(--brand-orange);"></i></div>
                                <div class="stat-info">
                                    <div class="stat-value" id="tripDetailDifficulty">Moderate</div>
                                    <div class="stat-label">Difficulty</div>
                                </div>
                            </div>
                            <div class="trip-stat-card">
                                <div class="stat-icon"><i data-lucide="calendar" style="width:20px;height:20px;color:var(--brand-orange);"></i></div>
                                <div class="stat-info">
                                    <div class="stat-value" id="tripDetailSeason">Spring</div>
                                    <div class="stat-label">Best Season</div>
                                </div>
                            </div>
                            <div class="trip-stat-card">
                                <div class="stat-icon"><i data-lucide="wallet" style="width:20px;height:20px;color:var(--brand-orange);"></i></div>
                                <div class="stat-info">
                                    <div class="stat-value" id="tripDetailBudget">$2000</div>
                                    <div class="stat-label">Est. Budget</div>
                                </div>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="trip-card">
                            <h3><i data-lucide="file-text" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> About This Trip</h3>
                            <p class="trip-description" id="tripDetailDescription"></p>
                        </div>

                        <!-- Highlights -->
                        <div class="trip-card">
                            <h3><i data-lucide="sparkles" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Trip Highlights</h3>
                            <div class="trip-highlights" id="tripDetailHighlights"></div>
                        </div>

                        <!-- Must Know -->
                        <div class="trip-card warning-card">
                            <h3><i data-lucide="alert-triangle" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;color:#f59e0b;"></i> Must Know Before You Go</h3>
                            <ul class="must-know-list" id="tripDetailMustKnow"></ul>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="trip-side-col">
                        <!-- Top Recommendations -->
                        <div class="trip-card recommendations-card">
                            <h3><i data-lucide="trophy" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;color:var(--brand-orange);"></i> Top Recommendations</h3>
                            <div class="recommendations-list" id="tripRecommendations"></div>
                        </div>

                        <!-- Packing Essentials -->
                        <div class="trip-card">
                            <h3><i data-lucide="backpack" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Packing Essentials</h3>
                            <div class="packing-list" id="tripPackingList"></div>
                        </div>

                        <!-- Contextual Partner Recommendation (Native Ad) -->
                        <div id="tripDetailAdSlot"></div>
                    </div>
                </div>
            </div>

            <!-- Route Tab: map + issues + POI + waypoints -->
            <div class="trip-tab-content" id="tab-route">
                <!-- Variant Duration Bar -->
                <div class="variant-bar" id="variantBar" style="display:none;">
                    <span class="variant-bar-label"><i data-lucide="clock" style="width:13px;height:13px;vertical-align:-2px;margin-right:3px;"></i> Duration</span>
                    <div class="variant-chips" id="variantChips">
                        <!-- Populated dynamically -->
                    </div>
                    <div class="variant-community-switcher">
                        <i data-lucide="users" style="width:13px;height:13px;color:#64748b;"></i>
                        <select class="variant-community-select" id="variantCommunitySelect" onchange="switchVariantCommunity(this.value)">
                            <option value="top">Top Rated</option>
                            <option value="newest">Newest</option>
                        </select>
                    </div>
                    <button class="variant-propose-btn" onclick="openProposeVariantModal()">
                        <i data-lucide="plus" style="width:13px;height:13px;"></i> Propose Variant
                    </button>
                </div>
                <!-- Variant Info Strip -->
                <div class="variant-info-strip" id="variantInfoStrip" style="display:none;">
                    <span class="vi-label" id="variantName">Full Route</span>
                    <span class="vi-stat"><i data-lucide="map-pin" style="width:12px;height:12px;"></i> <span id="variantStops">0</span> stops</span>
                    <span class="vi-stat"><i data-lucide="ruler" style="width:12px;height:12px;"></i> <span id="variantDistance">0 km</span></span>
                    <span class="vi-stat"><i data-lucide="star" style="width:12px;height:12px;color:#f59e0b;"></i> <span id="variantScore">0</span></span>
                    <button class="variant-upvote-btn" id="variantUpvoteBtn" onclick="upvoteCurrentVariant()">
                        <i data-lucide="thumbs-up" style="width:12px;height:12px;"></i> <span id="variantUpvoteCount">0</span>
                    </button>
                </div>
                <!-- Pending Community Proposals -->
                <div class="variant-pending-section" id="variantPendingSection" style="display:none;">
                    <div class="variant-pending-header">
                        <i data-lucide="clock" style="width:14px;height:14px;color:#f59e0b;"></i>
                        <span>Community Proposals</span>
                        <span class="variant-pending-count" id="variantPendingCount">0</span>
                    </div>
                    <div class="variant-pending-list" id="variantPendingList"></div>
                </div>

                <div class="route-tab-layout">
                    <!-- Map: zoom on road, POI layers -->
                    <div class="route-map-section">
                        <!-- GPX Export Bar -->
                        <div class="gpx-export-bar" id="gpxExportBar">
                            <span class="gpx-label"><i data-lucide="download" style="width:14px;height:14px;vertical-align:-2px;margin-right:4px;"></i> Export Route:</span>
                            <button class="gpx-export-btn gpx-file" onclick="exportRouteGPX()"><i data-lucide="file-down" style="width:12px;height:12px;"></i> GPX File</button>
                            <a class="gpx-export-btn google-maps" id="googleMapsExportLink" href="#" target="_blank" rel="noopener" onclick="exportToGoogleMaps(event)"><i data-lucide="map" style="width:12px;height:12px;"></i> Google Maps</a>
                            <a class="gpx-export-btn apple-maps" id="appleMapsExportLink" href="#" target="_blank" rel="noopener" onclick="exportToAppleMaps(event)"><i data-lucide="smartphone" style="width:12px;height:12px;"></i> Apple Maps</a>
                        </div>
                        <div class="route-map-header">
                            <h3><i data-lucide="map" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Route Map</h3>
                            <div class="poi-filter-bar" id="tripRoutePoiToggles">
                                <!-- Fuel -->
                                <div class="poi-filter-group" id="pfg-fuel">
                                    <button class="poi-filter-toggle active" data-poi="fuel" onclick="togglePoiFilter('fuel')"><svg class="icon" aria-hidden="true"><use href="#icon-fuel"></use></svg> Fuel <span class="poi-f-count" id="pfc-fuel">0</span></button>
                                </div>
                                <!-- Camp (nested) -->
                                <div class="poi-filter-group" id="pfg-camp">
                                    <button class="poi-filter-toggle has-sub active" onclick="togglePoiSubMenu('pfg-camp')"><svg class="icon" aria-hidden="true"><use href="#icon-tent"></use></svg> Camp <span class="poi-f-count" id="pfc-camp">0</span></button>
                                    <div class="poi-sub-menu">
                                        <div class="poi-sub-item active" data-sub="campsiteFree" onclick="togglePoiSub('campsiteFree', this)">
                                            <span class="poi-sub-check">✓</span><span class="poi-sub-icon">⛺</span><span class="poi-sub-label">Wild spot with a view</span><span class="poi-sub-count" id="pfc-campsiteFree">0</span>
                                        </div>
                                        <div class="poi-sub-item active" data-sub="campsitePaid" onclick="togglePoiSub('campsitePaid', this)">
                                            <span class="poi-sub-check">✓</span><span class="poi-sub-icon">🏕️</span><span class="poi-sub-label">Full-service Campsite</span><span class="poi-sub-count" id="pfc-campsitePaid">0</span>
                                        </div>
                                        <div class="poi-sub-item" data-sub="overnightParking" onclick="togglePoiSub('overnightParking', this)">
                                            <span class="poi-sub-check"></span><span class="poi-sub-icon">🅿️</span><span class="poi-sub-label">Overnight Parking allowed</span><span class="poi-sub-count" id="pfc-overnightParking">0</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Food (nested) -->
                                <div class="poi-filter-group" id="pfg-food">
                                    <button class="poi-filter-toggle has-sub active" onclick="togglePoiSubMenu('pfg-food')"><i data-lucide="shopping-cart" style="width:14px;height:14px;"></i> Food <span class="poi-f-count" id="pfc-food">0</span></button>
                                    <div class="poi-sub-menu">
                                        <div class="poi-sub-item active" data-sub="grocery" onclick="togglePoiSub('grocery', this)">
                                            <span class="poi-sub-check">✓</span><span class="poi-sub-icon">🛒</span><span class="poi-sub-label">Supermarket</span><span class="poi-sub-count" id="pfc-grocery">0</span>
                                        </div>
                                        <div class="poi-sub-item" data-sub="localProducer" onclick="togglePoiSub('localProducer', this)">
                                            <span class="poi-sub-check"></span><span class="poi-sub-icon">🧑‍🌾</span><span class="poi-sub-label">Local Producer</span><span class="poi-sub-count" id="pfc-localProducer">0</span>
                                        </div>
                                        <div class="poi-sub-item" data-sub="organicRestaurant" onclick="togglePoiSub('organicRestaurant', this)">
                                            <span class="poi-sub-check"></span><span class="poi-sub-icon">🥗</span><span class="poi-sub-label">Organic Restaurant</span><span class="poi-sub-count" id="pfc-organicRestaurant">0</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- Views -->
                                <div class="poi-filter-group" id="pfg-viewpoint">
                                    <button class="poi-filter-toggle" data-poi="viewpoint" onclick="togglePoiFilter('viewpoint')"><svg class="icon" aria-hidden="true"><use href="#icon-camera"></use></svg> Views <span class="poi-f-count" id="pfc-viewpoint">0</span></button>
                                </div>
                                <!-- Water -->
                                <div class="poi-filter-group" id="pfg-water">
                                    <button class="poi-filter-toggle" data-poi="water" onclick="togglePoiFilter('water')"><i data-lucide="droplets" style="width:14px;height:14px;"></i> Water</button>
                                </div>
                                <!-- Premium -->
                                <div class="poi-filter-group" id="pfg-premium">
                                    <button class="poi-filter-toggle" data-poi="premium" onclick="togglePoiFilter('premium')" style="border-color:#f59e0b;color:#d97706;"><i data-lucide="star" style="width:14px;height:14px;"></i> Partners</button>
                                </div>
                                <!-- Add POI -->
                                <button class="poi-filter-toggle" style="background:var(--brand-orange);color:#fff;border-color:var(--brand-orange);" onclick="openAddPoiModal()" title="Add POI"><i data-lucide="plus-circle" style="width:14px;height:14px;"></i> Add POI</button>
                            </div>
                        </div>
                        <div class="route-map-container" id="tripDetailMapContainer" style="position:relative;">
                            <button class="night-mode-toggle" id="nightModeToggle" onclick="toggleNightMode()" title="Toggle Night Mode">
                                <i data-lucide="moon" style="width:14px;height:14px;"></i> <span id="nightModeLabel">Night Mode</span>
                            </button>
                            <div id="tripDetailMap" class="trip-detail-map"></div>
                            <div class="route-map-legend" id="tripRouteMapLegend">
                                <span class="legend-route">—— Route</span>
                                <span class="legend-start"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-car"></use></svg> Départ</span>
                                <span class="legend-end"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-flag"></use></svg> Arrivée</span>
                                <span class="legend-etape">1,2,3… Étapes</span>
                                <span class="legend-poi"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-fuel"></use></svg> Essence</span>
                                <span class="legend-poi"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-tent"></use></svg> Camp gratuit</span>
                                <span class="legend-poi"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-tent"></use></svg> Camp payant</span>
                                <span class="legend-poi"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-document"></use></svg> Courses</span>
                                <span class="legend-poi"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-camera"></use></svg> Points de vue</span>
                            </div>
                            <!-- POI Placement Indicator -->
                            <div class="poi-drag-panel" id="poiPlaceIndicator" style="display:none;">
                                <div class="poi-drag-item" style="border-color:var(--brand-orange);color:var(--brand-orange);border-style:solid;cursor:default;">
                                    <span class="poi-drag-icon" id="poiPlaceIconPreview">📍</span>
                                    <span id="poiPlaceCatLabel">Click on the map</span>
                                </div>
                                <button class="poi-drag-item" style="border-style:solid;border-color:#ef4444;color:#ef4444;" onclick="cancelPoiPlacement()">
                                    <span class="poi-drag-icon">✕</span>
                                    <span>Cancel</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- Potential issues (from Must Know) -->
                    <div class="trip-card route-issues-card warning-card">
                        <h3><i data-lucide="alert-triangle" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;color:#f59e0b;"></i> Potential Issues & Must Know</h3>
                        <ul class="route-issues-list" id="tripRouteIssuesList"></ul>
                    </div>
                    <!-- Waypoints / pitstops -->
                    <div class="trip-card route-card">
                        <div class="route-header">
                            <h3><i data-lucide="navigation" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Stops & Pitstops</h3>
                            <span class="stops-count"><span id="waypointsCount">0</span> stops</span>
                        </div>
                        <div class="route-timeline" id="tripDetailWaypoints"></div>
                    </div>
                </div>
            </div>

            <!-- Budget Tab -->
            <div class="trip-tab-content" id="tab-budget">
                <div class="budget-grid">
                    <div class="budget-breakdown">
                        <h3><i data-lucide="wallet" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Cost Breakdown</h3>
                        <div class="budget-items">
                            <div class="budget-item">
                                <div class="budget-item-icon"><i data-lucide="fuel" style="width:18px;height:18px;color:var(--brand-orange);"></i></div>
                                <div class="budget-item-info">
                                    <span class="budget-item-label">Fuel</span>
                                    <span class="budget-item-value" id="tripFuelCost">~$300</span>
                                </div>
                                <div class="budget-item-bar"><div class="bar-fill fuel"></div></div>
                            </div>
                            <div class="budget-item">
                                <div class="budget-item-icon"><svg class="icon" aria-hidden="true"><use href="#icon-route"></use></svg></div>
                                <div class="budget-item-info">
                                    <span class="budget-item-label">Tolls</span>
                                    <span class="budget-item-value" id="tripTollCost">~$50</span>
                                </div>
                                <div class="budget-item-bar"><div class="bar-fill tolls"></div></div>
                            </div>
                            <div class="budget-item">
                                <div class="budget-item-icon"><i data-lucide="bed-double" style="width:18px;height:18px;color:#8b5cf6;"></i></div>
                                <div class="budget-item-info">
                                    <span class="budget-item-label">Accommodation</span>
                                    <span class="budget-item-value" id="tripAccomCost">~$800</span>
                                </div>
                                <div class="budget-item-bar"><div class="bar-fill accommodation"></div></div>
                            </div>
                            <div class="budget-item">
                                <div class="budget-item-icon"><i data-lucide="utensils" style="width:18px;height:18px;color:#22c55e;"></i></div>
                                <div class="budget-item-info">
                                    <span class="budget-item-label">Food & Drinks</span>
                                    <span class="budget-item-value" id="tripFoodCost">~$400</span>
                                </div>
                                <div class="budget-item-bar"><div class="bar-fill food"></div></div>
                            </div>
                        </div>
                        <div class="budget-total">
                            <span>Total Estimated Budget</span>
                            <span class="budget-total-value" id="tripTotalCost">~$1,550</span>
                        </div>
                    </div>
                    <div class="budget-tips">
                        <h3><i data-lucide="lightbulb" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;color:#f59e0b;"></i> Budget Tips</h3>
                        <div class="budget-tips-list" id="budgetTips">
                            <div class="budget-tip">Book accommodations in advance for 20-30% savings</div>
                            <div class="budget-tip">Use fuel apps like GasBuddy to find cheapest stations</div>
                            <div class="budget-tip">Save money by cooking at campsites when possible</div>
                            <div class="budget-tip">Look for combination tickets for attractions</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Planning Tab -->
            <div class="trip-tab-content" id="tab-planning">
                <div class="planning-grid">
                    <div class="planning-steps-container">
                        <h3><svg class="icon" aria-hidden="true"><use href="#icon-document"></use></svg> Step-by-Step Planning Guide</h3>
                        <div class="planning-timeline" id="tripPlanningSteps"></div>
                    </div>
                </div>
            </div>

            <!-- Preparation Tab – visas, vaccines, legal by nationality -->
            <div class="trip-tab-content" id="tab-preparation">
                <div class="preparation-layout">
                    <div class="preparation-intro">
                        <h3><svg class="icon" aria-hidden="true"><use href="#icon-prep"></use></svg> Préparation administrative & santé</h3>
                        <p>En fonction de votre nationalité et du pays du road trip, voici les éléments à anticiper : visas, vaccins, permis et assurance. <strong>Vérifiez toujours les sources officielles</strong> avant de partir.</p>
                    </div>
                    <div class="preparation-selector-card">
                        <label for="preparationNationality">Ma nationalité / Passeport :</label>
                        <select id="preparationNationality" class="preparation-select" onchange="updatePreparationContent()">
                            <option value="EU">🇪🇺 Union européenne / EEE / Suisse</option>
                            <option value="UK">🇬🇧 Royaume-Uni</option>
                            <option value="US">🇺🇸 États-Unis</option>
                            <option value="CA">🇨🇦 Canada</option>
                            <option value="AU">🇦🇺 Australie</option>
                            <option value="NZ">🇳🇿 Nouvelle-Zélande</option>
                            <option value="OTHER">Autre nationalité</option>
                        </select>
                    </div>
                    <div class="preparation-cards" id="preparationCards">
                        <div class="preparation-card" id="preparationVisaCard">
                            <h4><svg class="icon" aria-hidden="true"><use href="#icon-document"></use></svg> Visa & entrée</h4>
                            <div id="preparationVisaContent" class="preparation-card-body">Sélectionnez une nationalité et un road trip.</div>
                        </div>
                        <div class="preparation-card" id="preparationVaccinesCard">
                            <h4><i data-lucide="syringe" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Vaccins</h4>
                            <div id="preparationVaccinesContent" class="preparation-card-body">Recommandations selon la destination.</div>
                        </div>
                        <div class="preparation-card" id="preparationLegalCard">
                            <h4><i data-lucide="scale" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Légal & pratique</h4>
                            <div id="preparationLegalContent" class="preparation-card-body">Permis, assurance, douanes.</div>
                        </div>
                    </div>
                    <div class="preparation-disclaimer">
                        <p><i data-lucide="alert-triangle" style="width:14px;height:14px;vertical-align:-2px;color:#f59e0b;"></i> Ces informations sont indicatives. Consultez les sites officiels de votre pays et du pays de destination (gouvernement, ambassades, OMS) avant tout départ.</p>
                        <div class="preparation-links" id="preparationLinks"></div>
                    </div>
                </div>
            </div>

            <!-- Community Tab -->
            <div class="trip-tab-content" id="tab-community">
                <div class="community-grid">
                    <!-- Reviews Section -->
                    <div class="community-reviews">
                        <div class="reviews-header">
                            <h3><i data-lucide="star" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;color:#f59e0b;"></i> Reviews & Ratings</h3>
                            <div class="reviews-summary">
                                <span class="big-rating" id="tripBigRating">4.8</span>
                                <div class="rating-breakdown" id="ratingBreakdown"></div>
                            </div>
                        </div>
                        <div class="reviews-list" id="tripDetailReviews"></div>
                        <div class="add-review-box">
                            <h4>Share Your Experience</h4>
                            <div class="rating-input">
                                <span class="rating-star" data-rating="1">☆</span>
                                <span class="rating-star" data-rating="2">☆</span>
                                <span class="rating-star" data-rating="3">☆</span>
                                <span class="rating-star" data-rating="4">☆</span>
                                <span class="rating-star" data-rating="5">☆</span>
                            </div>
                            <textarea class="review-textarea" id="newReviewText" placeholder="Tell others about your experience..."></textarea>
                            <button class="submit-review-btn" onclick="submitTripReview()">Submit Review</button>
                        </div>
                    </div>

                    <!-- Chat Section -->
                    <div class="community-chat">
                        <div class="chat-container">
                            <div class="chat-header">
                                <h3><i data-lucide="message-circle" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Live Discussion</h3>
                                <span class="online-badge" id="chatOnlineCount"><i data-lucide="users" style="width:12px;height:12px;vertical-align:-1px;"></i> 12 online</span>
                            </div>
                            <div class="chat-messages" id="tripChatMessages"></div>
                            <div class="chat-input-section">
                                <div class="chat-type-pills">
                                    <button class="chat-pill active" data-type="question" onclick="setChatType('question')"><i data-lucide="help-circle" style="width:12px;height:12px;"></i> Question</button>
                                    <button class="chat-pill" data-type="tip" onclick="setChatType('tip')"><i data-lucide="lightbulb" style="width:12px;height:12px;"></i> Tip</button>
                                    <button class="chat-pill" data-type="experience" onclick="setChatType('experience')"><i data-lucide="sparkles" style="width:12px;height:12px;"></i> Story</button>
                                </div>
                                <div class="chat-input-row">
                                    <input type="text" class="chat-text-input" id="chatMessageInput" placeholder="Ask the community...">
                                    <button class="chat-submit-btn" onclick="sendChatMessage()">Send</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Guide Tab - Comprehensive Road Trip Guide -->
            <div class="trip-tab-content" id="tab-guide">
                <div class="trip-grid">
                    <div class="trip-main-col">
                        <!-- Offline Map Download -->
                        <div class="offline-download-card">
                            <div class="offline-download-header">
                                <i data-lucide="download" style="width:28px;height:28px;color:var(--brand-orange);"></i>
                                <h3>Download Offline Map</h3>
                            </div>
                            <div class="offline-download-info">
                                Download this complete road trip guide for offline use. Perfect for areas with limited cell coverage!
                            </div>
                            <div class="offline-download-includes">
                                <div class="offline-include-item"><i data-lucide="map-pin" style="width:12px;height:12px;"></i> Waypoints</div>
                                <div class="offline-include-item"><i data-lucide="fuel" style="width:12px;height:12px;"></i> Fuel Stations</div>
                                <div class="offline-include-item"><i data-lucide="shopping-cart" style="width:12px;height:12px;"></i> Grocery Stores</div>
                                <div class="offline-include-item"><i data-lucide="tent" style="width:12px;height:12px;"></i> Campsites</div>
                                <div class="offline-include-item"><i data-lucide="droplets" style="width:12px;height:12px;"></i> Water Points</div>
                                <div class="offline-include-item"><i data-lucide="camera" style="width:12px;height:12px;"></i> Viewpoints</div>
                            </div>
                            <button class="download-btn" id="downloadOfflineBtn" onclick="downloadOfflineMap()">
                                <i data-lucide="download" style="width:16px;height:16px;"></i> Download for Offline Use
                            </button>
                            <div class="download-progress" id="downloadProgress" style="display: none;">
                                <div class="download-progress-bar" id="downloadProgressBar" style="width: 0%;"></div>
                            </div>
                        </div>

                        <!-- Best Time to Visit -->
                        <div class="best-time-card" id="guideBestTime">
                            <div class="best-time-header">
                                <i data-lucide="calendar" style="width:24px;height:24px;color:var(--brand-orange);"></i>
                                <h4>Best Time to Visit</h4>
                            </div>
                            <div class="month-chips" id="guideMonthChips"></div>
                            <div class="best-time-reason" id="guideBestTimeReason">Loading seasonal information...</div>
                            <div class="events-list" id="guideEvents" style="display: none;">
                                <h5><i data-lucide="party-popper" style="width:14px;height:14px;"></i> Events & Festivals</h5>
                                <div id="guideEventsList"></div>
                            </div>
                        </div>

                        <!-- Warnings -->
                        <div class="trip-card">
                            <h3><i data-lucide="alert-triangle" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;color:#f59e0b;"></i> Important Warnings</h3>
                            <div id="guideWarnings">
                                <p style="color: var(--text-muted);">Loading safety information...</p>
                            </div>
                        </div>

                        <!-- Vanlife Community Forum -->
                        <div class="trip-card forum-section">
                            <div class="forum-header">
                                <h3><i data-lucide="truck" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Vanlife Forum</h3>
                                <button class="new-post-btn" onclick="openCreatePostModal()">
                                    <i data-lucide="pen-line" style="width:14px;height:14px;"></i> New Post
                                </button>
                            </div>
                            <div class="forum-filters">
                                <button class="forum-filter active" onclick="filterForumPosts('all', this)">All</button>
                                <button class="forum-filter" onclick="filterForumPosts('photo', this)"><i data-lucide="camera" style="width:12px;height:12px;"></i> Photos</button>
                                <button class="forum-filter" onclick="filterForumPosts('tip', this)"><i data-lucide="lightbulb" style="width:12px;height:12px;"></i> Tips</button>
                                <button class="forum-filter" onclick="filterForumPosts('question', this)"><i data-lucide="help-circle" style="width:12px;height:12px;"></i> Questions</button>
                                <button class="forum-filter" onclick="filterForumPosts('campsite', this)"><i data-lucide="tent" style="width:12px;height:12px;"></i> Campsites</button>
                            </div>
                            <div id="forumPosts">
                                <!-- Forum posts populated dynamically -->
                            </div>
                        </div>
                    </div>

                    <div class="trip-side-col">
                        <!-- Campsite Booking -->
                        <div class="trip-card">
                            <h3><i data-lucide="tent" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Book Campsites</h3>
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 12px;">Recommended spots along the route</p>
                            <div id="guideCampsites">
                                <!-- Campsites populated dynamically -->
                            </div>
                            <button class="btn btn-secondary" style="width: 100%; margin-top: 12px; font-size: 0.8rem;" onclick="searchNearbyCampsites()">
                                <i data-lucide="search" style="width:14px;height:14px;"></i> Search More Campsites
                            </button>
                        </div>

                        <!-- Fuel Stops -->
                        <div class="trip-card">
                            <h3><i data-lucide="fuel" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Fuel Stations</h3>
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 12px;">Key stops along the route</p>
                            <div id="guideFuelStops">
                                <p style="color: var(--text-muted);">Loading fuel stops...</p>
                            </div>
                        </div>

                        <!-- Grocery Stores -->
                        <div class="trip-card">
                            <h3><i data-lucide="shopping-cart" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Grocery & Supplies</h3>
                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 12px;">Stock up at these locations</p>
                            <div id="guideGroceryStops">
                                <p style="color: var(--text-muted);">Loading grocery stops...</p>
                            </div>
                        </div>

                        <!-- Saved Offline Maps -->
                        <div class="trip-card saved-maps-section">
                            <h3><i data-lucide="smartphone" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> My Offline Maps</h3>
                            <div id="savedOfflineMaps">
                                <p style="color: var(--text-muted); font-size: 0.8rem;">No maps downloaded yet</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Tab – Premium Dark UI -->
            <div class="trip-tab-content" id="tab-booking">
                <div class="bk-container">
                    <!-- Hero Header -->
                    <div class="bk-hero">
                        <div class="bk-hero-icon">
                            <i data-lucide="ticket" style="width:26px;height:26px;color:#fff;"></i>
                        </div>
                        <div>
                            <h2>Book Experiences</h2>
                            <p>Curated activities, guided tours & immersive local experiences</p>
                        </div>
                    </div>

                    <!-- Category Tabs -->
                    <div class="bk-tabs" id="bkTabs">
                        <button class="bk-tab active" data-bk="experts" onclick="switchBookingSection('experts')">
                            <i data-lucide="shield-check"></i> Local Experts
                        </button>
                        <button class="bk-tab" data-bk="activities" onclick="switchBookingSection('activities')">
                            <i data-lucide="compass"></i> Activities
                        </button>
                        <button class="bk-tab" data-bk="accommodations" onclick="switchBookingSection('accommodations')">
                            <i data-lucide="bed-double"></i> Where to Stay
                        </button>
                    </div>

                    <!-- Experts Section -->
                    <div class="bk-section active" id="bkSectionExperts">
                        <div class="bk-grid" id="bookingExperts"></div>
                    </div>

                    <!-- Activities Section -->
                    <div class="bk-section" id="bkSectionActivities">
                        <div class="bk-grid" id="bookingActivities"></div>
                    </div>

                    <!-- Accommodations Section -->
                    <div class="bk-section" id="bkSectionAccommodations">
                        <div class="bk-grid" id="bookingAccommodations"></div>
                    </div>
                </div>

                <!-- Shared Toast -->
                <div class="bk-toast" id="bkToast">Link copied!</div>
            </div>

        </div>
    </div>

    <!-- Structured Add POI Modal -->
    <div class="add-poi-overlay" id="addPoiOverlay">
        <div class="add-poi-modal">
            <div class="add-poi-header">
                <h3><i data-lucide="map-pin" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;color:var(--brand-orange);"></i> Add Point of Interest</h3>
                <button class="add-poi-close" onclick="closeAddPoiModal()">×</button>
            </div>
            <div class="add-poi-body">
                <!-- Step 1: Category -->
                <div class="add-poi-field">
                    <label class="add-poi-label">Category *</label>
                    <div class="add-poi-cat-grid" id="addPoiCatGrid">
                        <button class="add-poi-cat-btn" data-cat="viewpoint" onclick="selectAddPoiCat('viewpoint', this)"><span class="cat-icon">📸</span> Viewpoint</button>
                        <button class="add-poi-cat-btn" data-cat="restaurant" onclick="selectAddPoiCat('restaurant', this)"><span class="cat-icon">🍽️</span> Restaurant</button>
                        <button class="add-poi-cat-btn" data-cat="hotel" onclick="selectAddPoiCat('hotel', this)"><span class="cat-icon">🏨</span> Hotel</button>
                        <button class="add-poi-cat-btn" data-cat="campsiteFree" onclick="selectAddPoiCat('campsiteFree', this)"><span class="cat-icon">⛺</span> Wild Camp</button>
                        <button class="add-poi-cat-btn" data-cat="fuel" onclick="selectAddPoiCat('fuel', this)"><span class="cat-icon">⛽</span> Fuel</button>
                        <button class="add-poi-cat-btn" data-cat="grocery" onclick="selectAddPoiCat('grocery', this)"><span class="cat-icon">🛒</span> Grocery</button>
                        <button class="add-poi-cat-btn" data-cat="danger" onclick="selectAddPoiCat('danger', this)"><span class="cat-icon">⚠️</span> Warning</button>
                        <button class="add-poi-cat-btn" data-cat="water" onclick="selectAddPoiCat('water', this)"><span class="cat-icon">💧</span> Water</button>
                        <button class="add-poi-cat-btn" data-cat="attraction" onclick="selectAddPoiCat('attraction', this)"><span class="cat-icon">⭐</span> Attraction</button>
                    </div>
                </div>
                <!-- Step 2: Location (auto-populated via reverse geocoding) -->
                <div class="add-poi-field">
                    <label class="add-poi-label">Location (click map to set) *</label>
                    <div class="add-poi-address" id="addPoiAddress">
                        <i data-lucide="map-pin" style="width:16px;height:16px;"></i>
                        <span id="addPoiAddressText">Click on the map to set location...</span>
                    </div>
                    <input type="hidden" id="addPoiLat">
                    <input type="hidden" id="addPoiLng">
                </div>
                <!-- Step 3: Name -->
                <div class="add-poi-field">
                    <label class="add-poi-label">Name *</label>
                    <input class="add-poi-input" id="addPoiName" placeholder="e.g. Sunset Viewpoint, Boulangerie Marcel...">
                </div>
                <!-- Step 4: Pro-Tip -->
                <div class="add-poi-field">
                    <label class="add-poi-label">💡 Pro-Tip (practical advice)</label>
                    <textarea class="add-poi-textarea" id="addPoiTip" placeholder="e.g. Arrive 30 min before sunset for the best view. Parking available 200m below."></textarea>
                </div>
                <!-- Step 5: Photo -->
                <div class="add-poi-field">
                    <label class="add-poi-label">Photo (optional)</label>
                    <div class="add-poi-photo-area" id="addPoiPhotoArea" onclick="document.getElementById('addPoiPhotoInput').click()">
                        <span id="addPoiPhotoLabel"><i data-lucide="camera" style="width:20px;height:20px;"></i><br>Click to upload a photo</span>
                    </div>
                    <input type="file" id="addPoiPhotoInput" accept="image/*" style="display:none" onchange="handlePoiPhotoUpload(event)">
                </div>
            </div>
            <div class="add-poi-footer">
                <button class="add-poi-cancel" onclick="closeAddPoiModal()">Cancel</button>
                <button class="add-poi-submit" id="addPoiSubmitBtn" onclick="submitAddPoi()" disabled>
                    <i data-lucide="check" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Add to Map
                </button>
            </div>
        </div>
    </div>

    <!-- Country Satellite View Modal (Double-click) -->
    <div class="modal-overlay" id="satelliteViewModal">
        <div class="modal satellite-view-modal" style="max-width: 95vw; width: 1400px; height: 90vh;">
            <div class="modal-header satellite-header">
                <div class="satellite-title">
                    <span class="satellite-icon"><i data-lucide="satellite" style="width:20px;height:20px;"></i></span>
                    <h3><span id="satelliteCountryName">Country</span> - Satellite View</h3>
                </div>
                <div class="satellite-controls">
                    <div class="layer-toggle-group">
                        <button class="layer-btn active" data-layer="satellite" onclick="setSatelliteLayer('satellite')">
                            <i data-lucide="satellite" style="width:14px;height:14px;"></i> Satellite
                        </button>
                        <button class="layer-btn" data-layer="terrain" onclick="setSatelliteLayer('terrain')">
                            <i data-lucide="mountain" style="width:14px;height:14px;"></i> Terrain
                        </button>
                        <button class="layer-btn" data-layer="roads" onclick="setSatelliteLayer('roads')">
                            <i data-lucide="navigation" style="width:14px;height:14px;"></i> Roads
                        </button>
                        <button class="layer-btn" data-layer="hybrid" onclick="setSatelliteLayer('hybrid')">
                            <i data-lucide="map" style="width:14px;height:14px;"></i> Hybrid
                        </button>
                    </div>
                    <button class="modal-close" onclick="closeSatelliteViewModal()">×</button>
                </div>
            </div>
            <div class="satellite-container">
                <div id="satelliteMap" class="satellite-map"></div>
                <div class="satellite-info-panel" id="satelliteInfoPanel">
                    <div class="country-quick-facts">
                        <h4><i data-lucide="bar-chart-3" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Quick Facts</h4>
                        <div id="countryQuickFacts">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                    <div class="country-landmarks">
                        <h4><i data-lucide="landmark" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Key Landmarks</h4>
                        <div id="countryLandmarks">
                            <!-- Populated dynamically -->
                        </div>
                    </div>
                    <div class="satellite-legend">
                        <h4><i data-lucide="palette" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> What You're Seeing</h4>
                        <div class="legend-items">
                            <div class="legend-item"><span class="legend-color" style="background: #2d5016;"></span> Forests</div>
                            <div class="legend-item"><span class="legend-color" style="background: #c4a35a;"></span> Desert/Arid</div>
                            <div class="legend-item"><span class="legend-color" style="background: #4a7c59;"></span> Grasslands</div>
                            <div class="legend-item"><span class="legend-color" style="background: #1a5276;"></span> Water</div>
                            <div class="legend-item"><span class="legend-color" style="background: #808080;"></span> Urban Areas</div>
                            <div class="legend-item"><span class="legend-color" style="background: #ffffff;"></span> Snow/Ice</div>
                        </div>
                    </div>
                    <div class="satellite-actions">
                        <button class="btn btn-primary" onclick="planTripFromSatellite()"><i data-lucide="pen-line" style="width:14px;height:14px;"></i> Plan Trip Here</button>
                        <button class="btn btn-secondary" onclick="openInGoogleEarth()"><i data-lucide="globe" style="width:14px;height:14px;"></i> Google Earth</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Trip Planner Modal (Draw on Map) -->
    <div class="modal-overlay" id="tripPlannerModal">
        <div class="modal trip-planner-modal" style="max-width: 95vw; width: 1200px; height: 85vh;">
            <div class="modal-header">
                <h3><i data-lucide="pen-tool" style="width:20px;height:20px;vertical-align:-3px;margin-right:6px;color:var(--brand-orange);"></i> Plan Your Road Trip in <span id="plannerCountryName">Country</span></h3>
                <button class="modal-close" onclick="closeTripPlannerModal()">×</button>
            </div>
            <div class="planner-container">
                <!-- Left Panel - Tools -->
                <div class="planner-sidebar">
                    <div class="planner-tools">
                        <div class="tool-section">
                            <h4><i data-lucide="map-pin" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Add Stops</h4>
                            <p class="tool-hint">Click on map to add waypoints</p>
                            <div class="city-list-hint">
                                <i data-lucide="building-2" style="width:14px;height:14px;"></i>
                                <span>Click near a city to auto-snap! Purple dots show major cities.</span>
                            </div>
                            <div class="stop-type-selector">
                                <button class="stop-type-btn active" data-type="waypoint" onclick="setStopType('waypoint')">
                                    <i data-lucide="map-pin" style="width:12px;height:12px;"></i> Waypoint
                                </button>
                                <button class="stop-type-btn" data-type="camping" onclick="setStopType('camping')">
                                    <i data-lucide="tent" style="width:12px;height:12px;"></i> Camping
                                </button>
                                <button class="stop-type-btn" data-type="fuel" onclick="setStopType('fuel')">
                                    <i data-lucide="fuel" style="width:12px;height:12px;"></i> Fuel
                                </button>
                                <button class="stop-type-btn" data-type="hotel" onclick="setStopType('hotel')">
                                    <i data-lucide="bed-double" style="width:12px;height:12px;"></i> Hotel
                                </button>
                                <button class="stop-type-btn" data-type="atm" onclick="setStopType('atm')">
                                    <i data-lucide="banknote" style="width:12px;height:12px;"></i> ATM
                                </button>
                                <button class="stop-type-btn" data-type="viewpoint" onclick="setStopType('viewpoint')">
                                    <i data-lucide="camera" style="width:12px;height:12px;"></i> Viewpoint
                                </button>
                                <button class="stop-type-btn" data-type="restaurant" onclick="setStopType('restaurant')">
                                    <i data-lucide="utensils" style="width:12px;height:12px;"></i> Restaurant
                                </button>
                            </div>
                        </div>

                        <div class="tool-section">
                            <h4><i data-lucide="navigation" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Your Route</h4>
                            <div id="routeStopsList" class="route-stops-list">
                                <p class="empty-hint">Click on map to add stops...</p>
                            </div>
                            <div class="route-stats">
                                <div class="route-stat">
                                    <span class="stat-label">Stops:</span>
                                    <span class="stat-value" id="plannerStopsCount">0</span>
                                </div>
                                <div class="route-stat">
                                    <span class="stat-label">Est. Distance:</span>
                                    <span class="stat-value" id="plannerDistance">0 km</span>
                                </div>
                            </div>
                        </div>

                        <div class="tool-section">
                            <h4><i data-lucide="search" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Find Nearby</h4>
                            <div class="nearby-links">
                                <button class="nearby-btn" onclick="searchNearby('fuel station')"><i data-lucide="fuel" style="width:12px;height:12px;"></i> Fuel</button>
                                <button class="nearby-btn" onclick="searchNearby('atm')"><i data-lucide="banknote" style="width:12px;height:12px;"></i> ATMs</button>
                                <button class="nearby-btn" onclick="searchNearby('hotel')"><i data-lucide="bed-double" style="width:12px;height:12px;"></i> Hotels</button>
                                <button class="nearby-btn" onclick="searchNearby('camping')"><i data-lucide="tent" style="width:12px;height:12px;"></i> Camping</button>
                                <button class="nearby-btn" onclick="searchNearby('restaurant')"><i data-lucide="utensils" style="width:12px;height:12px;"></i> Restaurants</button>
                                <button class="nearby-btn" onclick="searchNearby('viewpoint')"><i data-lucide="camera" style="width:12px;height:12px;"></i> Viewpoints</button>
                            </div>
                        </div>

                        <div class="tool-section">
                            <h4><i data-lucide="save" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Trip Details</h4>
                            <input type="text" class="form-input" id="plannedTripName" placeholder="Trip name...">
                            <textarea class="form-input" id="plannedTripNotes" placeholder="Notes, tips..."></textarea>
                        </div>
                    </div>

                    <div class="planner-actions">
                        <button class="btn btn-secondary" onclick="clearPlannerRoute()"><i data-lucide="trash-2" style="width:14px;height:14px;"></i> Clear All</button>
                        <button class="btn btn-primary" onclick="savePlannedTrip()"><i data-lucide="save" style="width:14px;height:14px;"></i> Save Trip</button>
                        <button class="btn btn-serendipity" onclick="shareToCommunnity()"><i data-lucide="share-2" style="width:14px;height:14px;"></i> Share</button>
                    </div>
                </div>

                <!-- Right Panel - Map -->
                <div class="planner-map-container">
                    <div id="tripPlannerMap" class="planner-map"></div>
                    <div class="map-instructions">
                        <span><i data-lucide="info" style="width:12px;height:12px;vertical-align:-1px;"></i> Click anywhere on the map to add stops. Drag markers to adjust.</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Propose Variant Modal -->
    <div class="modal-overlay" id="proposeVariantModal">
        <div class="modal" style="max-width:560px;">
            <div class="modal-header">
                <h3 style="display:flex;align-items:center;gap:8px;margin:0;font-size:1.1rem;">
                    <i data-lucide="git-branch" style="width:20px;height:20px;color:#E07A5F;"></i> Propose a Route Variant
                </h3>
                <button class="modal-close" onclick="closeProposeVariantModal()">×</button>
            </div>
            <div class="modal-body" style="padding:20px;">
                <p style="font-size:0.82rem;color:#64748b;margin:0 0 16px;">Create your own version of this road trip. Draw waypoints on the map to define your route.</p>
                <div style="display:flex;flex-direction:column;gap:14px;">
                    <div>
                        <label style="display:block;font-size:0.8rem;font-weight:600;color:#1e293b;margin-bottom:5px;">Variant Name *</label>
                        <input type="text" id="variantNameInput" class="form-input" placeholder="e.g. The 3-Day Express" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:10px;font-size:0.9rem;">
                    </div>
                    <div>
                        <label style="display:block;font-size:0.8rem;font-weight:600;color:#1e293b;margin-bottom:5px;">Duration</label>
                        <select id="variantDurationTag" class="form-input" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:10px;font-size:0.9rem;">
                            <option value="short">Short (1-3 days)</option>
                            <option value="medium" selected>Medium (4-7 days)</option>
                            <option value="long">Long (8+ days)</option>
                        </select>
                    </div>
                    <div>
                        <label style="display:block;font-size:0.8rem;font-weight:600;color:#1e293b;margin-bottom:5px;">Your Name</label>
                        <input type="text" id="variantCreatorName" class="form-input" placeholder="Anonymous Explorer" style="width:100%;padding:10px 14px;border:1px solid #e2e8f0;border-radius:10px;font-size:0.9rem;">
                    </div>
                    <div id="variantWaypointsList" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:14px;min-height:60px;">
                        <p style="font-size:0.78rem;color:#94a3b8;margin:0;">No waypoints yet. Click "Draw on Map" to add stops.</p>
                    </div>
                    <button class="btn btn-serendipity" onclick="startVariantDrawMode()" style="display:flex;align-items:center;justify-content:center;gap:6px;">
                        <i data-lucide="pen-line" style="width:16px;height:16px;"></i> Draw Route on Map
                    </button>
                </div>
            </div>
            <div style="padding:14px 20px;border-top:1px solid #e2e8f0;display:flex;justify-content:flex-end;gap:10px;">
                <button class="btn btn-secondary" onclick="closeProposeVariantModal()">Cancel</button>
                <button class="btn btn-primary" onclick="saveUserVariant()" id="saveVariantBtn">
                    <i data-lucide="send" style="width:14px;height:14px;"></i> Submit Proposal
                </button>
            </div>
        </div>
    </div>

    <!-- Memory Book Modal -->
    <div class="memory-book-modal" id="memoryBookModal">
        <div class="memory-book">
            <button class="book-close-btn" onclick="closeMemoryBook()">×</button>
            
            <div class="book-container">
                <div class="book-spine"></div>
                
                <!-- Left Page - Country List -->
                <div class="book-page left">
                    <div class="page-title"><i data-lucide="book-open" style="width:20px;height:20px;vertical-align:-3px;margin-right:6px;"></i> My Travel Memories</div>
                    <p style="text-align: center; color: #8b7355; font-style: italic; margin-bottom: 20px;">Select a country to view memories</p>
                    
                    <div class="countries-with-memories" id="countriesWithMemories">
                        <!-- Dynamically populated -->
                    </div>
                    
                    <div class="no-memories-message" id="noMemoriesMessage" style="display: none;">
                        <div class="icon">📷</div>
                        <h3>No memories yet!</h3>
                        <p>Mark countries as visited and add your travel memories to create your personal journey book.</p>
                    </div>
                </div>
                
                <!-- Right Page - Memories Grid -->
                <div class="book-page right">
                    <div id="memoryPageContent">
                        <div class="country-flag-large" id="selectedCountryFlag">🌍</div>
                        <div class="page-title" id="selectedCountryTitle">Select a Country</div>
                        
                        <div class="memory-grid" id="memoryGrid">
                            <!-- Memories will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="book-nav">
                <button onclick="addMemoryToCountry()">➕ Add Memory</button>
            </div>
        </div>
    </div>

    <!-- Memory Detail Popup -->
    <div class="memory-popup" id="memoryPopup">
        <button class="memory-popup-close" onclick="closeMemoryPopup()">×</button>
        <div class="memory-popup-image" id="memoryPopupImage"></div>
        <div class="memory-popup-content">
            <div class="memory-popup-title" id="memoryPopupTitle">Memory Title</div>
            <div class="memory-popup-date" id="memoryPopupDate">Date</div>
            <div class="memory-popup-description" id="memoryPopupDesc">Description</div>
            <div class="memory-popup-actions">
                <button class="memory-edit-btn" onclick="editCurrentMemory()"><i data-lucide="pencil" style="width:14px;height:14px;"></i> Edit</button>
                <button class="memory-delete-btn" onclick="deleteCurrentMemory()"><i data-lucide="trash-2" style="width:14px;height:14px;"></i> Delete</button>
            </div>
        </div>
    </div>

    <!-- Trip Selection Modal (when clicking location with multiple trips) -->
    <div class="trip-selection-overlay" id="tripSelectionOverlay">
        <div class="trip-selection-modal">
            <div class="trip-selection-title"><i data-lucide="map-pin" style="width:16px;height:16px;vertical-align:-2px;margin-right:4px;"></i> Multiple Road Trips at this Location</div>
            <p style="text-align: center; color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 16px;">Select which road trip you want to explore:</p>
            <div class="trip-selection-list" id="tripSelectionList">
                <!-- Populated dynamically -->
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 16px;" onclick="closeTripSelection()">Cancel</button>
        </div>
    </div>

    <!-- Create Forum Post Modal -->
    <div class="create-post-modal" id="createPostModal">
        <div class="create-post-form">
            <div class="create-post-header">
                <h3><i data-lucide="pen-line" style="width:18px;height:18px;vertical-align:-3px;margin-right:6px;"></i> Share with the Community</h3>
                <button class="modal-close" onclick="closeCreatePostModal()">×</button>
            </div>
            <div class="create-post-body">
                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 16px;">
                    Share your experiences, tips, photos, or ask questions about this route!
                </p>
                
                <label style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 8px; display: block;">Post Type</label>
                <div class="post-type-selector">
                    <button class="post-type-option selected" data-type="tip" onclick="selectPostType('tip', this)">Tip</button>
                    <button class="post-type-option" data-type="photo" onclick="selectPostType('photo', this)">Photo</button>
                    <button class="post-type-option" data-type="question" onclick="selectPostType('question', this)">Question</button>
                    <button class="post-type-option" data-type="campsite" onclick="selectPostType('campsite', this)">Campsite</button>
                    <button class="post-type-option" data-type="warning" onclick="selectPostType('warning', this)">Warning</button>
                </div>
                
                <textarea class="post-textarea" id="postContent" placeholder="Share your experience, tip, or question..."></textarea>
                
                <label style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 8px; display: block;">📷 Add Photos (optional)</label>
                <div class="photo-upload-grid">
                    <div class="photo-upload-slot" onclick="triggerPhotoUpload(0)">
                        <span class="add-icon">+</span>
                    </div>
                    <div class="photo-upload-slot" onclick="triggerPhotoUpload(1)">
                        <span class="add-icon">+</span>
                    </div>
                    <div class="photo-upload-slot" onclick="triggerPhotoUpload(2)">
                        <span class="add-icon">+</span>
                    </div>
                    <div class="photo-upload-slot" onclick="triggerPhotoUpload(3)">
                        <span class="add-icon">+</span>
                    </div>
                </div>
                <input type="file" id="forumPhotoInput" accept="image/*" multiple style="display: none;" onchange="handleForumPhotoUpload(event)">
                
                <div class="location-tag-input">
                    <span>📍</span>
                    <input type="text" id="postLocation" placeholder="Add location (e.g., Mile 45, Seligman AZ)">
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" style="flex: 1;" onclick="closeCreatePostModal()">Cancel</button>
                    <button class="btn btn-primary" style="flex: 1;" onclick="submitForumPost()">🚀 Post</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Campsite Search Modal -->
    <div class="modal-overlay" id="campsiteSearchModal">
        <div class="modal" style="max-width: 600px; max-height: 80vh;">
            <div class="modal-header">
                <h3>🏕️ Search Campsites</h3>
                <button class="modal-close" onclick="closeCampsiteSearch()">×</button>
            </div>
            <div class="modal-body" style="overflow-y: auto; max-height: 60vh;">
                <div class="form-group">
                    <label>Search Area</label>
                    <input type="text" class="form-input" id="campsiteSearchArea" placeholder="e.g., Flagstaff, AZ">
                </div>
                <div class="form-group">
                    <label>Campsite Type</label>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="filter-chip active" onclick="setCampsiteType('all', this)">All</button>
                        <button class="filter-chip" onclick="setCampsiteType('free', this)">Free</button>
                        <button class="filter-chip" onclick="setCampsiteType('rv-park', this)">RV Park</button>
                        <button class="filter-chip" onclick="setCampsiteType('campground', this)">Campground</button>
                        <button class="filter-chip" onclick="setCampsiteType('wild', this)">Wild</button>
                    </div>
                </div>
                <div id="campsiteSearchResults">
                    <p style="text-align: center; color: var(--text-muted); padding: 20px;">
                        Enter a location to search for campsites
                    </p>
                </div>
                <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-subtle);">
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 10px;">🔗 External Booking Sites:</p>
                    <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                        <a href="https://www.hipcamp.com" target="_blank" class="btn btn-secondary" style="font-size: 0.75rem;">Hipcamp</a>
                        <a href="https://www.recreation.gov" target="_blank" class="btn btn-secondary" style="font-size: 0.75rem;">Recreation.gov</a>
                        <a href="https://www.campendium.com" target="_blank" class="btn btn-secondary" style="font-size: 0.75rem;">Campendium</a>
                        <a href="https://freecampsites.net" target="_blank" class="btn btn-secondary" style="font-size: 0.75rem;">FreeCampsites</a>
                        <a href="https://www.ioverlander.com" target="_blank" class="btn btn-secondary" style="font-size: 0.75rem;">iOverlander</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Memory Modal -->
    <div class="add-memory-modal" id="addMemoryModal">
        <div class="add-memory-form">
            <h3><span id="memoryFormIcon">📸</span> <span id="memoryFormTitle">Add Memory</span></h3>
            
            <div class="photo-upload-area" id="photoUploadArea" onclick="document.getElementById('memoryPhotoInput').click()">
                <div class="photo-upload-icon">📷</div>
                <div class="photo-upload-text">Click to upload a photo</div>
            </div>
            <input type="file" id="memoryPhotoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
            
            <div class="form-group">
                <label>Memory Title *</label>
                <input type="text" class="form-input" id="memoryTitle" placeholder="e.g., Sunset at Santorini">
            </div>
            
            <div class="form-group">
                <label>Date</label>
                <input type="date" class="form-input" id="memoryDate">
            </div>
            
            <div class="form-group">
                <label>Description</label>
                <textarea class="form-input" id="memoryDescription" rows="3" placeholder="What made this moment special?"></textarea>
            </div>
            
            <div class="form-group">
                <label>Location (optional)</label>
                <input type="text" class="form-input" id="memoryLocation" placeholder="e.g., Oia, Santorini">
            </div>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeAddMemoryModal()">Cancel</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="saveMemory()">💾 Save Memory</button>
            </div>
        </div>
    </div>
    </main>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <script>
        // ==================== GLOBAL STATE ====================
        let currentMode = 'diary';
        let selectedCountry = null;
        let currentCountryId = null;
        let currentCountryName = '';
        let countryColors = {};
        let svg, g, projection, path;
        let countriesData = [];
        let roadMap = null;
        let tripDetailMap = null;
        let tripDetailPoiLayers = {};
        let activeRoute = null;

        // ========== ROUTE VARIANTS SYSTEM ==========
        let currentVariantId = null;      // null = master/full route
        let variantGhostLayer = null;     // Faded master polyline
        let variantActiveLayer = null;    // Bold variant polyline
        let variantMarkers = [];          // Markers for the variant
        let upvotedVariants = JSON.parse(localStorage.getItem('srndipity_upvoted_variants') || '{}');

        // ========== ROUTE VARIANT FUNCTIONS ==========

        /**
         * Auto-generate variants from a trip's waypoints.
         * Parent-child: variants reference subsets of the master waypoints.
         */
        function getVariantsForTrip(trip) {
            if (!trip || !trip.waypoints || trip.waypoints.length < 4) return [];
            const wps = trip.waypoints;
            const total = wps.length;
            const savedVariantVotes = JSON.parse(localStorage.getItem('srndipity_variant_votes_' + trip.id) || '{}');

            // Short variant: first ~30% of waypoints
            const shortEnd = Math.max(3, Math.floor(total * 0.35));
            // Medium variant: first ~60% of waypoints
            const medEnd = Math.max(shortEnd + 1, Math.floor(total * 0.65));

            const variants = [
                {
                    id: trip.id + '_full',
                    label: 'Full Route',
                    tag: 'full',
                    durationDays: parseInt(trip.duration) || 14,
                    durationLabel: trip.duration || '10-14 days',
                    waypoints: wps,
                    communityScore: savedVariantVotes[trip.id + '_full'] || Math.floor(Math.random() * 40) + 60,
                    upvotes: savedVariantVotes[trip.id + '_full'] || Math.floor(Math.random() * 30) + 15,
                    description: 'The complete ' + trip.name + ' experience. Every stop, every highlight.'
                },
                {
                    id: trip.id + '_short',
                    label: getShortDays(trip) + '-Day Express',
                    tag: 'short',
                    durationDays: getShortDays(trip),
                    durationLabel: getShortDays(trip) + ' days',
                    waypoints: wps.slice(0, shortEnd),
                    communityScore: savedVariantVotes[trip.id + '_short'] || Math.floor(Math.random() * 30) + 40,
                    upvotes: savedVariantVotes[trip.id + '_short'] || Math.floor(Math.random() * 20) + 5,
                    description: 'Hit the key highlights of ' + trip.name + ' in a long weekend. Perfect for limited time.'
                },
                {
                    id: trip.id + '_medium',
                    label: getMedDays(trip) + '-Day Deep Dive',
                    tag: 'medium',
                    durationDays: getMedDays(trip),
                    durationLabel: getMedDays(trip) + ' days',
                    waypoints: wps.slice(0, medEnd),
                    communityScore: savedVariantVotes[trip.id + '_medium'] || Math.floor(Math.random() * 35) + 50,
                    upvotes: savedVariantVotes[trip.id + '_medium'] || Math.floor(Math.random() * 25) + 10,
                    description: 'A balanced itinerary covering most of ' + trip.name + '. Best value for time.'
                }
            ];
            // Sort by community score descending
            variants.sort((a, b) => b.communityScore - a.communityScore);
            return variants;
        }

        function getShortDays(trip) {
            const d = parseInt(trip.duration) || 10;
            return Math.max(2, Math.floor(d * 0.3));
        }
        function getMedDays(trip) {
            const d = parseInt(trip.duration) || 10;
            return Math.max(4, Math.floor(d * 0.6));
        }

        /** Render the variant chip bar in the Route tab */
        function renderVariantChips(trip) {
            const bar = document.getElementById('variantBar');
            const chipsContainer = document.getElementById('variantChips');
            if (!bar || !chipsContainer) return;

            const variants = getVariantsForTrip(trip);
            if (variants.length === 0) {
                bar.style.display = 'none';
                return;
            }
            bar.style.display = 'flex';

            chipsContainer.innerHTML = variants.map(v => {
                const isActive = (currentVariantId === v.id) || (!currentVariantId && v.tag === 'full');
                const isUpvoted = upvotedVariants[v.id];
                return `<button class="variant-chip ${isActive ? 'active' : ''}" onclick="selectVariant('${v.id}', '${trip.id}')" data-variant="${v.id}">
                    <span class="chip-days">${v.tag === 'full' ? 'Full' : v.durationLabel}</span>
                    <span class="chip-votes"><i data-lucide="arrow-up" style="width:10px;height:10px;"></i>${v.upvotes}</span>
                </button>`;
            }).join('');

            // Show info strip for current variant
            updateVariantInfoStrip(trip, currentVariantId);

            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 50);
        }

        /** Select a variant: update map with ghost + active route */
        async function selectVariant(variantId, tripId) {
            const allTrips = getAllTrips();
            const trip = allTrips.find(t => t.id === tripId);
            if (!trip) return;

            const variants = getVariantsForTrip(trip);
            const variant = variants.find(v => v.id === variantId);
            if (!variant) return;

            currentVariantId = variantId;

            // Update chip active state
            document.querySelectorAll('.variant-chip').forEach(chip => {
                chip.classList.toggle('active', chip.dataset.variant === variantId);
            });

            // Update info strip
            updateVariantInfoStrip(trip, variantId);

            // Update the map: ghost full route + highlight variant
            await renderVariantOnMap(trip, variant, variants.find(v => v.tag === 'full'));

            // Update recommendations for variant
            updateRecommendationsForVariant(trip, variant);
        }

        /** Draw ghost master + bold variant on the detail map */
        async function renderVariantOnMap(trip, variant, fullVariant) {
            if (!tripDetailMap) return;

            // Clear previous variant layers
            if (variantGhostLayer) { tripDetailMap.removeLayer(variantGhostLayer); variantGhostLayer = null; }
            if (variantActiveLayer) { tripDetailMap.removeLayer(variantActiveLayer); variantActiveLayer = null; }
            variantMarkers.forEach(m => tripDetailMap.removeLayer(m));
            variantMarkers = [];

            // Also clear the main route layer if present
            tripDetailMap.eachLayer(l => {
                if (l instanceof L.Polyline || (l instanceof L.Marker && l._icon && l._icon.classList && l._icon.classList.contains('route-step-marker'))) {
                    tripDetailMap.removeLayer(l);
                }
            });

            // Full route waypoints as latlngs
            const fullWps = (fullVariant ? fullVariant.waypoints : trip.waypoints) || [];
            const fullLatLngs = fullWps.filter(wp => Array.isArray(wp)).map(wp => [wp[0], wp[1]]);

            // Variant waypoints as latlngs
            const varWps = variant.waypoints || [];
            const varLatLngs = varWps.filter(wp => Array.isArray(wp)).map(wp => [wp[0], wp[1]]);

            // Draw ghost (full route) if variant is not the full route
            if (variant.tag !== 'full' && fullLatLngs.length >= 2) {
                let ghostCoords = await fetchOsrmRoute(fullLatLngs);
                if (!ghostCoords || ghostCoords.length < 2) ghostCoords = fullLatLngs;
                variantGhostLayer = L.polyline(ghostCoords, {
                    color: '#94a3b8',
                    weight: 3,
                    opacity: 0.35,
                    dashArray: '8, 8',
                    lineCap: 'round'
                }).addTo(tripDetailMap);
            }

            // Draw active variant route
            if (varLatLngs.length >= 2) {
                let activeCoords = await fetchOsrmRoute(varLatLngs);
                if (!activeCoords || activeCoords.length < 2) activeCoords = varLatLngs;
                variantActiveLayer = L.polyline(activeCoords, {
                    color: '#E07A5F',
                    weight: 5,
                    opacity: 0.95,
                    lineCap: 'round',
                    lineJoin: 'round'
                }).addTo(tripDetailMap);

                // Fit to active route
                tripDetailMap.fitBounds(variantActiveLayer.getBounds(), { padding: [30, 30], maxZoom: 12 });
            }

            // Add numbered markers for variant stops
            varWps.forEach((wp, i) => {
                if (!Array.isArray(wp)) return;
                const name = wp[2] || 'Stop ' + (i + 1);
                const isStart = i === 0;
                const isEnd = i === varWps.length - 1;
                const markerColor = isStart ? '#22c55e' : isEnd ? '#ef4444' : '#E07A5F';
                const markerLabel = isStart ? 'A' : isEnd ? 'Z' : String(i);

                const icon = L.divIcon({
                    className: 'route-step-marker',
                    html: `<div style="width:28px;height:28px;border-radius:50%;background:${markerColor};color:#fff;display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:700;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,0.3);">${markerLabel}</div>`,
                    iconSize: [28, 28],
                    iconAnchor: [14, 14]
                });
                const marker = L.marker([wp[0], wp[1]], { icon }).addTo(tripDetailMap);
                marker.bindPopup(`<strong>${name}</strong>${wp[3] ? '<br><em>' + wp[3] + '</em>' : ''}`);
                variantMarkers.push(marker);
            });
        }

        /** Update the info strip below the chips */
        function updateVariantInfoStrip(trip, variantId) {
            const strip = document.getElementById('variantInfoStrip');
            if (!strip) return;

            const variants = getVariantsForTrip(trip);
            const variant = variants.find(v => v.id === variantId) || variants.find(v => v.tag === 'full');
            if (!variant) { strip.style.display = 'none'; return; }

            strip.style.display = 'flex';
            document.getElementById('variantName').textContent = variant.label;
            document.getElementById('variantStops').textContent = variant.waypoints ? variant.waypoints.length : 0;

            // Estimate distance from waypoint count
            const totalKm = parseInt(trip.distance) || 500;
            const ratio = (variant.waypoints ? variant.waypoints.length : 0) / (trip.waypoints ? trip.waypoints.length : 1);
            document.getElementById('variantDistance').textContent = Math.round(totalKm * ratio) + ' km';

            document.getElementById('variantScore').textContent = variant.communityScore;
            document.getElementById('variantUpvoteCount').textContent = variant.upvotes;

            const btn = document.getElementById('variantUpvoteBtn');
            if (btn) {
                btn.classList.toggle('upvoted', !!upvotedVariants[variant.id]);
            }
        }

        /** Upvote the current variant */
        function upvoteCurrentVariant() {
            if (!currentVariantId || !currentDetailTrip) return;
            const trip = currentDetailTrip;
            const vid = currentVariantId;

            if (upvotedVariants[vid]) {
                // Un-upvote
                delete upvotedVariants[vid];
                // Decrement
                const votes = JSON.parse(localStorage.getItem('srndipity_variant_votes_' + trip.id) || '{}');
                if (votes[vid]) votes[vid] = Math.max(0, votes[vid] - 1);
                localStorage.setItem('srndipity_variant_votes_' + trip.id, JSON.stringify(votes));
            } else {
                // Upvote
                upvotedVariants[vid] = true;
                const votes = JSON.parse(localStorage.getItem('srndipity_variant_votes_' + trip.id) || '{}');
                votes[vid] = (votes[vid] || 0) + 1;
                localStorage.setItem('srndipity_variant_votes_' + trip.id, JSON.stringify(votes));
            }
            localStorage.setItem('srndipity_upvoted_variants', JSON.stringify(upvotedVariants));

            // Re-render chips to reflect new counts
            renderVariantChips(trip);
        }

        /** Community switcher: sort variants by score or newest */
        function switchVariantCommunity(sortBy) {
            // Just re-render chips (sort is handled in getVariantsForTrip by score already)
            if (currentDetailTrip) renderVariantChips(currentDetailTrip);
        }

        /** Update recommendations to match variant scope */
        function updateRecommendationsForVariant(trip, variant) {
            const recsContainer = document.getElementById('tripRecommendations');
            if (!recsContainer || !trip.recommendations) return;

            const recs = trip.recommendations || [];
            const bookingQuery = encodeURIComponent((trip.country || '') + ' hotels');
            if (variant.tag === 'full') {
                renderRecommendationsWithBooking(trip);
            } else {
                const ratio = (variant.waypoints ? variant.waypoints.length : 1) / Math.max(1, (trip.waypoints ? trip.waypoints.length : 1));
                const count = Math.max(1, Math.ceil(recs.length * ratio));
                const subset = recs.slice(0, count);
                const stopNames = (variant.waypoints || []).filter(w => Array.isArray(w) && w[2]).map(w => w[2]).join(', ');
                const recQuery = encodeURIComponent(stopNames + ' ' + (trip.country || ''));
                recsContainer.innerHTML = `
                    <div style="padding:10px 14px;background:#f0fdf4;border-radius:12px;border:1px solid #bbf7d0;margin-bottom:12px;font-size:0.8rem;color:#166534;">
                        <i data-lucide="info" style="width:13px;height:13px;vertical-align:-2px;margin-right:4px;"></i>
                        Showing recommendations for the <strong>${variant.label}</strong> variant (${variant.waypoints ? variant.waypoints.length : 0} stops)
                    </div>
                ` + subset.map(rec => `
                    <div class="recommendation-item">
                        <div class="rec-icon">${rec.icon}</div>
                        <div style="flex:1;">
                            <div class="rec-title">${rec.title}</div>
                            <div class="rec-desc">${rec.desc}</div>
                            <div class="rec-actions">
                                <a href="https://www.getyourguide.com/s/?q=${recQuery}" target="_blank" rel="noopener sponsored" class="rec-action-btn book-guide">
                                    <i data-lucide="users" style="width:12px;height:12px;"></i> Book a Guide
                                </a>
                                <a href="https://www.viator.com/searchResults/all?text=${recQuery}" target="_blank" rel="noopener sponsored" class="rec-action-btn check-avail">
                                    <i data-lucide="calendar-check" style="width:12px;height:12px;"></i> Check Availability
                                </a>
                                <a href="https://www.booking.com/searchresults.html?ss=${bookingQuery}" target="_blank" rel="noopener sponsored" class="rec-action-btn book-hotel">
                                    <i data-lucide="bed-double" style="width:12px;height:12px;"></i> Nearby Hotels
                                </a>
                            </div>
                            <div class="rec-partner-row">
                                <span class="rec-partner-badge">via GetYourGuide</span>
                                <span class="rec-partner-badge">· Viator</span>
                                <span class="rec-partner-badge">· Booking.com</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 80);
        }

        // ========== USER-CREATED VARIANT SYSTEM ==========
        const VARIANT_PUBLIC_THRESHOLD = 50;
        let variantDrawMode = false;
        let variantDrawPoints = [];
        let variantDrawMarkers = [];
        let variantDrawPolyline = null;

        function getUserVariants(tripId) {
            return JSON.parse(localStorage.getItem('srndipity_user_variants_' + tripId) || '[]');
        }
        function setUserVariants(tripId, variants) {
            localStorage.setItem('srndipity_user_variants_' + tripId, JSON.stringify(variants));
        }

        function openProposeVariantModal() {
            if (!currentDetailTrip) return;
            document.getElementById('proposeVariantModal').classList.add('active');
            document.getElementById('variantNameInput').value = '';
            document.getElementById('variantCreatorName').value = localStorage.getItem('srndipity_username') || '';
            const wpList = document.getElementById('variantWaypointsList');
            if (wpList) wpList.innerHTML = '<p style="font-size:0.78rem;color:#94a3b8;margin:0;">No waypoints yet. Click "Draw on Map" to add stops.</p>';
            variantDrawPoints = [];
            variantDrawMarkers = [];
            variantDrawPolyline = null;
            variantDrawMode = false;
            document.getElementById('saveVariantBtn').disabled = true;
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 50);
        }

        function closeProposeVariantModal() {
            document.getElementById('proposeVariantModal').classList.remove('active');
            stopVariantDrawMode();
        }

        function startVariantDrawMode() {
            if (!tripDetailMap || !currentDetailTrip) return;
            variantDrawMode = true;
            variantDrawPoints = [];
            variantDrawMarkers.forEach(m => tripDetailMap.removeLayer(m));
            variantDrawMarkers = [];
            if (variantDrawPolyline) { tripDetailMap.removeLayer(variantDrawPolyline); variantDrawPolyline = null; }

            // Minimize modal so user sees the map
            const modal = document.getElementById('proposeVariantModal');
            if (modal) modal.style.opacity = '0.15';

            const wpList = document.getElementById('variantWaypointsList');
            if (wpList) wpList.innerHTML = '<p style="font-size:0.78rem;color:#22c55e;font-weight:600;margin:0;">Drawing active — click on the map to place waypoints.</p>';

            tripDetailMap.getContainer().style.cursor = 'crosshair';
            tripDetailMap.on('click', onVariantMapClick);
        }

        function onVariantMapClick(e) {
            if (!variantDrawMode) return;
            const ll = [e.latlng.lat, e.latlng.lng];
            variantDrawPoints.push(ll);
            const idx = variantDrawPoints.length;
            const icon = L.divIcon({
                className: 'route-step-marker',
                html: '<div style="width:24px;height:24px;border-radius:50%;background:#E07A5F;color:#fff;display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:700;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,0.3);">' + idx + '</div>',
                iconSize: [24, 24], iconAnchor: [12, 12]
            });
            const marker = L.marker(ll, { icon, draggable: true }).addTo(tripDetailMap);
            marker.on('dragend', function() {
                const pos = marker.getLatLng();
                variantDrawPoints[idx - 1] = [pos.lat, pos.lng];
                updateVariantDrawPolyline();
            });
            variantDrawMarkers.push(marker);
            updateVariantDrawPolyline();
            document.getElementById('variantDrawStatus').innerHTML = '<span style="color:#22c55e;font-weight:600;">' + variantDrawPoints.length + ' points placed — click map for more, or "Done Drawing"</span>';
            document.getElementById('saveVariantBtn').disabled = variantDrawPoints.length < 2;
        }

        function updateVariantDrawPolyline() {
            if (!tripDetailMap) return;
            if (variantDrawPolyline) tripDetailMap.removeLayer(variantDrawPolyline);
            if (variantDrawPoints.length >= 2) {
                variantDrawPolyline = L.polyline(variantDrawPoints, { color: '#E07A5F', weight: 4, dashArray: '6,6' }).addTo(tripDetailMap);
            }
        }

        function stopVariantDrawMode() {
            variantDrawMode = false;
            if (tripDetailMap) {
                tripDetailMap.off('click', onVariantMapClick);
                tripDetailMap.getContainer().style.cursor = '';
            }
            const modal = document.getElementById('proposeVariantModal');
            if (modal) modal.style.opacity = '1';
            // Clean draw markers from map
            variantDrawMarkers.forEach(m => { if (tripDetailMap) tripDetailMap.removeLayer(m); });
            if (variantDrawPolyline && tripDetailMap) tripDetailMap.removeLayer(variantDrawPolyline);
            variantDrawMarkers = [];
            variantDrawPolyline = null;
        }

        function doneVariantDraw() {
            variantDrawMode = false;
            if (tripDetailMap) {
                tripDetailMap.off('click', onVariantMapClick);
                tripDetailMap.getContainer().style.cursor = '';
            }
            const modal = document.getElementById('proposeVariantModal');
            if (modal) modal.style.opacity = '1';
            document.getElementById('variantDrawStatus').innerHTML = '<span style="color:#0f172a;font-weight:600;">' + variantDrawPoints.length + ' waypoints set. Give your variant a name and save!</span>';
        }

        function saveUserVariant() {
            if (!currentDetailTrip || variantDrawPoints.length < 2) return;
            const name = (document.getElementById('variantNameInput') || document.getElementById('newVariantName')).value.trim();
            const creator = (document.getElementById('variantCreatorName') || document.getElementById('newVariantCreator')).value.trim() || 'Anonymous';
            if (!name) { alert('Please name your variant.'); return; }

            localStorage.setItem('srndipity_username', creator);

            const tripId = currentDetailTrip.id;
            const variants = getUserVariants(tripId);
            const newVariant = {
                id: tripId + '_user_' + Date.now(),
                parentTripId: tripId,
                label: name,
                creator: creator,
                tag: 'community',
                waypoints: variantDrawPoints.map((p, i) => [p[0], p[1], 'Stop ' + (i + 1)]),
                upvotes: 1, // Creator's auto-upvote
                communityScore: 1,
                isPublic: false,
                createdAt: new Date().toISOString()
            };
            variants.push(newVariant);
            setUserVariants(tripId, variants);

            // Auto-upvote own variant
            upvotedVariants[newVariant.id] = true;
            localStorage.setItem('srndipity_upvoted_variants', JSON.stringify(upvotedVariants));

            stopVariantDrawMode();
            closeProposeVariantModal();

            // Refresh chips + pending list
            renderVariantChips(currentDetailTrip);
            renderPendingVariants(currentDetailTrip);
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 100);
        }

        function renderPendingVariants(trip) {
            if (!trip) return;
            const section = document.getElementById('variantPendingSection');
            const list = document.getElementById('variantPendingList');
            const countEl = document.getElementById('variantPendingCount');
            if (!section || !list) return;

            const userVars = getUserVariants(trip.id);
            const pending = userVars.filter(v => !v.isPublic && v.upvotes < VARIANT_PUBLIC_THRESHOLD);
            const publicOnes = userVars.filter(v => v.isPublic || v.upvotes >= VARIANT_PUBLIC_THRESHOLD);

            // Auto-promote variants reaching threshold
            let changed = false;
            userVars.forEach(v => {
                if (!v.isPublic && v.upvotes >= VARIANT_PUBLIC_THRESHOLD) {
                    v.isPublic = true;
                    changed = true;
                }
            });
            if (changed) setUserVariants(trip.id, userVars);

            if (pending.length === 0 && publicOnes.length === 0) {
                section.style.display = 'none';
                return;
            }
            section.style.display = 'block';
            countEl.textContent = pending.length;

            const allToShow = [...publicOnes.map(v => ({...v, _status: 'public'})), ...pending.map(v => ({...v, _status: 'pending'}))];
            list.innerHTML = allToShow.map(v => {
                const pct = Math.min(100, Math.round((v.upvotes / VARIANT_PUBLIC_THRESHOLD) * 100));
                const isUpvoted = upvotedVariants[v.id];
                return `<div class="variant-pending-item ${v._status === 'public' ? 'is-public' : ''}">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
                        <span style="font-weight:600;font-size:0.85rem;color:#0f172a;">${v.label}</span>
                        ${v._status === 'public' ? '<span style="background:#22c55e;color:#fff;font-size:0.6rem;padding:2px 6px;border-radius:8px;font-weight:600;">PUBLIC</span>' : '<span style="background:#f59e0b;color:#fff;font-size:0.6rem;padding:2px 6px;border-radius:8px;font-weight:600;">PENDING</span>'}
                    </div>
                    <div class="variant-creator-info">by ${v.creator} ${renderUserBadge(v.creator)} · ${v.waypoints ? v.waypoints.length : 0} stops · ${new Date(v.createdAt).toLocaleDateString()}</div>
                    <div style="display:flex;align-items:center;gap:10px;margin-top:8px;">
                        <div style="flex:1;height:6px;background:#e2e8f0;border-radius:3px;overflow:hidden;">
                            <div style="width:${pct}%;height:100%;background:${pct >= 100 ? '#22c55e' : '#E07A5F'};border-radius:3px;transition:width 0.3s;"></div>
                        </div>
                        <span style="font-size:0.7rem;color:#64748b;white-space:nowrap;">${v.upvotes}/${VARIANT_PUBLIC_THRESHOLD}</span>
                        <button onclick="upvoteUserVariant('${v.id}','${v.parentTripId}')" class="variant-upvote-btn ${isUpvoted ? 'upvoted' : ''}" style="padding:4px 10px;font-size:0.75rem;">
                            <i data-lucide="thumbs-up" style="width:11px;height:11px;"></i> ${isUpvoted ? 'Voted' : 'Vote'}
                        </button>
                        <button onclick="selectUserVariant('${v.id}','${v.parentTripId}')" class="variant-chip" style="padding:4px 10px;font-size:0.75rem;">
                            <i data-lucide="map" style="width:11px;height:11px;"></i> View
                        </button>
                    </div>
                </div>`;
            }).join('');
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 80);
        }

        function upvoteUserVariant(variantId, tripId) {
            const userVars = getUserVariants(tripId);
            const v = userVars.find(x => x.id === variantId);
            if (!v) return;
            if (upvotedVariants[variantId]) {
                delete upvotedVariants[variantId];
                v.upvotes = Math.max(0, v.upvotes - 1);
            } else {
                upvotedVariants[variantId] = true;
                v.upvotes++;
            }
            v.communityScore = v.upvotes;
            if (v.upvotes >= VARIANT_PUBLIC_THRESHOLD) v.isPublic = true;
            setUserVariants(tripId, userVars);
            localStorage.setItem('srndipity_upvoted_variants', JSON.stringify(upvotedVariants));
            if (currentDetailTrip && currentDetailTrip.id === tripId) {
                renderPendingVariants(currentDetailTrip);
                renderVariantChips(currentDetailTrip);
            }
        }

        async function selectUserVariant(variantId, tripId) {
            const userVars = getUserVariants(tripId);
            const v = userVars.find(x => x.id === variantId);
            if (!v || !currentDetailTrip) return;
            currentVariantId = variantId;
            document.querySelectorAll('.variant-chip').forEach(c => c.classList.remove('active'));
            await renderVariantOnMap(currentDetailTrip, v, { tag: 'full', waypoints: currentDetailTrip.waypoints });
            updateVariantInfoStrip(currentDetailTrip, null);
            const strip = document.getElementById('variantInfoStrip');
            if (strip) {
                strip.style.display = 'flex';
                document.getElementById('variantName').textContent = v.label + ' (community)';
                document.getElementById('variantStops').textContent = v.waypoints ? v.waypoints.length : 0;
                document.getElementById('variantScore').textContent = v.upvotes;
                document.getElementById('variantUpvoteCount').textContent = v.upvotes;
            }
        }

        // Hook: also render pending variants when route tab opens
        const _origSwitchTripTab = typeof switchTripTab === 'function' ? null : null; // already hooked in switchTripTab

        /* Routing API – OSRM (free, no key) or Mapbox (set window.__MAPBOX_ACCESS_TOKEN__)
           Override base URL: window.__ROUTING_API_BASE__ = 'https://your-osrm-host' */
        const ROUTING_CONFIG = {
            apiBase: (typeof window !== 'undefined' && window.__ROUTING_API_BASE__) || 'https://router.project-osrm.org',
            apiKey: (typeof window !== 'undefined' && window.__MAPBOX_ACCESS_TOKEN__) || '',
            useRealRoutes: true
        };

        async function fetchOsrmRoute(latlngs) {
            if (!latlngs || latlngs.length < 2 || !ROUTING_CONFIG.useRealRoutes) return null;
            const coords = latlngs.map(ll => ll[1] + ',' + ll[0]).join(';');
            const url = ROUTING_CONFIG.apiBase + '/route/v1/driving/' + coords + '?overview=full&geometries=geojson';
            try {
                const res = await fetch(url);
                const data = await res.json();
                if (data.code === 'Ok' && data.routes && data.routes[0] && data.routes[0].geometry && data.routes[0].geometry.coordinates) {
                    return data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
                }
            } catch (e) { console.warn('OSRM route fetch failed, using straight line:', e); }
            return null;
        }
        let routeLayers = {};  // tripId -> { polyline, markers[] } for map highlight & sync
        let communityAlerts = [];
        let completedTrips = [];  // Track completed road trips
        let garageTripIds = [];   // Save to Garage (wishlist)
        const TRIPS_PAGE_SIZE = 12;
        let visibleTripCount = TRIPS_PAGE_SIZE;
        let lastTripListKey = '';
        let userCreatedTrips = []; // User-created road trips
        let userName = 'Anonymous Explorer'; // User's display name
        let plannedTrips = []; // User's planned trips from diary mode
        let tripPlannerMap = null; // Leaflet map for trip planner
        let plannerMarkers = []; // Markers on planner map
        let plannerRoute = null; // Polyline for route
        let currentStopType = 'waypoint'; // Current stop type being added
        let plannerStops = []; // Stops in current planning session
        let satelliteMap = null; // Leaflet map for satellite view
        let currentSatelliteLayer = 'satellite'; // Current layer type
        let satelliteLayers = {}; // Store layer references
        const DEFAULT_COLOR = '#2d2d3a';
        const VISITED_COLOR = '#22c55e';
        const ROAD_TRIP_FILL = '#22c55e';
        const ROAD_TRIP_STROKE = '#E07A5F';

        // POI Layer Groups for Road Map
        let poiLayers = {
            campsiteFree: null, campsitePaid: null, overnightParking: null,
            fuel: null, grocery: null, localProducer: null, organicRestaurant: null,
            water: null, viewpoint: null, restArea: null, mechanic: null, premium: null
        };
        let poiVisible = {
            campsiteFree: false, campsitePaid: false, overnightParking: false,
            fuel: false, grocery: false, localProducer: false, organicRestaurant: false,
            water: false, viewpoint: false, restArea: false, mechanic: false, premium: false
        };

        // Preparation data: visas, vaccines, legal by destination country and nationality
        const preparationByCountry = {
            Norway: {
                visas: { EU: { required: false, note: 'Espace Schengen. Pas de visa pour séjour &lt; 90 jours.' }, UK: { required: false, note: '90 jours / 180 jours (règles post-Brexit).' }, US: { required: false, note: '90 jours sans visa (VWP si éligible).' }, CA: { required: false, note: '90 jours sans visa.' }, AU: { required: false, note: '90 jours sans visa.' }, NZ: { required: false, note: '90 jours sans visa.' }, OTHER: { required: true, note: 'Visa Schengen requis. Contacter l\'ambassade.' } },
                vaccines: { required: [], recommended: ['Routine (DTP, ROR, Covid selon recommandations OMS).'] },
                legal: ['Permis de conduire national valide (ou permis international si hors UE/EEE).', 'Assurance véhicule (carte verte / extension internationale).', 'Allemannsretten : camping sauvage autorisé sous conditions (respect de la nature, pas de déchets).']
            },
            Scotland: {
                visas: { EU: { required: false, note: 'Voyage sans visa (règles UK post-Brexit, vérifier durée selon passeport).' }, UK: { required: false, note: 'Résidents UK : pas de formalité.' }, US: { required: false, note: '6 mois sans visa (tourisme).' }, CA: { required: false, note: '6 mois sans visa.' }, AU: { required: false, note: '6 mois sans visa.' }, NZ: { required: false, note: '6 mois sans visa.' }, OTHER: { required: true, note: 'Visa UK requis. Vérifier gov.uk.' } },
                vaccines: { required: [], recommended: ['Routine (DTP, ROR).'] },
                legal: ['Permis de conduire valide (UE/UK reconnus). Conduite à gauche.', 'Assurance véhicule UK obligatoire.', 'Wild camping légal en Écosse (Scottish Outdoor Access Code).']
            },
            Iceland: {
                visas: { EU: { required: false, note: 'Espace Schengen. Pas de visa &lt; 90 jours.' }, UK: { required: false, note: '90 jours / 180 jours.' }, US: { required: false, note: '90 jours sans visa (VWP).' }, CA: { required: false, note: '90 jours sans visa.' }, AU: { required: false, note: '90 jours sans visa.' }, NZ: { required: false, note: '90 jours sans visa.' }, OTHER: { required: true, note: 'Visa Schengen requis.' } },
                vaccines: { required: [], recommended: ['Routine. Conditions météo rudes : prévoir santé générale.'] },
                legal: ['Permis de conduire valide (international recommandé si hors UE/EEE).', 'Assurance véhicule obligatoire. Routes F non couvertes par toutes les assurances.', 'Camping uniquement dans les aires désignées (règlement strict).']
            },
            USA: {
                visas: { EU: { required: true, note: 'ESTA (si éligible) ou visa B2. ESTA valable 2 ans, séjour max 90 jours.' }, UK: { required: true, note: 'ESTA ou visa B2.' }, US: { required: false, note: 'Résidents US.' }, CA: { required: false, note: 'Citoyens canadiens : pas de visa pour séjour touristique.' }, AU: { required: true, note: 'ESTA ou visa B2.' }, NZ: { required: true, note: 'ESTA ou visa B2.' }, OTHER: { required: true, note: 'Visa ou programme d\'exemption (ESTA). Vérifier travel.state.gov.' } },
                vaccines: { required: [], recommended: ['Routine. Selon régions : rage (activités outdoors), encéphalite à tiques (Nord-Est).'] },
                legal: ['Permis de conduire national valide (certains États exigent un permis international).', 'Assurance auto obligatoire (niveau minimal selon l\'État).', 'Vérifier règles par État (alcool, camping, feux).']
            },
            Australia: {
                visas: { EU: { required: true, note: 'eVisitor (651) ou ETA. En ligne, payant.' }, UK: { required: true, note: 'eVisitor ou ETA.' }, US: { required: true, note: 'ETA (Electronic Travel Authority).' }, CA: { required: true, note: 'eVisitor ou ETA.' }, AU: { required: false, note: 'Résidents australiens.' }, NZ: { required: false, note: 'Citoyens NZ : pas de visa pour séjour court.' }, OTHER: { required: true, note: 'Visa requis (touriste, eVisitor, etc.). homeaffairs.gov.au.' } },
                vaccines: { required: [], recommended: ['Routine. Pas de vaccin obligatoire pour tourisme standard.'] },
                legal: ['Permis de conduire en anglais ou traduction officielle / permis international.', 'Assurance véhicule obligatoire. Camping : respecter les zones autorisées (variable par État).']
            },
            'New Zealand': {
                visas: { EU: { required: true, note: 'NZeTA (Nouvelle-Zélande Electronic Travel Authority) + droit de passage international.' }, UK: { required: true, note: 'NZeTA.' }, US: { required: true, note: 'NZeTA.' }, CA: { required: true, note: 'NZeTA.' }, AU: { required: false, note: 'Citoyens australiens : pas de visa.' }, NZ: { required: false, note: 'Résidents NZ.' }, OTHER: { required: true, note: 'NZeTA ou visa. immigration.govt.nz.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire valide (international recommandé si non anglophone). Conduite à gauche.', 'Assurance véhicule obligatoire. DOC : camping dans les sites désignés.']
            },
            Ireland: {
                visas: { EU: { required: false, note: 'Espace communautaire. Pas de visa.' }, UK: { required: false, note: 'Common Travel Area avec le Royaume-Uni.' }, US: { required: false, note: '90 jours sans visa (tourisme).' }, CA: { required: false, note: 'Séjour court sans visa.' }, AU: { required: false, note: '90 jours sans visa.' }, NZ: { required: false, note: '90 jours sans visa.' }, OTHER: { required: true, note: 'Vérifier visa Irlande (différent du UK).' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire valide. Conduite à gauche.', 'Assurance véhicule obligatoire.']
            },
            Portugal: {
                visas: { EU: { required: false, note: 'Schengen. Pas de visa &lt; 90 jours.' }, UK: { required: false, note: '90 jours / 180 jours.' }, US: { required: false, note: '90 jours sans visa (Schengen).' }, CA: { required: false, note: '90 jours sans visa.' }, AU: { required: false, note: '90 jours sans visa.' }, NZ: { required: false, note: '90 jours sans visa.' }, OTHER: { required: true, note: 'Visa Schengen requis.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire UE/EEE valide. Sinon permis international.', 'Assurance véhicule (carte verte).']
            },
            Spain: {
                visas: { EU: { required: false, note: 'Schengen.' }, UK: { required: false, note: '90/180 jours.' }, US: { required: false, note: '90 jours sans visa.' }, CA: { required: false, note: '90 jours.' }, AU: { required: false, note: '90 jours.' }, NZ: { required: false, note: '90 jours.' }, OTHER: { required: true, note: 'Visa Schengen.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire valide (UE ou international).', 'Assurance véhicule (carte verte).']
            },
            Italy: {
                visas: { EU: { required: false, note: 'Schengen.' }, UK: { required: false, note: '90/180 jours.' }, US: { required: false, note: '90 jours.' }, CA: { required: false, note: '90 jours.' }, AU: { required: false, note: '90 jours.' }, NZ: { required: false, note: '90 jours.' }, OTHER: { required: true, note: 'Visa Schengen.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire UE ou international.', 'Assurance véhicule (carte verte).']
            },
            Switzerland: {
                visas: { EU: { required: false, note: 'Accord Schengen. Pas de visa &lt; 90 jours.' }, UK: { required: false, note: '90/180 jours.' }, US: { required: false, note: '90 jours.' }, CA: { required: false, note: '90 jours.' }, AU: { required: false, note: '90 jours.' }, NZ: { required: false, note: '90 jours.' }, OTHER: { required: true, note: 'Visa Schengen.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire valide. Vignette autoroutière obligatoire (achat à la frontière).', 'Assurance véhicule (carte verte).']
            },
            Namibia: {
                visas: { EU: { required: false, note: '90 jours sans visa (tourisme).' }, UK: { required: false, note: '90 jours sans visa.' }, US: { required: false, note: '90 jours sans visa.' }, CA: { required: false, note: '90 jours.' }, AU: { required: false, note: '90 jours.' }, NZ: { required: false, note: '90 jours.' }, OTHER: { required: true, note: 'Vérifier selon nationalité. Ambassade Namibie.' } },
                vaccines: { required: [], recommended: ['Fièvre jaune si transit par zone endémique. Hépatite A, typhoïde recommandés. Rage si séjour prolongé en brousse.'] },
                legal: ['Permis de conduire international recommandé. Conduite à gauche.', 'Assurance véhicule (extension Afrique souvent nécessaire). 4x4 recommandé pour certains circuits.']
            },
            Germany: {
                visas: { EU: { required: false, note: 'Schengen.' }, UK: { required: false, note: '90/180 jours.' }, US: { required: false, note: '90 jours.' }, CA: { required: false, note: '90 jours.' }, AU: { required: false, note: '90 jours.' }, NZ: { required: false, note: '90 jours.' }, OTHER: { required: true, note: 'Visa Schengen.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire UE ou international.', 'Assurance véhicule (carte verte).']
            },
            France: {
                visas: { EU: { required: false, note: 'Schengen.' }, UK: { required: false, note: '90/180 jours.' }, US: { required: false, note: '90 jours.' }, CA: { required: false, note: '90 jours.' }, AU: { required: false, note: '90 jours.' }, NZ: { required: false, note: '90 jours.' }, OTHER: { required: true, note: 'Visa Schengen.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire valide (UE ou international).', 'Assurance véhicule (carte verte).']
            },
            Romania: {
                visas: { EU: { required: false, note: 'Schengen (à terme). Actuellement pas de visa &lt; 90 jours pour UE/EEE/Suisse.' }, UK: { required: false, note: '90 jours / 180 jours.' }, US: { required: false, note: '90 jours sans visa.' }, CA: { required: false, note: '90 jours.' }, AU: { required: false, note: '90 jours.' }, NZ: { required: false, note: '90 jours.' }, OTHER: { required: true, note: 'Vérifier selon nationalité. Ambassade Roumanie.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire UE ou international.', 'Assurance véhicule (carte verte).']
            },
            Canada: {
                visas: { EU: { required: true, note: 'eTA (Electronic Travel Authorization) obligatoire pour vol. Pas de visa pour séjour court.' }, UK: { required: true, note: 'eTA obligatoire.' }, US: { required: false, note: 'Citoyens US : pas de visa.' }, CA: { required: false, note: 'Résidents canadiens.' }, AU: { required: true, note: 'eTA.' }, NZ: { required: true, note: 'eTA.' }, OTHER: { required: true, note: 'eTA ou visa. canada.ca/fr/immigration.' } },
                vaccines: { required: [], recommended: ['Routine.'] },
                legal: ['Permis de conduire valide (international recommandé si non canadien).', 'Assurance véhicule obligatoire.']
            },
            Multi: {
                visas: { EU: { required: null, note: 'Plusieurs pays : vérifier visa pour chaque frontière (Schengen, UK, USA, etc.).' }, UK: { required: null, note: 'Vérifier chaque pays traversé.' }, US: { required: null, note: 'Vérifier chaque pays.' }, CA: { required: null, note: 'Vérifier chaque pays.' }, AU: { required: null, note: 'Vérifier chaque pays.' }, NZ: { required: null, note: 'Vérifier chaque pays.' }, OTHER: { required: true, note: 'Visa requis pour chaque pays du parcours. Planifier longtemps à l\'avance.' } },
                vaccines: { required: [], recommended: ['Routine. Selon pays : fièvre jaune, rage, etc. Consulter OMS / centre de vaccination.'] },
                legal: ['Permis international recommandé. Assurances multi-pays. Vérifier règles par pays (douanes, durée de séjour).']
            }
        };
        // Map trip country names to preparation key (e.g. Scotland -> Scotland, UK -> United Kingdom if needed)
        function getPreparationKey(countryName) {
            if (!countryName) return null;
            const key = countryName.trim();
            if (preparationByCountry[key]) return key;
            if (key === 'UK' || key === 'United Kingdom') return 'Scotland';
            return key;
        }

        // POI Database - Pre-loaded reference data for offline use
        const poiDatabase = {
            // ============ FREE CAMPSITES ============
            campsiteFree: [
                // Route 66 (USA)
                { lat: 35.6870, lng: -105.9378, name: 'Santa Fe BLM Land', region: 'Route 66', country: 'USA', tip: 'Dispersed camping allowed, no facilities' },
                { lat: 35.1983, lng: -111.6513, name: 'Coconino Forest Camp', region: 'Route 66', country: 'USA', tip: 'Free 14-day limit, bring water' },
                { lat: 35.2220, lng: -101.8313, name: 'Lake Meredith NRA', region: 'Route 66', country: 'USA', tip: 'Free camping at designated areas' },
                // Iceland Ring Road
                { lat: 64.1466, lng: -21.9426, name: 'Reykjavik Campsite', region: 'Iceland Ring', country: 'Iceland', tip: 'Basic facilities, central location' },
                { lat: 65.6835, lng: -18.0878, name: 'Akureyri Camping', region: 'Iceland Ring', country: 'Iceland', tip: 'Hot showers, near town center' },
                { lat: 64.2538, lng: -15.2080, name: 'Höfn Campground', region: 'Iceland Ring', country: 'Iceland', tip: 'Glacier views, basic facilities' },
                // Scotland NC500
                { lat: 57.4778, lng: -4.2247, name: 'Inverness Wild Camp', region: 'NC500', country: 'Scotland', tip: 'Right to roam - wild camping legal' },
                { lat: 58.4375, lng: -4.4312, name: 'Durness Beach Camp', region: 'NC500', country: 'Scotland', tip: 'Stunning beach, free wild camping' },
                { lat: 57.8619, lng: -5.1589, name: 'Ullapool Hills', region: 'NC500', country: 'Scotland', tip: 'Wild camping with loch views' },
                // Norway
                { lat: 62.1127, lng: 7.2066, name: 'Trollstigen Valley', region: 'Trollstigen', country: 'Norway', tip: 'Allemannsretten - right to roam' },
                { lat: 61.2176, lng: 6.8413, name: 'Sognefjord Rest', region: 'Norway', country: 'Norway', tip: 'Free fjord-side camping' },
                // Australia
                { lat: -38.6819, lng: 143.4764, name: 'Great Ocean Free Camp', region: 'Great Ocean Road', country: 'Australia', tip: '24hr max, self-contained only' },
                { lat: -38.7611, lng: 143.6667, name: 'Johanna Beach', region: 'Great Ocean Road', country: 'Australia', tip: 'Beautiful beach camping, free' },
                // New Zealand
                { lat: -45.0312, lng: 168.6626, name: 'Milford Road Camp', region: 'Milford Sound', country: 'New Zealand', tip: 'DOC site, basic facilities' },
                { lat: -44.6714, lng: 167.9264, name: 'Lake Gunn Rest', region: 'Milford Sound', country: 'New Zealand', tip: 'Free DOC campsite, stunning' },
                // Europe
                { lat: 40.4168, lng: -3.7038, name: 'Madrid Outskirts', region: 'Spain', country: 'Spain', tip: 'Free areas outside city' },
                { lat: 41.3851, lng: 2.1734, name: 'Barcelona Hills', region: 'Spain', country: 'Spain', tip: 'Montjuic area, check local rules' },
                { lat: 43.7696, lng: 11.2558, name: 'Tuscany Agriturismi', region: 'Italy', country: 'Italy', tip: 'Many offer free overnight' },
                { lat: 45.4642, lng: 9.1900, name: 'Milan Lakes', region: 'Italy', country: 'Italy', tip: 'Lake Como free spots' }
            ],
            
            // ============ PAID CAMPSITES ============
            campsitePaid: [
                // Route 66
                { lat: 34.0522, lng: -118.2437, name: 'LA/Long Beach KOA', region: 'Route 66', country: 'USA', price: '$45-65/night', tip: 'Full hookups, pool, WiFi' },
                { lat: 36.1699, lng: -115.1398, name: 'Las Vegas RV Resort', region: 'Route 66', country: 'USA', price: '$40-80/night', tip: 'Near Strip, full amenities' },
                { lat: 35.0844, lng: -106.6504, name: 'Albuquerque KOA', region: 'Route 66', country: 'USA', price: '$35-55/night', tip: 'Clean facilities, laundry' },
                // Iceland
                { lat: 64.1466, lng: -21.9426, name: 'Reykjavik Campsite', region: 'Iceland Ring', country: 'Iceland', price: '2500 ISK', tip: 'Hot showers, central' },
                { lat: 65.2622, lng: -14.4044, name: 'Egilsstaðir Camp', region: 'Iceland Ring', country: 'Iceland', price: '2000 ISK', tip: 'Near supermarket' },
                // Europe
                { lat: 40.6337, lng: 14.6027, name: 'Amalfi Coast Camp', region: 'Amalfi', country: 'Italy', price: '€25-40/night', tip: 'Sea views, book ahead in summer' },
                { lat: 48.8566, lng: 2.3522, name: 'Paris Bois de Boulogne', region: 'France', country: 'France', price: '€30-50/night', tip: 'Closest to city center' },
                { lat: 47.3769, lng: 8.5417, name: 'Zurich Camping', region: 'Switzerland', country: 'Switzerland', price: '€35-45/night', tip: 'Lake access, clean' },
                // Australia/NZ
                { lat: -38.7611, lng: 143.6667, name: 'Apollo Bay Holiday Park', region: 'Great Ocean Road', country: 'Australia', price: 'A$35-60/night', tip: 'Hot showers, beach access' },
                { lat: -45.4140, lng: 167.7180, name: 'Te Anau Holiday Park', region: 'Milford Sound', country: 'New Zealand', price: 'NZ$45-65/night', tip: 'Gateway to Milford' }
            ],
            
            // ============ FUEL STATIONS ============
            fuel: [
                // Route 66 - Critical fuel stops
                { lat: 35.4676, lng: -109.0565, name: 'Holbrook Shell', region: 'Route 66', country: 'USA', type: 'Gas/Diesel', tip: 'Last fuel for 60 miles' },
                { lat: 35.2220, lng: -101.8313, name: 'Amarillo Loves', region: 'Route 66', country: 'USA', type: 'Gas/Diesel/LPG', tip: '24hr, truck stop, showers' },
                { lat: 35.1917, lng: -111.6178, name: 'Flagstaff Chevron', region: 'Route 66', country: 'USA', type: 'Gas/Diesel', tip: 'Near historic downtown' },
                // Iceland - Limited fuel!
                { lat: 64.1466, lng: -21.9426, name: 'N1 Reykjavik', region: 'Iceland Ring', country: 'Iceland', type: 'Gas/Diesel', tip: 'Fill up here, sparse ahead' },
                { lat: 65.6835, lng: -18.0878, name: 'N1 Akureyri', region: 'Iceland Ring', country: 'Iceland', type: 'Gas/Diesel', tip: 'Major stop in North' },
                { lat: 64.2538, lng: -15.2080, name: 'Olís Höfn', region: 'Iceland Ring', country: 'Iceland', type: 'Gas/Diesel', tip: 'Southeast Iceland' },
                { lat: 63.4186, lng: -20.2867, name: 'N1 Vík', region: 'Iceland Ring', country: 'Iceland', type: 'Gas/Diesel', tip: 'South coast stop' },
                // Scotland NC500
                { lat: 57.4778, lng: -4.2247, name: 'Tesco Inverness', region: 'NC500', country: 'Scotland', type: 'Gas/Diesel', tip: 'Cheapest fuel, stock up' },
                { lat: 58.5667, lng: -3.0667, name: 'John o Groats Shell', region: 'NC500', country: 'Scotland', type: 'Gas/Diesel', tip: 'Northernmost mainland' },
                // Norway
                { lat: 62.4722, lng: 6.1549, name: 'Circle K Ålesund', region: 'Trollstigen', country: 'Norway', type: 'Gas/Diesel', tip: 'Before mountain pass' },
                // Australia
                { lat: -38.3583, lng: 144.0500, name: 'Shell Geelong', region: 'Great Ocean Road', country: 'Australia', type: 'Gas/Diesel/LPG', tip: 'Last major town fuel' },
                { lat: -38.7611, lng: 143.6667, name: 'Apollo Bay BP', region: 'Great Ocean Road', country: 'Australia', type: 'Gas/Diesel', tip: 'Mid-route fuel stop' },
                // Patagonia - CRITICAL
                { lat: -43.1167, lng: -72.0667, name: 'COPEC Chaitén', region: 'Carretera Austral', country: 'Chile', type: 'Gas/Diesel', tip: 'Fill tank completely!' },
                { lat: -45.4000, lng: -72.7000, name: 'COPEC Coyhaique', region: 'Carretera Austral', country: 'Chile', type: 'Gas/Diesel', tip: 'Major hub, fill up' }
            ],
            
            // ============ GROCERY STORES ============
            grocery: [
                // Route 66
                { lat: 34.0522, lng: -118.2437, name: 'Walmart Los Angeles', region: 'Route 66', country: 'USA', type: 'Supermarket', tip: '24hr, good for stocking up' },
                { lat: 35.0844, lng: -106.6504, name: 'Smith\'s Albuquerque', region: 'Route 66', country: 'USA', type: 'Supermarket', tip: 'Good deli section' },
                // Iceland
                { lat: 64.1466, lng: -21.9426, name: 'Bónus Reykjavik', region: 'Iceland Ring', country: 'Iceland', type: 'Discount', tip: 'Cheapest groceries in Iceland' },
                { lat: 65.6835, lng: -18.0878, name: 'Krónan Akureyri', region: 'Iceland Ring', country: 'Iceland', type: 'Supermarket', tip: 'Good selection, fair prices' },
                // Scotland
                { lat: 57.4778, lng: -4.2247, name: 'Tesco Inverness', region: 'NC500', country: 'Scotland', type: 'Supermarket', tip: 'Stock up, limited shops on route' },
                // Europe
                { lat: 40.6337, lng: 14.6027, name: 'Conad Amalfi', region: 'Amalfi', country: 'Italy', type: 'Supermarket', tip: 'Small but has essentials' },
                { lat: 48.8566, lng: 2.3522, name: 'Carrefour Paris', region: 'France', country: 'France', type: 'Hypermarket', tip: 'Multiple locations' },
                // Australia
                { lat: -38.3583, lng: 144.0500, name: 'Coles Geelong', region: 'Great Ocean Road', country: 'Australia', type: 'Supermarket', tip: 'Last big supermarket' },
                // New Zealand
                { lat: -45.4140, lng: 167.7180, name: 'Fresh Choice Te Anau', region: 'Milford Sound', country: 'New Zealand', type: 'Supermarket', tip: 'Stock up before Milford' }
            ],
            
            // ============ WATER REFILL POINTS ============
            water: [
                { lat: 35.4676, lng: -109.0565, name: 'Holbrook Visitor Center', region: 'Route 66', country: 'USA', type: 'Free', tip: 'Potable water tap' },
                { lat: 64.1466, lng: -21.9426, name: 'Reykjavik Campsite', region: 'Iceland Ring', country: 'Iceland', type: 'Free', tip: 'Iceland tap water is excellent' },
                { lat: 57.4778, lng: -4.2247, name: 'Inverness Rest Stop', region: 'NC500', country: 'Scotland', type: 'Free', tip: 'Scottish water is pristine' },
                { lat: -38.7611, lng: 143.6667, name: 'Apollo Bay Info Center', region: 'Great Ocean Road', country: 'Australia', type: 'Free', tip: 'Filtered water available' },
                { lat: -45.0312, lng: 168.6626, name: 'Milford Road Rest', region: 'Milford Sound', country: 'New Zealand', type: 'Free', tip: 'Natural spring water' },
                { lat: 62.1127, lng: 7.2066, name: 'Trollstigen Parking', region: 'Trollstigen', country: 'Norway', type: 'Free', tip: 'Mountain spring water' }
            ],
            
            // ============ VIEWPOINTS / PHOTO SPOTS ============
            viewpoint: [
                // Route 66
                { lat: 36.0544, lng: -112.1401, name: 'Grand Canyon South Rim', region: 'Route 66', country: 'USA', tip: 'Sunset views incredible' },
                { lat: 35.0456, lng: -110.8350, name: 'Meteor Crater', region: 'Route 66', country: 'USA', tip: '50,000 year old crater' },
                // Iceland
                { lat: 64.3271, lng: -20.1199, name: 'Gullfoss Waterfall', region: 'Iceland Ring', country: 'Iceland', tip: 'Golden hour magic' },
                { lat: 64.0558, lng: -16.1819, name: 'Jökulsárlón Glacier', region: 'Iceland Ring', country: 'Iceland', tip: 'Icebergs in lagoon' },
                { lat: 63.6167, lng: -19.9917, name: 'Seljalandsfoss', region: 'Iceland Ring', country: 'Iceland', tip: 'Walk behind the waterfall' },
                // Scotland
                { lat: 57.2271, lng: -5.5210, name: 'Eilean Donan Castle', region: 'NC500', country: 'Scotland', tip: 'Most photographed castle' },
                { lat: 58.4375, lng: -4.7286, name: 'Smoo Cave', region: 'NC500', country: 'Scotland', tip: 'Sea cave with waterfall' },
                // Norway
                { lat: 62.4583, lng: 7.6667, name: 'Trollstigen Viewpoint', region: 'Trollstigen', country: 'Norway', tip: 'Glass viewing platform' },
                { lat: 60.1282, lng: 6.7461, name: 'Trolltunga', region: 'Norway', country: 'Norway', tip: 'Famous rock formation' },
                // Australia
                { lat: -38.7597, lng: 143.1044, name: 'Twelve Apostles', region: 'Great Ocean Road', country: 'Australia', tip: 'Sunrise/sunset best' },
                { lat: -38.8583, lng: 143.5167, name: 'London Arch', region: 'Great Ocean Road', country: 'Australia', tip: 'Former London Bridge' },
                // New Zealand
                { lat: -44.6714, lng: 167.9264, name: 'Mirror Lakes', region: 'Milford Sound', country: 'New Zealand', tip: 'Perfect reflections, calm days' },
                { lat: -44.6731, lng: 167.9256, name: 'Milford Sound', region: 'Milford Sound', country: 'New Zealand', tip: 'Best from boat cruise' },
                // Amalfi
                { lat: 40.6500, lng: 14.6000, name: 'Ravello Gardens', region: 'Amalfi', country: 'Italy', tip: 'Villa Rufolo gardens' },
                { lat: 40.6337, lng: 14.6027, name: 'Amalfi Cathedral', region: 'Amalfi', country: 'Italy', tip: 'Steps are famous photo' }
            ],
            
            // ============ REST AREAS ============
            restArea: [
                { lat: 35.2220, lng: -101.8313, name: 'Texas Rest Stop', region: 'Route 66', country: 'USA', tip: 'Clean toilets, picnic tables' },
                { lat: 35.4676, lng: -109.0565, name: 'Arizona Welcome Center', region: 'Route 66', country: 'USA', tip: 'Info, toilets, vending' },
                { lat: 64.2538, lng: -15.2080, name: 'Höfn Rest Area', region: 'Iceland Ring', country: 'Iceland', tip: 'Toilets, info board' },
                { lat: 57.8619, lng: -5.1589, name: 'Ullapool Layby', region: 'NC500', country: 'Scotland', tip: 'Scenic rest with view' },
                { lat: -38.7611, lng: 143.6667, name: 'Apollo Bay Rest', region: 'Great Ocean Road', country: 'Australia', tip: 'Toilets, BBQ facilities' }
            ],
            
            // ============ MECHANICS / SERVICE ============
            mechanic: [
                { lat: 35.0844, lng: -106.6504, name: 'Albuquerque Auto', region: 'Route 66', country: 'USA', type: 'Full Service', tip: 'Good for older vehicles' },
                { lat: 64.1466, lng: -21.9426, name: 'Bílaþjónusta Reykjavik', region: 'Iceland Ring', country: 'Iceland', type: 'Full Service', tip: 'English spoken, expensive' },
                { lat: 65.6835, lng: -18.0878, name: 'Akureyri Garage', region: 'Iceland Ring', country: 'Iceland', type: 'Full Service', tip: 'Only major service in North' },
                { lat: 57.4778, lng: -4.2247, name: 'Halfords Inverness', region: 'NC500', country: 'Scotland', type: 'Parts & Basic', tip: 'Good for parts and basics' },
                { lat: -38.3583, lng: 144.0500, name: 'Repco Geelong', region: 'Great Ocean Road', country: 'Australia', type: 'Parts', tip: 'Auto parts chain' }
            ],
            // ============ NEW: LOCAL PRODUCERS ============
            localProducer: [
                { lat: 43.7696, lng: 11.2558, name: 'Fattoria Toscana', region: 'Italy', country: 'Italy', tip: 'Fresh olive oil & wine tasting', type: 'Farm shop' },
                { lat: 40.6337, lng: 14.6027, name: 'Limoni di Amalfi', region: 'Amalfi', country: 'Italy', tip: 'Famous local lemons, limoncello', type: 'Farm shop' },
                { lat: 57.4778, lng: -4.2247, name: 'Highland Honey', region: 'NC500', country: 'Scotland', tip: 'Raw local heather honey', type: 'Farm shop' },
                { lat: 62.1127, lng: 7.2066, name: 'Geiranger Gard', region: 'Trollstigen', country: 'Norway', tip: 'Local goat cheese & berries', type: 'Farm shop' }
            ],
            // ============ NEW: ORGANIC RESTAURANTS ============
            organicRestaurant: [
                { lat: 64.1466, lng: -21.9426, name: 'Gott Restaurant', region: 'Iceland Ring', country: 'Iceland', tip: 'Farm-to-table Icelandic cuisine', type: 'Restaurant', price: '$$' },
                { lat: 43.7696, lng: 11.2558, name: 'Bio Trattoria', region: 'Italy', country: 'Italy', tip: 'Full organic menu with local wines', type: 'Restaurant', price: '$$' },
                { lat: 48.8566, lng: 2.3522, name: 'Le Potager du Marais', region: 'France', country: 'France', tip: 'Vegan & organic in the heart of Paris', type: 'Restaurant', price: '$$' }
            ],
            // ============ NEW: OVERNIGHT PARKING ============
            overnightParking: [
                { lat: 35.6870, lng: -105.9378, name: 'Walmart Santa Fe', region: 'Route 66', country: 'USA', tip: 'Free overnight, ask permission at service desk', type: 'Parking' },
                { lat: -38.6819, lng: 143.4764, name: 'Apollo Bay P&R', region: 'Great Ocean Road', country: 'Australia', tip: 'Free 24h parking, self-contained only', type: 'Parking' },
                { lat: 57.8619, lng: -5.1589, name: 'Ullapool Car Park', region: 'NC500', country: 'Scotland', tip: 'Tolerated overnight, no facilities', type: 'Parking' }
            ],
            // ============ NEW: PREMIUM / PARTNER POIs ============
            premium: [
                { lat: 35.0844, lng: -106.6504, name: 'El Pinto Restaurant & Cantina', region: 'Route 66', country: 'USA', tip: 'Award-winning New Mexican cuisine. Mention DrawYourMap for 10% off.', type: 'Restaurant', price: 'From $25', partner: 'GetYourGuide', partnerUrl: 'https://www.getyourguide.com/', rating: 4.7, reviews: 482, isPremium: true },
                { lat: 64.1466, lng: -21.9426, name: 'Blue Lagoon Premium', region: 'Iceland Ring', country: 'Iceland', tip: 'Skip the line with our partner link. Best at sunset.', type: 'Spa', price: 'From 75€', partner: 'Viator', partnerUrl: 'https://www.viator.com/', rating: 4.8, reviews: 1247, isPremium: true },
                { lat: 57.4778, lng: -4.2247, name: 'Loch Ness Explorer Lodge', region: 'NC500', country: 'Scotland', tip: 'Boutique lodge with loch views. Free cancellation via our link.', type: 'Hotel', price: 'From 89€', partner: 'Booking.com', partnerUrl: 'https://www.booking.com/', rating: 4.6, reviews: 312, isPremium: true },
                { lat: -38.7611, lng: 143.6667, name: 'Twelve Apostles Helicopter Tour', region: 'Great Ocean Road', country: 'Australia', tip: '15-min scenic flight. Book 48h ahead.', type: 'Activity', price: 'From A$149', partner: 'GetYourGuide', partnerUrl: 'https://www.getyourguide.com/', rating: 4.9, reviews: 856, isPremium: true },
                { lat: 43.7696, lng: 11.2558, name: 'Chianti Wine Tour', region: 'Italy', country: 'Italy', tip: 'Full day guided tour with tastings. Small group.', type: 'Activity', price: 'From 69€', partner: 'Civitatis', partnerUrl: 'https://www.civitatis.com/', rating: 4.5, reviews: 623, isPremium: true },
                { lat: 62.1127, lng: 7.2066, name: 'Trollstigen Sky Lodge', region: 'Trollstigen', country: 'Norway', tip: 'Glass-ceiling cabins with mountain views. Unique experience.', type: 'Hotel', price: 'From 195€', partner: 'Booking.com', partnerUrl: 'https://www.booking.com/', rating: 4.8, reviews: 178, isPremium: true }
            ]
        };

        // ==================== COMMUNITY VALIDATION SYSTEM ====================
        const POI_VOTES_KEY = 'dym_poi_votes';
        const POI_REPORTS_KEY = 'dym_poi_reports';
        const COMMUNITY_VERIFIED_THRESHOLD = 5;

        function getPoiVotes() {
            try { return JSON.parse(localStorage.getItem(POI_VOTES_KEY)) || {}; } catch { return {}; }
        }
        function setPoiVotes(v) { localStorage.setItem(POI_VOTES_KEY, JSON.stringify(v)); }
        function getPoiReports() {
            try { return JSON.parse(localStorage.getItem(POI_REPORTS_KEY)) || {}; } catch { return {}; }
        }
        function setPoiReports(r) { localStorage.setItem(POI_REPORTS_KEY, JSON.stringify(r)); }

        function getPoiId(poi) { return `${poi.lat}_${poi.lng}_${(poi.name||'').replace(/\s/g,'_')}`; }

        function votePoiUp(lat, lng, name) {
            const id = `${lat}_${lng}_${(name||'').replace(/\\s/g,'_')}`;
            const votes = getPoiVotes();
            if (!votes[id]) votes[id] = { up: 0, down: 0, myVote: null };
            if (votes[id].myVote === 'up') { votes[id].up--; votes[id].myVote = null; }
            else { if (votes[id].myVote === 'down') votes[id].down--; votes[id].up++; votes[id].myVote = 'up'; }
            setPoiVotes(votes);
            return votes[id];
        }
        function votePoiDown(lat, lng, name) {
            const id = `${lat}_${lng}_${(name||'').replace(/\\s/g,'_')}`;
            const votes = getPoiVotes();
            if (!votes[id]) votes[id] = { up: 0, down: 0, myVote: null };
            if (votes[id].myVote === 'down') { votes[id].down--; votes[id].myVote = null; }
            else { if (votes[id].myVote === 'up') votes[id].up--; votes[id].down++; votes[id].myVote = 'down'; }
            setPoiVotes(votes);
            return votes[id];
        }
        function reportPoi(lat, lng, name, reason) {
            const id = `${lat}_${lng}_${(name||'').replace(/\\s/g,'_')}`;
            const reports = getPoiReports();
            reports[id] = { reason, date: new Date().toISOString() };
            setPoiReports(reports);
        }

        // Major world cities database for trip planning snap-to feature
        const majorCities = [
            // Europe
            { name: 'Paris', country: 'France', lat: 48.8566, lng: 2.3522, pop: 11000000 },
            { name: 'London', country: 'UK', lat: 51.5074, lng: -0.1278, pop: 9000000 },
            { name: 'Berlin', country: 'Germany', lat: 52.5200, lng: 13.4050, pop: 3600000 },
            { name: 'Madrid', country: 'Spain', lat: 40.4168, lng: -3.7038, pop: 6600000 },
            { name: 'Barcelona', country: 'Spain', lat: 41.3851, lng: 2.1734, pop: 5500000 },
            { name: 'Rome', country: 'Italy', lat: 41.9028, lng: 12.4964, pop: 4300000 },
            { name: 'Milan', country: 'Italy', lat: 45.4642, lng: 9.1900, pop: 3100000 },
            { name: 'Amsterdam', country: 'Netherlands', lat: 52.3676, lng: 4.9041, pop: 1100000 },
            { name: 'Vienna', country: 'Austria', lat: 48.2082, lng: 16.3738, pop: 1900000 },
            { name: 'Munich', country: 'Germany', lat: 48.1351, lng: 11.5820, pop: 1500000 },
            { name: 'Prague', country: 'Czechia', lat: 50.0755, lng: 14.4378, pop: 1300000 },
            { name: 'Budapest', country: 'Hungary', lat: 47.4979, lng: 19.0402, pop: 1800000 },
            { name: 'Lisbon', country: 'Portugal', lat: 38.7223, lng: -9.1393, pop: 2900000 },
            { name: 'Dublin', country: 'Ireland', lat: 53.3498, lng: -6.2603, pop: 1400000 },
            { name: 'Brussels', country: 'Belgium', lat: 50.8503, lng: 4.3517, pop: 1200000 },
            { name: 'Stockholm', country: 'Sweden', lat: 59.3293, lng: 18.0686, pop: 1000000 },
            { name: 'Oslo', country: 'Norway', lat: 59.9139, lng: 10.7522, pop: 1000000 },
            { name: 'Copenhagen', country: 'Denmark', lat: 55.6761, lng: 12.5683, pop: 800000 },
            { name: 'Warsaw', country: 'Poland', lat: 52.2297, lng: 21.0122, pop: 1800000 },
            { name: 'Zurich', country: 'Switzerland', lat: 47.3769, lng: 8.5417, pop: 400000 },
            { name: 'Geneva', country: 'Switzerland', lat: 46.2044, lng: 6.1432, pop: 200000 },
            { name: 'Athens', country: 'Greece', lat: 37.9838, lng: 23.7275, pop: 3200000 },
            { name: 'Istanbul', country: 'Turkey', lat: 41.0082, lng: 28.9784, pop: 15500000 },
            { name: 'Edinburgh', country: 'UK', lat: 55.9533, lng: -3.1883, pop: 500000 },
            { name: 'Florence', country: 'Italy', lat: 43.7696, lng: 11.2558, pop: 380000 },
            { name: 'Venice', country: 'Italy', lat: 45.4408, lng: 12.3155, pop: 260000 },
            { name: 'Nice', country: 'France', lat: 43.7102, lng: 7.2620, pop: 350000 },
            { name: 'Lyon', country: 'France', lat: 45.7640, lng: 4.8357, pop: 500000 },
            { name: 'Marseille', country: 'France', lat: 43.2965, lng: 5.3698, pop: 870000 },
            { name: 'Bordeaux', country: 'France', lat: 44.8378, lng: -0.5792, pop: 260000 },
            { name: 'Seville', country: 'Spain', lat: 37.3891, lng: -5.9845, pop: 700000 },
            { name: 'Valencia', country: 'Spain', lat: 39.4699, lng: -0.3763, pop: 800000 },
            { name: 'Porto', country: 'Portugal', lat: 41.1579, lng: -8.6291, pop: 240000 },
            { name: 'Krakow', country: 'Poland', lat: 50.0647, lng: 19.9450, pop: 780000 },
            { name: 'Split', country: 'Croatia', lat: 43.5081, lng: 16.4402, pop: 180000 },
            { name: 'Dubrovnik', country: 'Croatia', lat: 42.6507, lng: 18.0944, pop: 45000 },
            { name: 'Reykjavik', country: 'Iceland', lat: 64.1466, lng: -21.9426, pop: 130000 },
            // Africa
            { name: 'Cape Town', country: 'South Africa', lat: -33.9249, lng: 18.4241, pop: 4600000 },
            { name: 'Johannesburg', country: 'South Africa', lat: -26.2041, lng: 28.0473, pop: 5600000 },
            { name: 'Marrakech', country: 'Morocco', lat: 31.6295, lng: -7.9811, pop: 930000 },
            { name: 'Casablanca', country: 'Morocco', lat: 33.5731, lng: -7.5898, pop: 3700000 },
            { name: 'Cairo', country: 'Egypt', lat: 30.0444, lng: 31.2357, pop: 21000000 },
            { name: 'Nairobi', country: 'Kenya', lat: -1.2921, lng: 36.8219, pop: 4400000 },
            { name: 'Windhoek', country: 'Namibia', lat: -22.5609, lng: 17.0658, pop: 430000 },
            { name: 'Swakopmund', country: 'Namibia', lat: -22.6784, lng: 14.5266, pop: 45000 },
            { name: 'Sossusvlei', country: 'Namibia', lat: -24.7275, lng: 15.2772, pop: 100 },
            { name: 'Etosha', country: 'Namibia', lat: -18.8556, lng: 16.3294, pop: 100 },
            { name: 'Dar es Salaam', country: 'Tanzania', lat: -6.7924, lng: 39.2083, pop: 6700000 },
            { name: 'Addis Ababa', country: 'Ethiopia', lat: 9.0320, lng: 38.7400, pop: 3400000 },
            { name: 'Dakar', country: 'Senegal', lat: 14.7167, lng: -17.4677, pop: 1100000 },
            { name: 'Lagos', country: 'Nigeria', lat: 6.5244, lng: 3.3792, pop: 15000000 },
            { name: 'Accra', country: 'Ghana', lat: 5.6037, lng: -0.1870, pop: 2500000 },
            // Americas
            { name: 'New York', country: 'USA', lat: 40.7128, lng: -74.0060, pop: 8300000 },
            { name: 'Los Angeles', country: 'USA', lat: 34.0522, lng: -118.2437, pop: 4000000 },
            { name: 'Chicago', country: 'USA', lat: 41.8781, lng: -87.6298, pop: 2700000 },
            { name: 'San Francisco', country: 'USA', lat: 37.7749, lng: -122.4194, pop: 880000 },
            { name: 'Las Vegas', country: 'USA', lat: 36.1699, lng: -115.1398, pop: 640000 },
            { name: 'Miami', country: 'USA', lat: 25.7617, lng: -80.1918, pop: 470000 },
            { name: 'Boston', country: 'USA', lat: 42.3601, lng: -71.0589, pop: 690000 },
            { name: 'Seattle', country: 'USA', lat: 47.6062, lng: -122.3321, pop: 750000 },
            { name: 'Denver', country: 'USA', lat: 39.7392, lng: -104.9903, pop: 730000 },
            { name: 'Austin', country: 'USA', lat: 30.2672, lng: -97.7431, pop: 960000 },
            { name: 'Nashville', country: 'USA', lat: 36.1627, lng: -86.7816, pop: 690000 },
            { name: 'New Orleans', country: 'USA', lat: 29.9511, lng: -90.0715, pop: 390000 },
            { name: 'Santa Fe', country: 'USA', lat: 35.6870, lng: -105.9378, pop: 85000 },
            { name: 'Flagstaff', country: 'USA', lat: 35.1983, lng: -111.6513, pop: 75000 },
            { name: 'Phoenix', country: 'USA', lat: 33.4484, lng: -112.0740, pop: 1600000 },
            { name: 'Albuquerque', country: 'USA', lat: 35.0844, lng: -106.6504, pop: 560000 },
            { name: 'Toronto', country: 'Canada', lat: 43.6532, lng: -79.3832, pop: 2900000 },
            { name: 'Vancouver', country: 'Canada', lat: 49.2827, lng: -123.1207, pop: 680000 },
            { name: 'Montreal', country: 'Canada', lat: 45.5017, lng: -73.5673, pop: 1700000 },
            { name: 'Mexico City', country: 'Mexico', lat: 19.4326, lng: -99.1332, pop: 21000000 },
            { name: 'Cancun', country: 'Mexico', lat: 21.1619, lng: -86.8515, pop: 890000 },
            { name: 'Buenos Aires', country: 'Argentina', lat: -34.6037, lng: -58.3816, pop: 15000000 },
            { name: 'Rio de Janeiro', country: 'Brazil', lat: -22.9068, lng: -43.1729, pop: 6700000 },
            { name: 'São Paulo', country: 'Brazil', lat: -23.5505, lng: -46.6333, pop: 12300000 },
            { name: 'Lima', country: 'Peru', lat: -12.0464, lng: -77.0428, pop: 10700000 },
            { name: 'Cusco', country: 'Peru', lat: -13.5319, lng: -71.9675, pop: 430000 },
            { name: 'Santiago', country: 'Chile', lat: -33.4489, lng: -70.6693, pop: 6200000 },
            { name: 'Bogota', country: 'Colombia', lat: 4.7110, lng: -74.0721, pop: 7400000 },
            { name: 'Cartagena', country: 'Colombia', lat: 10.3910, lng: -75.4794, pop: 1000000 },
            // Asia
            { name: 'Tokyo', country: 'Japan', lat: 35.6762, lng: 139.6503, pop: 14000000 },
            { name: 'Kyoto', country: 'Japan', lat: 35.0116, lng: 135.7681, pop: 1500000 },
            { name: 'Osaka', country: 'Japan', lat: 34.6937, lng: 135.5023, pop: 2700000 },
            { name: 'Seoul', country: 'South Korea', lat: 37.5665, lng: 126.9780, pop: 10000000 },
            { name: 'Bangkok', country: 'Thailand', lat: 13.7563, lng: 100.5018, pop: 10500000 },
            { name: 'Chiang Mai', country: 'Thailand', lat: 18.7883, lng: 98.9853, pop: 130000 },
            { name: 'Singapore', country: 'Singapore', lat: 1.3521, lng: 103.8198, pop: 5700000 },
            { name: 'Hong Kong', country: 'China', lat: 22.3193, lng: 114.1694, pop: 7500000 },
            { name: 'Beijing', country: 'China', lat: 39.9042, lng: 116.4074, pop: 21500000 },
            { name: 'Shanghai', country: 'China', lat: 31.2304, lng: 121.4737, pop: 24900000 },
            { name: 'Hanoi', country: 'Vietnam', lat: 21.0285, lng: 105.8542, pop: 8000000 },
            { name: 'Ho Chi Minh City', country: 'Vietnam', lat: 10.8231, lng: 106.6297, pop: 9000000 },
            { name: 'Bali (Denpasar)', country: 'Indonesia', lat: -8.6705, lng: 115.2126, pop: 900000 },
            { name: 'Jakarta', country: 'Indonesia', lat: -6.2088, lng: 106.8456, pop: 10600000 },
            { name: 'Mumbai', country: 'India', lat: 19.0760, lng: 72.8777, pop: 20700000 },
            { name: 'Delhi', country: 'India', lat: 28.7041, lng: 77.1025, pop: 32000000 },
            { name: 'Jaipur', country: 'India', lat: 26.9124, lng: 75.7873, pop: 3100000 },
            { name: 'Goa', country: 'India', lat: 15.2993, lng: 74.1240, pop: 100000 },
            { name: 'Dubai', country: 'UAE', lat: 25.2048, lng: 55.2708, pop: 3400000 },
            { name: 'Tel Aviv', country: 'Israel', lat: 32.0853, lng: 34.7818, pop: 460000 },
            { name: 'Kathmandu', country: 'Nepal', lat: 27.7172, lng: 85.3240, pop: 1400000 },
            // Oceania
            { name: 'Sydney', country: 'Australia', lat: -33.8688, lng: 151.2093, pop: 5300000 },
            { name: 'Melbourne', country: 'Australia', lat: -37.8136, lng: 144.9631, pop: 5000000 },
            { name: 'Brisbane', country: 'Australia', lat: -27.4698, lng: 153.0251, pop: 2500000 },
            { name: 'Perth', country: 'Australia', lat: -31.9505, lng: 115.8605, pop: 2100000 },
            { name: 'Auckland', country: 'New Zealand', lat: -36.8509, lng: 174.7645, pop: 1700000 },
            { name: 'Queenstown', country: 'New Zealand', lat: -45.0312, lng: 168.6626, pop: 15000 },
            { name: 'Wellington', country: 'New Zealand', lat: -41.2865, lng: 174.7762, pop: 215000 },
            // Ireland (Wild Atlantic Way)
            { name: 'Galway', country: 'Ireland', lat: 53.2707, lng: -9.0568, pop: 80000 },
            { name: 'Cork', country: 'Ireland', lat: 51.8985, lng: -8.4756, pop: 210000 },
            { name: 'Killarney', country: 'Ireland', lat: 52.0598, lng: -9.5044, pop: 14000 },
            { name: 'Dingle', country: 'Ireland', lat: 52.1408, lng: -10.2686, pop: 2000 },
            { name: 'Limerick', country: 'Ireland', lat: 52.6638, lng: -8.6267, pop: 95000 },
            { name: 'Cliffs of Moher', country: 'Ireland', lat: 52.9715, lng: -9.4309, pop: 100 },
            { name: 'Westport', country: 'Ireland', lat: 53.8008, lng: -9.5200, pop: 6000 },
            { name: 'Sligo', country: 'Ireland', lat: 54.2766, lng: -8.4761, pop: 20000 },
            { name: 'Donegal', country: 'Ireland', lat: 54.6539, lng: -8.1099, pop: 2600 },
        ];

        // City search radius in km (for snap-to feature)
        const CITY_SNAP_RADIUS = 50; // Will snap to city within 50km

        // Country center coordinates for zooming
        const countryCoordinates = {
            'France': [46.2276, 2.2137, 6],
            'Germany': [51.1657, 10.4515, 6],
            'Spain': [40.4637, -3.7492, 6],
            'Italy': [41.8719, 12.5674, 6],
            'United Kingdom': [55.3781, -3.4360, 6],
            'Portugal': [39.3999, -8.2245, 7],
            'Norway': [60.4720, 8.4689, 5],
            'Sweden': [60.1282, 18.6435, 5],
            'Iceland': [64.9631, -19.0208, 6],
            'Romania': [45.9432, 24.9668, 7],
            'Greece': [39.0742, 21.8243, 7],
            'Croatia': [45.1000, 15.2000, 7],
            'Austria': [47.5162, 14.5501, 7],
            'Switzerland': [46.8182, 8.2275, 8],
            'Morocco': [31.7917, -7.0926, 6],
            'South Africa': [-30.5595, 22.9375, 5],
            'Namibia': [-22.9576, 18.4904, 6],
            'Tanzania': [-6.3690, 34.8888, 6],
            'Ethiopia': [9.1450, 40.4897, 6],
            'Senegal': [14.4974, -14.4524, 7],
            'Madagascar': [-18.7669, 46.8691, 6],
            'Egypt': [26.8206, 30.8025, 6],
            'Kenya': [-0.0236, 37.9062, 6],
            'India': [20.5937, 78.9629, 5],
            'Vietnam': [14.0583, 108.2772, 6],
            'Thailand': [15.8700, 100.9925, 6],
            'Japan': [36.2048, 138.2529, 6],
            'Pakistan': [30.3753, 69.3451, 6],
            'China': [35.8617, 104.1954, 4],
            'South Korea': [35.9078, 127.7669, 7],
            'Uzbekistan': [41.3775, 64.5853, 6],
            'Australia': [-25.2744, 133.7751, 4],
            'New Zealand': [-40.9006, 174.8860, 6],
            'United States of America': [37.0902, -95.7129, 4],
            'Canada': [56.1304, -106.3468, 4],
            'Mexico': [23.6345, -102.5528, 5],
            'Brazil': [-14.2350, -51.9253, 4],
            'Argentina': [-38.4161, -63.6167, 4],
            'Peru': [-9.1900, -75.0152, 6],
            'Chile': [-35.6751, -71.5430, 4]
        };

        // ==================== ROAD TRIP DETAILED GUIDES ====================
        // Comprehensive data for each road trip: fuel, groceries, best times, community tips
        const roadTripGuides = {
            'route66': {
                fuelStops: [
                    { name: 'Kingman Shell', location: 'Kingman, AZ', distance: '0 mi', tip: 'Start here, full tank' },
                    { name: 'Seligman General', location: 'Seligman, AZ', distance: '72 mi', tip: 'Historic town, last cheap gas' },
                    { name: 'Williams Chevron', location: 'Williams, AZ', distance: '115 mi', tip: 'Gateway to Grand Canyon' },
                    { name: 'Flagstaff Loves', location: 'Flagstaff, AZ', distance: '145 mi', tip: '24hr, truck stop amenities' },
                    { name: 'Winslow Circle K', location: 'Winslow, AZ', distance: '200 mi', tip: 'Standing on the corner!' },
                    { name: 'Holbrook Maverick', location: 'Holbrook, AZ', distance: '235 mi', tip: 'Petrified Forest nearby' }
                ],
                groceryStops: [
                    { name: 'Safeway Kingman', location: 'Kingman, AZ', type: 'Full supermarket', tip: 'Stock up before desert' },
                    { name: 'Bashas\' Flagstaff', location: 'Flagstaff, AZ', type: 'Supermarket', tip: 'Good deli section' },
                    { name: "Walmart Albuquerque", location: 'Albuquerque, NM', type: 'Supercenter', tip: '24hr, best prices' }
                ],
                bestTimeAnalysis: {
                    ideal: ['March', 'April', 'May', 'September', 'October', 'November'],
                    avoid: ['June', 'July', 'August'],
                    reason: 'Summer temperatures in Arizona/New Mexico can exceed 110°F (43°C). Desert sections are dangerous in extreme heat. Spring and fall offer perfect 70-85°F weather.',
                    events: ['Route 66 Festival (Kingman) - May', 'Albuquerque Balloon Fiesta - October']
                },
                communityTips: [
                    { source: 'Reddit r/roadtrip', user: 'DesertWanderer', tip: 'The stretch between Kingman and Seligman is the most scenic - take your time!', upvotes: 245 },
                    { source: 'Reddit r/Route66', user: 'VintageTraveler', tip: 'Angel Delgadillo\'s barbershop in Seligman is a must-stop. He\'s the "Guardian Angel of Route 66"', upvotes: 189 },
                    { source: 'TripAdvisor', user: 'RoadWarrior22', tip: 'Book Wigwam Motel in Holbrook weeks ahead - it fills up fast!', upvotes: 156 },
                    { source: 'Reddit r/vanlife', user: 'NomadLife', tip: 'Free camping at dispersed sites in Coconino National Forest near Flagstaff', upvotes: 134 }
                ],
                warnings: [
                    '⚠️ No cell service for 30+ miles in some desert sections',
                    '⚠️ Carry extra water - minimum 1 gallon per person',
                    '⚠️ Flash floods possible July-September in washes',
                    '⚠️ Wildlife on road at dawn/dusk (deer, elk near Flagstaff)'
                ]
            },
            'iceland-ring': {
                fuelStops: [
                    { name: 'N1 Reykjavik', location: 'Reykjavik', distance: '0 km', tip: 'Fill up completely before leaving!' },
                    { name: 'Olís Borgarnes', location: 'Borgarnes', distance: '74 km', tip: 'Last station before Snæfellsnes' },
                    { name: 'N1 Akureyri', location: 'Akureyri', distance: '388 km', tip: 'Major hub in the North' },
                    { name: 'N1 Egilsstaðir', location: 'Egilsstaðir', distance: '596 km', tip: 'Only station for 150km!' },
                    { name: 'Olís Höfn', location: 'Höfn', distance: '786 km', tip: 'Southeast, near glaciers' },
                    { name: 'N1 Vík', location: 'Vík', distance: '960 km', tip: 'Black sand beach town' }
                ],
                groceryStops: [
                    { name: 'Bónus Reykjavik', location: 'Reykjavik', type: 'Discount', tip: 'Cheapest in Iceland - stock up here!' },
                    { name: 'Krónan Akureyri', location: 'Akureyri', type: 'Supermarket', tip: 'Best selection in North' },
                    { name: 'Samkaup Höfn', location: 'Höfn', type: 'Small market', tip: 'Limited but has essentials' }
                ],
                bestTimeAnalysis: {
                    ideal: ['June', 'July', 'August'],
                    avoid: ['November', 'December', 'January', 'February', 'March'],
                    reason: 'F-roads and highland routes close in winter. Summer offers 24hr daylight (midnight sun), all roads open, and mild temperatures (10-15°C). Winter has only 4-5 hours of daylight and dangerous driving conditions.',
                    events: ['Midnight Sun - June 21', 'Secret Solstice Festival - June', 'Þjóðhátíð Festival - August']
                },
                communityTips: [
                    { source: 'Reddit r/VisitingIceland', user: 'IcelandExpert', tip: 'NEVER drive off-road. Fines are €50,000+ and you destroy fragile ecosystems that take centuries to recover', upvotes: 892 },
                    { source: 'Reddit r/Iceland', user: 'LocalGuide', tip: 'Download offline maps! Cell coverage is spotty in East Fjords and highlands', upvotes: 445 },
                    { source: 'iOverlander', user: 'VanTripper', tip: 'Wild camping is legal but use designated sites when possible - leave no trace', upvotes: 334 },
                    { source: 'Reddit r/roadtrip', user: 'NorthernLights22', tip: 'Book accommodations 3+ months ahead for summer. Everything sells out.', upvotes: 278 }
                ],
                warnings: [
                    '⚠️ Single-lane bridges - yield to first arrival',
                    '⚠️ Sheep on roads everywhere - slow down!',
                    '⚠️ River crossings require 4x4 - never attempt in 2WD',
                    '⚠️ Weather changes in minutes - always check vedur.is'
                ]
            },
            'nc500': {
                fuelStops: [
                    { name: 'Tesco Inverness', location: 'Inverness', distance: '0 mi', tip: 'Cheapest fuel - fill up here!' },
                    { name: 'Morrisons Dingwall', location: 'Dingwall', distance: '14 mi', tip: 'Last supermarket fuel' },
                    { name: 'Highland Fuels Ullapool', location: 'Ullapool', distance: '57 mi', tip: 'Only station for next 50mi' },
                    { name: 'Lochinver Fuel', location: 'Lochinver', distance: '92 mi', tip: 'Small but reliable' },
                    { name: 'Durness Filling Station', location: 'Durness', distance: '140 mi', tip: 'Remote! Fill up!' },
                    { name: 'John o\' Groats Shell', location: 'John o\' Groats', distance: '220 mi', tip: 'Northernmost mainland' }
                ],
                groceryStops: [
                    { name: 'Tesco Inverness', location: 'Inverness', type: 'Superstore', tip: 'Only large supermarket on route' },
                    { name: 'Co-op Ullapool', location: 'Ullapool', type: 'Small market', tip: 'Surprisingly good selection' },
                    { name: 'Spar Thurso', location: 'Thurso', type: 'Convenience', tip: 'Has essentials' }
                ],
                bestTimeAnalysis: {
                    ideal: ['May', 'June', 'July', 'August', 'September'],
                    avoid: ['December', 'January', 'February'],
                    reason: 'Summer offers long days (up to 18hrs daylight in June) and the best chance of dry weather. Single-track roads can be icy and dangerous in winter. Midges (biting insects) worst in July-August.',
                    events: ['Up Helly Aa (Shetland nearby) - January', 'Highland Games - various summer dates']
                },
                communityTips: [
                    { source: 'Reddit r/Scotland', user: 'HighlandRoamer', tip: 'Clockwise direction is easier - most passing places are on your left', upvotes: 567 },
                    { source: 'Reddit r/NC500', user: 'LocalLad', tip: 'Stop at Kylesku Bridge viewpoint - best photo op on the entire route', upvotes: 423 },
                    { source: 'TripAdvisor', user: 'ScotlandLover', tip: 'Book Kylesku Hotel for dinner - their seafood is caught that morning', upvotes: 345 },
                    { source: 'Reddit r/vanlife', user: 'FreeCamper', tip: 'Wild camping is legal in Scotland - "right to roam" - but be respectful', upvotes: 289 }
                ],
                warnings: [
                    '⚠️ Single-track roads with passing places - pull in for oncoming traffic',
                    '⚠️ Midges (biting insects) June-August - bring repellent!',
                    '⚠️ Fuel stations close early (5-6pm) in remote areas',
                    '⚠️ Mobile signal very patchy - download offline maps'
                ]
            },
            'great-ocean': {
                fuelStops: [
                    { name: 'Shell Geelong', location: 'Geelong', distance: '0 km', tip: 'Last major town - fill up' },
                    { name: 'BP Torquay', location: 'Torquay', distance: '21 km', tip: 'Surf coast gateway' },
                    { name: 'United Lorne', location: 'Lorne', distance: '73 km', tip: 'Busy town, may have queues' },
                    { name: 'BP Apollo Bay', location: 'Apollo Bay', distance: '115 km', tip: 'Last before Otways' },
                    { name: 'Port Campbell Fuel', location: 'Port Campbell', distance: '185 km', tip: '12 Apostles nearby' },
                    { name: 'Coles Express Warrnambool', location: 'Warrnambool', distance: '260 km', tip: 'End point, full services' }
                ],
                groceryStops: [
                    { name: 'Coles Geelong', location: 'Geelong', type: 'Supermarket', tip: 'Stock up - last big store' },
                    { name: 'IGA Lorne', location: 'Lorne', type: 'Small market', tip: 'Tourist prices but has basics' },
                    { name: 'Apollo Bay Foodworks', location: 'Apollo Bay', type: 'Small market', tip: 'Good fresh produce' }
                ],
                bestTimeAnalysis: {
                    ideal: ['November', 'December', 'January', 'February', 'March'],
                    avoid: ['June', 'July', 'August'],
                    reason: 'Australian summer (Dec-Feb) offers warm weather and long days. Winter is cold, wet, and grey. Spring (Sep-Nov) can be beautiful with wildflowers. Whale watching best June-September off Warrnambool.',
                    events: ['Falls Festival (Lorne) - December/January', 'Whale Season - June-September']
                },
                communityTips: [
                    { source: 'Reddit r/australia', user: 'MelbourneLocal', tip: 'Go at sunrise for 12 Apostles - no crowds and best light for photos', upvotes: 678 },
                    { source: 'Reddit r/roadtrip', user: 'AussieRoads', tip: 'Teddy\'s Lookout near Lorne is the best viewpoint most tourists miss', upvotes: 445 },
                    { source: 'TripAdvisor', user: 'CoastalDrives', tip: 'Walk down Gibson Steps to the beach at 12 Apostles for a different perspective', upvotes: 389 },
                    { source: 'Reddit r/vanlife', user: 'FreedomWheels', tip: 'Johanna Beach has free camping but gets windy - great surf though!', upvotes: 234 }
                ],
                warnings: [
                    '⚠️ Koalas on road especially at dusk - drive carefully',
                    '⚠️ Cliffs are unstable at 12 Apostles - stay behind barriers',
                    '⚠️ Rip currents at beaches - swim between flags only',
                    '⚠️ Summer bushfire risk - check CFA warnings'
                ]
            },
            'amalfi': {
                fuelStops: [
                    { name: 'Esso Naples', location: 'Naples', distance: '0 km', tip: 'Fill up before the coast road' },
                    { name: 'IP Sorrento', location: 'Sorrento', distance: '50 km', tip: 'Last easy access before Amalfi' },
                    { name: 'Agip Positano', location: 'Positano area', distance: '65 km', tip: 'Small, often busy' },
                    { name: 'Q8 Amalfi', location: 'Amalfi', distance: '85 km', tip: 'Town center, limited parking' },
                    { name: 'Esso Salerno', location: 'Salerno', distance: '110 km', tip: 'End point, full services' }
                ],
                groceryStops: [
                    { name: 'Conad Naples', location: 'Naples', type: 'Supermarket', tip: 'Best selection and prices' },
                    { name: 'Sorrento Market', location: 'Sorrento', type: 'Small market', tip: 'Higher prices but fresh limoncello!' },
                    { name: 'Mini-market Amalfi', location: 'Amalfi', type: 'Convenience', tip: 'Very expensive - buy elsewhere' }
                ],
                bestTimeAnalysis: {
                    ideal: ['April', 'May', 'June', 'September', 'October'],
                    avoid: ['July', 'August'],
                    reason: 'Summer is extremely crowded and hot (35°C+). Traffic jams can last hours. Spring and fall offer pleasant weather (20-25°C), fewer crowds, and better prices. Shoulder season is the sweet spot.',
                    events: ['Ravello Festival - July-August', 'Regatta of the Maritime Republics - June']
                },
                communityTips: [
                    { source: 'Reddit r/Italy', user: 'ItalianRoads', tip: 'Drive EARLY morning (before 8am) or evening to avoid buses and traffic', upvotes: 734 },
                    { source: 'Reddit r/travel', user: 'EuroTripper', tip: 'Rent the SMALLEST car possible - roads are incredibly narrow', upvotes: 612 },
                    { source: 'TripAdvisor', user: 'AmalfiExpert', tip: 'Park in Amalfi and take SITA buses to other towns - much less stressful', upvotes: 534 },
                    { source: 'Reddit r/roadtrip', user: 'CoastalDreamer', tip: 'Villa Rufolo gardens in Ravello at sunset is the most magical spot on the coast', upvotes: 423 }
                ],
                warnings: [
                    '⚠️ Roads extremely narrow - large vehicles prohibited',
                    '⚠️ Buses have priority - pull over when you see them',
                    '⚠️ Parking scarce and expensive - book accommodations with parking',
                    '⚠️ ZTL zones (limited traffic zones) - check before entering towns'
                ]
            }
        };

        // ==================== ICONIC ROAD TRIPS DATABASE ====================
        const roadTrips = [
            {
                id: 'namibia_highlights',
                name: 'Namibia Highlights',
                icon: '🇳🇦',
                country: 'Namibia',
                distance: '3500 km',
                duration: '12-16 days',
                coordinates: [[-22.5609, 17.0658], [-24.7275, 15.7390]],
                waypoints: [
                    [-22.5609, 17.0658, 'Windhoek'],
                    [-22.6792, 14.5272, 'Swakopmund'],
                    [-23.1061, 14.4361, 'Walvis Bay'],
                    [-24.7275, 15.7390, 'Sossusvlei'],
                    [-24.4628, 15.9446, 'Sesriem Canyon'],
                    [-23.3425, 15.9369, 'Solitaire'],
                    [-19.1738, 15.9494, 'Twyfelfontein'],
                    [-19.5833, 13.1000, 'Skeleton Coast'],
                    [-19.0154, 15.9150, 'Palmwag'],
                    [-18.8558, 16.1568, 'Etosha (Okaukuejo)'],
                    [-18.7878, 16.9306, 'Etosha (Halali)'],
                    [-18.8111, 17.0667, 'Etosha (Namutoni)'],
                    [-22.5609, 17.0658, 'Windhoek']
                ],
                tags: ['fourx4', 'adventure', 'camping', 'wildlife'],
                description: 'L\'aventure ultime en Namibie: dunes rouges de Sossusvlei, côte des squelettes, faune d\'Etosha.',
                tips: 'Location 4x4 avec tente de toit obligatoire. Réserver les campings NWR à l\'avance!',
                personalTrip: true,
                tripDate: 'Il y a 3 mois',
                rating: 4.9,
                difficulty: 'moderate',
                bestSeason: 'May-October (dry season, best wildlife)',
                budget: '€2500-4000',
                mustKnow: [
                    '🚙 4x4 with rooftop tent is THE way to do Namibia',
                    '⛽ Fill up at EVERY station - distances are huge',
                    '🏜️ Sossusvlei gate opens 1hr before sunrise for NWR guests only',
                    '📱 No cell service in most areas - download offline maps',
                    '💧 Carry 20+ liters of water at all times',
                    '🦏 Etosha waterholes at night = guaranteed rhino sightings',
                    '🛣️ Gravel roads are excellent but require reduced speed',
                    '🌡️ Temperature swings are extreme - freezing nights, hot days'
                ],
                reviews: [
                    { user: 'SafariSol', rating: 5, text: 'Mon road trip! Sossusvlei au lever du soleil = moment inoubliable. La tente de toit sous les étoiles d\'Etosha, magique!', date: '3 months ago', isOwner: true },
                    { user: 'OverlandAfrica', rating: 5, text: 'Did this route exactly. Palmwag for desert elephants was the highlight!', date: '1 month ago' },
                    { user: 'CoupleOnTheRoad', rating: 5, text: 'Best self-drive safari in Africa. NWR camps are basic but the locations are unbeatable.', date: '2 months ago' }
                ],
                highlights: ['Dune 45 sunrise', 'Deadvlei', 'Etosha waterholes', 'Skeleton Coast', 'Desert elephants'],
                costs: {
                    fuel: '€300-400',
                    tolls: '€0 (no tolls!)',
                    accommodation: '€600-1000',
                    food: '€300-500',
                    total: '€2,500-4,000 (incl. 4x4 rental)'
                },
                planningSteps: [
                    { title: 'Book 4x4 with Rooftop Tent', desc: 'Essential! Book 3-6 months ahead with ASCO, Britz or Namibia2Go. Toyota Hilux recommended.' },
                    { title: 'Reserve NWR Camps', desc: 'Sesriem and Etosha camps book out fast. NWR website: nwr.com.na - book 2-3 months ahead!' },
                    { title: 'Plan Your Route', desc: 'Clockwise or counter-clockwise both work. Allow 2+ nights at Etosha for wildlife.' },
                    { title: 'Get Travel Insurance', desc: 'Medical evacuation coverage essential. Nearest hospital can be 500km away.' },
                    { title: 'Download Tracks4Africa', desc: 'Best offline GPS app for Namibia. Includes campsites, fuel stations, distances.' }
                ],
                recommendations: [
                    { icon: '🌅', title: 'Dune 45 at Sunrise', desc: 'Arrive 5:30am. Climb for best photos. Magical!' },
                    { icon: '🦏', title: 'Okaukuejo Night Waterhole', desc: 'Rhinos visit 10pm-2am. Bring chair & patience!' },
                    { icon: '🍰', title: 'Solitaire Apfelstrudel', desc: 'Best apple cake in Africa. Seriously!' },
                    { icon: '🐘', title: 'Palmwag Desert Elephants', desc: 'Morning game drive - desert-adapted elephants unique here' },
                    { icon: '💀', title: 'Skeleton Coast', desc: 'Shipwrecks, seal colonies, eerie beauty' },
                    { icon: '⭐', title: 'Stargazing at Sesriem', desc: 'Some of the darkest skies on Earth. Unforgettable!' }
                ],
                packingList: [
                    { item: '💧 20L water reserve', essential: true },
                    { item: '⛽ Know fuel distances', essential: true },
                    { item: '🔦 Headlamp (camp nights)', essential: true },
                    { item: '🧴 SPF50 sunscreen', essential: true },
                    { item: '🧥 Warm fleece (cold nights)', essential: true },
                    { item: '📷 Camera + zoom lens', essential: false },
                    { item: '🔌 Car charger', essential: true },
                    { item: '🗺️ Tracks4Africa app', essential: true },
                    { item: '🩹 First aid kit', essential: true },
                    { item: '🕶️ Polarized sunglasses', essential: true },
                    { item: '👒 Sun hat', essential: false },
                    { item: '🔧 Basic tools', essential: false }
                ],
                rentalProviders: [
                    { name: 'ASCO Car Hire', url: 'https://ascocarhire.com', rating: '⭐⭐⭐⭐⭐', note: 'Excellent, véhicules bien entretenus' },
                    { name: 'Namibia2Go', url: 'https://namibia2go.com', rating: '⭐⭐⭐⭐', note: 'Bon rapport qualité/prix' },
                    { name: 'Britz Namibia', url: 'https://britz.co.za', rating: '⭐⭐⭐⭐', note: 'Grande flotte, pro' },
                    { name: 'Camping Car Hire', url: 'https://campingcarhire.com', rating: '⭐⭐⭐⭐⭐', note: 'Spécialiste camping' },
                    { name: 'Safari Car Rental', url: 'https://safaricarrental.com', rating: '⭐⭐⭐⭐', note: 'Service client top' }
                ],
                campingSites: [
                    { name: 'Urban Camp Windhoek', location: 'Windhoek', type: 'Privé', price: '~250 NAD', facilities: 'Piscine, bar, wifi', coords: [-22.5700, 17.0800] },
                    { name: 'Alte Brücke', location: 'Swakopmund', type: 'Privé', price: '~300 NAD', facilities: 'Près centre-ville, propre', coords: [-22.6850, 14.5350] },
                    { name: 'Sesriem Campsite (NWR)', location: 'Sossusvlei', type: 'NWR', price: '~350 NAD', facilities: 'Accès dunes au lever du soleil!', coords: [-24.4800, 15.8300] },
                    { name: 'Sossus Oasis', location: 'Sesriem', type: 'Privé', price: '~400 NAD', facilities: 'Piscine, restaurant', coords: [-24.4700, 15.8200] },
                    { name: 'Solitaire Guest Farm', location: 'Solitaire', type: 'Privé', price: '~350 NAD', facilities: 'Apfelstrudel légendaire!', coords: [-23.8900, 16.0100] },
                    { name: 'Palmwag Lodge Camp', location: 'Palmwag', type: 'Privé', price: '~400 NAD', facilities: 'Rhinos, éléphants', coords: [-19.8800, 13.9500] },
                    { name: 'Okaukuejo (NWR)', location: 'Etosha', type: 'NWR', price: '~450 NAD', facilities: 'Waterhole illuminé la nuit!', coords: [-18.9000, 15.9200] },
                    { name: 'Halali (NWR)', location: 'Etosha', type: 'NWR', price: '~400 NAD', facilities: 'Central, waterhole', coords: [-18.7600, 16.5000] },
                    { name: 'Namutoni (NWR)', location: 'Etosha', type: 'NWR', price: '~450 NAD', facilities: 'Fort historique, waterhole', coords: [-18.8100, 16.9300] }
                ],
                variants: [
                    { id: 'nam-express-5', label: '5-Day Express', durationDays: 5, tag: 'short', communityScore: 42, description: 'Windhoek → Sossusvlei → Swakopmund → Windhoek. Best-of highlights sprint.', waypoints: [[-22.5609,17.0658,'Windhoek'],[-24.7275,15.7390,'Sossusvlei'],[-22.6792,14.5272,'Swakopmund'],[-22.5609,17.0658,'Windhoek']], recommendations: ['Dune 45 sunrise','Deadvlei','Swakopmund adventure sports'] },
                    { id: 'nam-classic-10', label: '10-Day Classic', durationDays: 10, tag: 'medium', communityScore: 87, description: 'The sweet spot. Sossusvlei + Skeleton Coast + Etosha with comfortable pace.', waypoints: [[-22.5609,17.0658,'Windhoek'],[-24.7275,15.7390,'Sossusvlei'],[-22.6792,14.5272,'Swakopmund'],[-19.5833,13.1000,'Skeleton Coast'],[-19.0154,15.9150,'Palmwag'],[-18.8558,16.1568,'Etosha'],[-22.5609,17.0658,'Windhoek']], recommendations: ['Dune 45 sunrise','Skeleton Coast seals','Etosha night waterhole','Palmwag elephants'] },
                    { id: 'nam-deep-16', label: '16-Day Deep Dive', durationDays: 16, tag: 'long', communityScore: 63, description: 'Full circuit including Caprivi Strip, Fish River Canyon, and Damaraland rock art.', waypoints: [[-22.5609,17.0658,'Windhoek'],[-24.7275,15.7390,'Sossusvlei'],[-22.6792,14.5272,'Swakopmund'],[-19.5833,13.1000,'Skeleton Coast'],[-19.1738,15.9494,'Twyfelfontein'],[-19.0154,15.9150,'Palmwag'],[-18.8558,16.1568,'Etosha (Okaukuejo)'],[-18.7878,16.9306,'Etosha (Halali)'],[-18.8111,17.0667,'Etosha (Namutoni)'],[-22.5609,17.0658,'Windhoek']], recommendations: ['Dune 45 sunrise','Deadvlei','Skeleton Coast','Etosha night waterhole','Desert elephants','Twyfelfontein rock engravings'] }
                ]
            },
            {
                id: 'route66',
                name: 'Route 66',
                icon: '🇺🇸',
                country: 'USA',
                distance: '3940 km',
                duration: '2-3 weeks',
                coordinates: [[34.0522, -118.2437], [41.8781, -87.6298]],
                waypoints: [
                    [34.0522, -118.2437, 'Los Angeles', 'Start at Santa Monica Pier'],
                    [34.1425, -118.2551, 'Pasadena', 'Route 66 Mother Road Museum'],
                    [35.1983, -114.0533, 'Kingman', 'Historic downtown, great diners'],
                    [35.2226, -101.8313, 'Amarillo', 'Cadillac Ranch art installation'],
                    [35.0844, -106.6504, 'Albuquerque', 'Old Town, Breaking Bad locations'],
                    [35.6870, -105.9378, 'Santa Fe', 'Art galleries, adobe architecture'],
                    [37.2753, -107.8801, 'Durango', 'Steam train, mountain scenery'],
                    [39.7392, -104.9903, 'Denver', 'Mile High City'],
                    [38.6270, -90.1994, 'St. Louis', 'Gateway Arch'],
                    [41.8781, -87.6298, 'Chicago', 'End at Grant Park']
                ],
                tags: ['scenic', 'adventure', 'historic'],
                description: 'The quintessential American road trip from Chicago to LA through the heart of America.',
                tips: 'Best in spring or fall. Many original motels and diners still open.',
                rating: 4.8,
                difficulty: 'easy',
                bestSeason: 'Spring (Apr-May) or Fall (Sep-Oct)',
                budget: '$2000-4000',
                mustKnow: [
                    '⛽ Gas stations can be 100+ miles apart in desert sections',
                    '🏨 Book iconic motels like Wigwam Motel in advance',
                    '📱 Download offline maps - cell service spotty in rural areas',
                    '🚗 Any car works but classic American muscle adds to the vibe',
                    '📸 Cadillac Ranch is free and open 24/7 - bring spray paint!',
                    '🍔 Must-try: Big Texan Steak Ranch in Amarillo (free 72oz steak challenge)'
                ],
                reviews: [
                    { user: 'RoadTripKing', rating: 5, text: 'Did this in a vintage Mustang. Best 2 weeks of my life!', date: '2 months ago' },
                    { user: 'WanderlustMom', rating: 5, text: 'Perfect family trip. Kids loved Cadillac Ranch and the quirky roadside attractions.', date: '3 months ago' },
                    { user: 'SoloTraveler22', rating: 4, text: 'Amazing but some sections are quite desolate. Make sure your car is reliable!', date: '5 months ago' }
                ],
                highlights: ['Cadillac Ranch', 'Grand Canyon detour', 'Santa Fe art scene', 'Gateway Arch', 'Petrified Forest'],
                costs: {
                    fuel: '$350-500',
                    tolls: '$0 (toll-free!)',
                    accommodation: '$800-1500',
                    food: '$400-700',
                    total: '$1,550-2,700'
                },
                planningSteps: [
                    { title: 'Book Your Car', desc: 'Rent from Chicago or LA. Consider a one-way rental. Classic car rentals available for the ultimate experience!' },
                    { title: 'Plan Your Route', desc: 'The original Route 66 is now fragmented. Download Route 66 Navigation app for authentic routing.' },
                    { title: 'Book Key Accommodations', desc: 'Reserve iconic spots like Wigwam Motel, Blue Swallow Motel 2-3 months ahead in peak season.' },
                    { title: 'Budget for Attractions', desc: 'Grand Canyon detour ($35/vehicle), Petrified Forest ($25), plus countless free roadside attractions.' },
                    { title: 'Check Your Vehicle', desc: 'Full service before departure. Carry spare tire, jumper cables, extra water for desert sections.' }
                ],
                recommendations: [
                    { icon: '🏨', title: 'Wigwam Motel', desc: 'Sleep in a concrete teepee - iconic Route 66!' },
                    { icon: '🍔', title: 'Big Texan Steak Ranch', desc: 'Free 72oz steak if eaten in 1 hour!' },
                    { icon: '🎨', title: 'Cadillac Ranch', desc: 'Bring spray paint and leave your mark' },
                    { icon: '🏜️', title: 'Grand Canyon', desc: '1-hour detour - absolutely worth it!' },
                    { icon: '📸', title: 'Blue Whale of Catoosa', desc: 'Quirky Oklahoma landmark, great photos' },
                    { icon: '🌮', title: 'Santa Fe Plaza', desc: 'Best New Mexican food on the route' }
                ],
                packingList: [
                    { item: '📱 Offline maps', essential: true },
                    { item: '💧 2L water per person', essential: true },
                    { item: '🧴 Sunscreen SPF50+', essential: true },
                    { item: '🕶️ Sunglasses', essential: true },
                    { item: '🎒 Cooler for drinks', essential: false },
                    { item: '📷 Camera', essential: false },
                    { item: '🔌 Car phone charger', essential: true },
                    { item: '🧥 Light jacket (desert nights)', essential: false },
                    { item: '🎧 Road trip playlist', essential: false }
                ]
            },
            {
                id: 'panamerican',
                name: 'Pan-American Highway',
                icon: '🌎',
                country: 'Multi',
                distance: '30000 km',
                duration: '6-12 months',
                coordinates: [[-54.8019, -68.3030], [64.8378, -147.7164]],
                waypoints: [
                    [-54.8019, -68.3030, 'Ushuaia'],
                    [-33.4489, -70.6693, 'Santiago'],
                    [-12.0464, -77.0428, 'Lima'],
                    [19.4326, -99.1332, 'Mexico City'],
                    [64.8378, -147.7164, 'Fairbanks']
                ],
                tags: ['adventure', 'epic'],
                description: 'The ultimate road trip spanning the Americas from Argentina to Alaska.',
                tips: 'Darien Gap requires shipping vehicle. Plan border crossings carefully.'
            },
            {
                id: 'wildatlantic',
                name: 'Wild Atlantic Way',
                icon: '🇮🇪',
                country: 'Ireland',
                distance: '2500 km',
                duration: '10-14 days',
                coordinates: [[51.8985, -8.4756], [55.2408, -7.3074]],
                waypoints: [
                    [51.8985, -8.4756, 'Cork', 'Start point, English Market'],
                    [51.9001, -8.4731, 'Kinsale', 'Foodie paradise, colorful harbor'],
                    [51.7044, -9.7686, 'Mizen Head', 'Ireland\'s most southwesterly point'],
                    [51.9419, -10.2418, 'Skellig Ring', 'Star Wars filming location'],
                    [52.2593, -9.7066, 'Dingle', 'Traditional pubs, dolphins'],
                    [52.9715, -9.4309, 'Cliffs of Moher', 'Iconic 200m sea cliffs'],
                    [53.2707, -9.0568, 'Galway', 'Vibrant city, live music every night'],
                    [53.5239, -10.0600, 'Connemara', 'Wild mountains, lakes, sheep'],
                    [53.8075, -9.6316, 'Westport', 'Charming Georgian town'],
                    [54.2766, -8.4761, 'Sligo', 'Yeats country, surfing'],
                    [55.2408, -7.3074, 'Malin Head', 'Ireland\'s most northerly point']
                ],
                tags: ['scenic', 'toll-free', 'camping'],
                description: 'Stunning 2,500km coastal route along Ireland\'s rugged Atlantic coast - the world\'s longest defined coastal touring route.',
                tips: 'Wild camping legal. Weather unpredictable - pack layers!',
                rating: 4.9,
                difficulty: 'easy',
                bestSeason: 'May-September (longest days, mildest weather)',
                budget: '€1500-3000',
                mustKnow: [
                    '🌧️ Rain is guaranteed - waterproof everything!',
                    '🚗 Narrow roads require confidence - locals drive fast',
                    '🍺 Pubs are the social hub - strike up conversations!',
                    '⛺ Wild camping allowed but ask landowners if near homes',
                    '🐑 Sheep on roads are common - drive carefully',
                    '📸 Golden hour is magical - days are very long in summer'
                ],
                reviews: [
                    { user: 'IrishExplorer', rating: 5, text: 'As an Irish person, this still blew me away. Cliffs of Moher at sunset is unreal.', date: '1 month ago' },
                    { user: 'CamperVanDave', rating: 5, text: 'Did this in a campervan. So many amazing free camping spots!', date: '2 months ago' },
                    { user: 'PhotoNomad', rating: 5, text: 'Best photography road trip I\'ve ever done. Light is incredible.', date: '4 months ago' }
                ],
                highlights: ['Cliffs of Moher', 'Skellig Michael', 'Connemara', 'Dingle Peninsula', 'Galway nightlife'],
                costs: {
                    fuel: '€200-300',
                    tolls: '€0 (toll-free!)',
                    accommodation: '€600-1200',
                    food: '€300-500',
                    total: '€1,100-2,000'
                },
                planningSteps: [
                    { title: 'Fly into Shannon or Cork', desc: 'These airports offer the best access to the WAW. Dublin adds 3+ hours driving.' },
                    { title: 'Rent the Right Vehicle', desc: 'Compact car recommended. Roads are narrow! Manual transmission cheaper.' },
                    { title: 'Book B&Bs Early', desc: 'Irish B&Bs are the best experience. Book 1-2 months ahead for summer.' },
                    { title: 'Get a Rain Jacket', desc: 'It WILL rain. Good waterproof gear essential. Layers for changeable weather.' },
                    { title: 'Download the WAW App', desc: 'Official app has all discovery points, audio guides, and offline maps.' }
                ],
                recommendations: [
                    { icon: '🌊', title: 'Cliffs of Moher at Sunset', desc: 'Arrive 2hrs before sunset, stay until dark' },
                    { icon: '🍺', title: 'Tigh Neachtain, Galway', desc: 'Best traditional pub atmosphere in Ireland' },
                    { icon: '🏝️', title: 'Skellig Michael', desc: 'Book boat trip 3+ months ahead - Star Wars fame!' },
                    { icon: '🐬', title: 'Fungie the Dolphin', desc: 'Dingle\'s famous dolphin - boat trips daily' },
                    { icon: '🎵', title: 'Galway Pubs', desc: 'Live trad music every night - free!' },
                    { icon: '🥾', title: 'Connemara National Park', desc: 'Free entry, Diamond Hill hike is unmissable' }
                ],
                packingList: [
                    { item: '🧥 Waterproof jacket', essential: true },
                    { item: '👟 Hiking boots', essential: true },
                    { item: '🧣 Warm layers', essential: true },
                    { item: '☔ Umbrella (compact)', essential: false },
                    { item: '📷 Camera (the light!)', essential: false },
                    { item: '🔌 EU adapter', essential: true },
                    { item: '💳 Cash for pubs', essential: true },
                    { item: '🗺️ Offline maps', essential: true },
                    { item: '🎧 Irish music playlist', essential: false }
                ]
            },
            {
                id: 'nc500',
                name: 'North Coast 500',
                icon: '🏴󠁧󠁢󠁳󠁣󠁴󠁿',
                country: 'Scotland',
                distance: '830 km',
                duration: '5-7 days',
                coordinates: [[57.4778, -4.2247], [58.6373, -3.0689]],
                waypoints: [
                    [57.4778, -4.2247, 'Inverness'],
                    [57.8690, -5.0960, 'Applecross'],
                    [58.4374, -4.9943, 'Durness'],
                    [58.4397, -3.0943, 'John o\' Groats'],
                    [57.4778, -4.2247, 'Inverness']
                ],
                tags: ['scenic', 'toll-free', 'camping'],
                description: 'Scotland\'s answer to Route 66. Breathtaking Highland scenery.',
                tips: 'Single track roads require patience. Book accommodation in summer.'
            },
            {
                id: 'greatocean',
                name: 'Great Ocean Road',
                icon: '🇦🇺',
                country: 'Australia',
                distance: '243 km',
                duration: '2-3 days',
                coordinates: [[-38.1499, 144.3617], [-38.6805, 143.1051]],
                waypoints: [
                    [-38.1499, 144.3617, 'Torquay'],
                    [-38.4089, 144.0033, 'Lorne'],
                    [-38.6639, 143.1044, '12 Apostles'],
                    [-38.7833, 143.0833, 'Port Campbell']
                ],
                tags: ['scenic', 'toll-free'],
                description: 'One of the world\'s most scenic coastal drives.',
                tips: 'Best light for 12 Apostles at sunrise/sunset. Watch for koalas!'
            },
            {
                id: 'transfagarasan',
                name: 'Transfăgărășan',
                icon: '🇷🇴',
                country: 'Romania',
                distance: '151 km',
                duration: '1-2 days',
                coordinates: [[45.5989, 24.6224], [45.3523, 24.6189]],
                waypoints: [
                    [45.5989, 24.6224, 'Curtea de Argeș'],
                    [45.6042, 24.6150, 'Balea Lake'],
                    [45.3523, 24.6189, 'Sibiu']
                ],
                tags: ['scenic', 'adventure', 'toll-free'],
                description: 'Called "the best road in the world" by Top Gear.',
                tips: 'Only open June-October. Arrive early to avoid crowds.'
            },
            // ==================== MORE EUROPE ROAD TRIPS ====================
            {
                id: 'amalfi_coast',
                name: 'Amalfi Coast',
                icon: '🇮🇹',
                country: 'Italy',
                distance: '50 km',
                duration: '2-3 days',
                coordinates: [[40.6333, 14.6029], [40.8518, 14.2681]],
                waypoints: [
                    [40.6333, 14.6029, 'Salerno'],
                    [40.6340, 14.6027, 'Vietri sul Mare'],
                    [40.6492, 14.4844, 'Amalfi'],
                    [40.6262, 14.3749, 'Positano'],
                    [40.7262, 14.4867, 'Ravello'],
                    [40.8518, 14.2681, 'Sorrento']
                ],
                tags: ['scenic', 'historic'],
                description: 'Italy\'s most glamorous coastal drive - cliffside villages and Mediterranean views.',
                tips: 'Drive early morning or late afternoon. Very narrow roads, honk at curves!'
            },
            {
                id: 'trollstigen',
                name: 'Norwegian Fjords & Trollstigen',
                icon: '🇳🇴',
                country: 'Norway',
                distance: '1500 km',
                duration: '7-10 days',
                coordinates: [[60.3913, 5.3221], [69.6489, 18.9551]],
                waypoints: [
                    [60.3913, 5.3221, 'Bergen'],
                    [61.9047, 6.7091, 'Geirangerfjord'],
                    [62.4574, 7.6817, 'Trollstigen'],
                    [62.4722, 6.1549, 'Ålesund'],
                    [63.4305, 10.3951, 'Trondheim'],
                    [68.4385, 17.4278, 'Lofoten Islands'],
                    [69.6489, 18.9551, 'Tromsø']
                ],
                tags: ['scenic', 'adventure', 'camping'],
                description: 'Dramatic fjords, serpentine mountain roads, and the midnight sun.',
                tips: 'Expensive! Wild camping legal (Allemannsretten). Best June-August.'
            },
            {
                id: 'romantic_road',
                name: 'Romantic Road',
                icon: '🇩🇪',
                country: 'Germany',
                distance: '460 km',
                duration: '3-5 days',
                coordinates: [[49.8988, 10.9028], [47.5576, 10.7498]],
                waypoints: [
                    [49.8988, 10.9028, 'Würzburg'],
                    [49.3795, 10.1807, 'Rothenburg ob der Tauber'],
                    [48.9260, 10.6996, 'Nördlingen'],
                    [48.3705, 10.8978, 'Augsburg'],
                    [47.5576, 10.7498, 'Neuschwanstein Castle'],
                    [47.5667, 10.6833, 'Füssen']
                ],
                tags: ['scenic', 'historic', 'toll-free'],
                description: 'Medieval towns, castles, and the fairytale Neuschwanstein.',
                tips: 'Christmas markets amazing in December. Book Neuschwanstein tickets online!'
            },
            {
                id: 'grossglockner',
                name: 'Grossglockner High Alpine Road',
                icon: '🇦🇹',
                country: 'Austria',
                distance: '48 km',
                duration: '1 day',
                coordinates: [[47.0744, 12.8428], [47.1167, 12.8500]],
                waypoints: [
                    [47.0744, 12.8428, 'Bruck an der Großglocknerstraße'],
                    [47.0833, 12.8167, 'Fuscher Törl'],
                    [47.0742, 12.7514, 'Kaiser-Franz-Josefs-Höhe'],
                    [47.1167, 12.8500, 'Heiligenblut']
                ],
                tags: ['scenic', 'adventure'],
                description: 'Austria\'s highest paved road with 36 hairpin turns and glacier views.',
                tips: 'Toll road (~40€). Open May-October. Stop at Edelweissspitze viewpoint!'
            },
            {
                id: 'stelvio_pass',
                name: 'Stelvio Pass',
                icon: '🇮🇹',
                country: 'Italy',
                distance: '25 km',
                duration: '1 day',
                coordinates: [[46.5290, 10.4534], [46.5285, 10.5353]],
                waypoints: [
                    [46.5290, 10.4534, 'Prato allo Stelvio'],
                    [46.5285, 10.5353, 'Stelvio Pass Summit (2757m)'],
                    [46.5404, 10.5902, 'Bormio']
                ],
                tags: ['scenic', 'adventure', 'toll-free'],
                description: '48 hairpin bends - the most challenging alpine pass in the Alps.',
                tips: 'Open June-September. Early morning = no traffic. Great for motorcycles!'
            },
            {
                id: 'costa_brava',
                name: 'Costa Brava Coastal',
                icon: '🇪🇸',
                country: 'Spain',
                distance: '200 km',
                duration: '3-4 days',
                coordinates: [[41.3851, 2.1734], [42.3154, 3.1836]],
                waypoints: [
                    [41.3851, 2.1734, 'Barcelona'],
                    [41.6986, 2.8453, 'Tossa de Mar'],
                    [41.9688, 3.2147, 'Cadaqués'],
                    [42.1209, 3.1212, 'Dalí Museum Figueres'],
                    [42.3154, 3.1836, 'Portbou (France border)']
                ],
                tags: ['scenic', 'toll-free', 'camping'],
                description: 'Rugged Catalan coastline, hidden coves, and Dalí country.',
                tips: 'Wild camping tolerated on beaches. Avoid August crowds!'
            },
            {
                id: 'balkan_adventure',
                name: 'Balkan Adventure',
                icon: '🇭🇷',
                country: 'Multi-country',
                distance: '2000 km',
                duration: '10-14 days',
                coordinates: [[45.8150, 15.9819], [42.6507, 18.0944]],
                waypoints: [
                    [45.8150, 15.9819, 'Zagreb'],
                    [44.8176, 15.8714, 'Plitvice Lakes'],
                    [43.5081, 16.4402, 'Split'],
                    [42.6507, 18.0944, 'Dubrovnik'],
                    [42.4411, 19.2636, 'Kotor (Montenegro)'],
                    [41.3275, 19.8187, 'Tirana (Albania)']
                ],
                tags: ['scenic', 'adventure', 'toll-free'],
                description: 'Croatia, Montenegro, Albania - stunning coastline and affordable adventure.',
                tips: 'Very affordable! Green Card insurance for Albania. Incredible value.'
            },
            {
                id: 'portugal_atlantic',
                name: 'Portugal Atlantic Coast',
                icon: '🇵🇹',
                country: 'Portugal',
                distance: '850 km',
                duration: '7-10 days',
                coordinates: [[41.1579, -8.6291], [37.0179, -7.9308]],
                waypoints: [
                    [41.1579, -8.6291, 'Porto'],
                    [40.2033, -8.4103, 'Coimbra'],
                    [39.5000, -8.8833, 'Nazaré (Big Waves!)'],
                    [38.7223, -9.1393, 'Lisbon'],
                    [38.6916, -9.4163, 'Sintra'],
                    [37.0941, -8.2478, 'Lagos'],
                    [37.0179, -7.9308, 'Sagres (End of Europe)']
                ],
                tags: ['scenic', 'camping', 'toll-free'],
                description: 'From Porto to the dramatic cliffs of Sagres - surf, wine, and history.',
                tips: 'Tolls avoidable on N-roads. Best surf spots: Nazaré, Ericeira, Peniche.'
            },
            {
                id: 'swiss_alpine',
                name: 'Swiss Grand Tour',
                icon: '🇨🇭',
                country: 'Switzerland',
                distance: '1600 km',
                duration: '7-10 days',
                coordinates: [[46.9480, 7.4474], [46.2044, 6.1432]],
                waypoints: [
                    [46.9480, 7.4474, 'Bern'],
                    [46.6863, 7.8632, 'Interlaken'],
                    [46.0207, 7.7491, 'Zermatt (Matterhorn)'],
                    [46.2044, 6.1432, 'Geneva'],
                    [46.8182, 8.2275, 'Lucerne'],
                    [46.4908, 9.8355, 'St. Moritz'],
                    [47.3769, 8.5417, 'Zürich']
                ],
                tags: ['scenic', 'adventure'],
                description: 'Mountain passes, pristine lakes, and Alpine perfection.',
                tips: 'Very expensive! Get Swiss Vignette (40 CHF). Free camping difficult.'
            },
            {
                id: 'scottish_highlands',
                name: 'Scottish Highlands & Islands',
                icon: '🏴󠁧󠁢󠁳󠁣󠁴󠁿',
                country: 'Scotland',
                distance: '1500 km',
                duration: '10-14 days',
                coordinates: [[55.9533, -3.1883], [57.4778, -4.2247]],
                waypoints: [
                    [55.9533, -3.1883, 'Edinburgh'],
                    [56.8198, -5.1052, 'Fort William'],
                    [57.2760, -5.5160, 'Isle of Skye'],
                    [58.4397, -3.0943, 'John o\' Groats'],
                    [57.4778, -4.2247, 'Inverness'],
                    [56.4907, -4.2026, 'Loch Ness']
                ],
                tags: ['scenic', 'adventure', 'camping'],
                description: 'Mystical highlands, dramatic castles, and the Isle of Skye.',
                tips: 'Wild camping legal! Single track roads - use passing places. Midges in summer!'
            },
            {
                id: 'garden_route',
                name: 'Garden Route',
                icon: '🇿🇦',
                country: 'South Africa',
                distance: '300 km',
                duration: '5-7 days',
                coordinates: [[-34.0373, 23.0471], [-33.9580, 22.4610]],
                waypoints: [
                    [-34.0373, 23.0471, 'Storms River'],
                    [-34.0355, 23.3695, 'Plettenberg Bay'],
                    [-33.9580, 22.4610, 'George']
                ],
                tags: ['scenic', 'adventure', 'camping'],
                description: 'Lush forests, lagoons, and stunning coastline.',
                tips: 'Great for wildlife. Bungee jump at Bloukrans Bridge!'
            },
            {
                id: 'ring_road',
                name: 'Ring Road',
                icon: '🇮🇸',
                country: 'Iceland',
                distance: '1332 km',
                duration: '7-10 days',
                coordinates: [[64.1466, -21.9426], [65.6835, -18.0878]],
                waypoints: [
                    [64.1466, -21.9426, 'Reykjavik'],
                    [64.3260, -20.1210, 'Geysir'],
                    [63.5320, -19.5110, 'Vik'],
                    [65.6835, -18.0878, 'Akureyri']
                ],
                tags: ['scenic', 'adventure', 'toll-free'],
                description: 'Circle Iceland through volcanoes, glaciers and waterfalls.',
                tips: 'F-roads need 4x4. Summer has 24hr daylight. Expensive but incredible!'
            },
            // ==================== ASIA ROAD TRIPS ====================
            {
                id: 'karakoram',
                name: 'Karakoram Highway',
                icon: '🇵🇰',
                country: 'Pakistan/China',
                distance: '1300 km',
                duration: '7-10 days',
                coordinates: [[35.9208, 74.3082], [39.4704, 75.9893]],
                waypoints: [
                    [35.9208, 74.3082, 'Gilgit'],
                    [36.3167, 74.6500, 'Karimabad (Hunza)'],
                    [36.4500, 74.8667, 'Passu'],
                    [36.8333, 75.4167, 'Khunjerab Pass (4693m)'],
                    [39.4704, 75.9893, 'Kashgar']
                ],
                tags: ['adventure', 'scenic', 'epic'],
                description: 'The 8th wonder of the world - highest paved international road crossing the Himalayas.',
                tips: 'Permits required. Best May-October. Altitude sickness possible at Khunjerab.'
            },
            {
                id: 'hai_van',
                name: 'Hai Van Pass & Coastal Vietnam',
                icon: '🇻🇳',
                country: 'Vietnam',
                distance: '1700 km',
                duration: '10-14 days',
                coordinates: [[10.7769, 106.7009], [21.0285, 105.8542]],
                waypoints: [
                    [10.7769, 106.7009, 'Ho Chi Minh City'],
                    [11.9404, 108.4583, 'Da Lat'],
                    [12.2388, 109.1967, 'Nha Trang'],
                    [13.7563, 109.2225, 'Quy Nhon'],
                    [15.8801, 108.3380, 'Hoi An'],
                    [16.0544, 108.2022, 'Da Nang'],
                    [16.4637, 107.5909, 'Hue'],
                    [21.0285, 105.8542, 'Hanoi']
                ],
                tags: ['scenic', 'adventure', 'toll-free'],
                description: 'Vietnam\'s legendary coastal route including the famous Hai Van Pass (Top Gear\'s best road).',
                tips: 'Rent motorbike in HCMC, sell in Hanoi. Rainy season varies by region.'
            },
            {
                id: 'hokkaido',
                name: 'Hokkaido Circuit',
                icon: '🇯🇵',
                country: 'Japan',
                distance: '1200 km',
                duration: '7-10 days',
                coordinates: [[43.0621, 141.3544], [43.7714, 142.3630]],
                waypoints: [
                    [43.0621, 141.3544, 'Sapporo'],
                    [43.0587, 141.3570, 'Otaru'],
                    [43.4564, 142.4847, 'Furano'],
                    [43.7714, 142.3630, 'Biei (Blue Pond)'],
                    [43.0618, 144.3589, 'Kushiro'],
                    [44.0206, 145.1370, 'Shiretoko Peninsula'],
                    [43.0621, 141.3544, 'Sapporo']
                ],
                tags: ['scenic', 'camping'],
                description: 'Japan\'s wild north - lavender fields, volcanic lakes, and untamed wilderness.',
                tips: 'Michi-no-Eki (road stations) allow overnight parking. Best July-September.'
            },
            {
                id: 'golden_triangle',
                name: 'Golden Triangle',
                icon: '🇹🇭',
                country: 'Thailand',
                distance: '1900 km',
                duration: '10-14 days',
                coordinates: [[13.7563, 100.5018], [20.3500, 100.0833]],
                waypoints: [
                    [13.7563, 100.5018, 'Bangkok'],
                    [14.3692, 99.9938, 'Kanchanaburi'],
                    [18.7883, 98.9853, 'Chiang Mai'],
                    [19.9071, 99.8309, 'Chiang Rai'],
                    [20.3500, 100.0833, 'Golden Triangle'],
                    [19.2966, 97.9684, 'Mae Hong Son Loop'],
                    [18.7883, 98.9853, 'Chiang Mai']
                ],
                tags: ['scenic', 'adventure', 'toll-free'],
                description: 'Northern Thailand loop through mountains, temples, and the legendary Mae Hong Son Loop.',
                tips: '762 curves in Mae Hong Son Loop! Rent big bike in Chiang Mai.'
            },
            {
                id: 'silk_road',
                name: 'Silk Road (Central Asia)',
                icon: '🐪',
                country: 'Multi-country',
                distance: '4000 km',
                duration: '3-4 weeks',
                coordinates: [[41.2995, 69.2401], [39.6542, 66.9597]],
                waypoints: [
                    [41.2995, 69.2401, 'Tashkent'],
                    [39.6542, 66.9597, 'Samarkand'],
                    [39.7747, 64.4286, 'Bukhara'],
                    [41.3775, 60.3378, 'Khiva'],
                    [42.4602, 59.6035, 'Nukus'],
                    [37.9601, 58.3261, 'Mary (Merv)'],
                    [37.9509, 58.3794, 'Ashgabat']
                ],
                tags: ['adventure', 'epic', 'historic'],
                description: 'Follow the ancient trade route through Uzbekistan and Turkmenistan.',
                tips: 'Visas can be complex. Best spring/autumn. Incredible Islamic architecture.'
            },
            {
                id: 'rajasthan',
                name: 'Rajasthan Royal Route',
                icon: '🇮🇳',
                country: 'India',
                distance: '1200 km',
                duration: '10-14 days',
                coordinates: [[28.6139, 77.2090], [26.9124, 70.9021]],
                waypoints: [
                    [28.6139, 77.2090, 'Delhi'],
                    [27.1767, 78.0081, 'Agra (Taj Mahal)'],
                    [26.9124, 75.7873, 'Jaipur'],
                    [26.4499, 74.6399, 'Pushkar'],
                    [26.2967, 73.0167, 'Jodhpur'],
                    [26.9124, 70.9021, 'Jaisalmer'],
                    [24.5854, 72.7125, 'Udaipur']
                ],
                tags: ['historic', 'scenic', 'adventure'],
                description: 'India\'s royal route through forts, palaces, and the Thar Desert.',
                tips: 'Chaotic traffic! Best October-March. Hire driver or be very experienced.'
            },
            {
                id: 'korea_coastal',
                name: 'Korea Coastal Road',
                icon: '🇰🇷',
                country: 'South Korea',
                distance: '1700 km',
                duration: '7-10 days',
                coordinates: [[35.1796, 129.0756], [38.2070, 128.5918]],
                waypoints: [
                    [35.1796, 129.0756, 'Busan'],
                    [35.8714, 128.6014, 'Gyeongju'],
                    [36.0190, 129.3435, 'Pohang'],
                    [37.4563, 129.1658, 'Gangneung'],
                    [38.2070, 128.5918, 'Sokcho'],
                    [37.5665, 126.9780, 'Seoul']
                ],
                tags: ['scenic', 'toll-free', 'camping'],
                description: 'Korea\'s stunning east coast from Busan to the DMZ area.',
                tips: 'Excellent rest stops. Try the seafood! Camping at beaches possible.'
            },
            // ==================== AFRICA ROAD TRIPS ====================
            {
                id: 'morocco_atlas',
                name: 'Morocco Grand Tour',
                icon: '🇲🇦',
                country: 'Morocco',
                distance: '2200 km',
                duration: '12-16 days',
                coordinates: [[33.5731, -7.5898], [31.6295, -7.9811]],
                waypoints: [
                    [33.5731, -7.5898, 'Casablanca'],
                    [33.9716, -6.8498, 'Rabat'],
                    [34.0181, -5.0078, 'Fes'],
                    [31.9314, -4.4288, 'Merzouga (Sahara)'],
                    [31.1649, -4.0004, 'Todra Gorge'],
                    [31.0482, -6.8388, 'Ait Benhaddou'],
                    [31.6295, -7.9811, 'Marrakech'],
                    [30.4278, -9.5981, 'Agadir'],
                    [31.5085, -9.7595, 'Essaouira']
                ],
                tags: ['adventure', 'scenic', 'camping'],
                description: 'From imperial cities to Sahara dunes, kasbahs and coastal charm.',
                tips: 'Wild camping easy outside cities. Negotiate everything! Best spring/autumn.'
            },
            {
                id: 'cape_town_kruger',
                name: 'Cape Town to Kruger',
                icon: '🇿🇦',
                country: 'South Africa',
                distance: '1800 km',
                duration: '14-18 days',
                coordinates: [[-33.9249, 18.4241], [-24.9916, 31.5430]],
                waypoints: [
                    [-33.9249, 18.4241, 'Cape Town'],
                    [-33.9580, 22.4610, 'Garden Route Start'],
                    [-33.4580, 26.5220, 'Addo Elephant Park'],
                    [-29.8587, 31.0218, 'Durban'],
                    [-25.7479, 28.2293, 'Pretoria'],
                    [-24.9916, 31.5430, 'Kruger National Park']
                ],
                tags: ['scenic', 'wildlife', 'adventure'],
                description: 'The ultimate South African road trip - coast, wildlife, and everything in between.',
                tips: 'Book Kruger camps months ahead. Garden Route doable year-round.'
            },
            {
                id: 'ethiopia_historic',
                name: 'Ethiopian Historic Route',
                icon: '🇪🇹',
                country: 'Ethiopia',
                distance: '1500 km',
                duration: '10-14 days',
                coordinates: [[9.0320, 38.7469], [14.1210, 38.7469]],
                waypoints: [
                    [9.0320, 38.7469, 'Addis Ababa'],
                    [11.5936, 37.3908, 'Bahir Dar (Blue Nile Falls)'],
                    [12.6000, 37.4667, 'Gondar'],
                    [13.4910, 39.4750, 'Axum'],
                    [12.0300, 39.0442, 'Lalibela'],
                    [9.0320, 38.7469, 'Addis Ababa']
                ],
                tags: ['historic', 'adventure', 'fourx4'],
                description: 'Ancient churches, castles, and the ark of the covenant route.',
                tips: 'Roads improving but still challenging. Best October-March (dry season).'
            },
            {
                id: 'tanzania_circuit',
                name: 'Tanzania Northern Circuit',
                icon: '🇹🇿',
                country: 'Tanzania',
                distance: '800 km',
                duration: '7-10 days',
                coordinates: [[-3.3869, 36.6830], [-2.3333, 34.8333]],
                waypoints: [
                    [-3.3869, 36.6830, 'Arusha'],
                    [-3.0674, 37.3556, 'Moshi (Kilimanjaro)'],
                    [-2.3333, 34.8333, 'Serengeti'],
                    [-3.2400, 35.5320, 'Ngorongoro Crater'],
                    [-3.5000, 35.7500, 'Lake Manyara'],
                    [-4.0500, 35.7620, 'Tarangire'],
                    [-3.3869, 36.6830, 'Arusha']
                ],
                tags: ['wildlife', 'adventure', 'fourx4'],
                description: 'Safari paradise - Great Migration, Ngorongoro, and Kilimanjaro views.',
                tips: 'June-October for migration. Book camps well in advance!'
            },
            {
                id: 'senegal_dakar',
                name: 'Senegal Adventure',
                icon: '🇸🇳',
                country: 'Senegal',
                distance: '1200 km',
                duration: '10-14 days',
                coordinates: [[14.6928, -17.4467], [12.5833, -16.2719]],
                waypoints: [
                    [14.6928, -17.4467, 'Dakar'],
                    [14.7500, -17.3600, 'Lac Rose'],
                    [15.6178, -16.4181, 'Saint-Louis'],
                    [13.4531, -16.5775, 'Sine-Saloum Delta'],
                    [12.5833, -16.2719, 'Casamance'],
                    [14.6928, -17.4467, 'Dakar']
                ],
                tags: ['adventure', 'scenic', 'toll-free'],
                description: 'West African adventure - colonial history, pink lake, and tropical south.',
                tips: 'Peugeot 504 sept-place for local experience! Casamance requires patience.'
            },
            {
                id: 'madagascar_rn7',
                name: 'Madagascar RN7',
                icon: '🇲🇬',
                country: 'Madagascar',
                distance: '1000 km',
                duration: '10-14 days',
                coordinates: [[-18.8792, 47.5079], [-23.3516, 43.6854]],
                waypoints: [
                    [-18.8792, 47.5079, 'Antananarivo'],
                    [-19.8659, 47.0333, 'Antsirabe'],
                    [-20.5167, 46.5500, 'Ambositra'],
                    [-21.4419, 47.0856, 'Ranomafana'],
                    [-21.2500, 45.3667, 'Isalo'],
                    [-23.3516, 43.6854, 'Toliara']
                ],
                tags: ['adventure', 'wildlife', 'scenic'],
                description: 'Madagascar\'s most famous road - lemurs, baobabs, and otherworldly landscapes.',
                tips: 'Roads very rough! 4x4 recommended. Best April-November.'
            },
            // ==================== NEW TRIPS FROM REDDIT, FORUMS & TRAVEL AGENCIES ====================
            {
                id: 'nc500_scotland',
                name: 'North Coast 500',
                icon: '🏴󠁧󠁢󠁳󠁣󠁴󠁿',
                country: 'Scotland',
                distance: '830 km',
                duration: '5-7 days',
                coordinates: [[57.4778, -4.2247], [58.6373, -3.0689]],
                waypoints: [
                    [57.4778, -4.2247, 'Inverness', 'Highland capital start'],
                    [58.6373, -3.0689, 'John O\'Groats', 'Britain\'s northern tip'],
                    [58.5667, -4.7500, 'Durness', 'Remote beauty'],
                    [57.4167, -5.6333, 'Applecross', 'Bealach na Bà pass']
                ],
                tags: ['scenic', 'historic', 'adventure'],
                description: 'Scotland\'s answer to Route 66 - dramatic highlands, castles, and coastal beauty.',
                tips: 'Single-track roads with passing places. Book accommodation early. Midges in summer!',
                rating: 4.8,
                difficulty: 'easy',
                bestSeason: 'May-September',
                budget: '£800-1500',
                mustKnow: ['Single-track roads require patience', 'Use passing places correctly', 'Book B&Bs 2-3 months ahead in summer', 'Bring midge repellent!', 'Weather changes rapidly', 'Isle of Skye detour highly recommended'],
                highlights: ['Dunrobin Castle', 'Smoo Cave', 'Bealach na Bà mountain pass', 'Applecross', 'Ullapool'],
                costs: { fuel: '£150-250', accommodation: '£400-800', food: '£200-400', total: '£800-1,500' }
            },
            {
                id: 'swiss_alps_tour',
                name: 'Swiss Alps Grand Tour',
                icon: '🇨🇭',
                country: 'Switzerland',
                distance: '1600 km',
                duration: '7-10 days',
                coordinates: [[47.3769, 8.5417], [46.0207, 7.7491]],
                waypoints: [
                    [47.3769, 8.5417, 'Zurich', 'Start point'],
                    [47.0502, 8.3093, 'Lucerne', 'Lake city'],
                    [46.0207, 7.7491, 'Zermatt', 'Matterhorn views'],
                    [46.4908, 9.8355, 'St. Moritz', 'Alpine glamour'],
                    [46.6863, 7.8632, 'Interlaken', 'Adventure capital']
                ],
                tags: ['scenic', 'adventure', 'epic'],
                description: 'Switzerland\'s official grand tour - alpine passes, turquoise lakes, and mountain villages.',
                tips: 'Many passes close in winter. Book mountain hotels early. Vignette required for highways.',
                rating: 4.9,
                difficulty: 'moderate',
                bestSeason: 'June-September',
                budget: 'CHF 2000-4000',
                mustKnow: ['High mountain passes close October-May', 'Switzerland is expensive', 'Vignette (CHF 40) required for motorways', 'Train is also scenic option', 'Book Zermatt accommodation well ahead'],
                highlights: ['Grimsel Pass', 'Furka Pass', 'Lake Lucerne', 'Matterhorn', 'Jungfrau region'],
                costs: { fuel: 'CHF 200-350', accommodation: 'CHF 800-1500', food: 'CHF 400-700', total: 'CHF 2,000-4,000' }
            },
            {
                id: 'dolomites_circuit',
                name: 'Dolomites Circuit',
                icon: '🇮🇹',
                country: 'Italy',
                distance: '400 km',
                duration: '4-6 days',
                coordinates: [[46.4983, 11.3548], [46.5369, 12.1375]],
                waypoints: [
                    [46.4983, 11.3548, 'Bolzano', 'Gateway city'],
                    [46.5369, 12.1375, 'Cortina d\'Ampezzo', 'Olympic resort'],
                    [46.6192, 12.3028, 'Tre Cime di Lavaredo', 'Iconic peaks'],
                    [46.5739, 11.6711, 'Ortisei', 'Val Gardena village']
                ],
                tags: ['scenic', 'adventure', 'epic'],
                description: 'Italian Alps at their finest - dramatic peaks, alpine meadows, and legendary mountain passes.',
                tips: 'Passes crowded in August. Cable cars offer best views. Great hiking opportunities.',
                rating: 4.8,
                difficulty: 'moderate',
                bestSeason: 'June-September',
                budget: '€600-1200',
                mustKnow: ['Stelvio Pass is nearby and legendary', 'Book rifugios (mountain huts) ahead', 'August is extremely crowded', 'Autumn colors spectacular in October'],
                highlights: ['Tre Cime di Lavaredo', 'Passo Stelvio', 'Lake Braies', 'Seceda viewpoint', 'Alpe di Siusi'],
                costs: { fuel: '€80-120', accommodation: '€300-700', food: '€150-300', total: '€600-1,200' }
            },
            {
                id: 'amalfi_coast',
                name: 'Amalfi Coast',
                icon: '🇮🇹',
                country: 'Italy',
                distance: '50 km',
                duration: '2-4 days',
                coordinates: [[40.6263, 14.3758], [40.6333, 14.6028]],
                waypoints: [
                    [40.6263, 14.3758, 'Sorrento', 'Gateway town'],
                    [40.6280, 14.4847, 'Positano', 'Cliffside icon'],
                    [40.6333, 14.6028, 'Amalfi', 'Historic center'],
                    [40.6514, 14.6117, 'Ravello', 'Garden paradise']
                ],
                tags: ['scenic', 'historic', 'epic'],
                description: 'Italy\'s most famous coastal drive - clifftop villages, lemon groves, and Mediterranean views.',
                tips: 'Very narrow roads. Heavy traffic in summer. Park and walk in villages. Start early morning.',
                rating: 4.7,
                difficulty: 'moderate',
                bestSeason: 'May-June, September-October',
                budget: '€500-1200',
                mustKnow: ['Roads are extremely narrow', 'Traffic jams common in summer', 'Consider hiring a driver', 'Ferries connect the towns', 'Book restaurants in advance'],
                highlights: ['Positano views', 'Ravello gardens', 'Amalfi Cathedral', 'Path of the Gods hike', 'Limoncello tasting'],
                costs: { fuel: '€30-50', accommodation: '€300-800', food: '€150-300', total: '€500-1,200' }
            },
            {
                id: 'romantic_road_germany',
                name: 'Romantic Road',
                icon: '🇩🇪',
                country: 'Germany',
                distance: '460 km',
                duration: '3-5 days',
                coordinates: [[49.7913, 9.9534], [47.5667, 10.6833]],
                waypoints: [
                    [49.7913, 9.9534, 'Würzburg', 'Wine city start'],
                    [49.3769, 10.1797, 'Rothenburg ob der Tauber', 'Medieval gem'],
                    [48.3706, 10.8978, 'Augsburg', 'Roman history'],
                    [47.5667, 10.6833, 'Füssen', 'Castle country']
                ],
                tags: ['scenic', 'historic'],
                description: 'Germany\'s most famous route through medieval towns and fairy-tale castles.',
                tips: 'Popular with tour buses. Best in shoulder season. Christmas markets are magical.',
                rating: 4.6,
                difficulty: 'easy',
                bestSeason: 'May-October',
                budget: '€400-800',
                mustKnow: ['Book Neuschwanstein tickets online in advance', 'Rothenburg gets very crowded', 'Christmas markets November-December are magical', 'Wine tasting in Würzburg region'],
                highlights: ['Neuschwanstein Castle', 'Rothenburg ob der Tauber', 'Würzburg Residenz', 'Dinkelsbühl', 'Nördlingen'],
                costs: { fuel: '€60-100', accommodation: '€200-450', food: '€100-200', total: '€400-800' }
            },
            {
                id: 'andalusia_spain',
                name: 'Andalusia Explorer',
                icon: '🇪🇸',
                country: 'Spain',
                distance: '800 km',
                duration: '7-10 days',
                coordinates: [[37.3891, -5.9845], [36.7213, -4.4214]],
                waypoints: [
                    [37.3891, -5.9845, 'Seville', 'Flamenco capital'],
                    [37.8882, -4.7794, 'Córdoba', 'Mezquita'],
                    [37.1773, -3.5986, 'Granada', 'Alhambra'],
                    [36.7413, -5.1668, 'Ronda', 'Cliffside drama'],
                    [36.7213, -4.4214, 'Málaga', 'Costa del Sol']
                ],
                tags: ['scenic', 'historic', 'adventure'],
                description: 'Southern Spain\'s cultural treasures - Moorish palaces, white villages, and flamenco.',
                tips: 'Book Alhambra tickets months ahead. Very hot in summer. Great tapas culture.',
                rating: 4.7,
                difficulty: 'easy',
                bestSeason: 'March-May, September-November',
                budget: '€600-1200',
                mustKnow: ['Alhambra tickets sell out weeks ahead', 'Summer temperatures exceed 40°C', 'Siesta hours still observed', 'Free tapas with drinks in Granada', 'White villages (pueblos blancos) worth exploring'],
                highlights: ['Alhambra Palace', 'Seville Cathedral', 'Córdoba Mezquita', 'Ronda gorge', 'White villages'],
                costs: { fuel: '€100-150', accommodation: '€300-600', food: '€150-300', total: '€600-1,200' }
            },
            {
                id: 'pacific_coast_highway',
                name: 'Pacific Coast Highway',
                icon: '🇺🇸',
                country: 'USA',
                distance: '1000 km',
                duration: '5-7 days',
                coordinates: [[37.7749, -122.4194], [34.0522, -118.2437]],
                waypoints: [
                    [37.7749, -122.4194, 'San Francisco', 'Golden Gate start'],
                    [36.5552, -121.9233, 'Monterey', 'Cannery Row'],
                    [36.2704, -121.8081, 'Big Sur', 'Coastal drama'],
                    [35.6131, -121.1906, 'Hearst Castle', 'Opulent estate'],
                    [34.4208, -119.6982, 'Santa Barbara', 'American Riviera'],
                    [34.0522, -118.2437, 'Los Angeles', 'Beach finish']
                ],
                tags: ['scenic', 'epic', 'adventure'],
                description: 'America\'s most iconic coastal drive from San Francisco to Los Angeles via Big Sur.',
                tips: 'Fog common in mornings. Landslides can close road. Drive north to south for ocean views.',
                rating: 4.9,
                difficulty: 'easy',
                bestSeason: 'April-October',
                budget: '$1500-3000',
                mustKnow: ['Big Sur accommodations book months ahead', 'Check road conditions (landslides)', 'Morning fog common', 'Drive south for ocean-side views', 'Bixby Bridge photo stop essential'],
                highlights: ['Big Sur', 'Bixby Bridge', 'Hearst Castle', 'Monterey Aquarium', '17-Mile Drive', 'Santa Barbara'],
                costs: { fuel: '$150-250', accommodation: '$700-1500', food: '$300-600', total: '$1,500-3,000' }
            },
            {
                id: 'grand_circle_utah',
                name: 'Utah Grand Circle',
                icon: '🇺🇸',
                country: 'USA',
                distance: '2000 km',
                duration: '10-14 days',
                coordinates: [[36.1699, -115.1398], [38.5733, -109.5498]],
                waypoints: [
                    [36.1699, -115.1398, 'Las Vegas', 'Start point'],
                    [37.2982, -113.0263, 'Zion', 'Red canyons'],
                    [37.6283, -112.1677, 'Bryce Canyon', 'Hoodoo wonderland'],
                    [38.5733, -109.5498, 'Moab', 'Arches & Canyonlands'],
                    [36.9980, -110.0985, 'Monument Valley', 'Iconic mesas'],
                    [36.0544, -112.1401, 'Grand Canyon', 'Ultimate canyon']
                ],
                tags: ['scenic', 'adventure', 'epic', 'camping'],
                description: 'Utah\'s legendary loop through 5 national parks, Monument Valley, and the Grand Canyon.',
                tips: 'Permits needed for some hikes. Very hot in summer. Book camping 6 months ahead.',
                rating: 4.9,
                difficulty: 'easy',
                bestSeason: 'March-May, September-November',
                budget: '$1500-3000',
                mustKnow: ['Angels Landing permit required', 'The Wave permit lottery', 'Summer temps exceed 100°F', 'Annual park pass ($80) worth it', 'Book Zion shuttle early in season'],
                highlights: ['Zion Angels Landing', 'Bryce hoodoos', 'Delicate Arch', 'Mesa Arch sunrise', 'Monument Valley'],
                costs: { fuel: '$200-350', accommodation: '$600-1200', food: '$300-500', total: '$1,500-3,000' }
            },
            {
                id: 'icefields_parkway',
                name: 'Icefields Parkway',
                icon: '🇨🇦',
                country: 'Canada',
                distance: '232 km',
                duration: '2-4 days',
                coordinates: [[51.4254, -116.1773], [52.8737, -118.0814]],
                waypoints: [
                    [51.4254, -116.1773, 'Banff', 'Mountain town'],
                    [51.4167, -116.2167, 'Lake Louise', 'Turquoise gem'],
                    [51.9000, -116.9667, 'Columbia Icefield', 'Glacier walk'],
                    [52.8737, -118.0814, 'Jasper', 'Northern terminus']
                ],
                tags: ['scenic', 'epic', 'adventure'],
                description: 'Canada\'s most stunning drive through the heart of the Canadian Rockies.',
                tips: 'Fill up gas in Banff or Jasper - limited services mid-route. Wildlife on roads.',
                rating: 4.9,
                difficulty: 'easy',
                bestSeason: 'June-September',
                budget: 'C$500-1000',
                mustKnow: ['No gas stations between Lake Louise and Jasper', 'Wildlife frequently on roads', 'Peyto Lake viewpoint essential', 'Columbia Icefield tour bookable', 'Weather can change rapidly'],
                highlights: ['Peyto Lake', 'Athabasca Glacier', 'Bow Lake', 'Sunwapta Falls', 'Athabasca Falls'],
                costs: { fuel: 'C$60-100', accommodation: 'C$250-500', food: 'C$100-200', total: 'C$500-1,000' }
            },
            {
                id: 'cabot_trail',
                name: 'Cabot Trail',
                icon: '🇨🇦',
                country: 'Canada',
                distance: '298 km',
                duration: '2-4 days',
                coordinates: [[46.1544, -60.9419], [46.8167, -60.8333]],
                waypoints: [
                    [46.1544, -60.9419, 'Baddeck', 'Gateway town'],
                    [46.6500, -60.5833, 'Ingonish', 'Beach stop'],
                    [46.8167, -60.8333, 'Pleasant Bay', 'Whale watching'],
                    [46.6333, -61.0167, 'Chéticamp', 'Acadian culture']
                ],
                tags: ['scenic', 'adventure'],
                description: 'Nova Scotia\'s spectacular coastal loop through Cape Breton Highlands.',
                tips: 'Drive clockwise for best ocean views. Book whale tours ahead. Fall colors spectacular.',
                rating: 4.8,
                difficulty: 'easy',
                bestSeason: 'June-October',
                budget: 'C$400-800',
                mustKnow: ['Drive clockwise for ocean-side views', 'Skyline Trail hike essential', 'Whale watching season June-October', 'Fall foliage peaks mid-October', 'Celtic music at local pubs'],
                highlights: ['Skyline Trail', 'Whale watching', 'Celtic culture', 'Fall colors', 'Acadian villages'],
                costs: { fuel: 'C$50-80', accommodation: 'C$200-400', food: 'C$100-200', total: 'C$400-800' }
            },
            {
                id: 'baja_california',
                name: 'Baja California',
                icon: '🇲🇽',
                country: 'Mexico',
                distance: '1700 km',
                duration: '10-14 days',
                coordinates: [[32.5149, -117.0382], [24.1426, -110.3128]],
                waypoints: [
                    [32.5149, -117.0382, 'Tijuana', 'Border crossing'],
                    [32.0500, -116.6000, 'Valle de Guadalupe', 'Wine country'],
                    [27.9578, -114.0508, 'Guerrero Negro', 'Whale watching'],
                    [24.1426, -110.3128, 'La Paz', 'Beach paradise']
                ],
                tags: ['adventure', 'scenic', 'camping', 'wildlife'],
                description: 'Mexico\'s wild peninsula - wine country, gray whales, desert, and pristine beaches.',
                tips: 'Mexican car insurance required. Gas up frequently. Cash needed in small towns.',
                rating: 4.6,
                difficulty: 'moderate',
                bestSeason: 'December-April',
                budget: '$1000-2000',
                mustKnow: ['Mexican car insurance mandatory', 'Gray whale season December-April', 'Valle de Guadalupe wines excellent', 'Balandra beach near La Paz is paradise', 'Desert can be extremely hot'],
                highlights: ['Valle de Guadalupe wines', 'Gray whale watching', 'Balandra beach', 'Boojum tree forest', 'Sea of Cortez'],
                costs: { fuel: '$200-350', accommodation: '$400-800', food: '$200-400', total: '$1,000-2,000' }
            },
            {
                id: 'ruta_40_argentina',
                name: 'Ruta 40',
                icon: '🇦🇷',
                country: 'Argentina',
                distance: '5000 km',
                duration: '21-30 days',
                coordinates: [[-50.3379, -72.2648], [-32.8895, -68.8458]],
                waypoints: [
                    [-50.3379, -72.2648, 'El Calafate', 'Glacier gateway'],
                    [-49.3314, -72.8867, 'El Chaltén', 'Trekking capital'],
                    [-41.1335, -71.3103, 'Bariloche', 'Lake District'],
                    [-32.8895, -68.8458, 'Mendoza', 'Wine country']
                ],
                tags: ['adventure', 'epic', 'scenic', 'camping'],
                description: 'Argentina\'s legendary route from Patagonia to Mendoza along the Andes.',
                tips: 'Long distances between services. Wind can be extreme. 4x4 for some sections.',
                rating: 4.8,
                difficulty: 'challenging',
                bestSeason: 'November-March',
                budget: '$2000-4000',
                mustKnow: ['Patagonian wind is intense', '300+ km between gas stations in places', 'Perito Moreno Glacier unmissable', 'El Chaltén hiking capital', 'Mendoza wine tasting perfect finale'],
                highlights: ['Perito Moreno Glacier', 'Fitz Roy mountains', 'Lake District', 'Mendoza wineries', 'Patagonian steppe'],
                costs: { fuel: '$400-700', accommodation: '$600-1200', food: '$300-600', total: '$2,000-4,000' }
            },
            {
                id: 'seven_lakes_argentina',
                name: 'Ruta de los Siete Lagos',
                icon: '🇦🇷',
                country: 'Argentina',
                distance: '110 km',
                duration: '1-2 days',
                coordinates: [[-40.1578, -71.3531], [-40.7617, -71.6428]],
                waypoints: [
                    [-40.1578, -71.3531, 'San Martín de los Andes', 'Start'],
                    [-40.4419, -71.6236, 'Lake Espejo', 'Mirror lake'],
                    [-40.7617, -71.6428, 'Villa La Angostura', 'End point']
                ],
                tags: ['scenic', 'adventure'],
                description: 'Argentina\'s Lake District gem - seven stunning glacial lakes connected by mountain road.',
                tips: 'Paved and easy. Beautiful in all seasons. Chocolate shops everywhere!',
                rating: 4.7,
                difficulty: 'easy',
                bestSeason: 'Year-round',
                budget: '$200-400',
                mustKnow: ['All paved, any car works', 'Arrayanes forest unique in the world', 'Chocolate shops in both towns', 'Autumn colors spectacular', 'Can do in a single day'],
                highlights: ['Lake Nahuel Huapi', 'Lake Correntoso', 'Arrayanes forest', 'Villa La Angostura', 'Mountain viewpoints'],
                costs: { fuel: '$30-50', accommodation: '$100-200', food: '$50-100', total: '$200-400' }
            },
            {
                id: 'botswana_safari',
                name: 'Botswana Self-Drive Safari',
                icon: '🇧🇼',
                country: 'Botswana',
                distance: '1200 km',
                duration: '10-14 days',
                coordinates: [[-19.9833, 23.4167], [-17.8000, 25.1500]],
                waypoints: [
                    [-19.9833, 23.4167, 'Maun', 'Gateway to Okavango'],
                    [-19.1667, 23.7500, 'Moremi', 'Prime wildlife'],
                    [-18.7500, 24.0500, 'Savuti', 'Predator paradise'],
                    [-17.8000, 25.1500, 'Kasane', 'Chobe riverfront']
                ],
                tags: ['fourx4', 'wildlife', 'camping', 'adventure'],
                description: 'Ultimate self-drive safari through Okavango Delta, Moremi and Chobe National Park.',
                tips: '4x4 essential - sandy terrain. Book campsites months ahead. Tracks4Africa GPS required.',
                rating: 4.8,
                difficulty: 'challenging',
                bestSeason: 'May-October (dry season)',
                budget: '$3000-5000',
                mustKnow: ['4x4 with high clearance essential', 'Book NWR/DWNP camps 6+ months ahead', 'Sandy roads challenging', 'No fences - wildlife everywhere', 'Carry Tracks4Africa GPS', 'Self-sufficient with water and fuel'],
                highlights: ['Okavango Delta', 'Moremi wildlife', 'Savuti elephants', 'Chobe boat safari', 'Night drives at Khwai'],
                costs: { fuel: '$400-600', accommodation: '$800-1500', food: '$300-500', total: '$3,000-5,000' }
            },
            {
                id: 'morocco_sahara',
                name: 'Morocco Sahara Trail',
                icon: '🇲🇦',
                country: 'Morocco',
                distance: '1500 km',
                duration: '7-10 days',
                coordinates: [[31.6295, -7.9811], [31.0802, -4.0130]],
                waypoints: [
                    [31.6295, -7.9811, 'Marrakech', 'Imperial city'],
                    [31.0481, -6.8617, 'Aït Benhaddou', 'UNESCO kasbah'],
                    [31.4500, -5.5333, 'Dades Valley', 'Rose valley'],
                    [31.0802, -4.0130, 'Merzouga', 'Sahara dunes']
                ],
                tags: ['adventure', 'scenic', 'historic', 'camping'],
                description: 'From Marrakech through Atlas Mountains to the golden dunes of the Sahara.',
                tips: '4x4 for desert sections. Bring cash for rural areas. Hire local guide for dunes.',
                rating: 4.7,
                difficulty: 'moderate',
                bestSeason: 'March-May, September-November',
                budget: '€800-1500',
                mustKnow: ['Tizi-n\'Tichka pass spectacular', 'Aït Benhaddou UNESCO site', 'Todra Gorge worth a stop', 'Camel trek in Erg Chebbi', 'Summer is extremely hot', 'Haggling expected in souks'],
                highlights: ['Aït Benhaddou kasbah', 'Dades Gorge', 'Todra Gorge', 'Erg Chebbi dunes', 'Desert camps'],
                costs: { fuel: '€150-250', accommodation: '€300-600', food: '€150-300', total: '€800-1,500' }
            },
            {
                id: 'japan_sanin',
                name: 'San\'in Coast Japan',
                icon: '🇯🇵',
                country: 'Japan',
                distance: '355 km',
                duration: '3-5 days',
                coordinates: [[35.4723, 133.0505], [35.5333, 135.1833]],
                waypoints: [
                    [35.4723, 133.0505, 'Matsue', 'Castle town'],
                    [35.4000, 132.6833, 'Izumo', 'Grand shrine'],
                    [35.5000, 134.2333, 'Tottori', 'Sand dunes'],
                    [35.5333, 135.1833, 'Ine', 'Boat houses']
                ],
                tags: ['scenic', 'historic', 'adventure'],
                description: 'Japan\'s hidden coast - ancient shrines, sand dunes, and traditional fishing villages.',
                tips: 'Less touristy than other routes. Onsen everywhere. Seafood is incredible.',
                rating: 4.7,
                difficulty: 'easy',
                bestSeason: 'April-May, September-November',
                budget: '¥80,000-150,000',
                mustKnow: ['Izumo Taisha one of Japan\'s oldest shrines', 'Tottori sand dunes unique in Japan', 'Less English signage than tourist areas', 'Matsue castle is original', 'Fresh crab in winter season'],
                highlights: ['Izumo Taisha shrine', 'Tottori sand dunes', 'Matsue castle', 'Ine funaya boat houses', 'Onsen towns'],
                costs: { fuel: '¥10,000-15,000', accommodation: '¥40,000-80,000', food: '¥20,000-40,000', total: '¥80,000-150,000' }
            },
            {
                id: 'taiwan_taroko',
                name: 'Taroko Gorge Route',
                icon: '🇹🇼',
                country: 'Taiwan',
                distance: '200 km',
                duration: '2-3 days',
                coordinates: [[23.9871, 121.6044], [24.5989, 121.8572]],
                waypoints: [
                    [23.9871, 121.6044, 'Hualien', 'Gateway city'],
                    [24.1586, 121.5028, 'Taroko Gorge', 'Marble canyon'],
                    [24.3333, 121.7333, 'Qingshui Cliffs', 'Ocean views'],
                    [24.5989, 121.8572, 'Suao', 'Coastal town']
                ],
                tags: ['scenic', 'adventure', 'epic'],
                description: 'Taiwan\'s most dramatic drive through marble gorges and along towering sea cliffs.',
                tips: 'Helmet required on scooter. Rock fall danger in gorge. Incredible hiking.',
                rating: 4.8,
                difficulty: 'moderate',
                bestSeason: 'October-April',
                budget: 'NT$5,000-10,000',
                mustKnow: ['Taroko entry permit needed for some trails', 'Rockfall danger after rain', 'Scooter popular option', 'Swallow Grotto trail dramatic', 'Qingshui Cliffs viewpoint essential'],
                highlights: ['Taroko Gorge', 'Qingshui Cliffs', 'Swallow Grotto', 'Eternal Spring Shrine', 'Shakadang Trail'],
                costs: { fuel: 'NT$500-1000', accommodation: 'NT$2000-5000', food: 'NT$1500-3000', total: 'NT$5,000-10,000' }
            },
            {
                id: 'sri_lanka_hill',
                name: 'Sri Lanka Hill Country',
                icon: '🇱🇰',
                country: 'Sri Lanka',
                distance: '300 km',
                duration: '4-6 days',
                coordinates: [[7.2906, 80.6337], [6.8667, 81.0500]],
                waypoints: [
                    [7.2906, 80.6337, 'Kandy', 'Temple city'],
                    [6.9697, 80.7892, 'Nuwara Eliya', 'Little England'],
                    [6.8667, 81.0500, 'Ella', 'Backpacker hub'],
                    [6.7833, 80.9833, 'Haputale', 'Tea views']
                ],
                tags: ['scenic', 'adventure', 'historic'],
                description: 'Tea plantations, waterfalls, and colonial hill stations of central Sri Lanka.',
                tips: 'Winding mountain roads. Train also scenic option. Pack for cool weather.',
                rating: 4.6,
                difficulty: 'moderate',
                bestSeason: 'January-April',
                budget: '$300-600',
                mustKnow: ['Train from Kandy to Ella is famous scenic journey', 'Nine Arch Bridge photo spot', 'Tea factory tours available', 'Cool weather - bring layers', 'Ella Rock sunrise hike popular'],
                highlights: ['Nuwara Eliya', 'Ella Rock', 'Nine Arch Bridge', 'Tea factory tours', 'Lipton\'s Seat viewpoint'],
                costs: { fuel: '$40-70', accommodation: '$100-250', food: '$50-120', total: '$300-600' }
            },
            {
                id: 'jordan_kings_highway',
                name: 'King\'s Highway Jordan',
                icon: '🇯🇴',
                country: 'Jordan',
                distance: '335 km',
                duration: '3-5 days',
                coordinates: [[31.9454, 35.9284], [30.3285, 35.4444]],
                waypoints: [
                    [31.9454, 35.9284, 'Amman', 'Capital start'],
                    [31.7167, 35.8000, 'Madaba', 'Mosaic city'],
                    [31.1833, 35.7000, 'Karak', 'Crusader castle'],
                    [30.3285, 35.4444, 'Petra', 'Rose city']
                ],
                tags: ['historic', 'scenic', 'adventure'],
                description: 'Ancient trading route through Jordan\'s biblical landscapes to the lost city of Petra.',
                tips: 'Petra needs 2 days minimum. Jordan Pass great value. Avoid summer heat.',
                rating: 4.8,
                difficulty: 'easy',
                bestSeason: 'March-May, September-November',
                budget: '$400-800',
                mustKnow: ['Jordan Pass includes Petra + visa', 'Petra needs at least 2 full days', 'Wadi Mujib canyon spectacular', 'Dana Biosphere Reserve worth a stop', 'Wadi Rum nearby for desert extension'],
                highlights: ['Petra Treasury', 'Wadi Mujib canyon', 'Karak Castle', 'Dana Reserve', 'Mount Nebo views'],
                costs: { fuel: '$50-80', accommodation: '$150-350', food: '$80-150', total: '$400-800' }
            },
            {
                id: 'oman_coastal',
                name: 'Oman Coastal Adventure',
                icon: '🇴🇲',
                country: 'Oman',
                distance: '1000 km',
                duration: '5-7 days',
                coordinates: [[23.5880, 58.3829], [17.0169, 54.0924]],
                waypoints: [
                    [23.5880, 58.3829, 'Muscat', 'Capital start'],
                    [22.5667, 59.5289, 'Sur', 'Dhow building'],
                    [22.5167, 59.1000, 'Wahiba Sands', 'Desert camp'],
                    [17.0169, 54.0924, 'Salalah', 'Tropical south']
                ],
                tags: ['scenic', 'adventure', 'camping'],
                description: 'From Muscat\'s grandeur through dramatic wadis to Salalah\'s tropical coast.',
                tips: '4x4 for wadis and desert. Very hot in summer. Respectful dress required.',
                rating: 4.7,
                difficulty: 'moderate',
                bestSeason: 'October-April',
                budget: 'OMR 300-600',
                mustKnow: ['Wadi Shab swimming pools stunning', 'Wahiba Sands desert camp experience', 'Jebel Shams is Oman\'s Grand Canyon', 'Salalah green in khareef (monsoon) season', 'Very safe country for travel'],
                highlights: ['Wadi Shab', 'Wahiba Sands', 'Jebel Shams', 'Sur dhow yards', 'Salalah beaches'],
                costs: { fuel: 'OMR 60-100', accommodation: 'OMR 150-300', food: 'OMR 60-120', total: 'OMR 300-600' }
            },
            {
                id: 'tasmania_circuit',
                name: 'Tasmania Road Trip',
                icon: '🇦🇺',
                country: 'Australia',
                distance: '1500 km',
                duration: '10-14 days',
                coordinates: [[-42.8821, 147.3272], [-41.4419, 145.9708]],
                waypoints: [
                    [-42.8821, 147.3272, 'Hobart', 'Capital start'],
                    [-42.1250, 148.2333, 'Freycinet', 'Wineglass Bay'],
                    [-41.6833, 145.9417, 'Cradle Mountain', 'Wilderness icon'],
                    [-42.1500, 145.3333, 'Strahan', 'West coast']
                ],
                tags: ['scenic', 'wildlife', 'adventure', 'camping'],
                description: 'Australia\'s island state - wilderness, wildlife, and world-class food and drink.',
                tips: 'Ferry or fly from mainland. Wildlife everywhere. Pack for all seasons.',
                rating: 4.7,
                difficulty: 'easy',
                bestSeason: 'December-March',
                budget: 'A$1500-3000',
                mustKnow: ['Spirit of Tasmania ferry from Melbourne', 'MONA museum in Hobart unmissable', 'Wildlife on roads at dusk/dawn', 'Weather changes rapidly', 'Convict history sites UNESCO listed'],
                highlights: ['Cradle Mountain', 'Wineglass Bay', 'MONA museum', 'Bay of Fires', 'Port Arthur'],
                costs: { fuel: 'A$200-350', accommodation: 'A$600-1200', food: 'A$300-600', total: 'A$1,500-3,000' }
            },
            {
                id: 'sea_to_sky_canada',
                name: 'Sea to Sky Highway',
                icon: '🇨🇦',
                country: 'Canada',
                distance: '120 km',
                duration: '1-2 days',
                coordinates: [[49.2827, -123.1207], [50.1163, -122.9574]],
                waypoints: [
                    [49.2827, -123.1207, 'Vancouver', 'Start'],
                    [49.7016, -123.1558, 'Squamish', 'Outdoor hub'],
                    [50.1163, -122.9574, 'Whistler', 'Resort village']
                ],
                tags: ['scenic', 'adventure'],
                description: 'Vancouver to Whistler through fjords, waterfalls, and mountain scenery.',
                tips: 'Winter conditions can be challenging. Sea to Sky Gondola stop recommended.',
                rating: 4.7,
                difficulty: 'easy',
                bestSeason: 'Year-round',
                budget: 'C$200-500',
                mustKnow: ['Sea to Sky Gondola stop essential', 'Shannon Falls easy roadside stop', 'Winter tires required Nov-April', 'Whistler village pedestrian-friendly', 'Brandywine Falls worth the detour'],
                highlights: ['Shannon Falls', 'Sea to Sky Gondola', 'Whistler village', 'Brandywine Falls', 'Garibaldi Lake'],
                costs: { fuel: 'C$30-50', accommodation: 'C$100-300', food: 'C$50-100', total: 'C$200-500' }
            },
            // ==================== 150+ ADDITIONAL ROAD TRIPS (Reddit, guides, travel agencies) ====================
            { id: 'blue_ridge_parkway', name: 'Blue Ridge Parkway', icon: '🇺🇸', country: 'USA', distance: '755 km', duration: '3-5 days', coordinates: [[35.7796, -78.6382], [35.7640, -82.9650]], waypoints: [[35.7796, -78.6382, 'Shenandoah'], [36.5385, -80.7231, 'Mabry Mill'], [35.7640, -82.9650, 'Great Smoky Mountains']], tags: ['scenic', 'historic'], description: 'America\'s favorite drive through the Appalachian Highlands. No commercial traffic.', tips: 'Fall colors peak October. Free to drive.', rating: 4.9, difficulty: 'easy', bestSeason: 'April-November', budget: '$500-1200' },
            { id: 'going_to_the_sun', name: 'Going-to-the-Sun Road', icon: '🇺🇸', country: 'USA', distance: '80 km', duration: '1 day', coordinates: [[48.6962, -113.7180], [48.7596, -113.7870]], waypoints: [[48.6962, -113.7180, 'West Glacier'], [48.7596, -113.7870, 'Logan Pass'], [48.7736, -113.6650, 'St. Mary']], tags: ['scenic', 'epic'], description: 'Glacier National Park\'s iconic alpine road. Open late June–October.', tips: 'Vehicle size limits. Arrive early for parking.', rating: 4.9, difficulty: 'easy', bestSeason: 'July-August', budget: '$100-300' },
            { id: 'overseas_highway', name: 'Overseas Highway (Florida Keys)', icon: '🇺🇸', country: 'USA', distance: '180 km', duration: '2-3 days', coordinates: [[25.7617, -80.1918], [24.5551, -81.7800]], waypoints: [[25.7617, -80.1918, 'Miami'], [24.9243, -80.6281, 'Key Largo'], [24.5551, -81.7800, 'Key West']], tags: ['scenic', 'adventure'], description: 'US-1 across the Florida Keys – bridges over turquoise water.', tips: 'Sunset at Mallory Square. Book Key West ahead.', rating: 4.7, difficulty: 'easy', bestSeason: 'November-April', budget: '$600-1500' },
            { id: 'natchez_trace', name: 'Natchez Trace Parkway', icon: '🇺🇸', country: 'USA', distance: '715 km', duration: '3-4 days', coordinates: [[31.5604, -91.4032], [36.1627, -86.7816]], waypoints: [[31.5604, -91.4032, 'Natchez'], [32.3526, -90.8779, 'Jackson'], [36.1627, -86.7816, 'Nashville']], tags: ['scenic', 'historic'], description: 'Historic route from Mississippi to Tennessee. No trucks, scenic and peaceful.', tips: 'Speed limit 50 mph. Free camping at designated stops.', rating: 4.6, difficulty: 'easy', bestSeason: 'Spring, Fall', budget: '$400-900' },
            { id: 'texas_hill_country', name: 'Texas Hill Country', icon: '🇺🇸', country: 'USA', distance: '400 km', duration: '3-5 days', coordinates: [[29.4241, -98.4936], [30.2672, -97.7431]], waypoints: [[29.4241, -98.4936, 'San Antonio'], [30.0869, -99.1437, 'Fredericksburg'], [30.2672, -97.7431, 'Austin']], tags: ['scenic', 'historic'], description: 'Wine country, wildflowers, and small towns between San Antonio and Austin.', tips: 'Spring for bluebonnets. Wine tastings along the way.', rating: 4.5, difficulty: 'easy', bestSeason: 'March-May, October', budget: '$500-1000' },
            { id: 'oregon_coast', name: 'Oregon Coast Highway', icon: '🇺🇸', country: 'USA', distance: '580 km', duration: '4-6 days', coordinates: [[45.5231, -122.6765], [42.0745, -124.2836]], waypoints: [[45.5231, -122.6765, 'Portland'], [44.6368, -124.0535, 'Newport'], [42.0745, -124.2836, 'Brookings']], tags: ['scenic', 'camping'], description: 'Dramatic Pacific coast, lighthouses, and state parks. Public beach access.', tips: 'Cannon Beach and Haystack Rock. Dunes at Florence.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-October', budget: '$800-1800' },
            { id: 'cascade_loop', name: 'Cascade Loop (Washington)', icon: '🇺🇸', country: 'USA', distance: '660 km', duration: '4-6 days', coordinates: [[47.6062, -122.3321], [48.4284, -121.7640]], waypoints: [[47.6062, -122.3321, 'Seattle'], [47.7511, -120.7401, 'Leavenworth'], [48.4284, -121.7640, 'North Cascades']], tags: ['scenic', 'adventure'], description: 'Mountains, lakes, and Bavarian-style Leavenworth. One of Washington\'s best loops.', tips: 'North Cascades Highway open May–November. Leavenworth for festivals.', rating: 4.7, difficulty: 'easy', bestSeason: 'June-September', budget: '$700-1500' },
            { id: 'alaska_highway', name: 'Alaska Highway', icon: '🇺🇸', country: 'USA', distance: '2232 km', duration: '7-10 days', coordinates: [[53.7267, -127.6476], [64.8378, -147.7164]], waypoints: [[53.7267, -127.6476, 'Dawson Creek'], [60.7212, -135.0568, 'Whitehorse'], [64.8378, -147.7164, 'Fairbanks']], tags: ['adventure', 'epic', 'camping'], description: 'Legendary road from British Columbia to Alaska. Wilderness and wildlife.', tips: 'Fuel up at every opportunity. Summer only. Prepare for gravel sections.', rating: 4.9, difficulty: 'moderate', bestSeason: 'June-August', budget: '$2000-4000' },
            { id: 'maine_coast', name: 'Maine Coast', icon: '🇺🇸', country: 'USA', distance: '350 km', duration: '3-5 days', coordinates: [[43.6591, -70.2568], [44.3876, -68.2042]], waypoints: [[43.6591, -70.2568, 'Portland'], [43.8334, -69.5242, 'Boothbay'], [44.3876, -68.2042, 'Acadia']], tags: ['scenic', 'historic'], description: 'Lighthouses, lobster, and Acadia National Park. Classic New England.', tips: 'Acadia requires vehicle reservation in peak season. Lobster rolls everywhere.', rating: 4.7, difficulty: 'easy', bestSeason: 'June-October', budget: '$600-1400' },
            { id: 'great_river_road', name: 'Great River Road (Mississippi)', icon: '🇺🇸', country: 'USA', distance: '3000 km', duration: '10-14 days', coordinates: [[45.0101, -92.7692], [29.9511, -90.0715]], waypoints: [[45.0101, -92.7692, 'Minnesota'], [41.8781, -87.6298, 'Chicago area'], [29.9511, -90.0715, 'New Orleans']], tags: ['scenic', 'historic'], description: 'Follow the Mississippi River through 10 states. Blues, culture, and scenery.', tips: 'Segment by segment. Louisiana section especially scenic.', rating: 4.6, difficulty: 'easy', bestSeason: 'Spring, Fall', budget: '$1500-3500' },
            { id: 'sedona_monument', name: 'Sedona & Monument Valley Loop', icon: '🇺🇸', country: 'USA', distance: '900 km', duration: '4-6 days', coordinates: [[34.8697, -111.7610], [36.9980, -110.0985]], waypoints: [[34.8697, -111.7610, 'Sedona'], [36.0544, -112.1401, 'Grand Canyon'], [36.9980, -110.0985, 'Monument Valley']], tags: ['scenic', 'adventure'], description: 'Red rocks, canyons, and iconic Western landscapes.', tips: 'Monument Valley tribal park has restricted access. Book jeep tours.', rating: 4.8, difficulty: 'easy', bestSeason: 'March-May, September-November', budget: '$800-1800' },
            { id: 'yellowstone_grand_teton', name: 'Yellowstone & Grand Teton Loop', icon: '🇺🇸', country: 'USA', distance: '500 km', duration: '5-7 days', coordinates: [[44.4280, -110.5885], [43.7904, -110.6818]], waypoints: [[44.4280, -110.5885, 'Yellowstone'], [43.7904, -110.6818, 'Grand Teton'], [43.4666, -110.7844, 'Jackson Hole']], tags: ['scenic', 'adventure', 'wildlife'], description: 'Geysers, bison, and the Tetons. America\'s first national park.', tips: 'Book lodging inside park early. Wildlife jams are real.', rating: 4.9, difficulty: 'easy', bestSeason: 'May-September', budget: '$1000-2500' },
            { id: 'vancouver_island', name: 'Vancouver Island Circle', icon: '🇨🇦', country: 'Canada', distance: '600 km', duration: '5-7 days', coordinates: [[48.4284, -123.3656], [49.6509, -125.0448]], waypoints: [[48.4284, -123.3656, 'Victoria'], [49.6509, -125.0448, 'Port Hardy'], [49.1529, -125.9062, 'Tofino']], tags: ['scenic', 'adventure', 'camping'], description: 'Rainforest, Pacific beaches, and whale watching. Ferry from Vancouver.', tips: 'Book ferry in advance. Tofino for surfing and storms.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-October', budget: 'C$800-1800' },
            { id: 'dempster_highway', name: 'Dempster Highway', icon: '🇨🇦', country: 'Canada', distance: '740 km', duration: '4-5 days', coordinates: [[64.0631, -139.4282], [66.2469, -136.2510]], waypoints: [[64.0631, -139.4282, 'Dawson City'], [66.2469, -136.2510, 'Inuvik']], tags: ['adventure', 'epic', 'fourx4'], description: 'Gravel highway to the Arctic. Tundra, midnight sun, and indigenous culture.', tips: 'Spare tire essential. Fuel in Eagle Plains only. Summer only.', rating: 4.9, difficulty: 'challenging', bestSeason: 'June-August', budget: 'C$1500-3000' },
            { id: 'yucatan_loop', name: 'Yucatán Peninsula Loop', icon: '🇲🇽', country: 'Mexico', distance: '1200 km', duration: '7-10 days', coordinates: [[20.9674, -89.5926], [20.2114, -87.4654]], waypoints: [[20.9674, -89.5926, 'Mérida'], [20.6843, -88.5678, 'Chichén Itzá'], [20.2114, -87.4654, 'Tulum'], [21.1619, -86.8515, 'Cancún']], tags: ['scenic', 'historic', 'adventure'], description: 'Mayan ruins, cenotes, and Caribbean beaches. Very popular route.', tips: 'Cenotes are a must. Avoid peak spring break. Rent car from Mérida or Cancún.', rating: 4.8, difficulty: 'easy', bestSeason: 'November-April', budget: '$800-2000' },
            { id: 'oaxaca_coast', name: 'Oaxaca Coast (Puerto Escondido to Huatulco)', icon: '🇲🇽', country: 'Mexico', distance: '280 km', duration: '3-5 days', coordinates: [[15.8700, -97.0731], [15.7505, -96.1150]], waypoints: [[15.8700, -97.0731, 'Puerto Escondido'], [15.7680, -96.7850, 'Mazunte'], [15.7505, -96.1150, 'Huatulco']], tags: ['scenic', 'adventure'], description: 'Pacific coast, surf towns, and turtle releases. Less touristy than Cancún.', tips: 'Curvy mountain road. Mazunte for laid-back vibe.', rating: 4.6, difficulty: 'moderate', bestSeason: 'November-April', budget: '$400-900' },
            { id: 'carretera_austral', name: 'Carretera Austral (Chile)', icon: '🇨🇱', country: 'Chile', distance: '1240 km', duration: '10-14 days', coordinates: [[-41.4693, -72.9424], [-49.1333, -72.5333]], waypoints: [[-41.4693, -72.9424, 'Puerto Montt'], [-43.6158, -72.9551, 'Chaitén'], [-49.1333, -72.5333, 'Villa O\'Higgins']], tags: ['adventure', 'epic', 'scenic'], description: 'Patagonia\'s iconic gravel road. Fjords, glaciers, and wilderness.', tips: 'Ferry required. Book ahead. Summer only. 4x4 or high clearance recommended.', rating: 4.9, difficulty: 'moderate', bestSeason: 'November-March', budget: '$1500-3500' },
            { id: 'ruta_40_full', name: 'Ruta 40 (Full Argentina)', icon: '🇦🇷', country: 'Argentina', distance: '5000 km', duration: '3-4 weeks', coordinates: [[-34.6037, -58.3816], [-50.3396, -72.2648]], waypoints: [[-34.6037, -58.3816, 'Buenos Aires'], [-41.1335, -71.3103, 'Bariloche'], [-50.3396, -72.2648, 'El Calafate']], tags: ['adventure', 'epic'], description: 'Argentina\'s backbone – from north to Patagonia. Deserts, wine, and glaciers.', tips: 'Segment it. Southern stretch is most dramatic. Fuel and supplies sparse.', rating: 4.8, difficulty: 'moderate', bestSeason: 'October-April', budget: '$2500-5000' },
            { id: 'salar_uyuni', name: 'Salar de Uyuni & Southwest Bolivia', icon: '🇧🇴', country: 'Bolivia', distance: '800 km', duration: '3-4 days', coordinates: [[-20.4596, -66.8250], [-22.4539, -67.7731]], waypoints: [[-20.4596, -66.8250, 'Uyuni'], [-22.4539, -67.7731, 'Salar'], [-21.9932, -67.6190, 'Laguna Colorada']], tags: ['adventure', 'epic', 'scenic'], description: 'World\'s largest salt flat and surreal landscapes. 4x4 tours standard.', tips: 'Altitude sickness possible. Tours from Uyuni or Tupiza. Wet season for mirror effect.', rating: 4.9, difficulty: 'moderate', bestSeason: 'May-November', budget: '$300-600' },
            { id: 'colombia_coffee', name: 'Colombia Coffee Axis (Eje Cafetero)', icon: '🇨🇴', country: 'Colombia', distance: '400 km', duration: '4-6 days', coordinates: [[4.7110, -74.0721], [5.0689, -75.5174]], waypoints: [[4.7110, -74.0721, 'Bogotá'], [4.6372, -75.5700, 'Salento'], [5.0689, -75.5174, 'Manizales']], tags: ['scenic', 'historic'], description: 'Coffee farms, wax palms, and green mountains. UNESCO coffee cultural landscape.', tips: 'Stay on fincas. Valle de Cocora for wax palms.', rating: 4.7, difficulty: 'easy', bestSeason: 'Year-round', budget: '$400-900' },
            { id: 'ecuador_avenue', name: 'Avenue of the Volcanoes (Ecuador)', icon: '🇪🇨', country: 'Ecuador', distance: '350 km', duration: '4-5 days', coordinates: [[-0.1807, -78.4678], [-2.1709, -78.8113]], waypoints: [[-0.1807, -78.4678, 'Quito'], [-0.6734, -78.6478, 'Cotopaxi'], [-2.1709, -78.8113, 'Cuenca']], tags: ['scenic', 'adventure'], description: 'Andean volcanoes and colonial towns. Cotopaxi and Chimborazo.', tips: 'Altitude. Quilotoa loop for hiking. Cuenca is UNESCO.', rating: 4.7, difficulty: 'moderate', bestSeason: 'June-September', budget: '$500-1000' },
            { id: 'causeway_coastal', name: 'Causeway Coastal Route (Northern Ireland)', icon: '🇮🇪', country: 'Ireland', distance: '210 km', duration: '2-3 days', coordinates: [[54.5973, -5.9301], [55.2408, -6.5116]], waypoints: [[54.5973, -5.9301, 'Belfast'], [55.2408, -6.5116, 'Giant\'s Causeway'], [55.2034, -6.5198, 'Carrick-a-Rede']], tags: ['scenic', 'historic'], description: 'Game of Thrones territory – Giant\'s Causeway, Dark Hedges, and coast.', tips: 'Combine with Wild Atlantic Way. Book Giant\'s Causeway parking.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-September', budget: '€300-700' },
            { id: 'ring_of_kerry', name: 'Ring of Kerry', icon: '🇮🇪', country: 'Ireland', distance: '179 km', duration: '1-2 days', coordinates: [[52.2660, -9.6954], [51.8985, -9.5043]], waypoints: [[52.2660, -9.6954, 'Killarney'], [51.8985, -9.5043, 'Kenmare'], [51.9464, -10.2245, 'Slea Head']], tags: ['scenic', 'historic'], description: 'Classic Irish loop – lakes, mountains, and villages. Drive counter-clockwise.', tips: 'Avoid tour buses by starting early. Killarney National Park.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-September', budget: '€200-500' },
            { id: 'isle_of_skyee', name: 'Isle of Skye (Scotland)', icon: '🏴󠁧󠁢󠁳󠁣󠁴󠁿', country: 'Scotland', distance: '200 km', duration: '2-4 days', coordinates: [[57.3275, -6.2510], [57.6984, -6.3551]], waypoints: [[57.3275, -6.2510, 'Portree'], [57.6984, -6.3551, 'Quiraing'], [57.2487, -6.0932, 'Fairy Pools']], tags: ['scenic', 'adventure'], description: 'Dramatic landscapes, fairy pools, and Old Man of Storr. Very popular.', tips: 'Book accommodation months ahead. Midges in summer – bring repellent.', rating: 4.9, difficulty: 'easy', bestSeason: 'May-September', budget: '£400-900' },
            { id: 'lake_district', name: 'Lake District (England)', icon: '🇬🇧', country: 'UK', distance: '150 km', duration: '2-3 days', coordinates: [[54.4609, -3.0886], [54.5260, -3.0214]], waypoints: [[54.4609, -3.0886, 'Windermere'], [54.5260, -3.0214, 'Keswick'], [54.4543, -3.0698, 'Ambleside']], tags: ['scenic', 'historic'], description: 'Poets and lakes – England\'s most beautiful national park.', tips: 'Narrow roads. Park and use buses in peak season.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-October', budget: '£300-700' },
            { id: 'cotswolds', name: 'Cotswolds Loop (England)', icon: '🇬🇧', country: 'UK', distance: '120 km', duration: '2-3 days', coordinates: [[51.7520, -1.2577], [51.7074, -2.3536]], waypoints: [[51.7520, -1.2577, 'Oxford'], [51.7074, -2.3536, 'Bath'], [51.8917, -1.7650, 'Bourton-on-the-Water']], tags: ['scenic', 'historic'], description: 'Honey-stone villages and rolling hills. Quintessential England.', tips: 'Small roads. Castle Combe and Bibury for photos.', rating: 4.6, difficulty: 'easy', bestSeason: 'Spring, Summer', budget: '£400-800' },
            { id: 'wales_coastal', name: 'Wales Coastal Road', icon: '🏴󠁧󠁢󠁷󠁬󠁳󠁿', country: 'Wales', distance: '400 km', duration: '5-7 days', coordinates: [[51.4816, -3.1791], [53.2734, -4.3100]], waypoints: [[51.4816, -3.1791, 'Cardiff'], [52.1307, -4.2687, 'Aberystwyth'], [53.2734, -4.3100, 'Anglesey']], tags: ['scenic', 'historic'], description: 'Castles, beaches, and Welsh culture along the coast.', tips: 'Conwy and Caernarfon castles. Llandudno for Victorian seaside.', rating: 4.5, difficulty: 'easy', bestSeason: 'May-September', budget: '£500-1000' },
            { id: 'cornwall_coast', name: 'Cornwall Coast (England)', icon: '🇬🇧', country: 'UK', distance: '250 km', duration: '3-5 days', coordinates: [[50.2660, -5.0527], [50.6224, -4.5311]], waypoints: [[50.2660, -5.0527, 'Land\'s End'], [50.1184, -5.5376, 'St Ives'], [50.6224, -4.5311, 'Tintagel']], tags: ['scenic', 'historic'], description: 'Dramatic cliffs, surfing, and Arthurian legend. Eden Project and Minack Theatre.', tips: 'Very busy in summer. Book ahead. Pasties!', rating: 4.7, difficulty: 'easy', bestSeason: 'May-September', budget: '£400-900' },
            { id: 'dolomites_loop', name: 'Dolomites Loop (Italy)', icon: '🇮🇹', country: 'Italy', distance: '400 km', duration: '5-7 days', coordinates: [[46.4983, 11.3548], [46.5362, 11.8477]], waypoints: [[46.4983, 11.3548, 'Bolzano'], [46.5362, 11.8477, 'Cortina'], [46.4203, 11.8393, 'Val Gardena']], tags: ['scenic', 'adventure'], description: 'UNESCO mountains, passes, and Ladin culture. Stunning in every season.', tips: 'Great Dolomites Road and Sella Pass. Winter for skiing.', rating: 4.9, difficulty: 'easy', bestSeason: 'June-October', budget: '€800-1800' },
            { id: 'tuscany_rolling', name: 'Tuscany Rolling Hills', icon: '🇮🇹', country: 'Italy', distance: '350 km', duration: '4-6 days', coordinates: [[43.7711, 11.2486], [43.3188, 11.3308]], waypoints: [[43.7711, 11.2486, 'Florence'], [43.3188, 11.3308, 'Siena'], [42.7425, 11.1095, 'Val d\'Orcia']], tags: ['scenic', 'historic'], description: 'Vineyards, cypress lanes, and Renaissance towns. Chianti and San Gimignano.', tips: 'Agriturismo stays. Avoid August heat.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-June, September-October', budget: '€700-1500' },
            { id: 'sicily_coast', name: 'Sicily Coastal Loop', icon: '🇮🇹', country: 'Italy', distance: '900 km', duration: '7-10 days', coordinates: [[38.1157, 13.3615], [37.0755, 15.2866]], waypoints: [[38.1157, 13.3615, 'Palermo'], [37.5024, 14.0629, 'Agrigento'], [37.0755, 15.2866, 'Taormina']], tags: ['scenic', 'historic'], description: 'Greek temples, volcanoes, and Mediterranean food. Etna and Cefalù.', tips: 'Driving can be chaotic. Allow extra time. Arancini and cannoli.', rating: 4.7, difficulty: 'moderate', bestSeason: 'April-June, September-October', budget: '€900-2000' },
            { id: 'provence_lavender', name: 'Provence Lavender & Villages', icon: '🇫🇷', country: 'France', distance: '400 km', duration: '4-6 days', coordinates: [[43.2965, 5.3698], [44.1376, 5.1670]], waypoints: [[43.2965, 5.3698, 'Marseille'], [43.7756, 4.8349, 'Arles'], [44.1376, 5.1670, 'Sault']], tags: ['scenic', 'historic'], description: 'Lavender fields (June–July), Roman ruins, and hill villages.', tips: 'Valensole plateau for lavender. Gordes and Roussillon.', rating: 4.8, difficulty: 'easy', bestSeason: 'June-July for lavender', budget: '€600-1200' },
            { id: 'brittany_coast', name: 'Brittany Coast (France)', icon: '🇫🇷', country: 'France', distance: '500 km', duration: '5-7 days', coordinates: [[48.3905, -4.4860], [48.6362, -2.0752]], waypoints: [[48.3905, -4.4860, 'Brest'], [48.3804, -4.4993, 'Pointe du Raz'], [48.6362, -2.0752, 'Saint-Malo']], tags: ['scenic', 'historic'], description: 'Celtic coast, megaliths, and crepes. Mont-Saint-Michel nearby.', tips: 'Carnac stones. Cider and galettes. Windy and dramatic.', rating: 4.6, difficulty: 'easy', bestSeason: 'May-September', budget: '€600-1300' },
            { id: 'loire_valley', name: 'Loire Valley Châteaux', icon: '🇫🇷', country: 'France', distance: '300 km', duration: '3-5 days', coordinates: [[47.2184, -1.5536], [47.4125, 0.7031]], waypoints: [[47.2184, -1.5536, 'Nantes'], [47.4125, 0.7031, 'Tours'], [47.2159, -0.0611, 'Saumur']], tags: ['scenic', 'historic'], description: 'Castles, wine, and the river Loire. Chambord, Chenonceau, Villandry.', tips: 'Bike paths along the river. Wine tastings. Book châteaux ahead.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-October', budget: '€500-1200' },
            { id: 'black_forest', name: 'Black Forest (Germany)', icon: '🇩🇪', country: 'Germany', distance: '300 km', duration: '3-4 days', coordinates: [[48.7758, 8.1820], [47.8298, 7.9150]], waypoints: [[48.7758, 8.1820, 'Baden-Baden'], [47.8298, 7.9150, 'Freiburg'], [48.4542, 8.2096, 'Triberg']], tags: ['scenic', 'historic'], description: 'Forest, cuckoo clocks, and cake. Titisee and Mummelsee.', tips: 'Schwarzwaldhochstrasse. Christmas markets in winter.', rating: 4.6, difficulty: 'easy', bestSeason: 'May-October', budget: '€400-900' },
            { id: 'croatia_dalmatian', name: 'Dalmatian Coast (Croatia)', icon: '🇭🇷', country: 'Croatia', distance: '600 km', duration: '7-10 days', coordinates: [[42.6507, 18.0944], [43.5081, 16.4402]], waypoints: [[42.6507, 18.0944, 'Dubrovnik'], [43.5081, 16.4402, 'Split'], [44.1149, 15.2282, 'Zadar']], tags: ['scenic', 'historic'], description: 'Adriatic coast, Game of Thrones walls, and islands. Plitvice en route.', tips: 'Dubrovnik very busy. Island hopping by ferry. Book in summer.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-June, September', budget: '€800-1800' },
            { id: 'montenegro_coast', name: 'Montenegro Coast', icon: '🇲🇪', country: 'Montenegro', distance: '200 km', duration: '2-3 days', coordinates: [[42.4304, 18.7061], [42.2784, 18.8394]], waypoints: [[42.4304, 18.7061, 'Kotor'], [42.2784, 18.8394, 'Budva'], [42.7467, 19.3726, 'Durmitor']], tags: ['scenic', 'adventure'], description: 'Bay of Kotor, mountains, and Adriatic. Compact and dramatic.', tips: 'Kotor old town. Lovćen pass. Avoid July-August crowds.', rating: 4.7, difficulty: 'easy', bestSeason: 'May-June, September', budget: '€400-800' },
            { id: 'albania_riviera', name: 'Albanian Riviera', icon: '🇦🇱', country: 'Albania', distance: '250 km', duration: '3-4 days', coordinates: [[41.3275, 19.8187], [39.7823, 19.9554]], waypoints: [[41.3275, 19.8187, 'Tirana'], [40.0691, 19.7360, 'Vlorë'], [39.7823, 19.9554, 'Ksamil']], tags: ['scenic', 'adventure'], description: 'Undiscovered beaches and mountain roads. Great value.', tips: 'Llogara Pass. Himarë for beaches. Roads improving.', rating: 4.5, difficulty: 'moderate', bestSeason: 'May-September', budget: '€300-600' },
            { id: 'slovenia_lakes', name: 'Slovenia Lakes & Alps', icon: '🇸🇮', country: 'Slovenia', distance: '350 km', duration: '4-5 days', coordinates: [[46.0569, 14.5058], [46.3783, 13.8366]], waypoints: [[46.0569, 14.5058, 'Ljubljana'], [46.3783, 13.8366, 'Lake Bled'], [46.4370, 13.7460, 'Triglav']], tags: ['scenic', 'adventure'], description: 'Lake Bled, Triglav National Park, and Julian Alps. Emerald rivers.', tips: 'Bled island. Vintgar Gorge. Soca Valley. Small country, big views.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-October', budget: '€500-1000' },
            { id: 'greece_peloponnese', name: 'Peloponnese (Greece)', icon: '🇬🇷', country: 'Greece', distance: '800 km', duration: '7-10 days', coordinates: [[37.9838, 23.7275], [36.3932, 25.4615]], waypoints: [[37.9838, 23.7275, 'Athens'], [37.6379, 22.3532, 'Olympia'], [36.3932, 25.4615, 'Monemvasia']], tags: ['scenic', 'historic'], description: 'Ancient sites, mountains, and coast. Mycenae, Epidaurus, Nafplio.', tips: 'Spring and fall best. Hot in summer. Stunning beaches.', rating: 4.7, difficulty: 'easy', bestSeason: 'April-June, September-October', budget: '€600-1200' },
            { id: 'norway_atlantic', name: 'Atlantic Ocean Road (Norway)', icon: '🇳🇴', country: 'Norway', distance: '36 km', duration: '1 day', coordinates: [[62.9980, 7.0180], [63.0120, 7.3520]], waypoints: [[62.9980, 7.0180, 'Kristiansund'], [63.0120, 7.3520, 'Molde']], tags: ['scenic', 'epic'], description: 'Iconic bridges and sea spray. One of the world\'s most dramatic short drives.', tips: 'Combine with Trollstigen. Weather can be fierce.', rating: 4.9, difficulty: 'easy', bestSeason: 'May-September', budget: '€100-300' },
            { id: 'iceland_westfjords', name: 'Westfjords (Iceland)', icon: '🇮🇸', country: 'Iceland', distance: '600 km', duration: '4-5 days', coordinates: [[65.6835, -18.0878], [66.0433, -23.5460]], waypoints: [[65.6835, -18.0878, 'Akureyri'], [66.0433, -23.5460, 'Ísafjörður'], [65.7490, -19.6330, 'Hólmavík']], tags: ['scenic', 'adventure'], description: 'Remote fjords, puffins, and hot springs. Less crowded than Ring Road.', tips: 'Gravel sections. Dynjandi waterfall. Summer only for some roads.', rating: 4.8, difficulty: 'moderate', bestSeason: 'June-August', budget: '€800-1500' },
            { id: 'faroe_islands', name: 'Faroe Islands Loop', icon: '🇫🇴', country: 'Denmark', distance: '300 km', duration: '3-4 days', coordinates: [[62.0078, -6.7714], [62.2980, -6.9420]], waypoints: [[62.0078, -6.7714, 'Tórshavn'], [62.2980, -6.9420, 'Gásadalur'], [62.2842, -6.6420, 'Saksun']], tags: ['scenic', 'adventure'], description: 'Dramatic North Atlantic islands. Waterfalls, sheep, and tunnels.', tips: 'Ferry or flight from Iceland/Denmark. Book accommodation early.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-September', budget: '€600-1200' },
            { id: 'mae_hong_son', name: 'Mae Hong Son Loop (Thailand)', icon: '🇹🇭', country: 'Thailand', distance: '600 km', duration: '4-6 days', coordinates: [[18.7883, 98.9853], [19.9167, 99.8265]], waypoints: [[18.7883, 98.9853, 'Chiang Mai'], [19.9167, 99.8265, 'Mae Hong Son'], [19.3032, 97.9694, 'Pai']], tags: ['scenic', 'adventure'], description: 'Mountains, tribes, and 1864 curves. Classic Northern Thailand loop.', tips: 'Rent motorbike or car. Pai is backpacker hub. Cool season best.', rating: 4.8, difficulty: 'moderate', bestSeason: 'November-February', budget: '$300-700' },
            { id: 'ha_giang_loop', name: 'Hà Giang Loop (Vietnam)', icon: '🇻🇳', country: 'Vietnam', distance: '350 km', duration: '3-4 days', coordinates: [[22.8235, 104.9839], [23.3920, 105.3310]], waypoints: [[22.8235, 104.9839, 'Hà Giang'], [23.3920, 105.3310, 'Dong Van'], [22.7500, 104.9839, 'Meo Vac']], tags: ['scenic', 'adventure'], description: 'Northern Vietnam\'s most spectacular ride. Karst peaks and ethnic villages.', tips: 'Motorbike essential. Permit required. Homestays.', rating: 4.9, difficulty: 'challenging', bestSeason: 'September-November', budget: '$200-500' },
            { id: 'kerala_backwaters', name: 'Kerala Backwaters & Coast (India)', icon: '🇮🇳', country: 'India', distance: '500 km', duration: '5-7 days', coordinates: [[10.0168, 76.3429], [8.5241, 76.9366]], waypoints: [[10.0168, 76.3429, 'Kochi'], [9.4981, 76.3388, 'Alleppey'], [8.5241, 76.9366, 'Kovalam']], tags: ['scenic', 'historic'], description: 'Houseboats, tea hills, and Arabian Sea. Spice plantations and yoga.', tips: 'Houseboat in Alleppey. Munnar for tea. Traffic chaotic.', rating: 4.7, difficulty: 'moderate', bestSeason: 'November-March', budget: '$400-900' },
            { id: 'ladakh_leh', name: 'Leh–Ladakh (India)', icon: '🇮🇳', country: 'India', distance: '800 km', duration: '7-10 days', coordinates: [[34.1526, 77.5771], [34.2098, 78.1980]], waypoints: [[34.1526, 77.5771, 'Leh'], [34.2098, 78.1980, 'Nubra Valley'], [33.7782, 78.7939, 'Pangong Lake']], tags: ['adventure', 'epic'], description: 'High-altitude desert, monasteries, and Himalayan passes. Permit required.', tips: 'Acclimatize in Leh. Inner Line Permit. May–September only.', rating: 4.9, difficulty: 'challenging', bestSeason: 'June-September', budget: '$600-1200' },
            { id: 'sri_lanka_central', name: 'Sri Lanka Central Highlands', icon: '🇱🇰', country: 'Sri Lanka', distance: '400 km', duration: '4-5 days', coordinates: [[6.9271, 79.8612], [6.9497, 80.7891]], waypoints: [[6.9271, 79.8612, 'Colombo'], [6.9497, 80.7891, 'Kandy'], [6.8531, 80.6302, 'Nuwara Eliya']], tags: ['scenic', 'historic'], description: 'Tea country, temples, and train rides. Sigiriya and Ella.', tips: 'Train Kandy–Ella is iconic. Book 2nd class. Leopards in Yala.', rating: 4.7, difficulty: 'easy', bestSeason: 'December-March', budget: '$300-700' },
            { id: 'jordan_wadi_rum', name: 'Jordan Desert & Petra', icon: '🇯🇴', country: 'Jordan', distance: '600 km', duration: '5-7 days', coordinates: [[31.9454, 35.9284], [29.5577, 35.0061]], waypoints: [[31.9454, 35.9284, 'Amman'], [30.3285, 35.4444, 'Petra'], [29.5577, 35.0061, 'Wadi Rum']], tags: ['scenic', 'historic', 'adventure'], description: 'Petra, Wadi Rum, and Dead Sea. Safe and spectacular.', tips: 'Jordan Pass for visa and sites. Wadi Rum jeep tour. Float in Dead Sea.', rating: 4.9, difficulty: 'easy', bestSeason: 'March-May, October-November', budget: '$800-1800' },
            { id: 'oman_mountains', name: 'Oman Mountains & Wadis', icon: '🇴🇲', country: 'Oman', distance: '800 km', duration: '5-7 days', coordinates: [[23.5880, 58.3829], [22.9333, 59.1167]], waypoints: [[23.5880, 58.3829, 'Muscat'], [22.9333, 59.1167, 'Nizwa'], [23.2474, 57.2990, 'Jebel Shams']], tags: ['adventure', 'scenic'], description: 'Forts, wadis, and desert. Safe and welcoming. 4x4 for some areas.', tips: 'Wadi Shab and Bimmah sinkhole. Nizwa souq Friday. Respect dress code.', rating: 4.7, difficulty: 'moderate', bestSeason: 'October-April', budget: '$700-1500' },
            { id: 'kyrgyzstan_pamir', name: 'Kyrgyzstan Pamir Highway (segment)', icon: '🇰🇬', country: 'Kyrgyzstan', distance: '500 km', duration: '5-7 days', coordinates: [[41.2044, 74.7661], [40.5156, 72.7939]], waypoints: [[41.2044, 74.7661, 'Osh'], [40.5156, 72.7939, 'Sary-Tash'], [39.4667, 72.8833, 'Lake Karakul']], tags: ['adventure', 'epic'], description: 'High-altitude Silk Road. Yurts and nomads. Part of the classic Pamir route.', tips: 'Permits. 4x4 or tour. Summer only. Basic facilities.', rating: 4.8, difficulty: 'challenging', bestSeason: 'June-September', budget: '$800-1500' },
            { id: 'georgia_military', name: 'Georgian Military Highway', icon: '🇬🇪', country: 'Georgia', distance: '220 km', duration: '2-3 days', coordinates: [[41.7151, 44.8271], [42.6525, 44.6453]], waypoints: [[41.7151, 44.8271, 'Tbilisi'], [42.6525, 44.6453, 'Stepantsminda'], [42.6617, 44.6431, 'Kazbegi']], tags: ['scenic', 'adventure'], description: 'Caucasus mountains and Gergeti Trinity. Stunning high road.', tips: 'Border with Russia at top. Check visa. 4x4 to church optional.', rating: 4.8, difficulty: 'moderate', bestSeason: 'May-October', budget: '$200-500' },
            { id: 'kenya_safari', name: 'Kenya Safari Circuit', icon: '🇰🇪', country: 'Kenya', distance: '1200 km', duration: '7-10 days', coordinates: [[-1.2921, 36.8219], [-1.5000, 35.2667]], waypoints: [[-1.2921, 36.8219, 'Nairobi'], [-1.5000, 35.2667, 'Masai Mara'], [-2.3333, 34.8333, 'Serengeti border']], tags: ['adventure', 'wildlife'], description: 'Masai Mara, Amboseli, and Lake Nakuru. Classic safari country.', tips: 'Safari vehicle or tour. Great migration July–October. Book lodges early.', rating: 4.9, difficulty: 'moderate', bestSeason: 'July-October', budget: '$2000-5000' },
            { id: 'uganda_gorillas', name: 'Uganda Gorillas & Wildlife', icon: '🇺🇬', country: 'Uganda', distance: '800 km', duration: '7-9 days', coordinates: [[0.3476, 32.5825], [-1.2921, 29.5730]], waypoints: [[0.3476, 32.5825, 'Kampala'], [-1.2921, 29.5730, 'Bwindi'], [-0.3716, 29.7417, 'Queen Elizabeth']], tags: ['adventure', 'wildlife'], description: 'Mountain gorilla trekking and savanna game drives. Permit required.', tips: 'Gorilla permit $700 – book months ahead. 4x4 recommended.', rating: 4.9, difficulty: 'moderate', bestSeason: 'June-September, December-February', budget: '$2500-4500' },
            { id: 'tunisia_sahara', name: 'Tunisia Sahara & Coast', icon: '🇹🇳', country: 'Tunisia', distance: '800 km', duration: '5-7 days', coordinates: [[36.8065, 10.1815], [33.8065, 10.9815]], waypoints: [[36.8065, 10.1815, 'Tunis'], [34.0000, 9.5000, 'Douz'], [33.8065, 10.9815, 'Matmata']], tags: ['scenic', 'historic', 'adventure'], description: 'Star Wars sets, desert, and Roman ruins. Good value.', tips: 'Chott el Jerid. Ksar Ouled Soltane. Check travel advice.', rating: 4.5, difficulty: 'easy', bestSeason: 'March-May, October-November', budget: '€400-900' },
            { id: 'lesotho_sani', name: 'Sani Pass (South Africa–Lesotho)', icon: '🇱🇸', country: 'Lesotho', distance: '200 km', duration: '2-3 days', coordinates: [[-29.6100, 29.3900], [-29.5850, 29.2920]], waypoints: [[-29.6100, 29.3900, 'Underberg'], [-29.5850, 29.2920, 'Sani Pass'], [-29.3636, 29.0372, 'Mokhotlong']], tags: ['adventure', 'fourx4'], description: 'Steep gravel pass into the Kingdom in the Sky. 4x4 only.', tips: 'Highest pub in Africa at top. Border formalities. Weather can close road.', rating: 4.7, difficulty: 'challenging', bestSeason: 'April-October', budget: '$200-500' },
            { id: 'red_centre', name: 'Australian Red Centre', icon: '🇦🇺', country: 'Australia', distance: '1200 km', duration: '5-7 days', coordinates: [[-23.6980, 133.8807], [-25.3444, 131.0369]], waypoints: [[-23.6980, 133.8807, 'Alice Springs'], [-25.3444, 131.0369, 'Uluru'], [-23.6980, 132.5556, 'Kings Canyon']], tags: ['scenic', 'adventure'], description: 'Uluru, Kata Tjuta, and outback. Iconic Australian interior.', tips: 'Sunrise/sunset at Uluru. Desert park pass. Fly or drive from Alice.', rating: 4.9, difficulty: 'easy', bestSeason: 'April-October', budget: 'A$1200-2500' },
            { id: 'kimberley', name: 'Kimberley (Australia)', icon: '🇦🇺', country: 'Australia', distance: '2000 km', duration: '10-14 days', coordinates: [[-17.9614, 122.2352], [-15.7785, 128.7375]], waypoints: [[-17.9614, 122.2352, 'Broome'], [-15.7785, 128.7375, 'Kununurra'], [-17.3114, 123.6342, 'Fitzroy Crossing']], tags: ['adventure', 'fourx4', 'epic'], description: 'Remote outback, gorges, and indigenous culture. 4x4 and planning essential.', tips: 'Dry season only. Fuel and supplies limited. Gibb River Road classic.', rating: 4.8, difficulty: 'challenging', bestSeason: 'May-October', budget: 'A$3000-6000' },
            { id: 'new_zealand_central', name: 'Central North Island (New Zealand)', icon: '🇳🇿', country: 'New Zealand', distance: '600 km', duration: '4-5 days', coordinates: [[-36.8485, 174.7633], [-38.6857, 176.0702]], waypoints: [[-36.8485, 174.7633, 'Auckland'], [-38.6857, 176.0702, 'Rotorua'], [-39.2927, 175.5673, 'Tongariro']], tags: ['scenic', 'adventure'], description: 'Volcanoes, geothermal, and Maori culture. Hobbiton and Lake Taupo.', tips: 'Tongariro Alpine Crossing – book shuttle. Rotorua for geothermal.', rating: 4.7, difficulty: 'easy', bestSeason: 'October-April', budget: 'NZ$600-1200' },
            // —— More USA & Canada (Reddit, Outside, Nat Geo, Rough Guides) ——
            { id: 'blue_ridge_parkway', name: 'Blue Ridge Parkway (USA)', icon: '🇺🇸', country: 'USA', distance: '755 km', duration: '3-5 days', coordinates: [[36.4317, -80.4690], [35.5951, -82.5515]], waypoints: [[36.4317, -80.4690, 'Shenandoah NP'], [36.5951, -81.5515, 'Roanoke'], [35.5951, -82.5515, 'Great Smoky Mountains']], tags: ['scenic', 'historic'], description: 'America\'s favorite drive. Virginia to North Carolina, fall foliage and mountain views.', tips: 'Fall colors peak Oct. Speed limit 45 mph. Many overlooks.', rating: 4.9, difficulty: 'easy', bestSeason: 'October for foliage', budget: '$400-900' },
            { id: 'pch_california', name: 'Pacific Coast Highway (California)', icon: '🇺🇸', country: 'USA', distance: '900 km', duration: '5-7 days', coordinates: [[37.7749, -122.4194], [34.0195, -118.4912]], waypoints: [[37.7749, -122.4194, 'San Francisco'], [36.6002, -121.8947, 'Monterey'], [34.4194, -119.6982, 'Santa Barbara'], [34.0195, -118.4912, 'Los Angeles']], tags: ['scenic', 'epic'], description: 'Big Sur, cliffs, and Pacific sunsets. One of the world\'s great drives.', tips: 'Check for road closures. Book Big Sur lodges ahead. Spring or fall.', rating: 4.9, difficulty: 'easy', bestSeason: 'April-October', budget: '$1200-2500' },
            { id: 'florida_keys', name: 'Florida Keys Overseas Highway', icon: '🇺🇸', country: 'USA', distance: '260 km', duration: '2-3 days', coordinates: [[25.7617, -80.1918], [24.5551, -81.7800]], waypoints: [[25.7617, -80.1918, 'Miami'], [24.7285, -81.0226, 'Key Largo'], [24.5551, -81.7800, 'Key West']], tags: ['scenic', 'adventure'], description: 'Ocean on both sides, bridges, and Key West vibes.', tips: 'Sunset at Mallory Square. Snorkel at John Pennekamp. Book early in winter.', rating: 4.7, difficulty: 'easy', bestSeason: 'November-April', budget: '$500-1200' },
            { id: 'columbia_river_gorge', name: 'Columbia River Gorge (USA)', icon: '🇺🇸', country: 'USA', distance: '200 km', duration: '1-2 days', coordinates: [[45.5152, -122.6784], [45.7252, -121.5350]], waypoints: [[45.5152, -122.6784, 'Portland'], [45.5946, -122.0714, 'Multnomah Falls'], [45.7252, -121.5350, 'Hood River']], tags: ['scenic', 'historic'], description: 'Waterfalls, windsurfing, and vineyards. Historic Highway 30.', tips: 'Multnomah Falls early to avoid crowds. Hood River for beer and kites.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-October', budget: '$200-500' },
            { id: 'san_juan_skyway', name: 'San Juan Skyway (Colorado)', icon: '🇺🇸', country: 'USA', distance: '380 km', duration: '2-3 days', coordinates: [[37.2753, -107.8801], [37.7510, -107.8235]], waypoints: [[37.2753, -107.8801, 'Durango'], [37.7510, -107.8235, 'Ouray'], [37.9400, -107.8136, 'Telluride']], tags: ['scenic', 'adventure'], description: 'Million Dollar Highway, alpine towns, and San Juan Mountains.', tips: 'Ouray to Silverton is stunning. 4x4 optional for passes. Summer best.', rating: 4.8, difficulty: 'moderate', bestSeason: 'June-September', budget: '$500-1000' },
            { id: 'highway_61_usa', name: 'Highway 61 (Minnesota to Louisiana)', icon: '🇺🇸', country: 'USA', distance: '2400 km', duration: '1-2 weeks', coordinates: [[44.9537, -93.0900], [29.9511, -90.0715]], waypoints: [[44.9537, -93.0900, 'Minneapolis'], [41.8781, -87.6298, 'Chicago'], [35.1495, -90.0490, 'Memphis'], [29.9511, -90.0715, 'New Orleans']], tags: ['scenic', 'historic'], description: 'Blues Highway. Music history, Mississippi River, and Southern culture.', tips: 'Clarksdale for blues. Graceland in Memphis. Spring or fall.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-May, September-October', budget: '$1500-3000' },
            { id: 'utah_mighty_five', name: 'Utah Mighty 5 National Parks', icon: '🇺🇸', country: 'USA', distance: '600 km', duration: '5-7 days', coordinates: [[37.0965, -113.5684], [38.5733, -109.5498]], waypoints: [[37.0965, -113.5684, 'Zion'], [37.6283, -112.1677, 'Bryce Canyon'], [38.2000, -111.1700, 'Capitol Reef'], [38.5733, -109.5498, 'Arches'], [38.2000, -109.8000, 'Canyonlands']], tags: ['scenic', 'adventure', 'epic'], description: 'Zion, Bryce, Capitol Reef, Arches, Canyonlands. Red rock wonderland.', tips: 'Reserve Arches timed entry. Spring or fall. Moab for base.', rating: 4.9, difficulty: 'easy', bestSeason: 'April-May, September-October', budget: '$800-1800' },
            { id: 'oregon_coast', name: 'Oregon Coast Highway 101', icon: '🇺🇸', country: 'USA', distance: '580 km', duration: '4-5 days', coordinates: [[45.5231, -122.6765], [42.0740, -124.2584]], waypoints: [[45.5231, -122.6765, 'Portland'], [45.8973, -123.9654, 'Cannon Beach'], [44.6368, -124.0535, 'Newport'], [42.0740, -124.2584, 'Brookings']], tags: ['scenic', 'adventure'], description: 'Sea stacks, lighthouses, and wild beaches. No billboards, pure coast.', tips: 'Cannon Beach for Haystack Rock. Dunes near Florence. Year-round.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-September', budget: '$600-1200' },
            { id: 'alaska_highway', name: 'Alaska Highway (USA/Canada)', icon: '🇺🇸', country: 'USA', distance: '2230 km', duration: '7-10 days', coordinates: [[53.5461, -113.4938], [64.8378, -147.7164]], waypoints: [[53.5461, -113.4938, 'Dawson Creek'], [60.7212, -135.0568, 'Whitehorse'], [64.8378, -147.7164, 'Fairbanks']], tags: ['adventure', 'epic'], description: 'Dawson Creek to Delta Junction. Wilderness, wildlife, and midnight sun.', tips: 'Summer only. Fuel and supplies spaced out. Mosquito repellent.', rating: 4.8, difficulty: 'moderate', bestSeason: 'June-August', budget: '$2000-4000' },
            { id: 'going_to_the_sun', name: 'Going-to-the-Sun Road (Glacier NP)', icon: '🇺🇸', country: 'USA', distance: '80 km', duration: '1 day', coordinates: [[48.7596, -113.7870], [48.6961, -113.7185]], waypoints: [[48.7596, -113.7870, 'West Glacier'], [48.6961, -113.7185, 'St. Mary']], tags: ['scenic', 'epic'], description: 'Glacier National Park. Alpine road, big horns, and Logan Pass.', tips: 'Vehicle reservation required in summer. Open roughly June–October.', rating: 4.9, difficulty: 'easy', bestSeason: 'July-August', budget: '$200-500' },
            { id: 'cabot_trail', name: 'Cabot Trail (Canada)', icon: '🇨🇦', country: 'Canada', distance: '298 km', duration: '2-3 days', coordinates: [[46.2382, -60.2566], [46.6919, -60.3819]], waypoints: [[46.2382, -60.2566, 'Baddeck'], [46.6919, -60.3819, 'Chéticamp'], [46.7167, -60.3000, 'Cape Breton Highlands']], tags: ['scenic', 'adventure'], description: 'Nova Scotia\'s Cape Breton. Cliffs, whales, and Celtic culture.', tips: 'Counter-clockwise for best views. Fall foliage spectacular.', rating: 4.9, difficulty: 'easy', bestSeason: 'June-October', budget: 'C$400-900' },
            { id: 'dempster_highway', name: 'Dempster Highway to Arctic Ocean', icon: '🇨🇦', country: 'Canada', distance: '740 km', duration: '4-5 days', coordinates: [[64.0601, -139.4330], [69.4544, -133.0296]], waypoints: [[64.0601, -139.4330, 'Dawson City'], [66.5647, -136.2036, 'Eagle Plains'], [69.4544, -133.0296, 'Inuvik / Tuktoyaktuk']], tags: ['adventure', 'epic', 'fourx4'], description: 'Gravel road to the Arctic. Tundra, midnight sun, and Inuvik.', tips: 'Spare tire, fuel plan. Summer only. Ferry at Peel River check times.', rating: 4.9, difficulty: 'challenging', bestSeason: 'June-August', budget: 'C$1500-3000' },
            { id: 'icefields_parkway', name: 'Icefields Parkway (Canada)', icon: '🇨🇦', country: 'Canada', distance: '232 km', duration: '1-2 days', coordinates: [[51.1784, -115.5708], [52.2203, -117.2237]], waypoints: [[51.1784, -115.5708, 'Lake Louise'], [52.2203, -117.2237, 'Jasper']], tags: ['scenic', 'epic'], description: 'Banff to Jasper. Glaciers, lakes, and wildlife. One of the world\'s top drives.', tips: 'Columbia Icefield tour. Book lodging early. Summer or early fall.', rating: 4.9, difficulty: 'easy', bestSeason: 'June-September', budget: 'C$300-700' },
            { id: 'sea_to_sky', name: 'Sea to Sky Highway (British Columbia)', icon: '🇨🇦', country: 'Canada', distance: '160 km', duration: '1-2 days', coordinates: [[49.2827, -123.1207], [50.1163, -122.9574]], waypoints: [[49.2827, -123.1207, 'Vancouver'], [49.7763, -123.1550, 'Squamish'], [50.1163, -122.9574, 'Whistler']], tags: ['scenic', 'adventure'], description: 'Vancouver to Whistler. Fjords, waterfalls, and skiing.', tips: 'Shannon Falls, Sea to Sky Gondola. Winter for skiing.', rating: 4.8, difficulty: 'easy', bestSeason: 'Year-round', budget: 'C$200-600' },
            { id: 'baja_california', name: 'Baja California (Mexico)', icon: '🇲🇽', country: 'Mexico', distance: '1700 km', duration: '10-14 days', coordinates: [[32.5149, -117.0382], [22.8905, -109.9167]], waypoints: [[32.5149, -117.0382, 'Tijuana'], [31.8689, -116.5964, 'Ensenada'], [26.0118, -111.3487, 'Loreto'], [22.8905, -109.9167, 'Cabo San Lucas']], tags: ['scenic', 'adventure'], description: 'Pacific to Sea of Cortez. Desert, whales, and beach towns.', tips: 'Whale season Jan–Mar. Bring spare tire. Toll and free roads.', rating: 4.8, difficulty: 'moderate', bestSeason: 'November-April', budget: '$800-2000' },
            { id: 'yucatan_loop', name: 'Yucatán Peninsula Loop (Mexico)', icon: '🇲🇽', country: 'Mexico', distance: '1200 km', duration: '7-10 days', coordinates: [[20.9674, -89.5926], [21.1619, -86.8515]], waypoints: [[20.9674, -89.5926, 'Mérida'], [20.6843, -88.5678, 'Chichén Itzá'], [21.1619, -86.8515, 'Cancún'], [19.4326, -99.1332, 'Tulum']], tags: ['scenic', 'historic'], description: 'Cenotes, Mayan ruins, and Caribbean coast. Safe and rewarding.', tips: 'Rent car. Cenotes near Valladolid. Avoid hurricane season.', rating: 4.8, difficulty: 'easy', bestSeason: 'November-April', budget: '$700-1500' },
            { id: 'copper_canyon', name: 'Copper Canyon (Mexico)', icon: '🇲🇽', country: 'Mexico', distance: '600 km', duration: '4-6 days', coordinates: [[28.7024, -105.9641], [27.5167, -107.7667]], waypoints: [[28.7024, -105.9641, 'Chihuahua'], [27.5167, -107.7667, 'Creel'], [27.0333, -108.0167, 'Divisadero']], tags: ['scenic', 'adventure'], description: 'Larger than Grand Canyon. Train option, Tarahumara culture.', tips: 'Chepe train or drive. Creel as base. Spring or fall.', rating: 4.7, difficulty: 'moderate', bestSeason: 'October-April', budget: '$600-1200' },
            // —— South America (Lonely Planet, Nat Geo, Rough Guides) ——
            { id: 'ruta_40_argentina', name: 'Ruta 40 (Argentina)', icon: '🇦🇷', country: 'Argentina', distance: '5000 km', duration: '3-4 weeks', coordinates: [[-34.6037, -58.3816], [-50.3392, -72.2658]], waypoints: [[-34.6037, -58.3816, 'Buenos Aires'], [-41.1335, -71.3103, 'Bariloche'], [-50.3392, -72.2658, 'El Calafate']], tags: ['epic', 'adventure', 'scenic'], description: 'Legendary spine of Argentina. Patagonia, vineyards, and Andes.', tips: 'Do full route or Patagonia segment. Spring or fall. Fuel stops planned.', rating: 4.9, difficulty: 'moderate', bestSeason: 'October-April', budget: '$2000-5000' },
            { id: 'trans_andean_chile_argentina', name: 'Trans-Andean Highway (Chile–Argentina)', icon: '🇨🇱', country: 'Chile', distance: '320 km', duration: '1-2 days', coordinates: [[-33.4489, -70.6693], [-32.8895, -68.8458]], waypoints: [[-33.4489, -70.6693, 'Santiago'], [-32.8895, -68.8458, 'Mendoza']], tags: ['scenic', 'adventure'], description: '29 hairpin turns, 11,500 ft. Wine and mountain views.', tips: 'Check border and road status. Winter can close pass.', rating: 4.8, difficulty: 'moderate', bestSeason: 'November-March', budget: '$200-500' },
            { id: 'death_road_bolivia', name: 'North Yungas Death Road (Bolivia)', icon: '🇧🇴', country: 'Bolivia', distance: '65 km', duration: '1 day', coordinates: [[-16.5000, -68.1500], [-15.9500, -67.4500]], waypoints: [[-16.5000, -68.1500, 'La Paz'], [-15.9500, -67.4500, 'Coroico']], tags: ['adventure', 'epic'], description: 'Cliff-edge road, now mostly for biking. Epic descent.', tips: 'Often done by bike tour. Rainy season risky. Acclimatize in La Paz.', rating: 4.7, difficulty: 'challenging', bestSeason: 'May-September', budget: '$50-150' },
            { id: 'salar_uyuni', name: 'Salar de Uyuni (Bolivia)', icon: '🇧🇴', country: 'Bolivia', distance: '500 km', duration: '3-4 days', coordinates: [[-19.0196, -65.2619], [-20.4597, -67.6382]], waypoints: [[-19.0196, -65.2619, 'Uyuni'], [-20.4597, -67.6382, 'Salar'], [-22.8333, -67.7833, 'Laguna Colorada']], tags: ['scenic', 'adventure', 'epic'], description: 'Salt flats, colored lagoons, and high-altitude desert. 4x4 tours.', tips: 'Wet season for mirror effect. Tour or 4x4. Acclimatize.', rating: 4.9, difficulty: 'moderate', bestSeason: 'December-April (mirror), May-November (dry)', budget: '$300-700' },
            { id: 'carretera_austral_chile', name: 'Carretera Austral (Chile)', icon: '🇨🇱', country: 'Chile', distance: '1240 km', duration: '10-14 days', coordinates: [[-41.4693, -72.9444], [-43.6158, -72.9551]], waypoints: [[-41.4693, -72.9444, 'Puerto Montt'], [-43.6158, -72.9551, 'Villa O\'Higgins']], tags: ['scenic', 'adventure', 'epic'], description: 'Patagonian wilderness. Fjords, glaciers, and gravel.', tips: 'Ferries required. Gravel, spare tire. Summer only for full route.', rating: 4.9, difficulty: 'moderate', bestSeason: 'November-March', budget: '$1500-3500' },
            { id: 'patagonia_argentina_chile', name: 'Patagonia Loop (Argentina & Chile)', icon: '🇦🇷', country: 'Argentina', distance: '1500 km', duration: '10-14 days', coordinates: [[-41.1335, -71.3103], [-50.3392, -72.2658]], waypoints: [[-41.1335, -71.3103, 'Bariloche'], [-50.3392, -72.2658, 'El Calafate'], [-51.6230, -69.2168, 'Ushuaia']], tags: ['scenic', 'epic', 'adventure'], description: 'Glaciers, Torres del Paine, and end of the world.', tips: 'Book Perito Moreno and Torres early. Cross into Chile for Paine.', rating: 4.9, difficulty: 'moderate', bestSeason: 'November-March', budget: '$2500-5000' },
            { id: 'ecuador_avenue_volcanoes', name: 'Avenue of the Volcanoes (Ecuador)', icon: '🇪🇨', country: 'Ecuador', distance: '400 km', duration: '4-5 days', coordinates: [[-0.1807, -78.4678], [-2.1700, -78.8300]], waypoints: [[-0.1807, -78.4678, 'Quito'], [-0.2198, -78.5121, 'Cotopaxi'], [-2.1700, -78.8300, 'Cuenca']], tags: ['scenic', 'adventure'], description: 'Andean volcanoes, indigenous markets, and highland towns.', tips: 'Acclimatize in Quito. Cotopaxi and Chimborazo. Spring or fall.', rating: 4.7, difficulty: 'moderate', bestSeason: 'June-September', budget: '$400-900' },
            { id: 'peru_coast_north', name: 'Peru North Coast & Andes', icon: '🇵🇪', country: 'Peru', distance: '1200 km', duration: '7-10 days', coordinates: [[-12.0464, -77.0428], [-6.7714, -79.8410]], waypoints: [[-12.0464, -77.0428, 'Lima'], [-8.1116, -79.0286, 'Trujillo'], [-6.7714, -79.8410, 'Chiclayo']], tags: ['scenic', 'historic'], description: 'Chan Chan, Moche sites, and desert coast. Less crowded than south.', tips: 'Combine with Huaraz or Amazon. Year-round possible.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-October', budget: '$600-1200' },
            { id: 'colombia_coffee_axis', name: 'Colombia Coffee Axis (Eje Cafetero)', icon: '🇨🇴', country: 'Colombia', distance: '400 km', duration: '4-5 days', coordinates: [[4.7110, -74.0721], [5.0689, -75.5174]], waypoints: [[4.7110, -74.0721, 'Bogotá'], [5.0689, -75.5174, 'Manizales'], [4.6370, -75.5707, 'Salento']], tags: ['scenic', 'historic'], description: 'Coffee fincas, wax palms, and green hills. UNESCO landscape.', tips: 'Salento and Valle de Cocora. Stay on fincas. Year-round.', rating: 4.8, difficulty: 'easy', bestSeason: 'December-March', budget: '$400-800' },
            { id: 'brasilia_amazon_access', name: 'Brasília to Amazon (Brazil)', icon: '🇧🇷', country: 'Brazil', distance: '2000 km', duration: '5-7 days', coordinates: [[-15.7939, -47.8828], [-3.1190, -60.0217]], waypoints: [[-15.7939, -47.8828, 'Brasília'], [-3.1190, -60.0217, 'Manaus']], tags: ['adventure', 'epic'], description: 'Capital to rainforest. Savanna to jungle.', tips: 'Long drive or fly one way. Manaus for Amazon boats.', rating: 4.5, difficulty: 'moderate', bestSeason: 'June-October', budget: '$800-2000' },
            // —— Europe (Lonely Planet, Rough Guides, Nat Geo) ——
            { id: 'grossglockner_austria', name: 'Grossglockner High Alpine Road (Austria)', icon: '🇦🇹', country: 'Austria', distance: '48 km', duration: '1 day', coordinates: [[47.2692, 13.0481], [47.0744, 12.6936]], waypoints: [[47.2692, 13.0481, 'Bruck'], [47.0744, 12.6936, 'Heiligenblut']], tags: ['scenic', 'epic'], description: 'Alpine hairpins and Austria\'s highest peak. Toll road.', tips: 'Open May–November. Early morning for fewer cars.', rating: 4.9, difficulty: 'easy', bestSeason: 'June-September', budget: '€50-150' },
            { id: 'atlantic_highway_england', name: 'Atlantic Highway (England)', icon: '🇬🇧', country: 'UK', distance: '270 km', duration: '2-3 days', coordinates: [[50.7184, -3.5339], [51.0830, -4.0490]], waypoints: [[50.7184, -3.5339, 'Exeter'], [51.0830, -4.0490, 'Bude'], [50.8283, -4.5445, 'Newquay']], tags: ['scenic', 'historic'], description: 'Cornwall and Devon. Beaches, cliffs, and villages.', tips: 'Summer busy. Tintagel, Padstow. Cream teas.', rating: 4.7, difficulty: 'easy', bestSeason: 'May-September', budget: '£300-700' },
            { id: 'basque_circuit_spain', name: 'Basque Circuit (Spain)', icon: '🇪🇸', country: 'Spain', distance: '400 km', duration: '4-5 days', coordinates: [[43.2630, -2.9350], [42.8125, -1.6458]], waypoints: [[43.2630, -2.9350, 'Bilbao'], [43.3183, -1.9812, 'San Sebastián'], [42.8125, -1.6458, 'Pamplona']], tags: ['scenic', 'historic'], description: 'Bilbao, San Sebastián, pintxos, and Pyrenees.', tips: 'Food focus. Guggenheim. Book restaurants.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-October', budget: '€600-1200' },
            { id: 'paris_berlin', name: 'Paris to Berlin', icon: '🇫🇷', country: 'France', distance: '1050 km', duration: '5-7 days', coordinates: [[48.8566, 2.3522], [52.5200, 13.4050]], waypoints: [[48.8566, 2.3522, 'Paris'], [50.8503, 4.3517, 'Brussels'], [52.3676, 4.9041, 'Amsterdam'], [52.5200, 13.4050, 'Berlin']], tags: ['scenic', 'historic'], description: 'Capitals and culture. Optional Belgium/Netherlands detour.', tips: 'Highways or scenic. Book Berlin ahead.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-October', budget: '€800-1800' },
            { id: 'london_edinburgh', name: 'London to Edinburgh', icon: '🇬🇧', country: 'UK', distance: '650 km', duration: '3-5 days', coordinates: [[51.5074, -0.1278], [55.9533, -3.1883]], waypoints: [[51.5074, -0.1278, 'London'], [52.4862, -1.8904, 'Birmingham'], [53.4808, -2.2426, 'Manchester'], [55.9533, -3.1883, 'Edinburgh']], tags: ['scenic', 'historic'], description: 'Cathedrals, Peak District, and Scottish capital.', tips: 'M1/A1 or scenic via Yorkshire. Book Edinburgh in summer.', rating: 4.6, difficulty: 'easy', bestSeason: 'May-September', budget: '£400-900' },
            { id: 'germany_alpine_road', name: 'German Alpine Road', icon: '🇩🇪', country: 'Germany', distance: '450 km', duration: '4-5 days', coordinates: [[47.8560, 12.1281], [47.4240, 10.9850]], waypoints: [[47.8560, 12.1281, 'Lindau'], [47.4240, 10.9850, 'Berchtesgaden']], tags: ['scenic', 'historic'], description: 'Bavarian Alps, castles, and lakes. Romantic Road link.', tips: 'Neuschwanstein, Königssee. Summer or fall.', rating: 4.8, difficulty: 'easy', bestSeason: 'May-October', budget: '€500-1000' },
            { id: 'norway_bergen_trondheim', name: 'Bergen to Trondheim (Norway)', icon: '🇳🇴', country: 'Norway', distance: '650 km', duration: '5-7 days', coordinates: [[60.3913, 5.3221], [63.4305, 10.3951]], waypoints: [[60.3913, 5.3221, 'Bergen'], [61.3020, 7.8030, 'Flåm'], [62.0980, 7.0780, 'Geiranger'], [63.4305, 10.3951, 'Trondheim']], tags: ['scenic', 'epic'], description: 'Fjords, ferries, and Trollstigen. Epic Norwegian scenery.', tips: 'Ferry bookings in summer. Allow extra time.', rating: 4.9, difficulty: 'moderate', bestSeason: 'June-August', budget: '€1200-2500' },
            { id: 'romania_transfagarasan', name: 'Transfăgărășan (Romania)', icon: '🇷🇴', country: 'Romania', distance: '90 km', duration: '1 day', coordinates: [[45.6427, 24.9691], [45.5983, 24.6194]], waypoints: [[45.6427, 24.9691, 'Sibiu'], [45.5983, 24.6194, 'Curtea de Argeș']], tags: ['scenic', 'epic'], description: 'Top Gear\'s best road. Hairpins and high passes.', tips: 'Open June–October. Early to avoid traffic.', rating: 4.9, difficulty: 'moderate', bestSeason: 'July-August', budget: '€50-150' },
            { id: 'costa_brava_spain', name: 'Costa Brava Loop (Spain)', icon: '🇪🇸', country: 'Spain', distance: '350 km', duration: '4-5 days', coordinates: [[41.3851, 2.1734], [42.2784, 3.0176]], waypoints: [[41.3851, 2.1734, 'Barcelona'], [41.9818, 3.1903, 'Cadaqués'], [42.2784, 3.0176, 'Girona']], tags: ['scenic', 'historic'], description: 'Greek and Roman ruins, medieval towns, and Med coast.', tips: 'Dali museum Figueres. Avoid August crowds.', rating: 4.7, difficulty: 'easy', bestSeason: 'April-June, September', budget: '€500-1000' },
            { id: 'poland_baltic_coast', name: 'Polish Baltic Coast', icon: '🇵🇱', country: 'Poland', distance: '500 km', duration: '4-5 days', coordinates: [[54.3520, 18.6466], [53.4285, 14.5528]], waypoints: [[54.3520, 18.6466, 'Gdańsk'], [54.5189, 18.5305, 'Sopot'], [53.4285, 14.5528, 'Szczecin']], tags: ['scenic', 'historic'], description: 'Sandy beaches, Teutonic castles, and Hanseatic towns.', tips: 'Malbork Castle. Summer for beach.', rating: 4.5, difficulty: 'easy', bestSeason: 'May-September', budget: '€400-800' },
            { id: 'switzerland_gotthard', name: 'Gotthard Pass (Switzerland)', icon: '🇨🇭', country: 'Switzerland', distance: '150 km', duration: '1-2 days', coordinates: [[46.9480, 7.4474], [46.5197, 8.5596]], waypoints: [[46.9480, 7.4474, 'Bern'], [46.5197, 8.5596, 'Lugano']], tags: ['scenic', 'epic'], description: 'Alpine pass or tunnel. Lakes and peaks.', tips: 'Pass open summer. Tunnel faster. Expensive fuel.', rating: 4.8, difficulty: 'easy', bestSeason: 'June-September', budget: 'CHF150-400' },
            { id: 'portugal_atlantic_full', name: 'Portugal Atlantic Coast (Full)', icon: '🇵🇹', country: 'Portugal', distance: '700 km', duration: '7-9 days', coordinates: [[41.1579, -8.6291], [37.0194, -8.9304]], waypoints: [[41.1579, -8.6291, 'Porto'], [40.2033, -8.4103, 'Figueira da Foz'], [38.7223, -9.1393, 'Lisbon'], [37.0194, -8.9304, 'Lagos']], tags: ['scenic', 'historic'], description: 'Porto to Algarve. Beaches, cliffs, and seafood.', tips: 'Nazaré for waves. Alentejo coast quieter.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-October', budget: '€700-1500' },
            // —— Asia (Timeout, Nat Geo, Rough Guides) ——
            { id: 'karakoram_highway', name: 'Karakoram Highway (Pakistan/China)', icon: '🇵🇰', country: 'Pakistan', distance: '1300 km', duration: '10-14 days', coordinates: [[34.0479, 71.5780], [36.3250, 74.8650]], waypoints: [[34.0479, 71.5780, 'Islamabad'], [35.9200, 74.3100, 'Gilgit'], [36.3250, 74.8650, 'Hunza']], tags: ['epic', 'adventure'], description: 'Highest paved international road. Himalayas and Hunza Valley.', tips: 'Permits. Check security. Best May–October.', rating: 4.9, difficulty: 'challenging', bestSeason: 'May-October', budget: '$800-1800' },
            { id: 'golden_road_samarkand', name: 'Golden Road to Samarkand (Uzbekistan)', icon: '🇺🇿', country: 'Uzbekistan', distance: '800 km', duration: '5-7 days', coordinates: [[41.3111, 69.2797], [39.6542, 66.9597]], waypoints: [[41.3111, 69.2797, 'Tashkent'], [40.3842, 71.7843, 'Fergana'], [39.6542, 66.9597, 'Samarkand'], [39.7756, 64.4222, 'Bukhara']], tags: ['historic', 'scenic'], description: 'Silk Road mosques, madrasas, and blue tiles.', tips: 'E-visa. Spring or fall. Drive or train combo.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-May, September-October', budget: '$500-1000' },
            { id: 'oman_circle', name: 'Oman Circle (Full Loop)', icon: '🇴🇲', country: 'Oman', distance: '1200 km', duration: '7-10 days', coordinates: [[23.5880, 58.3829], [22.9333, 59.1167]], waypoints: [[23.5880, 58.3829, 'Muscat'], [22.9333, 59.1167, 'Nizwa'], [22.2474, 59.2990, 'Sur'], [17.0385, 54.0924, 'Salalah']], tags: ['scenic', 'adventure'], description: 'Forts, wadis, desert, and coast. Safe and diverse.', tips: '4x4 for Wahiba. Salalah in khareef. Respect dress.', rating: 4.8, difficulty: 'moderate', bestSeason: 'October-April', budget: '$900-2000' },
            { id: 'gobi_desert_mongolia', name: 'Gobi Desert (Mongolia)', icon: '🇲🇳', country: 'Mongolia', distance: '1500 km', duration: '10-14 days', coordinates: [[47.8864, 106.9057], [43.2220, 107.9556]], waypoints: [[47.8864, 106.9057, 'Ulaanbaatar'], [43.2220, 107.9556, 'Dalanzadgad'], [43.5928, 102.6216, 'Yol Valley']], tags: ['adventure', 'epic'], description: 'Dunes, dinosaurs, and nomadic stays. 4x4 or tour.', tips: 'Organized tour common. Ger camps. Summer only.', rating: 4.8, difficulty: 'challenging', bestSeason: 'June-August', budget: '$1500-3000' },
            { id: 'japan_alps', name: 'Japanese Alps (Japan)', icon: '🇯🇵', country: 'Japan', distance: '400 km', duration: '4-5 days', coordinates: [[36.2048, 138.2529], [36.6950, 137.2110]], waypoints: [[36.2048, 138.2529, 'Nagano'], [36.6950, 137.2110, 'Takayama'], [36.2556, 136.9011, 'Kanazawa']], tags: ['scenic', 'historic'], description: 'Temples, onsens, and alpine roads. Tateyama Kurobe option.', tips: 'Toll roads. Autumn foliage. Drive on left.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-May, October-November', budget: '¥80000-150000' },
            { id: 'taiwan_round_island', name: 'Taiwan Round Island', icon: '🇹🇼', country: 'Taiwan', distance: '1000 km', duration: '7-10 days', coordinates: [[25.0330, 121.5654], [22.6273, 120.3014]], waypoints: [[25.0330, 121.5654, 'Taipei'], [24.1477, 120.6736, 'Taichung'], [22.6273, 120.3014, 'Kaohsiung'], [24.1370, 121.6610, 'Taroko']], tags: ['scenic', 'adventure'], description: 'Taroko Gorge, east coast, and night markets.', tips: 'International license. Taroko permit. Year-round.', rating: 4.7, difficulty: 'moderate', bestSeason: 'October-April', budget: '$600-1200' },
            { id: 'cambodia_angkor_siem_reap', name: 'Cambodia Temples & Coast', icon: '🇰🇭', country: 'Cambodia', distance: '600 km', duration: '5-7 days', coordinates: [[11.5564, 104.9282], [10.6118, 103.5496]], waypoints: [[11.5564, 104.9282, 'Phnom Penh'], [13.4125, 103.8670, 'Siem Reap / Angkor'], [10.6118, 103.5496, 'Sihanoukville']], tags: ['historic', 'scenic'], description: 'Angkor Wat, Tonle Sap, and beaches.', tips: 'Angkor 3-day pass. Drive or bus. Dry season.', rating: 4.8, difficulty: 'easy', bestSeason: 'November-March', budget: '$400-900' },
            { id: 'laos_bolaven', name: 'Bolaven Plateau (Laos)', icon: '🇱🇦', country: 'Laos', distance: '400 km', duration: '4-5 days', coordinates: [[15.8700, 106.7500], [15.1167, 106.3833]], waypoints: [[15.8700, 106.7500, 'Pakse'], [15.1167, 106.3833, 'Tad Lo'], [15.2500, 106.7000, 'Coffee plantations']], tags: ['scenic', 'adventure'], description: 'Waterfalls, coffee, and ethnic villages. Motorbike or car.', tips: 'Wet season lush. Roads improving.', rating: 4.6, difficulty: 'moderate', bestSeason: 'November-March', budget: '$300-600' },
            { id: 'malaysia_cameron_highlands', name: 'Cameron Highlands & East Coast (Malaysia)', icon: '🇲🇾', country: 'Malaysia', distance: '600 km', duration: '5-6 days', coordinates: [[3.1390, 101.6869], [5.4167, 103.0833]], waypoints: [[3.1390, 101.6869, 'Kuala Lumpur'], [4.4690, 101.3930, 'Cameron Highlands'], [5.4167, 103.0833, 'Kota Bharu']], tags: ['scenic', 'historic'], description: 'Tea, rainforest, and Perhentian access.', tips: 'Drive on left. East coast monsoon Nov–Feb.', rating: 4.5, difficulty: 'easy', bestSeason: 'March-October', budget: '$400-800' },
            { id: 'indonesia_bali_east', name: 'Bali & East Java (Indonesia)', icon: '🇮🇩', country: 'Indonesia', distance: '800 km', duration: '7-10 days', coordinates: [[-8.6705, 115.2126], [-7.2504, 112.7688]], waypoints: [[-8.6705, 115.2126, 'Denpasar'], [-8.5069, 115.2625, 'Ubud'], [-7.6079, 110.2038, 'Yogyakarta / Borobudur']], tags: ['scenic', 'historic'], description: 'Temples, rice terraces, and volcanoes.', tips: 'Traffic heavy. Borobudur at sunrise. Dry season.', rating: 4.7, difficulty: 'moderate', bestSeason: 'April-October', budget: '$500-1000' },
            { id: 'turkey_cappadocia_coast', name: 'Cappadocia to Mediterranean (Turkey)', icon: '🇹🇷', country: 'Turkey', distance: '800 km', duration: '7-9 days', coordinates: [[38.6431, 34.8289], [36.8969, 30.7133]], waypoints: [[38.6431, 34.8289, 'Cappadocia'], [37.8746, 32.4932, 'Konya'], [36.8969, 30.7133, 'Antalya']], tags: ['scenic', 'historic'], description: 'Hot-air balloons, ruins, and Turquoise Coast.', tips: 'Balloon book ahead. Spring or fall.', rating: 4.8, difficulty: 'easy', bestSeason: 'April-June, September-October', budget: '€600-1200' },
            { id: 'iran_classic', name: 'Classic Iran (Tehran–Shiraz–Isfahan)', icon: '🇮🇷', country: 'Iran', distance: '1200 km', duration: '7-10 days', coordinates: [[35.6892, 51.3890], [32.6546, 51.6680]], waypoints: [[35.6892, 51.3890, 'Tehran'], [32.6546, 51.6680, 'Isfahan'], [29.5918, 52.5836, 'Shiraz'], [30.1211, 53.1790, 'Persepolis']], tags: ['historic', 'scenic'], description: 'Mosques, bazaars, and ancient Persia. Visa required.', tips: 'Guide required for many nationalities. Hospitality legendary.', rating: 4.9, difficulty: 'moderate', bestSeason: 'March-May, September-November', budget: '$800-1500' },
            // —— Africa (Lonely Planet, Road Trip Africa) ——
            { id: 'garden_route_south_africa', name: 'Garden Route (South Africa)', icon: '🇿🇦', country: 'South Africa', distance: '300 km', duration: '4-5 days', coordinates: [[-33.9249, 18.4241], [-34.0351, 23.0465]], waypoints: [[-33.9249, 18.4241, 'Cape Town'], [-34.0351, 23.0465, 'Knysna'], [-33.9581, 25.6160, 'Port Elizabeth']], tags: ['scenic', 'adventure'], description: 'Coast, forests, and wildlife. Left-hand drive.', tips: 'Tsitsikamma, bungee at Bloukrans. Oudtshoorn ostriches.', rating: 4.8, difficulty: 'easy', bestSeason: 'September-April', budget: '$500-1200' },
            { id: 'avenue_baobabs_madagascar', name: 'Avenue of the Baobabs (Madagascar)', icon: '🇲🇬', country: 'Madagascar', distance: '400 km', duration: '3-4 days', coordinates: [[-18.8792, 47.5079], [-20.2500, 44.4333]], waypoints: [[-18.8792, 47.5079, 'Antananarivo'], [-20.2500, 44.4333, 'Morondava'], [-19.7167, 44.3833, 'Kirindy']], tags: ['scenic', 'adventure'], description: 'Iconic baobabs, lemurs, and red roads.', tips: '4x4 or tour. Rainy season Dec–Mar. Road conditions variable.', rating: 4.7, difficulty: 'challenging', bestSeason: 'April-November', budget: '$600-1200' },
            { id: 'egypt_nile_upper', name: 'Upper Egypt (Nile Valley)', icon: '🇪🇬', country: 'Egypt', distance: '700 km', duration: '5-7 days', coordinates: [[26.8206, 30.8025], [25.6872, 32.6396]], waypoints: [[26.8206, 30.8025, 'Luxor'], [25.6872, 32.6396, 'Aswan'], [24.0889, 32.8998, 'Abu Simbel']], tags: ['historic', 'scenic'], description: 'Temples, Valley of the Kings, and Lake Nasser.', tips: 'Convoy or police escort in past. Check current rules.', rating: 4.8, difficulty: 'moderate', bestSeason: 'October-April', budget: '$500-1000' },
            { id: 'tanzania_northern_circuit', name: 'Tanzania Northern Safari Circuit', icon: '🇹🇿', country: 'Tanzania', distance: '600 km', duration: '6-8 days', coordinates: [[-3.3869, 36.6829], [-2.3333, 34.8333]], waypoints: [[-3.3869, 36.6829, 'Arusha'], [-3.5000, 36.1000, 'Tarangire'], [-3.2400, 35.5320, 'Ngorongoro'], [-2.3333, 34.8333, 'Serengeti']], tags: ['wildlife', 'adventure'], description: 'Tarangire, Ngorongoro, Serengeti. Classic safari.', tips: '4x4 or tour. Migration Dec–Jul. Book lodges.', rating: 4.9, difficulty: 'moderate', bestSeason: 'June-October', budget: '$2500-5000' },
            { id: 'morocco_south_circuit', name: 'Morocco South & Desert Circuit', icon: '🇲🇦', country: 'Morocco', distance: '1500 km', duration: '8-10 days', coordinates: [[33.5731, -7.5898], [31.7917, -7.0926]], waypoints: [[33.5731, -7.5898, 'Marrakech'], [30.4278, -9.5981, 'Agadir'], [31.7917, -7.0926, 'Ouarzazate'], [31.0830, -4.0120, 'Merzouga']], tags: ['scenic', 'adventure'], description: 'Atlas, kasbahs, and Sahara dunes. Camel trek option.', tips: '4x4 for dunes. Spring or fall. Bargain in souks.', rating: 4.8, difficulty: 'moderate', bestSeason: 'March-May, September-November', budget: '€600-1200' },
            { id: 'ethiopia_historic', name: 'Ethiopian Historic Route', icon: '🇪🇹', country: 'Ethiopia', distance: '1500 km', duration: '10-14 days', coordinates: [[9.0320, 38.7469], [12.0320, 39.0442]], waypoints: [[9.0320, 38.7469, 'Addis Ababa'], [12.0320, 39.0442, 'Lalibela'], [13.5140, 39.4740, 'Axum']], tags: ['historic', 'adventure'], description: 'Rock churches, Axum, and Simien Mountains.', tips: 'Driver/guide common. Altitude. Best Oct–Jun.', rating: 4.7, difficulty: 'moderate', bestSeason: 'October-March', budget: '$1000-2000' },
            { id: 'rwanda_uganda_gorillas', name: 'Rwanda & Uganda Gorilla Circuit', icon: '🇷🇼', country: 'Rwanda', distance: '600 km', duration: '5-7 days', coordinates: [[-1.9536, 30.0606], [-1.2921, 29.5730]], waypoints: [[-1.9536, 30.0606, 'Kigali'], [-1.2921, 29.5730, 'Bwindi'], [-1.5000, 29.5333, 'Volcanoes NP']], tags: ['wildlife', 'adventure'], description: 'Mountain gorillas and green hills. Permit essential.', tips: 'Rwanda permit $1500. Uganda cheaper. Book months ahead.', rating: 4.9, difficulty: 'moderate', bestSeason: 'June-September', budget: '$2500-4500' },
            // —— Oceania & more USA/Canada ——
            { id: 'tasmania_circuit', name: 'Tasmania Circuit (Australia)', icon: '🇦🇺', country: 'Australia', distance: '1200 km', duration: '7-10 days', coordinates: [[-42.8821, 147.3272], [-41.4332, 147.1441]], waypoints: [[-42.8821, 147.3272, 'Hobart'], [-41.4332, 147.1441, 'Launceston'], [-42.0634, 146.6564, 'Cradle Mountain']], tags: ['scenic', 'adventure'], description: 'Wilderness, convict history, and wildlife.', tips: 'Freycinet, Wineglass Bay. Spring or fall.', rating: 4.8, difficulty: 'easy', bestSeason: 'October-April', budget: 'A$1500-3000' },
            { id: 'new_zealand_south_island', name: 'South Island Circuit (New Zealand)', icon: '🇳🇿', country: 'New Zealand', distance: '1800 km', duration: '10-14 days', coordinates: [[-43.5321, 172.6362], [-45.0312, 168.6626]], waypoints: [[-43.5321, 172.6362, 'Christchurch'], [-43.6158, 170.0284, 'Fox Glacier'], [-44.6414, 167.8975, 'Milford Sound'], [-45.0312, 168.6626, 'Queenstown']], tags: ['scenic', 'epic'], description: 'Glaciers, fjords, and adventure capital. Must-do.', tips: 'Milford booking. Left-hand drive. Spring or fall.', rating: 4.9, difficulty: 'easy', bestSeason: 'October-April', budget: 'NZ$2000-4000' },
            { id: 'powder_highway_canada', name: 'Powder Highway (British Columbia)', icon: '🇨🇦', country: 'Canada', distance: '600 km', duration: '5-7 days', coordinates: [[49.2962, -115.7542], [50.2673, -115.8319]], waypoints: [[49.2962, -115.7542, 'Fernie'], [49.7231, -116.4360, 'Nelson'], [50.2673, -115.8319, 'Golden']], tags: ['adventure', 'scenic'], description: 'Ski resorts and mountain towns. Winter road trip.', tips: 'Winter driving. Revelstoke, Kicking Horse.', rating: 4.7, difficulty: 'moderate', bestSeason: 'December-March', budget: 'C$800-1800' },
            { id: 'trans_canada_ontario', name: 'Trans-Canada (Ontario–Quebec)', icon: '🇨🇦', country: 'Canada', distance: '1200 km', duration: '5-7 days', coordinates: [[43.6532, -79.3832], [46.8139, -71.2082]], waypoints: [[43.6532, -79.3832, 'Toronto'], [45.4215, -75.6972, 'Ottawa'], [46.8139, -71.2082, 'Quebec City']], tags: ['scenic', 'historic'], description: 'Lakes, capital, and French Canada.', tips: 'Fall colors. Montreal and Quebec City.', rating: 4.6, difficulty: 'easy', bestSeason: 'May-October', budget: 'C$600-1200' },
            { id: 'usa_pacific_northwest', name: 'Pacific Northwest (USA)', icon: '🇺🇸', country: 'USA', distance: '800 km', duration: '5-7 days', coordinates: [[47.6062, -122.3321], [45.5152, -122.6784]], waypoints: [[47.6062, -122.3321, 'Seattle'], [48.7519, -122.4787, 'Bellingham'], [45.5152, -122.6784, 'Portland']], tags: ['scenic', 'adventure'], description: 'Rainforest, volcanoes, and coast. Olympic NP, Mt Rainier.', tips: 'Summer best. Rain gear. Coffee and craft beer.', rating: 4.8, difficulty: 'easy', bestSeason: 'June-September', budget: '$800-1800' },
            { id: 'usa_smoky_mountains', name: 'Great Smoky Mountains (USA)', icon: '🇺🇸', country: 'USA', distance: '200 km', duration: '2-3 days', coordinates: [[35.5951, -83.5080], [35.6532, -83.5070]], waypoints: [[35.5951, -83.5080, 'Gatlinburg'], [35.6532, -83.5070, 'Cades Cove'], [35.6823, -83.5321, 'Clingmans Dome']], tags: ['scenic', 'historic'], description: 'Most visited US national park. Fall colors and wildlife.', tips: 'Cades Cove loop. Avoid summer weekends.', rating: 4.7, difficulty: 'easy', bestSeason: 'April-May, October', budget: '$300-600' },
            { id: 'usa_badlands_black_hills', name: 'Badlands & Black Hills (South Dakota)', icon: '🇺🇸', country: 'USA', distance: '400 km', duration: '3-4 days', coordinates: [[43.5446, -96.7313], [43.8791, -103.4591]], waypoints: [[43.5446, -96.7313, 'Sioux Falls'], [43.8661, -102.3334, 'Badlands NP'], [43.8791, -103.4591, 'Mount Rushmore'], [44.3668, -104.0825, 'Devils Tower']], tags: ['scenic', 'historic'], description: 'Badlands, Rushmore, and Devils Tower.', tips: 'Custer State Park. Summer or fall.', rating: 4.7, difficulty: 'easy', bestSeason: 'May-September', budget: '$400-800' },
            { id: 'usa_bluegrass_kentucky', name: 'Kentucky Bluegrass & Bourbon', icon: '🇺🇸', country: 'USA', distance: '350 km', duration: '3-4 days', coordinates: [[38.2527, -85.7585], [37.8393, -84.2700]], waypoints: [[38.2527, -85.7585, 'Louisville'], [37.8393, -84.2700, 'Lexington'], [37.7749, -84.8597, 'Bardstown']], tags: ['scenic', 'historic'], description: 'Bourbon distilleries, horse farms, and rolling hills.', tips: 'Bourbon Trail. Keeneland. Spring or fall.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-May, September-October', budget: '$400-800' },
            { id: 'usa_route_12_utah', name: 'Scenic Byway 12 (Utah)', icon: '🇺🇸', country: 'USA', distance: '200 km', duration: '1-2 days', coordinates: [[37.6770, -112.1461], [38.2982, -111.2500]], waypoints: [[37.6770, -112.1461, 'Bryce Canyon'], [38.2982, -111.2500, 'Capitol Reef']], tags: ['scenic', 'epic'], description: 'All-American Road. Red rock and high plateau.', tips: 'Combine with Mighty 5. Boulder Mountain stretch.', rating: 4.9, difficulty: 'easy', bestSeason: 'April-October', budget: '$150-400' },
            { id: 'usa_going_to_sun_glacier', name: 'Glacier National Park Loop', icon: '🇺🇸', country: 'USA', distance: '250 km', duration: '2-3 days', coordinates: [[48.7596, -113.7870], [48.6961, -113.7185]], waypoints: [[48.7596, -113.7870, 'West Glacier'], [48.6961, -113.7185, 'St. Mary'], [48.8800, -113.9900, 'Many Glacier']], tags: ['scenic', 'adventure'], description: 'Going-to-the-Sun plus Many Glacier. Bears and peaks.', tips: 'Vehicle reservation. Summer only. Book lodging.', rating: 4.9, difficulty: 'easy', bestSeason: 'July-August', budget: '$400-800' },
            // —— More Europe, Asia, Americas (200+ total) ——
            { id: 'iceland_ring_road', name: 'Iceland Ring Road (Full)', icon: '🇮🇸', country: 'Iceland', distance: '1332 km', duration: '7-10 days', coordinates: [[64.1466, -21.9426], [65.6835, -18.0878]], waypoints: [[64.1466, -21.9426, 'Reykjavík'], [65.6835, -18.0878, 'Akureyri'], [63.4180, -19.0070, 'Vík'], [64.2530, -15.2070, 'Höfn']], tags: ['scenic', 'epic'], description: 'Full circle of fire and ice. Waterfalls, glaciers, hot springs.', tips: 'Book accommodation. F-roads summer only. Wind and weather.', rating: 4.9, difficulty: 'moderate', bestSeason: 'June-August', budget: '€1500-3500' },
            { id: 'scotland_nc500', name: 'North Coast 500 (Scotland)', icon: '🇬🇧', country: 'UK', distance: '830 km', duration: '5-7 days', coordinates: [[57.4778, -4.2247], [58.5920, -3.5210]], waypoints: [[57.4778, -4.2247, 'Inverness'], [58.5920, -3.5210, 'John O\'Groats'], [58.3838, -6.1826, 'Stornoway']], tags: ['scenic', 'epic'], description: 'Scotland\'s answer to Route 66. Castles, lochs, and cliffs.', tips: 'Book B&Bs early. Single-track roads. Midges in summer.', rating: 4.9, difficulty: 'moderate', bestSeason: 'May-September', budget: '£600-1500' },
            { id: 'ireland_wild_atlantic', name: 'Wild Atlantic Way (Ireland)', icon: '🇮🇪', country: 'Ireland', distance: '2500 km', duration: '2-3 weeks', coordinates: [[53.2707, -9.0568], [51.8985, -8.4756]], waypoints: [[53.2707, -9.0568, 'Galway'], [52.0598, -9.5044, 'Killarney'], [51.8985, -8.4756, 'Cork'], [51.5085, -9.4756, 'Dingle']], tags: ['scenic', 'historic'], description: 'Cliffs of Moher, Dingle, and Gaelic culture.', tips: 'Narrow roads. Left-hand drive. Pubs and music.', rating: 4.8, difficulty: 'moderate', bestSeason: 'May-September', budget: '€800-1800' },
            { id: 'norway_lofoten', name: 'Lofoten Islands (Norway)', icon: '🇳🇴', country: 'Norway', distance: '350 km', duration: '4-5 days', coordinates: [[68.1467, 13.6110], [67.8783, 13.0866]], waypoints: [[68.1467, 13.6110, 'Svolvær'], [67.8783, 13.0866, 'Å'], [68.2500, 14.0000, 'Reine']], tags: ['scenic', 'epic'], description: 'Arctic fishing villages, midnight sun, and peaks.', tips: 'Ferry or drive. Summer for midnight sun. Book cabins.', rating: 4.9, difficulty: 'easy', bestSeason: 'June-August', budget: '€800-1800' },
            { id: 'sweden_kiruna_abisko', name: 'Swedish Lapland (Kiruna–Abisko)', icon: '🇸🇪', country: 'Sweden', distance: '400 km', duration: '3-4 days', coordinates: [[67.8558, 20.2253], [68.3494, 18.8310]], waypoints: [[67.8558, 20.2253, 'Kiruna'], [68.3494, 18.8310, 'Abisko'], [67.1333, 20.6500, 'Jukkasjärvi']], tags: ['scenic', 'adventure'], description: 'Northern lights, Ice Hotel, and Arctic wilderness.', tips: 'Winter for aurora. Summer for midnight sun.', rating: 4.8, difficulty: 'easy', bestSeason: 'December-March, June-August', budget: '€600-1500' },
            { id: 'estonia_latvia_lithuania', name: 'Baltic Capitals (Estonia–Latvia–Lithuania)', icon: '🇪🇪', country: 'Estonia', distance: '600 km', duration: '5-7 days', coordinates: [[59.4370, 24.7536], [54.6872, 25.2797]], waypoints: [[59.4370, 24.7536, 'Tallinn'], [56.9496, 24.1052, 'Riga'], [54.6872, 25.2797, 'Vilnius']], tags: ['scenic', 'historic'], description: 'Medieval old towns, Soviet heritage, and coast.', tips: 'Cheap and safe. Spring or fall.', rating: 4.6, difficulty: 'easy', bestSeason: 'May-September', budget: '€400-900' },
            { id: 'cyprus_coastal', name: 'Cyprus Coastal Loop', icon: '🇨🇾', country: 'Cyprus', distance: '600 km', duration: '5-6 days', coordinates: [[35.1856, 33.3823], [34.6857, 33.0420]], waypoints: [[35.1856, 33.3823, 'Nicosia'], [34.6857, 33.0420, 'Paphos'], [34.9167, 33.6333, 'Ayia Napa']], tags: ['scenic', 'historic'], description: 'Beaches, ancient sites, and Troodos Mountains.', tips: 'Left-hand drive. North Cyprus check regulations.', rating: 4.5, difficulty: 'easy', bestSeason: 'April-June, September-October', budget: '€500-1000' },
            { id: 'malta_gozo', name: 'Malta & Gozo', icon: '🇲🇹', country: 'Malta', distance: '150 km', duration: '2-3 days', coordinates: [[35.9042, 14.5189], [36.0443, 14.2517]], waypoints: [[35.9042, 14.5189, 'Valletta'], [36.0443, 14.2517, 'Victoria (Gozo)']], tags: ['scenic', 'historic'], description: 'Tiny islands, megaliths, and Mediterranean history.', tips: 'Ferry to Gozo. Left-hand drive. Year-round.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-October', budget: '€300-600' },
            { id: 'bulgaria_black_sea', name: 'Bulgaria Black Sea Coast', icon: '🇧🇬', country: 'Bulgaria', distance: '400 km', duration: '4-5 days', coordinates: [[43.2141, 27.9147], [42.6977, 27.7373]], waypoints: [[43.2141, 27.9147, 'Varna'], [42.6977, 27.7373, 'Burgas'], [42.1514, 24.7490, 'Plovdiv']], tags: ['scenic', 'historic'], description: 'Beaches, Thracian tombs, and rose valleys.', tips: 'Summer for beach. Plovdiv for culture.', rating: 4.5, difficulty: 'easy', bestSeason: 'May-September', budget: '€300-600' },
            { id: 'bosnia_herzegovina', name: 'Bosnia & Herzegovina Highlights', icon: '🇧🇦', country: 'Bosnia and Herzegovina', distance: '500 km', duration: '4-5 days', coordinates: [[43.8516, 18.3864], [43.3438, 17.8078]], waypoints: [[43.8516, 18.3864, 'Sarajevo'], [43.3438, 17.8078, 'Mostar'], [44.8172, 17.2169, 'Banja Luka']], tags: ['scenic', 'historic'], description: 'Sarajevo, Mostar bridge, and mountains.', tips: 'War history. Kravice Falls. Spring or fall.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-October', budget: '€300-600' },
            { id: 'north_macedonia_lake_ohrid', name: 'North Macedonia & Lake Ohrid', icon: '🇲🇰', country: 'North Macedonia', distance: '400 km', duration: '3-4 days', coordinates: [[41.9973, 21.4280], [41.1171, 20.8013]], waypoints: [[41.9973, 21.4280, 'Skopje'], [41.1171, 20.8013, 'Ohrid'], [41.3400, 21.5500, 'Bitola']], tags: ['scenic', 'historic'], description: 'Ohrid, ancient sites, and Balkan hospitality.', tips: 'Ohrid in summer. Cheap and underrated.', rating: 4.5, difficulty: 'easy', bestSeason: 'May-September', budget: '€250-500' },
            { id: 'serbia_belgrade_novi_sad', name: 'Serbia Belgrade to Novi Sad', icon: '🇷🇸', country: 'Serbia', distance: '350 km', duration: '3-4 days', coordinates: [[44.7866, 20.4489], [45.2671, 19.8335]], waypoints: [[44.7866, 20.4489, 'Belgrade'], [45.2671, 19.8335, 'Novi Sad'], [43.3209, 21.8958, 'Niš']], tags: ['historic', 'scenic'], description: 'Fortresses, nightlife, and Danube.', tips: 'Belgrade fortress. Exit to Romania or Bulgaria.', rating: 4.4, difficulty: 'easy', bestSeason: 'April-October', budget: '€250-500' },
            { id: 'china_silk_road_gansu', name: 'Gansu Silk Road (China)', icon: '🇨🇳', country: 'China', distance: '1200 km', duration: '7-10 days', coordinates: [[36.0611, 103.8343], [40.5142, 94.7738]], waypoints: [[36.0611, 103.8343, 'Lanzhou'], [39.0392, 100.4492, 'Zhangye'], [40.5142, 94.7738, 'Dunhuang']], tags: ['historic', 'scenic'], description: 'Buddhist caves, rainbow mountains, and desert.', tips: 'Permits for some areas. Spring or fall.', rating: 4.8, difficulty: 'moderate', bestSeason: 'May-October', budget: '$600-1200' },
            { id: 'philippines_palawan', name: 'Palawan (Philippines)', icon: '🇵🇭', country: 'Philippines', distance: '400 km', duration: '5-7 days', coordinates: [[9.5370, 118.3790], [10.1833, 119.2333]], waypoints: [[9.5370, 118.3790, 'Puerto Princesa'], [10.1833, 119.2333, 'El Nido'], [10.0167, 118.8333, 'Coron']], tags: ['scenic', 'adventure'], description: 'Underground river, lagoons, and island hopping.', tips: 'Ferries and vans. Book El Nido ahead.', rating: 4.8, difficulty: 'moderate', bestSeason: 'November-April', budget: '$400-900' },
            { id: 'myanmar_mandalay_bagan', name: 'Mandalay to Bagan (Myanmar)', icon: '🇲🇲', country: 'Myanmar', distance: '400 km', duration: '4-5 days', coordinates: [[21.9588, 96.0891], [21.1717, 94.8585]], waypoints: [[21.9588, 96.0891, 'Mandalay'], [21.1717, 94.8585, 'Bagan'], [20.7890, 96.9933, 'Inle Lake']], tags: ['historic', 'scenic'], description: 'Temples, balloons over Bagan, and Inle.', tips: 'Check current travel advice. Balloon at sunrise.', rating: 4.8, difficulty: 'moderate', bestSeason: 'November-February', budget: '$500-1000' },
            { id: 'bhutan_paro_thimphu', name: 'Bhutan Paro–Thimphu–Punakha', icon: '🇧🇹', country: 'Bhutan', distance: '300 km', duration: '5-7 days', coordinates: [[27.4305, 89.4136], [27.5142, 89.6394]], waypoints: [[27.4305, 89.4136, 'Paro'], [27.5142, 89.6394, 'Thimphu'], [27.5914, 89.8722, 'Punakha']], tags: ['scenic', 'historic'], description: 'Tiger\'s Nest, dzongs, and Himalayan culture.', tips: 'Tour or visa with guide. Daily fee. Spring or fall.', rating: 4.9, difficulty: 'moderate', bestSeason: 'March-May, September-November', budget: '$2500-4000' },
            { id: 'nepal_kathmandu_pokhara', name: 'Kathmandu to Pokhara (Nepal)', icon: '🇳🇵', country: 'Nepal', distance: '200 km', duration: '3-4 days', coordinates: [[27.7172, 85.3240], [28.2096, 83.9856]], waypoints: [[27.7172, 85.3240, 'Kathmandu'], [28.2096, 83.9856, 'Pokhara'], [27.5170, 85.2920, 'Nagarkot']], tags: ['scenic', 'adventure'], description: 'Himalayan views, lakes, and trekking base.', tips: 'Mountain flights. Road conditions variable.', rating: 4.7, difficulty: 'moderate', bestSeason: 'October-November, March-April', budget: '$300-600' },
            { id: 'pakistan_swat_valley', name: 'Swat Valley (Pakistan)', icon: '🇵🇰', country: 'Pakistan', distance: '400 km', duration: '4-5 days', coordinates: [[34.0479, 71.5780], [35.2200, 72.3500]], waypoints: [[34.0479, 71.5780, 'Islamabad'], [35.2200, 72.3500, 'Kalam'], [34.7800, 72.3600, 'Malam Jabba']], tags: ['scenic', 'adventure'], description: 'Alpine valleys and Pakistan\'s Switzerland.', tips: 'Check security. Spring or summer.', rating: 4.6, difficulty: 'moderate', bestSeason: 'April-September', budget: '$300-600' },
            { id: 'azerbaijan_baku_gobustan', name: 'Azerbaijan Baku to Mountains', icon: '🇦🇿', country: 'Azerbaijan', distance: '400 km', duration: '4-5 days', coordinates: [[40.4093, 49.8671], [41.3775, 48.5020]], waypoints: [[40.4093, 49.8671, 'Baku'], [40.3775, 48.5020, 'Gobustan'], [41.6330, 46.6430, 'Sheki']], tags: ['scenic', 'historic'], description: 'Fire temple, mud volcanoes, and Caucasus.', tips: 'Visa on arrival. Spring or fall.', rating: 4.5, difficulty: 'easy', bestSeason: 'April-June, September-October', budget: '$400-800' },
            { id: 'armenia_yerevan_gyumri', name: 'Armenia Yerevan to Gyumri', icon: '🇦🇲', country: 'Armenia', distance: '300 km', duration: '3-4 days', coordinates: [[40.1872, 44.5152], [40.7894, 43.8475]], waypoints: [[40.1872, 44.5152, 'Yerevan'], [40.7894, 43.8475, 'Gyumri'], [39.7680, 45.2270, 'Tatev']], tags: ['historic', 'scenic'], description: 'Monasteries, Tatev cable car, and Ararat views.', tips: 'Wine and brandy. Nagorno-Karabakh check situation.', rating: 4.6, difficulty: 'easy', bestSeason: 'May-October', budget: '$300-600' },
            { id: 'chile_atacama', name: 'Atacama Desert (Chile)', icon: '🇨🇱', country: 'Chile', distance: '500 km', duration: '4-5 days', coordinates: [[-22.4484, -68.9294], [-23.6345, -68.9056]], waypoints: [[-22.4484, -68.9294, 'San Pedro'], [-23.6345, -68.9056, 'El Tatio'], [-23.2000, -68.2500, 'Laguna Cejar']], tags: ['scenic', 'adventure'], description: 'Salt flats, geysers, and stargazing.', tips: 'Altitude. Stargazing tours. Year-round.', rating: 4.9, difficulty: 'easy', bestSeason: 'March-November', budget: '$500-1000' },
            { id: 'brazil_rio_santos', name: 'Rio to Santos (Brazil Coast)', icon: '🇧🇷', country: 'Brazil', distance: '500 km', duration: '4-5 days', coordinates: [[-22.9068, -43.1729], [-23.9608, -46.3332]], waypoints: [[-22.9068, -43.1729, 'Rio'], [-22.9519, -42.0239, 'Paraty'], [-23.9608, -46.3332, 'Santos']], tags: ['scenic', 'historic'], description: 'Green coast, colonial Paraty, and beaches.', tips: 'BR-101. Safety in cities. Spring or fall.', rating: 4.6, difficulty: 'moderate', bestSeason: 'April-October', budget: '$400-800' },
            { id: 'usa_denali_highway', name: 'Denali Highway (Alaska)', icon: '🇺🇸', country: 'USA', distance: '217 km', duration: '1-2 days', coordinates: [[63.7494, -148.8410], [62.1230, -145.4340]], waypoints: [[63.7494, -148.8410, 'Cantwell'], [62.1230, -145.4340, 'Paxson']], tags: ['scenic', 'adventure'], description: 'Gravel road, tundra, and wildlife. Summer only.', tips: 'Unpaved. Rentals may restrict. Fuel in Cantwell.', rating: 4.8, difficulty: 'moderate', bestSeason: 'June-August', budget: '$200-500' },
            { id: 'usa_beartooth_highway', name: 'Beartooth Highway (Montana–Wyoming)', icon: '🇺🇸', country: 'USA', distance: '110 km', duration: '1 day', coordinates: [[45.7833, -109.0333], [44.9667, -109.2500]], waypoints: [[45.7833, -109.0333, 'Red Lodge'], [44.9667, -109.2500, 'Cooke City']], tags: ['scenic', 'epic'], description: 'Alpine pass near Yellowstone. Open summer only.', tips: 'Open Memorial Day–October. Snow possible any month.', rating: 4.9, difficulty: 'easy', bestSeason: 'July-August', budget: '$100-300' },
            { id: 'usa_shenandoah_skyline', name: 'Skyline Drive (Virginia)', icon: '🇺🇸', country: 'USA', distance: '170 km', duration: '1-2 days', coordinates: [[38.8816, -78.1705], [38.5336, -78.3678]], waypoints: [[38.8816, -78.1705, 'Front Royal'], [38.5336, -78.3678, 'Waynesboro']], tags: ['scenic', 'historic'], description: 'Shenandoah NP. Fall colors and deer.', tips: 'Fall peak. Speed limit 35. Connects to Blue Ridge.', rating: 4.7, difficulty: 'easy', bestSeason: 'October', budget: '$100-250' },
            { id: 'canada_gaspésie', name: 'Gaspésie Peninsula (Quebec)', icon: '🇨🇦', country: 'Canada', distance: '900 km', duration: '5-7 days', coordinates: [[48.4284, -68.5242], [48.8333, -64.4833]], waypoints: [[48.4284, -68.5242, 'Rimouski'], [48.8333, -64.4833, 'Percé'], [48.1500, -66.3333, 'Carleton']], tags: ['scenic', 'adventure'], description: 'Percé Rock, Chic-Chocs, and Acadian culture.', tips: 'French-speaking. Fall colors. Summer for whales.', rating: 4.7, difficulty: 'easy', bestSeason: 'June-October', budget: 'C$600-1200' },
            { id: 'usa_outer_banks', name: 'Outer Banks (North Carolina)', icon: '🇺🇸', country: 'USA', distance: '200 km', duration: '2-3 days', coordinates: [[36.0895, -75.7080], [35.5622, -75.4662]], waypoints: [[36.0895, -75.7080, 'Kitty Hawk'], [35.5622, -75.4662, 'Ocracoke']], tags: ['scenic', 'historic'], description: 'Dunes, lighthouses, and Wright Brothers.', tips: 'Ferry to Ocracoke. Summer busy.', rating: 4.6, difficulty: 'easy', bestSeason: 'April-October', budget: '$300-600' },
            { id: 'usa_route_1_maine', name: 'Maine Coast Route 1', icon: '🇺🇸', country: 'USA', distance: '350 km', duration: '3-4 days', coordinates: [[43.6591, -70.2568], [44.3876, -68.2040]], waypoints: [[43.6591, -70.2568, 'Portland'], [44.3876, -68.2040, 'Bar Harbor'], [44.3500, -68.2200, 'Acadia NP']], tags: ['scenic', 'historic'], description: 'Lobster, lighthouses, and Acadia National Park.', tips: 'Fall foliage. Book Bar Harbor in summer.', rating: 4.7, difficulty: 'easy', bestSeason: 'June-October', budget: '$500-1000' },
            { id: 'usa_highway_12_idaho', name: 'Highway 12 Idaho (Lolo Pass)', icon: '🇺🇸', country: 'USA', distance: '300 km', duration: '2 days', coordinates: [[46.8722, -114.0186], [45.6782, -116.4595]], waypoints: [[46.8722, -114.0186, 'Missoula'], [45.6782, -116.4595, 'Lewiston']], tags: ['scenic', 'adventure'], description: 'Lewis and Clark route. Forest and river canyon.', tips: 'Summer or fall. Scenic byway.', rating: 4.6, difficulty: 'easy', bestSeason: 'June-September', budget: '$200-400' },
            { id: 'usa_trail_ridge_road', name: 'Trail Ridge Road (Rocky Mountain NP)', icon: '🇺🇸', country: 'USA', distance: '77 km', duration: '1 day', coordinates: [[40.3428, -105.6836], [40.4158, -105.7611]], waypoints: [[40.3428, -105.6836, 'Estes Park'], [40.4158, -105.7611, 'Grand Lake']], tags: ['scenic', 'epic'], description: 'Highest continuous paved road in USA. Alpine tundra.', tips: 'Open Memorial Day–October. Timed entry in summer.', rating: 4.8, difficulty: 'easy', bestSeason: 'June-September', budget: '$100-250' },
            { id: 'canada_newfoundland', name: 'Newfoundland T\'CH (Canada)', icon: '🇨🇦', country: 'Canada', distance: '900 km', duration: '7-9 days', coordinates: [[47.5700, -52.7100], [51.3900, -55.5900]], waypoints: [[47.5700, -52.7100, 'St. John\'s'], [51.3900, -55.5900, 'L\'Anse aux Meadows']], tags: ['scenic', 'historic'], description: 'Vikings, icebergs, and Irish culture.', tips: 'Iceberg season May–June. Ferry from Nova Scotia.', rating: 4.7, difficulty: 'moderate', bestSeason: 'June-August', budget: 'C$1200-2500' },
            { id: 'spain_picos_europa', name: 'Picos de Europa (Spain)', icon: '🇪🇸', country: 'Spain', distance: '250 km', duration: '3-4 days', coordinates: [[43.3614, -5.8593], [43.2500, -4.8500]], waypoints: [[43.3614, -5.8593, 'Oviedo'], [43.2500, -4.8500, 'Potes'], [43.3000, -4.7000, 'Fuente Dé']], tags: ['scenic', 'adventure'], description: 'Alpine peaks, cable car, and cheese.', tips: 'Cable car to summit. Spring or fall.', rating: 4.7, difficulty: 'moderate', bestSeason: 'May-October', budget: '€400-800' },
            { id: 'iceland_golden_circle', name: 'Golden Circle (Iceland)', icon: '🇮🇸', country: 'Iceland', distance: '300 km', duration: '1 day', coordinates: [[64.1466, -21.9426], [64.2530, -20.2070]], waypoints: [[64.1466, -21.9426, 'Reykjavík'], [64.2530, -20.2070, 'Þingvellir'], [64.3100, -20.1200, 'Geysir'], [63.4180, -19.0070, 'Gullfoss']], tags: ['scenic', 'historic'], description: 'Classic day trip: Þingvellir, Geysir, Gullfoss.', tips: 'Do early or late to avoid buses. Year-round.', rating: 4.7, difficulty: 'easy', bestSeason: 'Year-round', budget: '€100-250' },
            { id: 'australia_gibb_river', name: 'Gibb River Road (Australia)', icon: '🇦🇺', country: 'Australia', distance: '660 km', duration: '5-7 days', coordinates: [[-17.9614, 122.2352], [-15.7785, 128.7375]], waypoints: [[-17.9614, 122.2352, 'Derby'], [-15.7785, 128.7375, 'Kununurra'], [-16.8000, 125.9000, 'Bell Gorge']], tags: ['adventure', 'fourx4'], description: 'Kimberley outback. Gorges and cattle stations.', tips: '4x4 essential. Dry season only. Fuel and water.', rating: 4.8, difficulty: 'challenging', bestSeason: 'May-October', budget: 'A$1500-3000' },
            { id: 'new_zealand_coromandel', name: 'Coromandel Peninsula (New Zealand)', icon: '🇳🇿', country: 'New Zealand', distance: '250 km', duration: '2-3 days', coordinates: [[-36.8485, 174.7633], [-36.7800, 175.7800]], waypoints: [[-36.8485, 174.7633, 'Auckland'], [-36.7800, 175.7800, 'Hahei'], [-37.0000, 175.8500, 'Cathedral Cove']], tags: ['scenic', 'adventure'], description: 'Beaches, hot springs, and Cathedral Cove.', tips: 'Hot Water Beach. Summer best.', rating: 4.6, difficulty: 'easy', bestSeason: 'October-April', budget: 'NZ$300-600' },
            { id: 'panamerican_mexico_central', name: 'Pan-American Mexico (Segment)', icon: '🇲🇽', country: 'Mexico', distance: '1500 km', duration: '7-10 days', coordinates: [[19.4326, -99.1332], [32.5149, -117.0382]], waypoints: [[19.4326, -99.1332, 'Mexico City'], [20.6597, -103.3496, 'Guadalajara'], [25.6866, -100.3161, 'Monterrey'], [32.5149, -117.0382, 'Tijuana']], tags: ['epic', 'historic'], description: 'Central Mexico to US border. Colonial towns and desert.', tips: 'Check security. Toll roads. Spring or fall.', rating: 4.5, difficulty: 'moderate', bestSeason: 'November-April', budget: '$800-1500' },
            { id: 'india_rajasthan_golden', name: 'Rajasthan Golden Triangle', icon: '🇮🇳', country: 'India', distance: '800 km', duration: '6-8 days', coordinates: [[28.7041, 77.1025], [26.9124, 75.7873]], waypoints: [[28.7041, 77.1025, 'Delhi'], [26.9124, 75.7873, 'Jaipur'], [27.1767, 78.0081, 'Agra'], [26.2389, 73.0243, 'Jodhpur']], tags: ['historic', 'scenic'], description: 'Taj Mahal, forts, and palaces. Classic India.', tips: 'Driver or self-drive. Ranthambore for tigers.', rating: 4.8, difficulty: 'moderate', bestSeason: 'October-March', budget: '$500-1200' }
        ];

        // ==================== WORLD VIEWPOINTS & HISTORICAL SITES (UNESCO + FAMOUS) ====================
        const worldViewpoints = [
            // Africa
            { name: 'Pyramids of Giza', lat: 29.9792, lng: 31.1342, type: 'historic', icon: '🏛️', country: 'Egypt', unesco: true },
            { name: 'Victoria Falls', lat: -17.9243, lng: 25.8572, type: 'viewpoint', icon: '💧', country: 'Zambia/Zimbabwe', unesco: true },
            { name: 'Serengeti', lat: -2.3333, lng: 34.8333, type: 'nature', icon: '🦁', country: 'Tanzania', unesco: true },
            { name: 'Medina of Fes', lat: 34.0181, lng: -5.0078, type: 'historic', icon: '🕌', country: 'Morocco', unesco: true },
            { name: 'Rock Churches of Lalibela', lat: 12.0300, lng: 39.0442, type: 'historic', icon: '⛪', country: 'Ethiopia', unesco: true },
            { name: 'Table Mountain', lat: -33.9628, lng: 18.4098, type: 'viewpoint', icon: '⛰️', country: 'South Africa' },
            { name: 'Ngorongoro Crater', lat: -3.2400, lng: 35.5320, type: 'nature', icon: '🌋', country: 'Tanzania', unesco: true },
            { name: 'Sossusvlei Dunes', lat: -24.7275, lng: 15.7390, type: 'viewpoint', icon: '🏜️', country: 'Namibia' },
            // Asia
            { name: 'Taj Mahal', lat: 27.1751, lng: 78.0421, type: 'historic', icon: '🕌', country: 'India', unesco: true },
            { name: 'Great Wall of China', lat: 40.4319, lng: 116.5704, type: 'historic', icon: '🏯', country: 'China', unesco: true },
            { name: 'Angkor Wat', lat: 13.4125, lng: 103.8670, type: 'historic', icon: '🛕', country: 'Cambodia', unesco: true },
            { name: 'Mount Fuji', lat: 35.3606, lng: 138.7274, type: 'viewpoint', icon: '🗻', country: 'Japan', unesco: true },
            { name: 'Ha Long Bay', lat: 20.9101, lng: 107.1839, type: 'nature', icon: '🌊', country: 'Vietnam', unesco: true },
            { name: 'Petra', lat: 30.3285, lng: 35.4444, type: 'historic', icon: '🏛️', country: 'Jordan', unesco: true },
            { name: 'Bagan Temples', lat: 21.1717, lng: 94.8585, type: 'historic', icon: '🛕', country: 'Myanmar', unesco: true },
            { name: 'Hagia Sophia', lat: 41.0086, lng: 28.9802, type: 'historic', icon: '🕌', country: 'Turkey', unesco: true },
            { name: 'Borobudur', lat: -7.6079, lng: 110.2038, type: 'historic', icon: '🛕', country: 'Indonesia', unesco: true },
            { name: 'Terracotta Army', lat: 34.3848, lng: 109.2785, type: 'historic', icon: '🏺', country: 'China', unesco: true },
            { name: 'Sigiriya Rock', lat: 7.9570, lng: 80.7603, type: 'historic', icon: '🏰', country: 'Sri Lanka', unesco: true },
            { name: 'Khajuraho', lat: 24.8318, lng: 79.9199, type: 'historic', icon: '🛕', country: 'India', unesco: true },
            // Europe
            { name: 'Colosseum', lat: 41.8902, lng: 12.4922, type: 'historic', icon: '🏟️', country: 'Italy', unesco: true },
            { name: 'Acropolis', lat: 37.9715, lng: 23.7257, type: 'historic', icon: '🏛️', country: 'Greece', unesco: true },
            { name: 'Eiffel Tower', lat: 48.8584, lng: 2.2945, type: 'viewpoint', icon: '🗼', country: 'France' },
            { name: 'Neuschwanstein Castle', lat: 47.5576, lng: 10.7498, type: 'historic', icon: '🏰', country: 'Germany' },
            { name: 'Santorini Caldera', lat: 36.3932, lng: 25.4615, type: 'viewpoint', icon: '🌅', country: 'Greece' },
            { name: 'Stonehenge', lat: 51.1789, lng: -1.8262, type: 'historic', icon: '🪨', country: 'UK', unesco: true },
            { name: 'Alhambra', lat: 37.1760, lng: -3.5881, type: 'historic', icon: '🏰', country: 'Spain', unesco: true },
            { name: 'Dubrovnik Old Town', lat: 42.6507, lng: 18.0944, type: 'historic', icon: '🏰', country: 'Croatia', unesco: true },
            // Americas
            { name: 'Machu Picchu', lat: -13.1631, lng: -72.5450, type: 'historic', icon: '🏔️', country: 'Peru', unesco: true },
            { name: 'Grand Canyon', lat: 36.1069, lng: -112.1129, type: 'viewpoint', icon: '🏜️', country: 'USA', unesco: true },
            { name: 'Chichen Itza', lat: 20.6843, lng: -88.5678, type: 'historic', icon: '🏛️', country: 'Mexico', unesco: true },
            { name: 'Iguazu Falls', lat: -25.6953, lng: -54.4367, type: 'viewpoint', icon: '💧', country: 'Argentina/Brazil', unesco: true },
            { name: 'Monument Valley', lat: 36.9980, lng: -110.0985, type: 'viewpoint', icon: '🏜️', country: 'USA' },
            { name: 'Moai of Easter Island', lat: -27.1127, lng: -109.3497, type: 'historic', icon: '🗿', country: 'Chile', unesco: true },
            // Oceania
            { name: 'Great Barrier Reef', lat: -18.2871, lng: 147.6992, type: 'nature', icon: '🐠', country: 'Australia', unesco: true },
            { name: 'Uluru', lat: -25.3444, lng: 131.0369, type: 'nature', icon: '🪨', country: 'Australia', unesco: true },
            { name: 'Milford Sound', lat: -44.6414, lng: 167.8975, type: 'viewpoint', icon: '⛰️', country: 'New Zealand' }
        ];

        // ==================== VANLIFER COUNTRY INFO DATABASE ====================
        const vanliferInfo = {
            'United States of America': { tolls: 'Varies', tollClass: 'moderate', camping: 'BLM Land Free', campingClass: 'good', fuel: '$0.90/L', fuelClass: 'good', visa: '90 days ESTA', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Canada': { tolls: 'Few', tollClass: 'good', camping: 'Crown Land Free', campingClass: 'good', fuel: '$1.60/L', fuelClass: 'moderate', visa: '6 months eTA', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Mexico': { tolls: 'Expensive', tollClass: 'bad', camping: 'Informal OK', campingClass: 'moderate', fuel: '$1.20/L', fuelClass: 'good', visa: '180 days free', roadQuality: 'Variable', waterAccess: 'Moderate' },
            'France': { tolls: 'Very High', tollClass: 'bad', camping: 'Restricted', campingClass: 'bad', fuel: '$1.90/L', fuelClass: 'bad', visa: 'EU/90 days', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Spain': { tolls: 'Moderate', tollClass: 'moderate', camping: 'Gray Area', campingClass: 'moderate', fuel: '$1.60/L', fuelClass: 'moderate', visa: 'EU/90 days', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Portugal': { tolls: 'Moderate', tollClass: 'moderate', camping: 'Tolerated', campingClass: 'moderate', fuel: '$1.70/L', fuelClass: 'moderate', visa: 'EU/90 days', roadQuality: 'Good', waterAccess: 'Easy' },
            'Germany': { tolls: 'Free (cars)', tollClass: 'good', camping: 'Restricted', campingClass: 'bad', fuel: '$1.80/L', fuelClass: 'bad', visa: 'EU/90 days', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Italy': { tolls: 'Very High', tollClass: 'bad', camping: 'Restricted', campingClass: 'bad', fuel: '$1.85/L', fuelClass: 'bad', visa: 'EU/90 days', roadQuality: 'Good', waterAccess: 'Moderate' },
            'United Kingdom': { tolls: 'Few', tollClass: 'good', camping: 'Scotland OK', campingClass: 'moderate', fuel: '$1.95/L', fuelClass: 'bad', visa: '6 months', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Ireland': { tolls: 'Few', tollClass: 'good', camping: 'Tolerated', campingClass: 'good', fuel: '$1.80/L', fuelClass: 'bad', visa: '90 days', roadQuality: 'Good', waterAccess: 'Easy' },
            'Norway': { tolls: 'High', tollClass: 'bad', camping: 'Legal!', campingClass: 'good', fuel: '$2.20/L', fuelClass: 'bad', visa: 'EU/90 days', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Sweden': { tolls: 'Few', tollClass: 'good', camping: 'Legal!', campingClass: 'good', fuel: '$1.90/L', fuelClass: 'bad', visa: 'EU/90 days', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Iceland': { tolls: 'None', tollClass: 'good', camping: 'Designated', campingClass: 'moderate', fuel: '$2.30/L', fuelClass: 'bad', visa: 'EU/90 days', roadQuality: 'Variable', waterAccess: 'Moderate' },
            'Romania': { tolls: 'Cheap', tollClass: 'good', camping: 'Tolerated', campingClass: 'good', fuel: '$1.40/L', fuelClass: 'good', visa: 'EU/90 days', roadQuality: 'Variable', waterAccess: 'Moderate' },
            'Greece': { tolls: 'Moderate', tollClass: 'moderate', camping: 'Restricted', campingClass: 'bad', fuel: '$1.85/L', fuelClass: 'bad', visa: 'EU/90 days', roadQuality: 'Good', waterAccess: 'Moderate' },
            'Australia': { tolls: 'City Only', tollClass: 'good', camping: 'Outback Free', campingClass: 'good', fuel: '$1.50/L', fuelClass: 'moderate', visa: 'eVisitor', roadQuality: 'Excellent', waterAccess: 'Variable' },
            'New Zealand': { tolls: 'Very Few', tollClass: 'good', camping: 'Freedom OK', campingClass: 'good', fuel: '$1.70/L', fuelClass: 'moderate', visa: '3 months', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'South Africa': { tolls: 'Moderate', tollClass: 'moderate', camping: 'Variable', campingClass: 'moderate', fuel: '$1.10/L', fuelClass: 'good', visa: '90 days', roadQuality: 'Good', waterAccess: 'Variable' },
            'Morocco': { tolls: 'Cheap', tollClass: 'good', camping: 'Very Easy', campingClass: 'good', fuel: '$1.20/L', fuelClass: 'good', visa: '90 days', roadQuality: 'Variable', waterAccess: 'Moderate' },
            'Japan': { tolls: 'Very High', tollClass: 'bad', camping: 'Michi-no-Eki', campingClass: 'moderate', fuel: '$1.40/L', fuelClass: 'good', visa: '90 days', roadQuality: 'Excellent', waterAccess: 'Easy' },
            'Namibia': { tolls: 'None!', tollClass: 'good', camping: 'Excellent', campingClass: 'good', fuel: '~$1.10/L', fuelClass: 'good', visa: '90 days free', roadQuality: 'Gravel roads', waterAccess: 'Plan ahead', special: '4x4 + rooftop tent recommended. Book NWR camps early!' }
        };

        // Default vanlifer info
        const defaultVanliferInfo = { tolls: 'Unknown', tollClass: 'moderate', camping: 'Research needed', campingClass: 'moderate', fuel: 'Varies', fuelClass: 'moderate', visa: 'Check requirements', roadQuality: 'Variable', waterAccess: 'Variable' };

        // ==================== CONTINENT MAPPING ====================
        const continentMapping = {
            '840': 'North America', '124': 'North America', '484': 'North America',
            '76': 'South America', '32': 'South America', '152': 'South America', '170': 'South America', '604': 'South America',
            '250': 'Europe', '276': 'Europe', '380': 'Europe', '724': 'Europe', '620': 'Europe', '826': 'Europe', '372': 'Europe',
            '752': 'Europe', '578': 'Europe', '352': 'Europe', '642': 'Europe', '300': 'Europe', '756': 'Europe',
            '156': 'Asia', '392': 'Asia', '410': 'Asia', '764': 'Asia', '704': 'Asia', '356': 'Asia',
            '36': 'Oceania', '554': 'Oceania',
            '710': 'Africa', '504': 'Africa', '818': 'Africa', '404': 'Africa'
        };

        // ==================== INITIALIZE ====================
        async function initMap() {
            // Wait for D3 to be available
            if (typeof d3 === 'undefined') {
                setTimeout(initMap, 100);
                return;
            }
            if (typeof topojson === 'undefined') {
                setTimeout(initMap, 100);
                return;
            }
            
            try {
                var loadingEl = document.getElementById('mapLoading');
                
                // Setup SVG with D3
                svg = d3.select("#worldMap");
                g = svg.append("g");

                // ORIGINAL Mercator projection settings
                projection = d3.geoMercator()
                    .scale(320)
                    .translate([1000, 650]);

                path = d3.geoPath().projection(projection);

                // Fetch map data
                var world = await d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json");
                var countries = topojson.feature(world, world.objects.countries);
                
                // Draw countries – minimalist: default fill, then highlights applied below
                g.selectAll("path")
                    .data(countries.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("id", function(d) { return "country_" + d.id; })
                    .attr("data-id", function(d) { return d.id; })
                    .attr("data-name", function(d) { return d.properties.name || "Unknown"; })
                    .on("click", function(event, d) {
                        event.stopPropagation();
                        selectCountry(this, d);
                    })
                    .on("dblclick", function(event, d) {
                        event.stopPropagation();
                        event.preventDefault();
                        openCountrySatelliteView(d.properties.name || "Unknown");
                    })
                    .append("title")
                    .text(function(d) {
                        var name = d.properties.name || "Unknown";
                        var rt = getRoadTripCountryNames();
                        if (rt.has(name)) return name + " – Road trips available";
                        return name;
                    });

                countriesData = countries.features;
                applyWorldMapHighlights();
                
                // Hide loading indicator
                if (loadingEl) loadingEl.style.display = 'none';
                
                // Initialize other components
                populateCountrySearch();
                setupZoom();
                loadFromStorage();
                applyWorldMapHighlights();
                updateStats();
                renderRoadTrips();
                renderAlerts();
                renderPlannedTrips();
                checkPremiumStatus();
                initializeAds();

                // Default: show the real world map (Leaflet) with road trip traces and pins, not the country-highlight map
                initRoadMap();
                setTimeout(function() {
                    if (roadMap) roadMap.invalidateSize();
                }, 150);
                switchMode('serendipity');

            } catch (err) {
                console.error("Map init error:", err);
                var loadingEl = document.getElementById('mapLoading');
                if (loadingEl) {
                    loadingEl.innerHTML = '<div style="color: red;">Map error. <button onclick="location.reload()">Retry</button></div>';
                }
            }
        }

        function initRoadMap() {
            if (roadMap) return;
            
            roadMap = L.map('roadMap', {
                center: [35, 10],
                zoom: 4,
                zoomControl: false,
                minZoom: 2,
                maxZoom: 18
            });

            // Base dark layer
            const darkBase = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
                attribution: '© OpenStreetMap, © CARTO',
                maxZoom: 19
            });

            // OpenStreetMap roads
            const osmRoads = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap',
                maxZoom: 19,
                className: 'osm-roads-layer'
            });

            // Vue naturelle de la Terre : relief, déserts, forêts (Esri World Physical)
            const esriPhysical = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}', {
                attribution: '© Esri',
                maxZoom: 8
            });

            // Stamen Terrain – couleurs naturelles, relief (fallback si Esri limité en zoom)
            const stamenTerrain = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}{r}.png', {
                attribution: '© Stadia Maps, © OpenStreetMap',
                maxZoom: 18
            });

            // Carto Voyager (style léger)
            const cartoVoyager = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '© OpenStreetMap, © CARTO',
                maxZoom: 19
            });

            // Default: vue naturelle de la Terre (relief, déserts, forêts)
            esriPhysical.addTo(roadMap);

            // Layer control
            const baseLayers = {
                "🌍 Terre (relief, forêts, déserts)": esriPhysical,
                "🗺️ Terrain (détails)": stamenTerrain,
                "🛣️ OpenStreetMap": osmRoads,
                "☀️ Light": cartoVoyager,
                "🌙 Dark Mode": darkBase
            };
            L.control.layers(baseLayers, null, { position: 'topright' }).addTo(roadMap);
            L.control.zoom({ position: 'bottomright' }).addTo(roadMap);

            // Add road trip routes (store refs for highlight when user selects a trip)
            routeLayers = {};
            roadTrips.forEach(trip => {
                if (trip.waypoints && trip.waypoints.length > 1) {
                    const coords = trip.waypoints.map(w => [w[0], w[1]]);
                    
                    // Draw route line – SRNDIPITY charter: orange (active) / olive (routes)
                    const routeColor = trip.personalTrip ? '#2D3E33' : '#E07A5F';
                    const routeLine = L.polyline(coords, {
                        color: routeColor,
                        weight: trip.personalTrip ? 4 : 4,
                        opacity: 0.92,
                        lineCap: 'round',
                        lineJoin: 'round'
                    }).addTo(roadMap);

                    routeLayers[trip.id] = { polyline: routeLine, markers: [] };

                    // Single-click: select trip, highlight route, zoom to route, scroll sidebar to card
                    routeLine.on('click', function(e) {
                        L.DomEvent.stopPropagation(e);
                        selectRoute(trip.id);
                    });
                    // Double-click on route line opens trip detail
                    routeLine.on('dblclick', function(e) {
                        L.DomEvent.stopPropagation(e);
                        openTripDetail(trip.id);
                    });

                    // Hover effect for route lines (cursor + slight emphasis)
                    routeLine.on('mouseover', function() {
                        if (activeRoute !== trip.id) this.setStyle({ weight: 5, opacity: 1 });
                    });
                    routeLine.on('mouseout', function() {
                        if (activeRoute !== trip.id) this.setStyle({ weight: 4, opacity: 0.92 });
                    });

                    // Add tooltip on hover showing trip name
                    routeLine.bindTooltip(`<strong>${trip.icon} ${trip.name}</strong><br>Click to select • Double-click for details`, {
                        sticky: true,
                        className: 'route-tooltip'
                    });

                    // Add markers for waypoints – distinguish grandes étapes (start, end, numbered stops)
                    trip.waypoints.forEach((wp, idx) => {
                        const isStart = idx === 0;
                        const isEnd = idx === trip.waypoints.length - 1;
                        let html;
                        if (isStart) html = '<span class="route-marker start">A</span>';
                        else if (isEnd) html = '<span class="route-marker end">B</span>';
                        else html = '<span class="route-marker etape">' + (idx) + '</span>';
                        
                        const marker = L.marker([wp[0], wp[1]], {
                            icon: L.divIcon({
                                className: 'custom-marker route-waypoint-marker',
                                html: html,
                                iconSize: [32, 32],
                                iconAnchor: [16, 16]
                            })
                        }).addTo(roadMap);
                        if (routeLayers[trip.id]) routeLayers[trip.id].markers.push(marker);

                        // Create popup with click action to open trip detail
                        const popupContent = `
                            <div class="route-popup">
                                <h4>${wp[2] || 'Waypoint'}</h4>
                                <p><strong>${trip.icon} ${trip.name}</strong></p>
                                ${trip.personalTrip ? '<div style="color: #22c55e; font-size: 0.8rem;">✓ Visité</div>' : ''}
                                <div style="font-size: 0.8rem; color: #9494a8; margin-bottom: 10px;">${trip.description || ''}</div>
                                <button onclick="openTripDetail('${trip.id}')" style="
                                    background: #E07A5F;
                                    color: #2D2A1E;
                                    border: none;
                                    padding: 8px 16px;
                                    border-radius: 6px;
                                    cursor: pointer;
                                    font-size: 0.85rem;
                                    width: 100%;
                                ">📚 Open Full Guide</button>
                            </div>
                        `;
                        marker.bindPopup(popupContent);
                        
                        // Double-click on marker opens trip detail directly
                        marker.on('dblclick', function(e) {
                            L.DomEvent.stopPropagation(e);
                            openTripDetail(trip.id);
                        });
                    });

                    // Add camping markers for trips that have them
                    if (trip.campingSites) {
                        trip.campingSites.forEach(camp => {
                            if (camp.coords) {
                                const campMarker = L.marker(camp.coords, {
                                    icon: L.divIcon({
                                        className: 'custom-marker',
                                        html: '🏕️',
                                        iconSize: [26, 26]
                                    })
                                }).addTo(roadMap);

                                campMarker.bindPopup(`
                                    <div class="route-popup">
                                        <h4>🏕️ ${camp.name}</h4>
                                        <p><strong>${camp.type}</strong> - ${camp.location}</p>
                                        <div style="color: #22c55e; font-weight: bold;">${camp.price}/nuit</div>
                                        <div style="font-size: 0.8rem; color: #9494a8; margin-top: 4px;">${camp.facilities}</div>
                                    </div>
                                `);
                            }
                        });
                    }

                    routeLine.bindPopup(`
                        <div class="route-popup">
                            <h4>${trip.icon} ${trip.name}</h4>
                            <p>${trip.distance} • ${trip.duration}</p>
                            ${trip.personalTrip ? '<div style="color: #22c55e;">✓ Mon voyage - ' + trip.tripDate + '</div>' : ''}
                            <div style="font-size: 0.8rem; margin-top: 8px;">${trip.tips}</div>
                        </div>
                    `);
                }
            });

            // Add community alert markers
            communityAlerts.forEach(alert => {
                if (alert.lat && alert.lng) {
                    const alertIcon = L.divIcon({
                        className: `custom-marker ${alert.type === 'hazard' ? 'danger-marker' : 'alert-marker'}`,
                        html: getAlertIcon(alert.type),
                        iconSize: [30, 30]
                    });

                    L.marker([alert.lat, alert.lng], { icon: alertIcon })
                        .addTo(roadMap)
                        .bindPopup(`<div class="route-popup"><h4>${alert.title}</h4><p>${alert.description}</p></div>`);
                }
            });
            
            // Initialize POI layers after map is ready
            initPoiLayers();
            loadPoiPreferences();
        }

        // ==================== POI LAYER MANAGEMENT ====================
        
        // Initialize POI layers (call after roadMap is created)
        function initPoiLayers() {
            if (!roadMap) return;
            
            // Create layer groups for each POI type
            Object.keys(poiLayers).forEach(type => {
                poiLayers[type] = L.layerGroup();
            });
            
            // Populate layers with markers
            populatePoiMarkers();
            
            // Update counts in UI
            updatePoiCounts();
            
            // Cache POI data for offline use
            cachePoiData();
            
            // Check online status
            updateOnlineStatus();
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
        }

        // Populate POI markers from database (main road map)
        function populatePoiMarkers() {
            const iconConfig = {
                campsiteFree: { icon: '⛺', class: 'campsite-free' },
                campsitePaid: { icon: '🏕️', class: 'campsite-paid' },
                overnightParking: { icon: '🅿️', class: 'rest-area' },
                fuel: { icon: '⛽', class: 'fuel' },
                grocery: { icon: '🛒', class: 'grocery' },
                localProducer: { icon: '🧑‍🌾', class: 'grocery' },
                organicRestaurant: { icon: '🥗', class: 'grocery' },
                water: { icon: '💧', class: 'water' },
                viewpoint: { icon: '📸', class: 'viewpoint' },
                restArea: { icon: '🅿️', class: 'rest-area' },
                mechanic: { icon: '🔧', class: 'mechanic' },
                premium: { icon: '⭐', class: 'premium' }
            };
            
            Object.keys(poiDatabase).forEach(type => {
                const config = iconConfig[type] || { icon: '📍', class: 'viewpoint' };
                const pois = poiDatabase[type];
                if (!pois || !poiLayers[type]) return;
                
                // Use MarkerCluster for the main map too
                const clusterLayer = (L.markerClusterGroup) ? L.markerClusterGroup({
                    maxClusterRadius: 50,
                    showCoverageOnHover: false,
                    disableClusteringAtZoom: 13
                }) : L.layerGroup();

                pois.forEach(poi => {
                    const isPremium = type === 'premium';
                    const marker = L.marker([poi.lat, poi.lng], {
                        icon: L.divIcon({
                            className: 'poi-marker',
                            html: `<div class="poi-marker-icon ${config.class}${isPremium ? ' premium' : ''}">${config.icon}</div>`,
                            iconSize: [28, 28],
                            iconAnchor: [14, 14]
                        })
                    });
                    
                    const popupContent = createPoiPopup(poi, type);
                    marker.bindPopup(popupContent, { maxWidth: 300, className: 'poi-popup-wrapper' });
                    clusterLayer.addLayer(marker);
                });
                poiLayers[type] = clusterLayer;
            });
        }

        // Create popup content for POI
        function createPoiPopup(poi, type) {
            const typeLabels = {
                campsiteFree: 'Wild spot with a view', campsitePaid: 'Full-service Campsite',
                fuel: 'Fuel Station', grocery: 'Supermarket', water: 'Water Refill',
                viewpoint: 'Viewpoint', restArea: 'Rest Area', mechanic: 'Mechanic/Service',
                localProducer: 'Local Producer', organicRestaurant: 'Organic Restaurant',
                overnightParking: 'Overnight Parking', premium: 'Verified Partner'
            };
            const icons = {
                campsiteFree: '⛺', campsitePaid: '🏕️', fuel: '⛽', grocery: '🛒',
                water: '💧', viewpoint: '📸', restArea: '🅿️', mechanic: '🔧',
                localProducer: '🧑‍🌾', organicRestaurant: '🥗', overnightParking: '🅿️', premium: '⭐'
            };
            const bgColors = {
                campsiteFree: '#22c55e', campsitePaid: '#3b82f6', fuel: '#ef4444', grocery: '#f59e0b',
                water: '#06b6d4', viewpoint: '#8b5cf6', restArea: '#6b7280', mechanic: '#dc2626',
                localProducer: '#84cc16', organicRestaurant: '#10b981', overnightParking: '#6366f1',
                premium: '#f59e0b'
            };

            const poiId = getPoiId(poi);
            const votes = getPoiVotes();
            const v = votes[poiId] || { up: 0, down: 0, myVote: null };
            const net = v.up - v.down;
            const isVerified = net >= COMMUNITY_VERIFIED_THRESHOLD;
            const reports = getPoiReports();
            const isReported = !!reports[poiId];
            const isPremium = type === 'premium' || poi.isPremium;

            let html = `<div class="poi-popup-v2">
                <div class="poi-v2-header">
                    <div class="poi-v2-icon-wrap" style="background:${bgColors[type] || '#6b7280'}20;">
                        <span style="font-size:1.3rem;">${icons[type] || '📍'}</span>
                    </div>
                    <div style="flex:1;">
                        <div class="poi-v2-title">${poi.name}</div>
                        <div class="poi-v2-type">${typeLabels[type] || type}</div>
                    </div>
                    ${isVerified ? '<span class="poi-v2-verified">✓ Community Verified</span>' : ''}
                    ${isPremium ? '<span class="poi-v2-partner-badge">★ Verified Partner</span>' : ''}
                </div>
                <div class="poi-v2-details">
                    <p>📍 <strong>${poi.region || ''}</strong>${poi.country ? ', ' + poi.country : ''}</p>
                    ${poi.price ? `<p>💰 ${poi.price}</p>` : ''}
                    ${poi.type ? `<p>🏷️ ${poi.type}</p>` : ''}
                    ${poi.rating ? `<p>⭐ ${poi.rating}/5 (${poi.reviews || 0} reviews)</p>` : ''}
                </div>
                ${poi.tip ? `<div class="poi-v2-tip">💡 <strong>Pro-Tip:</strong> ${poi.tip}</div>` : ''}`;

            // Premium CTA
            if (isPremium && poi.partnerUrl) {
                html += `<a href="${poi.partnerUrl}" target="_blank" rel="noopener sponsored" class="poi-v2-book-btn">
                    🔗 Book Now ${poi.price ? '· ' + poi.price : ''} <span style="font-size:0.65rem;opacity:0.8;margin-left:4px;">via ${poi.partner || 'Partner'}</span>
                </a>`;
            }

            // Community vote row
            html += `<div class="poi-v2-vote-row">
                <span class="poi-v2-vote-label">Still valid?</span>
                <button class="poi-v2-vote-btn ${v.myVote === 'up' ? 'voted-up' : ''}" onclick="handlePoiVote('up',${poi.lat},${poi.lng},'${(poi.name||'').replace(/'/g,"\\'")}',this)">👍 ${v.up}</button>
                <button class="poi-v2-vote-btn ${v.myVote === 'down' ? 'voted-down' : ''}" onclick="handlePoiVote('down',${poi.lat},${poi.lng},'${(poi.name||'').replace(/'/g,"\\'")}',this)">👎 ${v.down}</button>
                <span class="poi-v2-vote-count">${isVerified ? '✓ Verified' : net + ' net'}</span>
            </div>`;

            // Report row
            html += `<div class="poi-v2-report">
                <button class="poi-v2-report-btn" onclick="handlePoiReport(${poi.lat},${poi.lng},'${(poi.name||'').replace(/'/g,"\\'")}','closed',this)" ${isReported ? 'disabled style="opacity:0.5;"' : ''}>
                    ${isReported ? '⚠️ Reported' : '🚫 Closed'}
                </button>
                <button class="poi-v2-report-btn" onclick="handlePoiReport(${poi.lat},${poi.lng},'${(poi.name||'').replace(/'/g,"\\'")}','wrong_location',this)" ${isReported ? 'disabled style="opacity:0.5;"' : ''}>
                    ${isReported ? '⚠️ Reported' : '📍 Wrong Location'}
                </button>
            </div>`;

            // Actions
            html += `<div class="poi-v2-actions">
                <a href="https://www.google.com/maps/search/?api=1&query=${poi.lat},${poi.lng}" target="_blank">🗺️ Maps</a>
                <a href="https://www.google.com/maps/dir/?api=1&destination=${poi.lat},${poi.lng}" target="_blank">🚗 Directions</a>
            </div></div>`;
            return html;
        }

        function handlePoiVote(dir, lat, lng, name, btnEl) {
            const result = dir === 'up' ? votePoiUp(lat, lng, name) : votePoiDown(lat, lng, name);
            // Update the popup in place
            const popup = btnEl.closest('.poi-popup-v2');
            if (!popup) return;
            const btns = popup.querySelectorAll('.poi-v2-vote-btn');
            btns[0].className = 'poi-v2-vote-btn' + (result.myVote === 'up' ? ' voted-up' : '');
            btns[0].innerHTML = '👍 ' + result.up;
            btns[1].className = 'poi-v2-vote-btn' + (result.myVote === 'down' ? ' voted-down' : '');
            btns[1].innerHTML = '👎 ' + result.down;
            const net = result.up - result.down;
            const countEl = popup.querySelector('.poi-v2-vote-count');
            if (countEl) countEl.textContent = net >= COMMUNITY_VERIFIED_THRESHOLD ? '✓ Verified' : net + ' net';
        }

        function handlePoiReport(lat, lng, name, reason, btnEl) {
            if (!confirm('Report this POI as "' + reason.replace('_', ' ') + '"?')) return;
            reportPoi(lat, lng, name, reason);
            const row = btnEl.closest('.poi-v2-report');
            if (row) row.querySelectorAll('.poi-v2-report-btn').forEach(b => { b.disabled = true; b.style.opacity = '0.5'; b.innerHTML = '⚠️ Reported'; });
        }

        // Toggle POI layer visibility
        function togglePoi(type, buttonEl) {
            if (!roadMap || !poiLayers[type]) return;
            
            poiVisible[type] = !poiVisible[type];
            
            if (poiVisible[type]) {
                roadMap.addLayer(poiLayers[type]);
                buttonEl.classList.add('active');
            } else {
                roadMap.removeLayer(poiLayers[type]);
                buttonEl.classList.remove('active');
            }
            
            // Save preference
            localStorage.setItem('srndipity_poi_visible', JSON.stringify(poiVisible));
        }

        // Toggle all POI layers
        function toggleAllPoi(show) {
            Object.keys(poiLayers).forEach(type => {
                poiVisible[type] = show;
                if (show && roadMap) {
                    roadMap.addLayer(poiLayers[type]);
                } else if (roadMap) {
                    roadMap.removeLayer(poiLayers[type]);
                }
            });
            
            // Update button states
            document.querySelectorAll('.poi-toggle').forEach(btn => {
                btn.classList.toggle('active', show);
            });
        }

        // Toggle POI panel collapse
        function togglePoiPanel() {
            const toggles = document.getElementById('poiToggles');
            const btn = document.querySelector('.poi-controls-toggle');
            
            if (toggles.style.display === 'none') {
                toggles.style.display = 'flex';
                btn.textContent = '−';
            } else {
                toggles.style.display = 'none';
                btn.textContent = '+';
            }
        }

        // Update POI counts in UI
        function updatePoiCounts() {
            Object.keys(poiDatabase).forEach(type => {
                const countEl = document.getElementById('count' + type.charAt(0).toUpperCase() + type.slice(1));
                if (countEl) {
                    countEl.textContent = poiDatabase[type].length;
                }
            });
        }

        // Cache POI data for offline use
        function cachePoiData() {
            try {
                localStorage.setItem('srndipity_poi_cache', JSON.stringify(poiDatabase));
                localStorage.setItem('srndipity_poi_cache_date', new Date().toISOString());
            } catch (e) {
                console.warn('Could not cache POI data:', e);
            }
        }

        // Load cached POI data
        function loadCachedPoiData() {
            try {
                const cached = localStorage.getItem('srndipity_poi_cache');
                if (cached) {
                    return JSON.parse(cached);
                }
            } catch (e) {
                console.warn('Could not load cached POI data:', e);
            }
            return null;
        }

        // Update online/offline status indicator
        function updateOnlineStatus() {
            const indicator = document.getElementById('offlineIndicator');
            if (indicator) {
                indicator.classList.toggle('visible', !navigator.onLine);
            }
        }

        // Show/hide POI controls based on mode
        function updatePoiControlsVisibility(mode) {
            const controls = document.getElementById('poiControls');
            if (controls) {
                controls.style.display = mode === 'serendipity' ? 'block' : 'none';
            }
        }

        // Load saved POI visibility preferences
        function loadPoiPreferences() {
            try {
                const saved = localStorage.getItem('srndipity_poi_visible');
                if (saved) {
                    const prefs = JSON.parse(saved);
                    Object.keys(prefs).forEach(type => {
                        if (prefs[type] && poiLayers[type] && roadMap) {
                            poiVisible[type] = true;
                            roadMap.addLayer(poiLayers[type]);
                            const btn = document.querySelector(`.poi-toggle[data-type="${type}"]`);
                            if (btn) btn.classList.add('active');
                        }
                    });
                }
            } catch (e) {
                console.warn('Could not load POI preferences:', e);
            }
        }

        // ==================== MODE SWITCHING (Map view only – sidebar is merged) ====================
        function switchMode(mode) {
            currentMode = mode;
            
            // Toggle vintage theme when viewing road map
            document.body.classList.toggle('vintage-mode', mode === 'serendipity');
            
            const logoIcon = document.getElementById('logoIcon');
            const logoText = document.getElementById('logoText');
            
            if (mode === 'serendipity') {
                if (logoIcon) { logoIcon.textContent = '🛣️'; logoIcon.classList.add('serendipity-mode'); }
                if (logoText) logoText.textContent = 'Road Trips';

                document.getElementById('worldMap').style.display = 'none';
                document.getElementById('roadMap').classList.add('active');
                document.getElementById('zoomControls').style.display = 'none';

                initRoadMap();
                setTimeout(() => roadMap && roadMap.invalidateSize(), 100);
                updatePoiControlsVisibility('serendipity');
            } else {
                if (logoIcon) { logoIcon.textContent = '🔍'; logoIcon.classList.remove('serendipity-mode'); }
                if (logoText) logoText.textContent = 'Srndipity';
                
                document.getElementById('worldMap').style.display = 'block';
                document.getElementById('roadMap').classList.remove('active');
                document.getElementById('zoomControls').style.display = 'flex';
                updatePoiControlsVisibility('diary');
            }
        }

        // ==================== COUNTRY SELECTION ====================
        function populateCountrySearch() {
            const select = document.getElementById('countrySearch');
            if (!select) return;
            const sorted = countriesData
                .map(d => ({ id: d.id, name: d.properties.name || "Unknown" }))
                .sort((a, b) => a.name.localeCompare(b.name));

            sorted.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = c.name;
                select.appendChild(opt);
            });
        }

        function selectCountryByCode(id) {
            if (!id) return;
            const el = document.querySelector(`[data-id="${id}"]`);
            if (el) {
                const data = countriesData.find(d => d.id == id);
                selectCountry(el, data);
            }
        }

        function selectCountry(element, data) {
            if (selectedCountry) {
                d3.select(selectedCountry).classed("selected", false);
            }

            selectedCountry = element;
            currentCountryId = data.id;
            currentCountryName = data.properties.name || "Unknown";
            d3.select(selectedCountry).classed("selected", true);

            const selName = document.getElementById('selectedCountryName');
            const selDisplay = document.getElementById('selectedDisplay');
            const countrySearchEl = document.getElementById('countrySearch');
            if (selName) selName.textContent = currentCountryName;
            if (selDisplay) selDisplay.classList.add('has-selection');
            if (countrySearchEl) countrySearchEl.value = data.id;

            // Update vanlifer info and zoom to roads if in serendipity mode
            if (currentMode === 'serendipity') {
                showVanliferInfo(currentCountryName);
                zoomToCountryRoads(currentCountryName);
            }
            
            // Enable plan trip button in diary mode
            updatePlanTripButton();
        }

        function showVanliferInfo(countryName) {
            const info = vanliferInfo[countryName] || defaultVanliferInfo;
            const panel = document.getElementById('vanliferCountryInfo');
            
            document.getElementById('vanliferCountryName').textContent = countryName;
            document.getElementById('tollInfo').textContent = info.tolls;
            document.getElementById('tollInfo').className = `detail-value ${info.tollClass}`;
            document.getElementById('campingInfo').textContent = info.camping;
            document.getElementById('campingInfo').className = `detail-value ${info.campingClass}`;
            document.getElementById('fuelInfo').textContent = info.fuel;
            document.getElementById('fuelInfo').className = `detail-value ${info.fuelClass}`;
            document.getElementById('visaInfo').textContent = info.visa;
            document.getElementById('roadQualityInfo').textContent = info.roadQuality;
            document.getElementById('waterInfo').textContent = info.waterAccess;
            
            panel.style.display = 'block';
        }

        // ==================== ROAD TRIPS ====================
        let currentRegionFilter = null;   // null = no region selected; user clicks region to open list
        let selectedTravelMonth = null;  // null = any month; when set, "recommended for this month" list
        
        // Best seasons for road trips - defined early so renderRoadTrips can use it
        const tripSeasons = {
            'route66': { best: [3, 4, 5, 8, 9, 10], avoid: [6, 7], reason: 'Avoid extreme summer heat in desert sections' },
            'pch': { best: [4, 5, 8, 9, 10], avoid: [11, 12, 0, 1], reason: 'Best weather and less fog' },
            'iceland-ring': { best: [5, 6, 7, 8], avoid: [10, 11, 12, 0, 1, 2], reason: 'Roads may be closed in winter' },
            'nc500': { best: [4, 5, 6, 7, 8, 9], avoid: [11, 12, 0, 1], reason: 'Scottish weather is mildest in summer' },
            'great-ocean': { best: [11, 12, 0, 1, 2], avoid: [5, 6, 7], reason: 'Southern hemisphere summer' },
            'garden-route': { best: [9, 10, 11, 0, 1, 2, 3], avoid: [5, 6, 7], reason: 'Dry season with pleasant temperatures' },
            'amalfi': { best: [4, 5, 6, 9], avoid: [7, 8], reason: 'Avoid peak summer crowds' },
            'romantic-road': { best: [4, 5, 6, 9], avoid: [11, 12, 0, 1, 2], reason: 'Best in spring/fall, Christmas markets in December' },
            'ring-of-kerry': { best: [4, 5, 6, 7, 8, 9], avoid: [11, 12, 0, 1], reason: 'Milder weather and longer days' },
            'wild-atlantic': { best: [5, 6, 7, 8], avoid: [11, 12, 0, 1], reason: 'Calmer weather along the coast' },
            'carretera-austral': { best: [11, 12, 0, 1, 2], avoid: [5, 6, 7], reason: 'Southern hemisphere summer' },
            'ruta-40': { best: [10, 11, 12, 0, 1, 2, 3], avoid: [5, 6, 7], reason: 'Patagonian summer is warmest' },
            'hai-van': { best: [1, 2, 3, 4], avoid: [9, 10, 11], reason: 'Avoid monsoon season' },
            'milford': { best: [11, 12, 0, 1, 2], avoid: [5, 6, 7], reason: 'New Zealand summer' },
            'trollstigen': { best: [5, 6, 7, 8], avoid: [9, 10, 11, 12, 0, 1, 2, 3, 4], reason: 'Road closed Oct-May' },
            'transfagarasan': { best: [6, 7, 8, 9], avoid: [10, 11, 12, 0, 1, 2, 3, 4, 5], reason: 'Road closed in winter' },
            'grossglockner': { best: [5, 6, 7, 8, 9], avoid: [10, 11, 12, 0, 1, 2, 3, 4], reason: 'Alpine road closed in winter' },
            'karakoram': { best: [5, 6, 7, 8, 9], avoid: [11, 12, 0, 1, 2], reason: 'High altitude, avoid winter' },
            'gibb-river': { best: [4, 5, 6, 7, 8, 9], avoid: [11, 12, 0, 1, 2], reason: 'Dry season only' },
            'icefields': { best: [6, 7, 8], avoid: [10, 11, 12, 0, 1, 2, 3], reason: 'Summer only' },
            'cabot-trail': { best: [5, 6, 7, 8, 9, 10], avoid: [12, 0, 1, 2, 3], reason: 'Fall foliage spectacular' },
            'blue-ridge': { best: [4, 5, 9, 10], avoid: [12, 0, 1, 2], reason: 'Spring flowers or fall colors' },
            'namibia': { best: [4, 5, 6, 7, 8, 9], avoid: [12, 0, 1, 2], reason: 'Dry season best' },
            'costa-rica': { best: [11, 12, 0, 1, 2, 3, 4], avoid: [9, 10], reason: 'Dry season Dec-Apr' }
        };

        // Check if a trip is good for selected month
        function getTripSeasonStatus(tripId) {
            if (selectedTravelMonth === null || selectedTravelMonth === undefined) return { status: 'unknown', reason: null };
            const seasonInfo = tripSeasons[tripId];
            if (!seasonInfo) return { status: 'unknown', reason: null };
            
            if (seasonInfo.best && seasonInfo.best.includes(selectedTravelMonth)) {
                return { status: 'best', reason: seasonInfo.reason };
            }
            if (seasonInfo.avoid && seasonInfo.avoid.includes(selectedTravelMonth)) {
                return { status: 'avoid', reason: seasonInfo.reason };
            }
            return { status: 'ok', reason: null };
        }
        
        const countryToContinent = {
            USA: 'North America', Canada: 'North America', Mexico: 'North America',
            Bahamas: 'North America', Cuba: 'North America', Jamaica: 'North America', 'Costa Rica': 'North America', Panama: 'North America', Guatemala: 'North America', Belize: 'North America', Honduras: 'North America', Nicaragua: 'North America', 'El Salvador': 'North America', 'Dominican Republic': 'North America',
            Brazil: 'South America', Argentina: 'South America', Chile: 'South America', Peru: 'South America', Colombia: 'South America', Ecuador: 'South America', Bolivia: 'South America', Uruguay: 'South America', Paraguay: 'South America', Venezuela: 'South America',
            UK: 'Europe', 'United Kingdom': 'Europe', Scotland: 'Europe', England: 'Europe', Wales: 'Europe', Ireland: 'Europe', France: 'Europe', Germany: 'Europe', Italy: 'Europe', Spain: 'Europe', Portugal: 'Europe', Norway: 'Europe', Sweden: 'Europe', Iceland: 'Europe', Switzerland: 'Europe', Austria: 'Europe', Greece: 'Europe', Croatia: 'Europe', Romania: 'Europe', Poland: 'Europe', 'Czech Republic': 'Europe', Hungary: 'Europe', Slovenia: 'Europe', Montenegro: 'Europe', Albania: 'Europe', Bulgaria: 'Europe', Serbia: 'Europe', Bosnia: 'Europe', 'Bosnia and Herzegovina': 'Europe', Netherlands: 'Europe', Belgium: 'Europe', Luxembourg: 'Europe', Denmark: 'Europe', Finland: 'Europe', Estonia: 'Europe', Latvia: 'Europe', Lithuania: 'Europe', Turkey: 'Europe', Cyprus: 'Europe', Malta: 'Europe', Andorra: 'Europe', Monaco: 'Europe', Liechtenstein: 'Europe', 'North Macedonia': 'Europe', Kosovo: 'Europe', Slovakia: 'Europe', Ukraine: 'Europe', Moldova: 'Europe', Belarus: 'Europe', Russia: 'Europe', Georgia: 'Europe', Armenia: 'Europe', Azerbaijan: 'Europe',
            Morocco: 'Africa', Tunisia: 'Africa', Egypt: 'Africa', 'South Africa': 'Africa', Namibia: 'Africa', Botswana: 'Africa', Kenya: 'Africa', Tanzania: 'Africa', Uganda: 'Africa', Ethiopia: 'Africa', Senegal: 'Africa', Madagascar: 'Africa', Zambia: 'Africa', Zimbabwe: 'Africa', Mozambique: 'Africa', Malawi: 'Africa', Lesotho: 'Africa', Rwanda: 'Africa', Ghana: 'Africa', Cameroon: 'Africa', Algeria: 'Africa', Libya: 'Africa', Sudan: 'Africa',
            Japan: 'Asia', China: 'Asia', India: 'Asia', Thailand: 'Asia', Vietnam: 'Asia', Indonesia: 'Asia', Malaysia: 'Asia', 'South Korea': 'Asia', Nepal: 'Asia', 'Sri Lanka': 'Asia', Taiwan: 'Asia', Philippines: 'Asia', Cambodia: 'Asia', Laos: 'Asia', Myanmar: 'Asia', Bhutan: 'Asia', Pakistan: 'Asia', Kazakhstan: 'Asia', Uzbekistan: 'Asia', Kyrgyzstan: 'Asia', Tajikistan: 'Asia', Mongolia: 'Asia', Jordan: 'Asia', Lebanon: 'Asia', Israel: 'Asia', UAE: 'Asia', Oman: 'Asia', Iran: 'Asia', 'Saudi Arabia': 'Asia', Yemen: 'Asia', Bangladesh: 'Asia', Singapore: 'Asia', 'Hong Kong': 'Asia', Maldives: 'Asia',
            Australia: 'Oceania', 'New Zealand': 'Oceania', Fiji: 'Oceania', 'Papua New Guinea': 'Oceania', 'New Caledonia': 'Oceania', Samoa: 'Oceania', Tonga: 'Oceania', Vanuatu: 'Oceania', 'Solomon Islands': 'Oceania',
            Multi: 'all'
        };
        function getAllTrips() {
            const all = [...roadTrips, ...userCreatedTrips];
            return all.map(t => ({ ...t, continent: t.continent || countryToContinent[t.country] || 'Europe' }));
        }

        function parseDistanceForSort(distanceStr) {
            if (!distanceStr || typeof distanceStr !== 'string') return 999999;
            const num = parseInt(distanceStr.replace(/[^0-9]/g, ''), 10);
            return isNaN(num) ? 999999 : num;
        }

        function applyTripSort(trips, sortBy) {
            const arr = [...trips];
            if (sortBy === 'topRated') {
                arr.sort((a, b) => (b.rating || 0) - (a.rating || 0));
            } else if (sortBy === 'shortest') {
                arr.sort((a, b) => parseDistanceForSort(a.distance) - parseDistanceForSort(b.distance));
            } else if (sortBy === 'newest') {
                const all = getAllTrips();
                const order = {};
                all.forEach((t, i) => { order[t.id] = i; });
                arr.sort((a, b) => (order[b.id] ?? 0) - (order[a.id] ?? 0));
            }
            return arr;
        }

        function toggleSaveToGarage(tripId) {
            if (garageTripIds.includes(tripId)) {
                garageTripIds = garageTripIds.filter(id => id !== tripId);
            } else {
                garageTripIds.push(tripId);
            }
            try { localStorage.setItem('srndipity_garage', JSON.stringify(garageTripIds)); } catch (e) {}
            renderRoadTrips();
        }

        function loadMoreTrips() {
            visibleTripCount += TRIPS_PAGE_SIZE;
            renderRoadTrips();
        }

        function renderRoadTrips() {
            const container = document.getElementById('roadTripsList');
            const sortSelect = document.getElementById('roadTripsSortBy');
            const loadMoreWrap = document.getElementById('roadTripsLoadMoreWrap');
            let allTrips = getAllTrips();
            
            const hasRegion = currentRegionFilter && currentRegionFilter !== 'all';
            const hasMonth = selectedTravelMonth !== null && selectedTravelMonth !== undefined;
            
            if (!hasRegion && !hasMonth) {
                if (container) container.innerHTML = '';
                const countElement = document.getElementById('roadTripsCount');
                if (countElement) countElement.textContent = '0';
                if (loadMoreWrap) loadMoreWrap.style.display = 'none';
                updateRoadTripsPanelVisibility();
                return;
            }
            
            if (hasRegion) {
                allTrips = allTrips.filter(trip => trip.continent === currentRegionFilter);
            }
            
            if (!hasRegion && hasMonth) {
                allTrips = allTrips.filter(trip => getTripSeasonStatus(trip.id).status === 'best');
            }

            // Apply vehicle filter
            if (activeVehicleFilter && activeVehicleFilter !== 'all') {
                allTrips = allTrips.filter(trip => tripMatchesVehicleFilter(trip));
            }
            // Apply budget filter
            if (activeBudgetFilter && activeBudgetFilter !== 'all') {
                allTrips = allTrips.filter(trip => classifyTripBudget(trip) === activeBudgetFilter);
            }
            
            const sortBy = (sortSelect && sortSelect.value) ? sortSelect.value : 'topRated';
            allTrips = applyTripSort(allTrips, sortBy);
            
            if (hasRegion && hasMonth) {
                allTrips.sort((a, b) => {
                    const aBest = getTripSeasonStatus(a.id).status === 'best' ? 1 : 0;
                    const bBest = getTripSeasonStatus(b.id).status === 'best' ? 1 : 0;
                    if (bBest !== aBest) return bBest - aBest;
                    return (sortBy === 'shortest' ? parseDistanceForSort(a.distance) - parseDistanceForSort(b.distance) : (b.rating || 0) - (a.rating || 0));
                });
            }
            
            const listKey = (currentRegionFilter || '') + (selectedTravelMonth ?? '') + sortBy + (activeVehicleFilter || '') + (activeBudgetFilter || '');
            if (listKey !== lastTripListKey) {
                visibleTripCount = TRIPS_PAGE_SIZE;
                lastTripListKey = listKey;
            }
            
            const totalCount = allTrips.length;
            const toShow = allTrips.slice(0, visibleTripCount);
            const hasMore = totalCount > visibleTripCount;
            
            const countElement = document.getElementById('roadTripsCount');
            if (countElement) countElement.textContent = totalCount;
            
            updateRoadTripsPanelVisibility();
            
            let tripCards = toShow.map((trip) => {
                const isCompleted = completedTrips.includes(trip.id);
                const isSaved = garageTripIds.includes(trip.id);
                const ratingStars = trip.rating ? '⭐'.repeat(Math.floor(trip.rating)) : '';
                const difficultyClass = trip.difficulty || 'moderate';
                const isSponsored = trip.sponsored || false;
                const isRugged = (trip.difficulty === 'challenging') || (trip.tags && trip.tags.includes('fourx4'));
                
                const seasonStatus = getTripSeasonStatus(trip.id);
                const seasonBadge = seasonStatus.status === 'best' 
                    ? `<span class="season-badge best" title="${(seasonStatus.reason || 'Great time to visit!').replace(/"/g, '&quot;')}">Best Season</span>`
                    : seasonStatus.status === 'avoid' 
                    ? `<span class="season-badge avoid" title="${(seasonStatus.reason || 'Consider another time').replace(/"/g, '&quot;')}">Off-Season</span>`
                    : '';
                
                const saveBtn = `<button type="button" class="trip-card-save ${isSaved ? 'saved' : ''}" onclick="event.stopPropagation(); toggleSaveToGarage('${trip.id}')" title="${isSaved ? 'Remove from Garage' : 'Save to Garage'}" aria-label="${isSaved ? 'Remove from Garage' : 'Save to Garage'}">${isSaved ? '<svg class="icon" aria-hidden="true"><use href="#icon-heart-filled"></use></svg>' : '<svg class="icon" aria-hidden="true"><use href="#icon-heart"></use></svg>'}</button>`;
                const badge4x4 = isRugged ? `<span class="badge-4x4" title="4x4 Recommended"><svg class="icon" aria-hidden="true"><use href="#icon-car"></use></svg> 4x4 Recommended</span>` : '';
                
                // Weather icon for the trip
                const weatherInfo = getWeatherIconForTrip(trip);
                const weatherBadge = `<span class="weather-icon-badge ${weatherInfo.class}" title="Climate: ${weatherInfo.label}">${weatherInfo.emoji} ${weatherInfo.label}</span>`;
                
                // Vehicle type badge
                const tags = (trip.tags || []).map(t => t.toLowerCase());
                const tripDesc = ((trip.description || '') + ' ' + (trip.name || '')).toLowerCase();
                let vehicleBadge = '';
                if (tags.includes('van') || tags.includes('vanlife') || tags.includes('camping') || tripDesc.includes('van') || tripDesc.includes('camper')) {
                    vehicleBadge = '<span class="vehicle-badge van">Van-Friendly</span>';
                } else if (tags.includes('motorcycle') || tags.includes('moto') || tripDesc.includes('motorcycle')) {
                    vehicleBadge = '<span class="vehicle-badge motorcycle">Motorcycle Epic</span>';
                } else if (isRugged) {
                    vehicleBadge = '<span class="vehicle-badge fourx4">4x4 Required</span>';
                }
                
                return `
                <div id="trip-card-${trip.id}" class="road-trip-card ${activeRoute === trip.id ? 'active' : ''} ${trip.personalTrip ? 'personal' : ''} ${isCompleted ? 'completed' : ''} ${trip.userCreated ? 'user-created' : ''} ${isSponsored ? 'sponsored' : ''} ${seasonStatus.status === 'best' ? 'season-best' : ''} ${seasonStatus.status === 'avoid' ? 'season-avoid' : ''}" onclick="selectRoute('${trip.id}')" ondblclick="event.stopPropagation(); openTripDetail('${trip.id}')">
                    ${saveBtn}
                    ${isCompleted ? '<div class="trip-completed-badge"><svg class="icon icon--sm" aria-hidden="true"><use href="#icon-check"></use></svg></div>' : ''}
                    <div class="road-trip-header">
                        <span class="road-trip-icon">${trip.icon}</span>
                        <span class="road-trip-name">${trip.name}</span>
                        ${badge4x4}
                        ${seasonBadge}
                        ${trip.personalTrip ? `<span class="personal-badge">Mon voyage</span>` : ''}
                        ${trip.userCreated ? `<span class="user-created-badge">Community</span>` : ''}
                        ${isSponsored ? `<span class="sponsored-badge">Sponsored</span>` : ''}
                        ${trip.difficulty ? `<span class="difficulty-badge ${difficultyClass}">${difficultyClass}</span>` : ''}
                    </div>
                    <div class="road-trip-meta">
                        <span>${trip.country}</span>
                        <span>${trip.distance}</span>
                        <span>${trip.duration}</span>
                        ${weatherBadge}
                    </div>
                    ${vehicleBadge ? `<div style="margin-top:4px;">${vehicleBadge}</div>` : ''}
                    ${trip.rating ? `
                        <div class="road-trip-rating">
                            <span>${ratingStars}</span>
                            <span class="rating-value">${trip.rating}</span>
                            <span style="color: var(--text-muted);">(${trip.reviews ? trip.reviews.length : 0} reviews)</span>
                        </div>
                    ` : ''}
                    ${seasonStatus.reason ? `<div class="season-tip">${seasonStatus.reason}</div>` : ''}
                    ${trip.tripDate ? `<div style="font-size: 0.7rem; color: var(--success); margin-top: 4px;">${trip.tripDate}</div>` : ''}
                    <div class="road-trip-tags">
                        ${(trip.tags || []).map(t => `<span class="road-tag ${t}">${t === 'fourx4' ? '4x4' : t}</span>`).join('')}
                    </div>
                    <button class="view-details-btn" onclick="event.stopPropagation(); openTripDetail('${trip.id}')">View Details</button>
                    ${!isCompleted ? `<button class="complete-btn" onclick="event.stopPropagation(); markTripCompleted('${trip.id}')">Done</button>` : ''}
                </div>
            `;
            });
            
            if (!isPremiumUser && tripCards.length > 3 && advertisers.sponsoredTrips.length > 0) {
                const sponsoredTrip = advertisers.sponsoredTrips[0];
                const sponsoredCard = `
                    <div class="road-trip-card sponsored" onclick="window.open('${sponsoredTrip.sponsorUrl}', '_blank')">
                        <div class="road-trip-header">
                            <span class="road-trip-icon">${sponsoredTrip.icon}</span>
                            <span class="road-trip-name">${sponsoredTrip.name}</span>
                            <span class="sponsored-badge">Sponsored by ${sponsoredTrip.sponsor}</span>
                        </div>
                        <div class="road-trip-meta">
                            <span>${sponsoredTrip.country}</span>
                            <span>${sponsoredTrip.distance}</span>
                            <span>${sponsoredTrip.duration}</span>
                        </div>
                        <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 8px;">${sponsoredTrip.description}</p>
                        <div class="road-trip-tags">
                            ${(sponsoredTrip.tags || []).map(t => `<span class="road-tag ${t}">${t}</span>`).join('')}
                        </div>
                        <a href="${sponsoredTrip.sponsorUrl}" target="_blank" class="view-details-btn" style="opacity: 1;" onclick="event.stopPropagation(); trackAdClick('${sponsoredTrip.id}', 'trip-list')">Learn More</a>
                    </div>
                `;
                tripCards.splice(3, 0, sponsoredCard);
            }
            
            container.innerHTML = tripCards.join('');
            
            if (loadMoreWrap) {
                loadMoreWrap.style.display = hasMore ? 'block' : 'none';
            }
            
            // Re-initialize Lucide icons for dynamically rendered content
            if (typeof lucide !== 'undefined') lucide.createIcons();
            
            updateLeagueStats();
        }

        function highlightRouteOnMap(routeId) {
            Object.keys(routeLayers).forEach(function(id) {
                var layer = routeLayers[id];
                if (!layer || !layer.polyline) return;
                var trip = getAllTrips().find(function(t) { return t.id === id; });
                var isSelected = id === routeId;
                var baseWeight = 4;
                var baseColor = (trip && trip.personalTrip) ? '#2D3E33' : '#E07A5F';
                layer.polyline.setStyle({
                    weight: isSelected ? 6 : baseWeight,
                    opacity: isSelected ? 1 : 0.92,
                    color: isSelected ? '#E07A5F' : baseColor
                });
                if (isSelected) layer.polyline.bringToFront();
            });
        }

        function selectRoute(routeId) {
            activeRoute = routeId;
            const allTrips = getAllTrips();
            const trip = allTrips.find(t => t.id === routeId);
            
            // If list is hidden, open the trip's region so the card appears in the sidebar
            const panel = document.getElementById('roadTripsListPanel');
            if (trip && panel && panel.style.display === 'none' && trip.continent) {
                currentRegionFilter = trip.continent;
                renderRoadTrips();
            } else {
                renderRoadTrips();
            }
            highlightRouteOnMap(routeId);
            
            if (trip && roadMap && trip.waypoints && Array.isArray(trip.waypoints[0])) {
                const bounds = L.latLngBounds(trip.waypoints.map(w => [w[0], w[1]]));
                roadMap.fitBounds(bounds, { padding: [50, 50], maxZoom: 12 });
                
                const detailsPanel = document.getElementById('routeDetailsPanel');
                if (trip.rentalProviders || trip.campingSites) {
                    detailsPanel.style.display = 'block';
                    renderRouteDetails(trip);
                } else {
                    detailsPanel.style.display = 'none';
                }
            }
            
            // Scroll sidebar so the selected trip card is visible
            setTimeout(function() {
                const card = document.getElementById('trip-card-' + routeId);
                if (card) card.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
            
            updateStats();
        }

        // ==================== TRIP DETAIL MODAL ====================
        let currentDetailTrip = null;
        let userRating = 0;

        // Tab switching for trip detail modal
        function switchTripTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.trip-nav-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Update tab content
            document.querySelectorAll('.trip-tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `tab-${tabName}`);
            });

            // Dynamic layout: split for overview, fullwidth for all other tabs
            const contentContainer = document.querySelector('.trip-content-container');
            const sideCols = document.querySelectorAll('.trip-side-col');
            const modal = document.getElementById('tripDetailModal');
            if (contentContainer) {
                if (tabName === 'overview') {
                    contentContainer.classList.remove('fullwidth-mode');
                    sideCols.forEach(sc => sc.classList.remove('hidden-col'));
                } else {
                    contentContainer.classList.add('fullwidth-mode');
                    sideCols.forEach(sc => sc.classList.add('hidden-col'));
                }
            }

            // Route fullscreen: collapse hero, map fills 100% viewport
            if (modal) {
                if (tabName === 'route') {
                    modal.classList.add('route-active');
                } else {
                    modal.classList.remove('route-active');
                }
            }
            
            // When Route tab is shown, init map + render variant chips
            if (tabName === 'route' && currentDetailTrip) {
                currentVariantId = null; // Reset to full route
                renderVariantChips(currentDetailTrip);
                renderPendingVariants(currentDetailTrip);
                setTimeout(function() {
                    initTripDetailMap(currentDetailTrip);
                    // Force map to recalculate size after layout transition
                    if (tripDetailMap) {
                        setTimeout(function() { tripDetailMap.invalidateSize(); }, 500);
                    }
                }, 200);
            }

            // Re-render Lucide icons for dynamically populated tabs
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 100);
        }

        function openTripDetail(tripId) {
            const allTrips = getAllTrips();
            const trip = allTrips.find(t => t.id === tripId);
            if (!trip) return;

            currentDetailTrip = trip;
            document.getElementById('tripDetailModal').classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevent background scroll
            
            // Reset to overview tab
            switchTripTab('overview');
            
            // Populate Hero Header
            document.getElementById('tripDetailIcon').textContent = trip.icon;
            document.getElementById('tripDetailName').textContent = trip.name;
            document.getElementById('tripDetailCountry').textContent = trip.country;
            document.getElementById('tripDetailDistance').textContent = trip.distance;
            document.getElementById('tripDetailDuration').textContent = trip.duration;
            
            // Rating in hero
            const rating = trip.rating || 4.0;
            document.getElementById('tripDetailRating').textContent = rating.toFixed(1);
            document.getElementById('tripHeroStars').textContent = '⭐'.repeat(Math.round(rating));
            document.getElementById('tripReviewsCount').textContent = trip.reviews ? trip.reviews.length : 0;
            document.getElementById('tripBigRating').textContent = rating.toFixed(1);
            
            // Tags in hero
            const tagsContainer = document.getElementById('tripHeroTags');
            if (trip.tags && trip.tags.length > 0) {
                tagsContainer.innerHTML = trip.tags.map(t => `<span class="tag">${t === 'fourx4' ? '4x4' : t}</span>`).join('');
            } else {
                tagsContainer.innerHTML = '';
            }

            // Populate Stats
            document.getElementById('tripDetailDifficulty').textContent = (trip.difficulty || 'moderate').charAt(0).toUpperCase() + (trip.difficulty || 'moderate').slice(1);
            document.getElementById('tripDetailSeason').textContent = trip.bestSeason || 'Year-round';
            document.getElementById('tripDetailBudget').textContent = trip.budget || 'Varies';

            // Description
            document.getElementById('tripDetailDescription').textContent = trip.description || 'An amazing road trip adventure awaits!';

            // Highlights
            const highlightsGrid = document.getElementById('tripDetailHighlights');
            if (trip.highlights && trip.highlights.length > 0) {
                highlightsGrid.innerHTML = trip.highlights.map(h => `<span class="highlight-tag">${h}</span>`).join('');
            } else {
                highlightsGrid.innerHTML = '<span style="color: var(--text-muted);">No highlights listed yet</span>';
            }

            // Must Know
            const mustKnowList = document.getElementById('tripDetailMustKnow');
            if (trip.mustKnow && trip.mustKnow.length > 0) {
                mustKnowList.innerHTML = trip.mustKnow.map(item => `<li>${item}</li>`).join('');
            } else {
                mustKnowList.innerHTML = '<li>📝 No specific tips available yet. Check the community tab for discussions!</li>';
            }
            // Route tab: potential issues (same as Must Know)
            const routeIssuesList = document.getElementById('tripRouteIssuesList');
            if (routeIssuesList) {
                if (trip.mustKnow && trip.mustKnow.length > 0) {
                    routeIssuesList.innerHTML = trip.mustKnow.map(item => `<li>${item}</li>`).join('');
                } else {
                    routeIssuesList.innerHTML = '<li>No specific issues listed. Check Overview tab for tips.</li>';
                }
            }

            // Recommendations – with enhanced booking action buttons
            renderRecommendationsWithBooking(trip);

            // Packing List – interactive checklist with affiliate links
            renderPackingChecklist(trip);

            // Insert contextual native ad
            const adSlot = document.getElementById('tripDetailAdSlot');
            if (adSlot && !isPremiumUser) {
                adSlot.innerHTML = insertTripDetailAd(trip);
            } else if (adSlot) {
                adSlot.innerHTML = '';
            }

            // Waypoints (Route Tab) – support [lat, lng, name] or { name, desc }
            const waypointsList = document.getElementById('tripDetailWaypoints');
            if (trip.waypoints && trip.waypoints.length > 0) {
                document.getElementById('waypointsCount').textContent = trip.waypoints.length;
                waypointsList.innerHTML = trip.waypoints.map((wp, idx) => {
                    const name = Array.isArray(wp) ? (wp[2] || 'Stop ' + (idx + 1)) : (wp.name || 'Stop ' + (idx + 1));
                    const desc = Array.isArray(wp) ? wp[3] : wp.desc;
                    return `
                    <div class="waypoint-item">
                        <div class="waypoint-name">${name}</div>
                        ${desc ? `<div class="waypoint-desc">${desc}</div>` : ''}
                    </div>
                `;
                }).join('');
            } else {
                document.getElementById('waypointsCount').textContent = '0';
                waypointsList.innerHTML = '<p style="color: var(--text-muted); padding: 20px;">No detailed waypoints available. Check the map view for the route.</p>';
            }

            // Costs (Budget Tab)
            if (trip.costs) {
                document.getElementById('tripFuelCost').textContent = trip.costs.fuel || 'N/A';
                document.getElementById('tripTollCost').textContent = trip.costs.tolls || 'N/A';
                document.getElementById('tripAccomCost').textContent = trip.costs.accommodation || 'N/A';
                document.getElementById('tripFoodCost').textContent = trip.costs.food || 'N/A';
                document.getElementById('tripTotalCost').textContent = trip.costs.total || 'Varies';
            } else {
                // Estimate costs based on distance
                const distKm = parseInt(trip.distance) || 1000;
                const days = parseInt(trip.duration) || 7;
                const estFuel = Math.round(distKm * 0.12);
                const estAccom = days * 80;
                const estFood = days * 50;
                document.getElementById('tripFuelCost').textContent = `~$${estFuel}`;
                document.getElementById('tripTollCost').textContent = 'Varies';
                document.getElementById('tripAccomCost').textContent = `~$${estAccom}`;
                document.getElementById('tripFoodCost').textContent = `~$${estFood}`;
                document.getElementById('tripTotalCost').textContent = `~$${estFuel + estAccom + estFood}`;
            }

            // Planning Steps (Planning Tab)
            const planningStepsContainer = document.getElementById('tripPlanningSteps');
            if (trip.planningSteps && trip.planningSteps.length > 0) {
                planningStepsContainer.innerHTML = trip.planningSteps.map((step, idx) => `
                    <div class="planning-step">
                        <div class="step-number">${idx + 1}</div>
                        <div class="step-content">
                            <div class="step-title">${step.title}</div>
                            <div class="step-desc">${step.desc}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                planningStepsContainer.innerHTML = `
                    <div class="planning-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">Research the Route</div>
                            <div class="step-desc">Study the waypoints, check road conditions, and plan your daily distances.</div>
                        </div>
                    </div>
                    <div class="planning-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">Book Accommodations</div>
                            <div class="step-desc">Reserve hotels, campsites, or B&Bs along the route, especially in peak season.</div>
                        </div>
                    </div>
                    <div class="planning-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">Prepare Your Vehicle</div>
                            <div class="step-desc">Service your car, check tires, and ensure you have emergency supplies.</div>
                        </div>
                    </div>
                    <div class="planning-step">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <div class="step-title">Download Offline Maps</div>
                            <div class="step-desc">Ensure you have offline access to navigation - cell service may be spotty.</div>
                        </div>
                    </div>
                `;
            }

            // Reviews (Community Tab)
            renderTripReviews(trip);
            
            // Reset rating input
            userRating = 0;
            updateRatingStars();

            // Load chat (Community Tab)
            renderTripChat(tripId);
            setChatType('question');
            
            // Load Guide Tab
            populateGuideTab(tripId);

            // Preparation Tab (visas, vaccines, legal by nationality)
            const savedNationality = localStorage.getItem('srndipity_preparation_nationality');
            const nationalitySelect = document.getElementById('preparationNationality');
            if (nationalitySelect && savedNationality) {
                nationalitySelect.value = savedNationality;
            }
            updatePreparationContent();

            // Booking Tab – Expert Locals + Activities + Accommodations
            populateBookingTab(trip);

            // Re-initialize Lucide icons after populating modal
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function updatePreparationContent() {
            const trip = currentDetailTrip;
            const nationalityEl = document.getElementById('preparationNationality');
            const nationality = nationalityEl ? nationalityEl.value : 'EU';
            if (nationalityEl) {
                try { localStorage.setItem('srndipity_preparation_nationality', nationality); } catch (e) {}
            }
            const key = getPreparationKey(trip ? trip.country : null);
            const prep = key && preparationByCountry[key] ? preparationByCountry[key] : null;

            const visaEl = document.getElementById('preparationVisaContent');
            const vaccinesEl = document.getElementById('preparationVaccinesContent');
            const legalEl = document.getElementById('preparationLegalContent');
            const linksEl = document.getElementById('preparationLinks');

            if (!trip) {
                if (visaEl) visaEl.innerHTML = 'Ouvrez un road trip pour voir les informations de préparation.';
                if (vaccinesEl) vaccinesEl.innerHTML = '—';
                if (legalEl) legalEl.innerHTML = '—';
                if (linksEl) linksEl.innerHTML = '';
                return;
            }

            const countryLabel = trip.country || 'Destination';

            if (!prep) {
                if (visaEl) visaEl.innerHTML = '<p>Données de préparation non disponibles pour <strong>' + countryLabel + '</strong>. Consultez les sites officiels de votre pays et du pays de destination (ambassade, ministère des Affaires étrangères) pour les visas et formalités.</p>';
                if (vaccinesEl) vaccinesEl.innerHTML = '<p>Vérifiez les recommandations OMS et les conseils aux voyageurs de votre pays (vaccins recommandés ou obligatoires).</p>';
                if (legalEl) legalEl.innerHTML = '<p>Vérifiez les exigences en matière de permis de conduire et d\'assurance véhicule pour <strong>' + countryLabel + '</strong>.</p>';
                if (linksEl) linksEl.innerHTML = '<a href="https://www.who.int/emergencies/diseases/novel-coronavirus-2019/travel-advice" target="_blank" rel="noopener">OMS – Conseils voyage</a>';
                return;
            }

            const visaInfo = prep.visas && prep.visas[nationality] ? prep.visas[nationality] : prep.visas && prep.visas.OTHER ? prep.visas.OTHER : { required: null, note: 'Vérifier selon votre nationalité.' };
            const visaRequired = visaInfo.required === false ? 'Pas de visa requis' : visaInfo.required === true ? 'Visa ou autorisation requis' : 'Vérifier selon votre nationalité';
            if (visaEl) {
                visaEl.innerHTML = '<span class="prep-badge ' + (visaInfo.required === false ? 'ok' : visaInfo.required === true ? 'required' : 'recommended') + '">' + visaRequired + '</span><p>' + (visaInfo.note || '') + '</p>';
            }
            if (vaccinesEl) {
                const req = prep.vaccines && prep.vaccines.required && prep.vaccines.required.length ? '<ul><li><strong>Obligatoires :</strong> ' + prep.vaccines.required.join(', ') + '</li></ul>' : '';
                const rec = prep.vaccines && prep.vaccines.recommended && prep.vaccines.recommended.length ? '<p><strong>Recommandés :</strong></p><ul><li>' + prep.vaccines.recommended.join('</li><li>') + '</li></ul>' : '<p>Vaccins de routine (DTP, ROR, Covid selon recommandations). Consulter un centre de vaccination.</p>';
                vaccinesEl.innerHTML = req + rec;
            }
            if (legalEl && prep.legal && prep.legal.length) {
                legalEl.innerHTML = '<ul><li>' + prep.legal.join('</li><li>') + '</li></ul>';
            } else if (legalEl) {
                legalEl.innerHTML = '<p>Vérifiez les exigences locales (permis, assurance, douanes).</p>';
            }
            const officialLinks = {
                Norway: [{ label: 'UDI Norway', url: 'https://www.udi.no/en/' }, { label: 'OMS', url: 'https://www.who.int/emergencies/diseases/novel-coronavirus-2019/travel-advice' }],
                Scotland: [{ label: 'GOV.UK visas', url: 'https://www.gov.uk/check-uk-visa' }, { label: 'NHS travel', url: 'https://www.nhs.uk/conditions/travel-immunisation/' }],
                Iceland: [{ label: 'Iceland travel', url: 'https://www.government.is/topics/foreign-affairs/travel-to-iceland/' }, { label: 'OMS', url: 'https://www.who.int/emergencies/diseases/novel-coronavirus-2019/travel-advice' }],
                USA: [{ label: 'Travel.State.Gov', url: 'https://travel.state.gov/content/travel/en.html' }, { label: 'CDC travel', url: 'https://wwwnc.cdc.gov/travel' }],
                Australia: [{ label: 'Home Affairs', url: 'https://www.homeaffairs.gov.au/' }, { label: 'Smartraveller', url: 'https://www.smartraveller.gov.au/' }],
                'New Zealand': [{ label: 'Immigration NZ', url: 'https://www.immigration.govt.nz/' }, { label: 'SafeTravel', url: 'https://www.safetravel.govt.nz/' }],
                Ireland: [{ label: 'Citizens Information', url: 'https://www.citizensinformation.ie/en/moving-country/irish-citizens-moving-abroad/working-abroad/visas-for-ireland/' }],
                Portugal: [{ label: 'Vistos Portugal', url: 'https://www.vistos.mne.gov.pt/' }],
                Spain: [{ label: 'Min. Asuntos Exteriores', url: 'https://www.exteriores.gob.es/' }],
                Italy: [{ label: 'Ministero Esteri', url: 'https://www.esteri.it/' }],
                Switzerland: [{ label: 'SEM', url: 'https://www.sem.admin.ch/sem/en/home.html' }],
                Namibia: [{ label: 'Ministry of Home Affairs', url: 'https://www.mha.gov.na/' }],
                Germany: [{ label: 'Auswärtiges Amt', url: 'https://www.auswaertiges-amt.de/en' }],
                France: [{ label: 'France-Visas', url: 'https://france-visas.gouv.fr/' }],
                Romania: [{ label: 'MAE Roumanie', url: 'https://www.mae.ro/en' }],
                Canada: [{ label: 'Immigration Canada', url: 'https://www.canada.ca/en/immigration-refugees-citizenship.html' }, { label: 'Voyage.gc.ca', url: 'https://travel.gc.ca/' }]
            };
            const links = officialLinks[key] || [];
            if (linksEl) {
                linksEl.innerHTML = links.map(function(l) { return '<a href="' + l.url + '" target="_blank" rel="noopener">' + l.label + '</a>'; }).join(' · ');
            }
        }

        // ========== BOOKING TAB – PREMIUM DARK UI (Airbnb / GYG style) ==========

        function switchBookingSection(section) {
            document.querySelectorAll('#bkTabs .bk-tab').forEach(t => t.classList.toggle('active', t.dataset.bk === section));
            document.querySelectorAll('.bk-section').forEach(s => s.classList.remove('active'));
            const target = document.getElementById('bkSection' + section.charAt(0).toUpperCase() + section.slice(1));
            if (target) target.classList.add('active');
        }

        // Utility: show toast
        function bkShowToast(msg) {
            const toast = document.getElementById('bkToast');
            if (!toast) return;
            toast.textContent = msg || 'Link copied!';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2200);
        }

        // Utility: share link
        function bkShareLink(title, url) {
            const shareText = title + ' — ' + url;
            if (navigator.clipboard) {
                navigator.clipboard.writeText(shareText).then(() => bkShowToast('Link copied to clipboard!')).catch(() => bkShowToast('Could not copy'));
            } else {
                bkShowToast('Share: ' + shareText);
            }
        }

        // Utility: toggle protip
        function bkToggleProTip(el) {
            el.classList.toggle('active');
        }

        // ——— High-quality Unsplash images keyed by activity/country type ———
        const bkImages = {
            photography: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?w=600&h=400&fit=crop',
            food: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=600&h=400&fit=crop',
            hiking: 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=600&h=400&fit=crop',
            offroad: 'https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?w=600&h=400&fit=crop',
            cultural: 'https://images.unsplash.com/photo-1523906834658-6e24ef2386f9?w=600&h=400&fit=crop',
            wildlife: 'https://images.unsplash.com/photo-1474511320723-9a56873571b7?w=600&h=400&fit=crop',
            camping: 'https://images.unsplash.com/photo-1504280390367-361c6d9f38f4?w=600&h=400&fit=crop',
            cabin: 'https://images.unsplash.com/photo-1449158743715-0a90ebb6d2d8?w=600&h=400&fit=crop',
            hotel: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=600&h=400&fit=crop',
            vanlife: 'https://images.unsplash.com/photo-1523987355523-c7b5b0dd90a7?w=600&h=400&fit=crop',
            sunset: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600&h=400&fit=crop',
            mountain: 'https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?w=600&h=400&fit=crop',
            desert: 'https://images.unsplash.com/photo-1509316975850-ff9c5deb0cd9?w=600&h=400&fit=crop',
            glacier: 'https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=600&h=400&fit=crop',
            coast: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=600&h=400&fit=crop'
        };

        function populateBookingTab(trip) {
            if (!trip) return;
            const country = trip.country || 'Unknown';
            const name = trip.name || 'Road Trip';

            // Reset to first tab
            switchBookingSection('experts');

            // ======= EXPERTS =======
            const experts = generateLocalExperts(trip);
            const expertsContainer = document.getElementById('bookingExperts');
            if (expertsContainer) {
                expertsContainer.innerHTML = experts.map((exp, idx) => {
                    const isFeatured = idx === 0;
                    const popularity = Math.floor(Math.random() * 15) + 5;
                    const proTip = exp.proTip || 'Book at least 2 weeks in advance for the best availability with this guide.';
                    return `
                    <div class="bk-expert-card ${isFeatured ? 'featured' : ''}">
                        <div class="bk-expert-left">
                            ${isFeatured ? '<span class="bk-badge sponsored" style="position:absolute;top:12px;left:12px;"><i data-lucide="award" style="width:10px;height:10px;"></i> Recommended</span>' : ''}
                            <div class="bk-expert-avatar">${exp.initials}</div>
                            <div class="bk-expert-name">${exp.name}</div>
                            <div class="bk-expert-specialty">${exp.specialty}</div>
                            <span class="bk-badge expert-local" style="margin-top:4px;"><i data-lucide="shield-check" style="width:10px;height:10px;"></i> Certified</span>
                        </div>
                        <div class="bk-expert-right">
                            <div class="bk-expert-desc">${exp.description}</div>
                            <div class="bk-expert-stats-row">
                                <div class="bk-expert-stat"><i data-lucide="star" style="width:13px;height:13px;color:#fbbf24;"></i> <strong>${exp.rating}</strong>/5</div>
                                <div class="bk-expert-stat"><i data-lucide="users" style="width:13px;height:13px;"></i> <strong>${exp.tripsDone}</strong> trips</div>
                                <div class="bk-expert-stat"><i data-lucide="globe" style="width:13px;height:13px;"></i> <strong>${exp.languages}</strong></div>
                                <div class="bk-popularity"><span class="bk-popularity-dot"></span> Booked ${popularity} times today</div>
                            </div>
                            <div class="bk-protip" onclick="bkToggleProTip(this)">
                                <i data-lucide="lightbulb" style="width:12px;height:12px;"></i> Pro Tip
                                <div class="bk-protip-bubble">${proTip}</div>
                            </div>
                            <div class="bk-expert-xps">
                                ${exp.experiences.map(xp => `
                                    <div class="bk-expert-xp">
                                        <div class="bk-expert-xp-icon"><i data-lucide="${xp.icon}" style="width:16px;height:16px;color:#E07A5F;"></i></div>
                                        <div>
                                            <div class="bk-expert-xp-name">${xp.name}</div>
                                            <div class="bk-expert-xp-detail">${xp.duration} · ${xp.type}</div>
                                        </div>
                                        <span class="bk-expert-xp-price">${xp.price}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="bk-expert-actions">
                                <a href="https://www.getyourguide.com/s/?q=${encodeURIComponent(exp.name + ' ' + country)}" target="_blank" rel="noopener sponsored" class="bk-cta" style="flex:1;">
                                    <i data-lucide="calendar-check" style="width:14px;height:14px;"></i> Check Availability
                                </a>
                                <button class="bk-cta-secondary" onclick="bkShareLink('${exp.name} – ${country}', 'https://www.getyourguide.com/s/?q=${encodeURIComponent(exp.name + ' ' + country)}')">
                                    <i data-lucide="share-2" style="width:12px;height:12px;"></i> Share
                                </button>
                            </div>
                            <div class="bk-partner"><div class="bk-partner-icon">G</div> via GetYourGuide — Trusted Partner</div>
                        </div>
                    </div>`;
                }).join('');
            }

            // ======= ACTIVITIES =======
            const activities = generateAffiliateActivities(trip);
            const activitiesContainer = document.getElementById('bookingActivities');
            if (activitiesContainer) {
                activitiesContainer.innerHTML = activities.map((act, idx) => {
                    const isFeatured = act.featured || idx === 0;
                    const popularity = Math.floor(Math.random() * 20) + 8;
                    const reviewCount = Math.floor(Math.random() * 400) + 50;
                    return `
                    <div class="bk-card ${isFeatured ? 'featured' : ''}">
                        <div class="bk-card-img">
                            <img src="${act.image}" alt="${act.title}" loading="lazy" onerror="this.style.display='none'">
                            <div class="bk-badge-row">
                                ${isFeatured ? '<span class="bk-badge coup-coeur"><i data-lucide="heart" style="width:10px;height:10px;"></i> Coup de coeur</span>' : ''}
                                ${act.badge ? `<span class="bk-badge ${act.badge.class}"><i data-lucide="${act.badge.icon}" style="width:10px;height:10px;"></i> ${act.badge.label}</span>` : ''}
                            </div>
                            <button class="bk-card-wishlist" onclick="event.stopPropagation(); this.classList.toggle('saved');" title="Save">
                                <i data-lucide="heart" style="width:16px;height:16px;"></i>
                            </button>
                            <div class="bk-card-price-tag"><small>From</small> ${act.price}</div>
                        </div>
                        <div class="bk-card-body">
                            <h4 class="bk-card-title">${act.title}</h4>
                            <p class="bk-card-desc">${act.desc}</p>
                            <div class="bk-card-meta">
                                <div class="bk-stars">★ ${act.rating} <span class="bk-star-count">(${reviewCount})</span></div>
                                <div class="bk-popularity"><span class="bk-popularity-dot"></span> ${popularity}x today</div>
                            </div>
                            <div class="bk-protip" onclick="bkToggleProTip(this)">
                                <i data-lucide="lightbulb" style="width:12px;height:12px;"></i> Pro Tip
                                <div class="bk-protip-bubble">${act.proTip || 'Book early morning slots to avoid crowds and get the best light for photos.'}</div>
                            </div>
                        </div>
                        <div class="bk-card-footer">
                            <a href="${act.url}" target="_blank" rel="noopener sponsored" class="bk-cta">
                                <i data-lucide="calendar-check" style="width:14px;height:14px;"></i> Check Availability
                            </a>
                            <button class="bk-cta-secondary" onclick="bkShareLink('${act.title.replace(/'/g, "\\'")}', '${act.url}')">
                                <i data-lucide="share-2" style="width:12px;height:12px;"></i> Share this deal
                            </button>
                            <div class="bk-partner"><div class="bk-partner-icon">G</div> via GetYourGuide</div>
                        </div>
                    </div>`;
                }).join('');
            }

            // ======= ACCOMMODATIONS =======
            const accommodations = generateAccommodations(trip);
            const accomContainer = document.getElementById('bookingAccommodations');
            if (accomContainer) {
                accomContainer.innerHTML = accommodations.map((acc, idx) => {
                    const isFeatured = idx === 1;
                    const popularity = Math.floor(Math.random() * 12) + 3;
                    return `
                    <div class="bk-card ${isFeatured ? 'featured' : ''}">
                        <div class="bk-card-img">
                            <img src="${acc.image}" alt="${acc.name}" loading="lazy" onerror="this.style.display='none'">
                            <div class="bk-badge-row">
                                ${isFeatured ? '<span class="bk-badge best-price"><i data-lucide="tag" style="width:10px;height:10px;"></i> Best Price</span>' : ''}
                                <span class="bk-badge new">${acc.type}</span>
                            </div>
                            <button class="bk-card-wishlist" onclick="event.stopPropagation(); this.classList.toggle('saved');" title="Save">
                                <i data-lucide="heart" style="width:16px;height:16px;"></i>
                            </button>
                            <div class="bk-card-price-tag">${acc.price}<small>/night</small></div>
                        </div>
                        <div class="bk-card-body">
                            <h4 class="bk-card-title">${acc.name}</h4>
                            <p class="bk-card-desc">${acc.location}</p>
                            <div class="bk-card-meta">
                                <div class="bk-stars">★ ${acc.rating} <span class="bk-star-count">(${acc.reviews})</span></div>
                                <div class="bk-popularity"><span class="bk-popularity-dot"></span> ${popularity}x today</div>
                            </div>
                            <div class="bk-protip" onclick="bkToggleProTip(this)">
                                <i data-lucide="lightbulb" style="width:12px;height:12px;"></i> Pro Tip
                                <div class="bk-protip-bubble">${acc.proTip || 'Book with free cancellation to keep your road trip flexible.'}</div>
                            </div>
                        </div>
                        <div class="bk-card-footer">
                            <a href="${acc.url}" target="_blank" rel="noopener sponsored" class="bk-cta" ${acc.type === 'Hotel' || acc.type === 'Cabin' ? 'style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);"' : ''}>
                                <i data-lucide="calendar-check" style="width:14px;height:14px;"></i> Check Availability
                            </a>
                            <button class="bk-cta-secondary" onclick="bkShareLink('${acc.name.replace(/'/g, "\\'")}', '${acc.url}')">
                                <i data-lucide="share-2" style="width:12px;height:12px;"></i> Share this deal
                            </button>
                            <div class="bk-partner"><div class="bk-partner-icon">B</div> via Booking.com</div>
                        </div>
                    </div>`;
                }).join('');
            }

            // Re-init Lucide icons
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 100);
        }

        // ——— Data generators (enriched with images, badges, proTips) ———

        function generateLocalExperts(trip) {
            const country = trip.country || 'Unknown';
            const expertDb = {
                'Norway': [
                    { id: 'exp-no-1', name: 'Erik Nordfjord', initials: 'EN', specialty: 'Arctic & Fjord Expert', description: 'Former park ranger with 15 years guiding through Norway\'s most remote fjords and Arctic landscapes. Specializes in winter driving and Northern Lights excursions.', rating: 4.9, tripsDone: 342, languages: 'NO, EN, DE', proTip: 'Tip: Book Erik\'s Northern Lights Chase on a clear-forecast night – he offers free rebooking if clouds roll in.', experiences: [
                        { name: 'Private Fjord Photography Tour', duration: '6h', type: 'Guided tour', price: '€189', icon: 'camera' },
                        { name: 'Northern Lights Chase', duration: '4h', type: 'Night expedition', price: '€149', icon: 'sparkles' },
                        { name: 'Off-Road Arctic Adventure', duration: '2 days', type: 'Expedition', price: '€490', icon: 'mountain' }
                    ]}
                ],
                'Iceland': [
                    { id: 'exp-is-1', name: 'Sigrid Björnsdóttir', initials: 'SB', specialty: 'Highland & Geothermal Guide', description: 'Certified Highland guide specializing in F-road navigation, volcanic landscapes and hidden hot springs. Over 200 guided expeditions in Iceland\'s interior.', rating: 4.8, tripsDone: 218, languages: 'IS, EN', proTip: 'Tip: Sigrid knows 3 secret hot springs not on any map – ask about the "hidden trio" experience.', experiences: [
                        { name: 'F-Road Expedition (Landmannalaugar)', duration: '10h', type: 'Full day', price: '€275', icon: 'mountain' },
                        { name: 'Secret Hot Springs Tour', duration: '5h', type: 'Guided tour', price: '€165', icon: 'flame' },
                        { name: 'Ice Cave & Glacier Walk', duration: '4h', type: 'Adventure', price: '€195', icon: 'snowflake' }
                    ]}
                ],
                'Scotland': [
                    { id: 'exp-sc-1', name: 'Angus McLeod', initials: 'AM', specialty: 'Highlands & Whisky Trail', description: 'Born and raised in the Scottish Highlands. Expert in single-track road navigation, wildlife spotting, and curated whisky distillery experiences.', rating: 4.7, tripsDone: 156, languages: 'EN, GD', proTip: 'Tip: Angus has VIP access to closed distillery sessions – request the "Master\'s Reserve" option.', experiences: [
                        { name: 'NC500 Guided Drive (3 days)', duration: '3 days', type: 'Multi-day', price: '£680', icon: 'map' },
                        { name: 'Highland Wildlife Safari', duration: '6h', type: 'Nature tour', price: '£120', icon: 'binoculars' },
                        { name: 'Whisky Trail Tasting', duration: '4h', type: 'Cultural', price: '£95', icon: 'wine' }
                    ]}
                ],
                'USA': [
                    { id: 'exp-us-1', name: 'Jake Sullivan', initials: 'JS', specialty: 'Desert & Canyon Overlander', description: 'Veteran overlander with 20+ years exploring America\'s Southwest. Expert in 4x4 trail navigation, desert survival, and national park backcountry access.', rating: 4.9, tripsDone: 520, languages: 'EN, ES', proTip: 'Tip: Jake can get you backcountry permits for restricted trails in Moab – ask 4 weeks ahead.', experiences: [
                        { name: 'Moab 4x4 Adventure (2 days)', duration: '2 days', type: 'Off-road', price: '$450', icon: 'truck' },
                        { name: 'Grand Canyon Rim-to-Rim Guide', duration: '8h', type: 'Hiking', price: '$220', icon: 'mountain' },
                        { name: 'Desert Star Photography', duration: '4h', type: 'Night tour', price: '$150', icon: 'camera' }
                    ]}
                ],
                'Australia': [
                    { id: 'exp-au-1', name: 'Mia Kowalski', initials: 'MK', specialty: 'Outback & Coastal Expert', description: 'Indigenous-approved tour guide with deep knowledge of Australian bush routes, marine wildlife, and Aboriginal cultural heritage sites.', rating: 4.8, tripsDone: 289, languages: 'EN', proTip: 'Tip: Mia\'s Uluru ceremony includes a private Anangu elder welcome – truly once-in-a-lifetime.', experiences: [
                        { name: 'Great Ocean Road VIP Tour', duration: '10h', type: 'Full day', price: 'A$310', icon: 'waves' },
                        { name: 'Outback Survival & Bush Tucker', duration: '6h', type: 'Cultural', price: 'A$195', icon: 'leaf' },
                        { name: 'Uluru Sunrise Ceremony', duration: '4h', type: 'Cultural', price: 'A$175', icon: 'sunrise' }
                    ]}
                ],
                'New Zealand': [
                    { id: 'exp-nz-1', name: 'Tane Aroha', initials: 'TA', specialty: 'South Island & Alpine Guide', description: 'Certified mountain guide and Māori cultural ambassador. Expert in alpine driving conditions, glacier access, and off-grid camping throughout New Zealand.', rating: 4.9, tripsDone: 175, languages: 'EN, MI', proTip: 'Tip: Tane offers a "sunrise-to-sunset" combo: Milford Sound + alpine drive at a 20% discount.', experiences: [
                        { name: 'Milford Sound Private Charter', duration: '6h', type: 'Boat tour', price: 'NZ$380', icon: 'anchor' },
                        { name: 'Alpine 4WD Expedition', duration: '8h', type: 'Off-road', price: 'NZ$290', icon: 'mountain' },
                        { name: 'Māori Cultural Immersion', duration: '3h', type: 'Cultural', price: 'NZ$120', icon: 'flame' }
                    ]}
                ],
                'Namibia': [
                    { id: 'exp-na-1', name: 'Kgosi Mweneni', initials: 'KM', specialty: 'Desert & Safari Expert', description: 'Third-generation safari guide born in the Namib. Specialist in desert-adapted wildlife tracking, sand dune navigation, and Himba community immersion.', rating: 4.9, tripsDone: 412, languages: 'EN, AF, OT', proTip: 'Tip: Kgosi\'s 3-day Skeleton Coast expedition includes a fly-in segment over the shipwrecks – incredible!', experiences: [
                        { name: 'Skeleton Coast Expedition', duration: '3 days', type: 'Multi-day', price: '$890', icon: 'compass' },
                        { name: 'Sossusvlei Sunrise & Photography', duration: '5h', type: 'Guided tour', price: '$150', icon: 'camera' },
                        { name: 'Himba Village Cultural Visit', duration: '4h', type: 'Cultural', price: '$120', icon: 'users' }
                    ]}
                ]
            };
            let experts = expertDb[country];
            if (!experts || experts.length === 0) {
                experts = [{
                    id: 'exp-gen-1', name: 'Local Expert', initials: country.substring(0, 2).toUpperCase(),
                    specialty: country + ' Road Trip Specialist',
                    description: `Experienced local guide offering curated ${country} road trip experiences. Expert knowledge of local roads, hidden gems, and cultural insights.`,
                    rating: 4.7, tripsDone: Math.floor(Math.random() * 200) + 50, languages: 'EN, Local',
                    proTip: 'Tip: Contact this guide directly for custom multi-day itineraries at group discounts.',
                    experiences: [
                        { name: 'Guided Scenic Drive', duration: '6h', type: 'Guided tour', price: '€150', icon: 'map' },
                        { name: 'Local Food & Culture Tour', duration: '4h', type: 'Cultural', price: '€95', icon: 'utensils' },
                        { name: 'Off-the-Beaten-Path Adventure', duration: '8h', type: 'Adventure', price: '€220', icon: 'compass' }
                    ]
                }];
            }
            return experts;
        }

        function generateAffiliateActivities(trip) {
            const country = trip.country || 'Unknown';
            const baseUrl = 'https://www.getyourguide.com/s/?q=';
            const query = encodeURIComponent(trip.name + ' ' + country);
            const activities = [
                { icon: 'camera', title: `${country} Photography Tour`, desc: `Capture stunning landscapes with a professional photographer guide along the ${trip.name} route.`, price: '€89', rating: 4.8, image: bkImages.photography, featured: true, badge: { class: 'coup-coeur', icon: 'heart', label: 'Coup de coeur' }, proTip: 'Arrive 30 min before the scheduled time to catch the best golden hour light.' },
                { icon: 'utensils', title: `Local Food Experience`, desc: `Taste authentic ${country} cuisine at hidden gems and local markets along your road trip.`, price: '€65', rating: 4.7, image: bkImages.food, badge: { class: 'best-price', icon: 'tag', label: 'Best Price' }, proTip: 'Ask your guide for the "off-menu" local speciality – they always know one!' },
                { icon: 'mountain', title: `Guided Nature Hike`, desc: `Explore scenic trails and viewpoints near the ${trip.name} with an experienced naturalist.`, price: '€45', rating: 4.6, image: bkImages.hiking, badge: { class: 'expert-local', icon: 'shield-check', label: 'Expert Local' }, proTip: 'Bring water shoes – many of the best viewpoints require small stream crossings.' },
                { icon: 'compass', title: `Off-Road Adventure`, desc: `Get off the beaten path with a guided 4x4 experience through ${country}'s wild terrain.`, price: '€120', rating: 4.9, image: bkImages.offroad, badge: { class: 'new', icon: 'sparkles', label: 'New' }, proTip: 'This tour has limited 6-person groups – book ahead for a private-feel experience.' },
                { icon: 'binoculars', title: `Wildlife Safari Drive`, desc: `Spot ${country}'s iconic wildlife from the comfort of an expert-driven safari vehicle.`, price: '€95', rating: 4.8, image: bkImages.wildlife, badge: null, proTip: 'Dawn departures have 3x more wildlife sightings than afternoon slots.' },
                { icon: 'sparkles', title: `Sunset Cultural Tour`, desc: `Experience local traditions, music, and storytelling as the sun sets over ${country}'s landscapes.`, price: '€75', rating: 4.5, image: bkImages.cultural, badge: null, proTip: 'This tour is BYOB-friendly – grab local wine at the first stop!' }
            ];
            return activities.map(act => ({ ...act, url: baseUrl + query }));
        }

        function generateAccommodations(trip) {
            const country = trip.country || 'Unknown';
            const baseUrl = 'https://www.booking.com/searchresults.html?ss=';
            const query = encodeURIComponent(country + ' road trip');
            const types = [
                { icon: 'tent', type: 'Campsite', name: `Wild Camp ${country}`, location: `Along the ${trip.name} route`, rating: 4.6, reviews: Math.floor(Math.random() * 300) + 50, price: '€25', image: bkImages.camping, proTip: 'Arrive before 4 PM to snag the best spots with a view – they fill fast in summer.' },
                { icon: 'home', type: 'Cabin', name: `Mountain Lodge & Spa`, location: `Scenic viewpoint near ${trip.name}`, rating: 4.8, reviews: Math.floor(Math.random() * 200) + 30, price: '€85', image: bkImages.cabin, proTip: 'Ask for a room upgrade at check-in – midweek stays often get free bumps.' },
                { icon: 'bed-double', type: 'Hotel', name: `Roadside Inn & Spa`, location: `Midpoint of ${trip.name}`, rating: 4.5, reviews: Math.floor(Math.random() * 500) + 100, price: '€110', image: bkImages.hotel, proTip: 'Book the "road tripper" package – includes early breakfast and a packed lunch to go.' },
                { icon: 'truck', type: 'Vanlife Spot', name: `Overlander Park`, location: `Free parking near ${trip.name}`, rating: 4.3, reviews: Math.floor(Math.random() * 150) + 20, price: 'Free', image: bkImages.vanlife, proTip: 'This spot has free showers and electric hookups – rare for a free park!' }
            ];
            return types.map(t => ({ ...t, url: baseUrl + query }));
        }

        function contactExpert(expertId) {
            alert('Contact request sent! The expert will reply within 24h. (Feature coming soon)');
        }
        function bookExpert(expertId) {
            alert('Booking calendar opening soon. Please check back! (Feature coming soon)');
        }

        function closeTripDetailModal() {
            if (tripDetailMap) {
                tripDetailMap.remove();
                tripDetailMap = null;
                tripDetailPoiLayers = {};
            }
            document.getElementById('tripDetailModal').classList.remove('active');
            document.body.style.overflow = ''; // Restore scrolling
            currentDetailTrip = null;
        }

        // Route tab: large tour-operator style map – real road routing via OSRM, POI layers
        // ==================== POI CONFIG (shared for filters & map) ====================
        const POI_CONFIG = {
            fuel:              { icon: '⛽', class: 'fuel',          label: 'Fuel', active: true },
            campsiteFree:      { icon: '⛺', class: 'campsite-free', label: 'Wild Camp', active: true },
            campsitePaid:      { icon: '🏕️', class: 'campsite-paid', label: 'Campsite', active: true },
            overnightParking:  { icon: '🅿️', class: 'rest-area',    label: 'Parking', active: false },
            grocery:           { icon: '🛒', class: 'grocery',       label: 'Supermarket', active: true },
            localProducer:     { icon: '🧑‍🌾', class: 'grocery',      label: 'Local Producer', active: false },
            organicRestaurant: { icon: '🥗', class: 'grocery',       label: 'Organic', active: false },
            viewpoint:         { icon: '📸', class: 'viewpoint',     label: 'Views', active: false },
            water:             { icon: '💧', class: 'water',         label: 'Water', active: false },
            premium:           { icon: '⭐', class: 'premium',       label: 'Partners', active: false }
        };

        // Active sub-filter state
        let activePoiSubs = {
            fuel: true, campsiteFree: true, campsitePaid: true, overnightParking: false,
            grocery: true, localProducer: false, organicRestaurant: false,
            viewpoint: false, water: false, premium: false
        };

        function filterPoiByTrip(pois, trip) {
            const country = (trip.country || '').toLowerCase();
            const regionName = (trip.name || '').toLowerCase();
            return pois.filter(p => {
                const c = (p.country || '').toLowerCase();
                const r = (p.region || '').toLowerCase();
                return c && (c.includes(country) || country.includes(c) || r.includes(regionName) || regionName.includes(r));
            });
        }

        async function initTripDetailMap(trip) {
            if (!trip || !document.getElementById('tripDetailMap')) return;
            if (tripDetailMap) {
                tripDetailMap.remove();
                tripDetailMap = null;
                tripDetailPoiLayers = {};
            }
            const container = document.getElementById('tripDetailMap');
            if (!container || !window.L) return;

            tripDetailMap = L.map('tripDetailMap', {
                center: [40, 0], zoom: 5, zoomControl: true, minZoom: 4, maxZoom: 18
            });
            L.control.zoom({ position: 'topright' }).addTo(tripDetailMap);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap', maxZoom: 19
            }).addTo(tripDetailMap);

            // Route line
            let latlngs = [];
            if (trip.waypoints && trip.waypoints.length > 0 && Array.isArray(trip.waypoints[0])) {
                latlngs = trip.waypoints.map(wp => [wp[0], wp[1]]);
            } else if (trip.coordinates && trip.coordinates.length >= 2) {
                latlngs = trip.coordinates;
            }
            let routeLine = null;
            if (latlngs.length >= 2) {
                let routeCoords = await fetchOsrmRoute(latlngs);
                if (!routeCoords || routeCoords.length < 2) routeCoords = latlngs;
                routeLine = L.polyline(routeCoords, { color: '#E07A5F', weight: 5, opacity: 0.95, lineCap: 'round', lineJoin: 'round' });
                routeLine.addTo(tripDetailMap);
                tripDetailMap.fitBounds(routeLine.getBounds(), { padding: [24, 24], maxZoom: 12 });
                latlngs.forEach((ll, i) => {
                    const name = trip.waypoints && trip.waypoints[i] && (Array.isArray(trip.waypoints[i]) ? trip.waypoints[i][2] : trip.waypoints[i].name);
                    const isStart = i === 0;
                    const isEnd = i === latlngs.length - 1;
                    const iconHtml = isStart ? '<span class="route-marker start">🚗</span>' : (isEnd ? '<span class="route-marker end">🏁</span>' : '<span class="route-marker etape">' + (i) + '</span>');
                    L.marker(ll, {
                        icon: L.divIcon({ className: 'route-waypoint-marker', html: iconHtml, iconSize: [32, 32], iconAnchor: [16, 16] })
                    }).addTo(tripDetailMap).bindPopup('<strong>' + (name || (isStart ? 'Départ' : isEnd ? 'Arrivée' : 'Étape ' + i)) + '</strong>');
                });
            } else if (latlngs.length === 1) {
                tripDetailMap.setView(latlngs[0], 8);
            }

            // ===== POI Layers with MarkerCluster =====
            const allPoiKeys = Object.keys(POI_CONFIG);
            allPoiKeys.forEach(key => {
                if (!poiDatabase[key]) { tripDetailPoiLayers[key] = L.layerGroup(); return; }
                const filtered = filterPoiByTrip(poiDatabase[key], trip);
                const cfg = POI_CONFIG[key];
                // Use MarkerClusterGroup if available, else layerGroup
                const layer = (window.L && L.markerClusterGroup) ? L.markerClusterGroup({
                    maxClusterRadius: 40,
                    spiderfyOnMaxZoom: true,
                    showCoverageOnHover: false,
                    disableClusteringAtZoom: 14
                }) : L.layerGroup();

                filtered.forEach(p => {
                    const isPremium = key === 'premium';
                    const popup = createPoiPopup(p, key);
                    L.marker([p.lat, p.lng], {
                        icon: L.divIcon({
                            className: 'poi-marker detail-poi',
                            html: '<div class="poi-marker-icon ' + cfg.class + (isPremium ? ' premium' : '') + '">' + cfg.icon + '</div>',
                            iconSize: [26, 26], iconAnchor: [13, 13]
                        })
                    }).addTo(layer).bindPopup(popup, { maxWidth: 300, className: 'poi-popup-wrapper' });
                });

                tripDetailPoiLayers[key] = layer;
                // Update count in filter bar
                const countEl = document.getElementById('pfc-' + key);
                if (countEl) countEl.textContent = filtered.length;

                // Auto-show active layers
                if (activePoiSubs[key]) layer.addTo(tripDetailMap);
            });

            // Update parent counts (camp, food)
            updateGroupCounts();

            // After container is visible, fix map size
            setTimeout(function() {
                if (tripDetailMap && routeLine) {
                    tripDetailMap.invalidateSize();
                    tripDetailMap.fitBounds(routeLine.getBounds(), { padding: [24, 24], maxZoom: 12 });
                }
            }, 350);
        }

        function updateGroupCounts() {
            // Camp group
            const campCount = ['campsiteFree', 'campsitePaid', 'overnightParking'].reduce((s, k) => {
                const el = document.getElementById('pfc-' + k);
                return s + (el ? parseInt(el.textContent) || 0 : 0);
            }, 0);
            const campEl = document.getElementById('pfc-camp');
            if (campEl) campEl.textContent = campCount;
            // Food group
            const foodCount = ['grocery', 'localProducer', 'organicRestaurant'].reduce((s, k) => {
                const el = document.getElementById('pfc-' + k);
                return s + (el ? parseInt(el.textContent) || 0 : 0);
            }, 0);
            const foodEl = document.getElementById('pfc-food');
            if (foodEl) foodEl.textContent = foodCount;
        }

        // ==================== NESTED FILTER INTERACTIONS ====================
        function togglePoiSubMenu(groupId) {
            const el = document.getElementById(groupId);
            if (!el) return;
            // Close all others
            document.querySelectorAll('.poi-filter-group.open').forEach(g => { if (g.id !== groupId) g.classList.remove('open'); });
            el.classList.toggle('open');
        }

        // Close sub-menus on outside click
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.poi-filter-group')) {
                document.querySelectorAll('.poi-filter-group.open').forEach(g => g.classList.remove('open'));
            }
        });

        function togglePoiFilter(key) {
            if (!tripDetailMap) return;
            activePoiSubs[key] = !activePoiSubs[key];
            const layer = tripDetailPoiLayers[key];
            const btn = document.querySelector(`.poi-filter-toggle[data-poi="${key}"]`);
            if (layer) {
                if (activePoiSubs[key]) { tripDetailMap.addLayer(layer); if (btn) btn.classList.add('active'); }
                else { tripDetailMap.removeLayer(layer); if (btn) btn.classList.remove('active'); }
            }
        }

        function togglePoiSub(subKey, itemEl) {
            if (!tripDetailMap) return;
            activePoiSubs[subKey] = !activePoiSubs[subKey];
            itemEl.classList.toggle('active');
            const layer = tripDetailPoiLayers[subKey];
            if (layer) {
                if (activePoiSubs[subKey]) tripDetailMap.addLayer(layer);
                else tripDetailMap.removeLayer(layer);
            }
            // Update parent toggle visual
            const groupEl = itemEl.closest('.poi-filter-group');
            if (groupEl) {
                const anyActive = groupEl.querySelectorAll('.poi-sub-item.active').length > 0;
                const toggle = groupEl.querySelector('.poi-filter-toggle');
                if (toggle) toggle.classList.toggle('active', anyActive);
            }
        }

        // Populate Guide Tab with comprehensive road trip information
        function populateGuideTab(tripId) {
            const guide = roadTripGuides[tripId];
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
            
            if (!guide) {
                // No detailed guide available - show generic message
                document.getElementById('guideMonthChips').innerHTML = '<span style="color: var(--text-muted);">Seasonal data coming soon</span>';
                document.getElementById('guideBestTimeReason').textContent = 'Detailed seasonal information is not yet available for this route. Check the Community tab for tips from other travelers.';
                document.getElementById('guideEvents').style.display = 'none';
                document.getElementById('guideWarnings').innerHTML = '<p style="color: var(--text-muted);">No specific warnings available. Always research current conditions before your trip.</p>';
                document.getElementById('guideCommunityTips').innerHTML = '<p style="color: var(--text-muted);">Community tips coming soon. Check Reddit and TripAdvisor for current discussions about this route.</p>';
                document.getElementById('guideFuelStops').innerHTML = '<p style="color: var(--text-muted);">Fuel station data coming soon. Use Google Maps or GasBuddy for real-time information.</p>';
                document.getElementById('guideGroceryStops').innerHTML = '<p style="color: var(--text-muted);">Grocery store data coming soon. Check Google Maps when planning your route.</p>';
                return;
            }
            
            // Best Time Analysis
            if (guide.bestTimeAnalysis) {
                const idealMonths = guide.bestTimeAnalysis.ideal || [];
                const avoidMonths = guide.bestTimeAnalysis.avoid || [];
                
                let chipsHTML = '';
                months.forEach((month, idx) => {
                    if (idealMonths.includes(month)) {
                        chipsHTML += `<span class="month-chip ideal">✓ ${month}</span>`;
                    } else if (avoidMonths.includes(month)) {
                        chipsHTML += `<span class="month-chip avoid">✗ ${month}</span>`;
                    }
                });
                document.getElementById('guideMonthChips').innerHTML = chipsHTML || '<span style="color: var(--text-muted);">Year-round destination</span>';
                document.getElementById('guideBestTimeReason').textContent = guide.bestTimeAnalysis.reason || 'Check local conditions before traveling.';
                
                // Events
                if (guide.bestTimeAnalysis.events && guide.bestTimeAnalysis.events.length > 0) {
                    document.getElementById('guideEvents').style.display = 'block';
                    document.getElementById('guideEventsList').innerHTML = guide.bestTimeAnalysis.events
                        .map(e => `<div class="event-item">🎉 ${e}</div>`).join('');
                } else {
                    document.getElementById('guideEvents').style.display = 'none';
                }
            }
            
            // Warnings
            if (guide.warnings && guide.warnings.length > 0) {
                document.getElementById('guideWarnings').innerHTML = guide.warnings
                    .map(w => `<div class="warning-card">${w}</div>`).join('');
            } else {
                document.getElementById('guideWarnings').innerHTML = '<p style="color: var(--text-muted);">No specific warnings. Always check current conditions.</p>';
            }
            
            // Community Tips
            if (guide.communityTips && guide.communityTips.length > 0) {
                document.getElementById('guideCommunityTips').innerHTML = guide.communityTips.map(tip => `
                    <div class="community-tip-card">
                        <div class="community-tip-header">
                            <div class="community-tip-source">
                                <span class="community-tip-platform">${tip.source}</span>
                                <span class="community-tip-user">@${tip.user}</span>
                            </div>
                            <div class="community-tip-upvotes">
                                👍 ${tip.upvotes}
                            </div>
                        </div>
                        <div class="community-tip-text">"${tip.tip}"</div>
                    </div>
                `).join('');
            } else {
                document.getElementById('guideCommunityTips').innerHTML = '<p style="color: var(--text-muted);">No community tips yet. Check the Community tab to add yours!</p>';
            }
            
            // Fuel Stops
            if (guide.fuelStops && guide.fuelStops.length > 0) {
                document.getElementById('guideFuelStops').innerHTML = guide.fuelStops.map(stop => `
                    <div class="stop-card fuel">
                        <div class="stop-icon">⛽</div>
                        <div class="stop-info">
                            <div class="stop-name">${stop.name}</div>
                            <div class="stop-location">${stop.location}</div>
                            ${stop.distance ? `<div class="stop-distance">📏 ${stop.distance} from start</div>` : ''}
                            ${stop.tip ? `<div class="stop-tip">💡 ${stop.tip}</div>` : ''}
                        </div>
                    </div>
                `).join('');
            } else {
                document.getElementById('guideFuelStops').innerHTML = '<p style="color: var(--text-muted);">Fuel station data not yet available.</p>';
            }
            
            // Grocery Stops
            if (guide.groceryStops && guide.groceryStops.length > 0) {
                document.getElementById('guideGroceryStops').innerHTML = guide.groceryStops.map(stop => `
                    <div class="stop-card grocery">
                        <div class="stop-icon">🛒</div>
                        <div class="stop-info">
                            <div class="stop-name">${stop.name}</div>
                            <div class="stop-location">${stop.location} • ${stop.type}</div>
                            ${stop.tip ? `<div class="stop-tip">💡 ${stop.tip}</div>` : ''}
                        </div>
                    </div>
                `).join('');
            } else {
                document.getElementById('guideGroceryStops').innerHTML = '<p style="color: var(--text-muted);">Grocery store data not yet available.</p>';
            }
            
            // Populate Campsites
            populateCampsites(tripId);
            
            // Populate Forum Posts
            loadForumPosts(tripId);
            
            // Check and display saved offline maps
            displaySavedMaps();
        }

        // ==================== VANLIFE COMMUNITY FORUM ====================
        
        // Forum posts storage
        let forumPosts = {};
        let currentPostType = 'tip';
        let currentForumFilter = 'all';
        let forumPhotos = [];

        // Load forum posts from localStorage
        function loadForumPostsFromStorage() {
            const saved = localStorage.getItem('srndipity_forum_posts');
            if (saved) {
                forumPosts = JSON.parse(saved);
            }
        }

        // Save forum posts to localStorage
        function saveForumPosts() {
            localStorage.setItem('srndipity_forum_posts', JSON.stringify(forumPosts));
        }

        // Initialize sample forum posts
        function initSampleForumPosts(tripId) {
            if (!forumPosts[tripId]) {
                forumPosts[tripId] = [
                    {
                        id: 'post_sample_1',
                        type: 'tip',
                        user: 'RoadWarrior22',
                        avatar: '🚐',
                        badge: 'Verified Vanlifer',
                        content: 'Pro tip: Fill up your water tanks at the visitor center before heading into the desert sections. It\'s free and the water quality is great!',
                        location: 'Visitor Center',
                        timestamp: new Date(Date.now() - 86400000 * 2).toISOString(),
                        likes: 45,
                        comments: 8,
                        photos: []
                    },
                    {
                        id: 'post_sample_2',
                        type: 'photo',
                        user: 'SunsetChaser',
                        avatar: '🌅',
                        badge: 'Photo Pro',
                        content: 'Caught this incredible sunset yesterday! The colors were absolutely unreal. Highly recommend stopping here around 6pm.',
                        location: 'Mile Marker 45',
                        timestamp: new Date(Date.now() - 86400000).toISOString(),
                        likes: 128,
                        comments: 23,
                        photos: ['sunset_placeholder']
                    },
                    {
                        id: 'post_sample_3',
                        type: 'campsite',
                        user: 'FreeCamper',
                        avatar: '⛺',
                        badge: 'Campsite Hunter',
                        content: 'Found an amazing free campsite with flat ground and cell signal! GPS: Check the pin. Stayed 3 nights, very quiet.',
                        location: 'BLM Land, Mile 78',
                        timestamp: new Date(Date.now() - 86400000 * 5).toISOString(),
                        likes: 89,
                        comments: 15,
                        photos: []
                    },
                    {
                        id: 'post_sample_4',
                        type: 'warning',
                        user: 'SafeTraveler',
                        avatar: '⚠️',
                        badge: 'Safety First',
                        content: 'Heads up! Road construction between mile 30-35. Expect 20-30 min delays. Flaggers present weekdays 7am-5pm.',
                        location: 'Mile 30-35',
                        timestamp: new Date(Date.now() - 3600000 * 5).toISOString(),
                        likes: 67,
                        comments: 12,
                        photos: []
                    }
                ];
            }
        }

        // Load and display forum posts for a trip
        function loadForumPosts(tripId) {
            loadForumPostsFromStorage();
            initSampleForumPosts(tripId);
            renderForumPosts(tripId);
        }

        // Render forum posts
        function renderForumPosts(tripId) {
            const container = document.getElementById('forumPosts');
            if (!container) return;
            
            let posts = forumPosts[tripId] || [];
            
            // Filter by type
            if (currentForumFilter !== 'all') {
                posts = posts.filter(p => p.type === currentForumFilter);
            }
            
            // Sort by timestamp (newest first)
            posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            if (posts.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
                        <div style="font-size: 3rem; margin-bottom: 10px;">💬</div>
                        <p>No posts yet. Be the first to share!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = posts.map(post => `
                <div class="forum-post" data-id="${post.id}">
                    <div class="forum-post-header">
                        <div class="forum-avatar">${post.avatar}</div>
                        <div class="forum-post-meta">
                            <div class="forum-username">
                                ${post.user}
                                ${post.badge ? `<span class="forum-badge">${post.badge}</span>` : ''}
                            </div>
                            <div class="forum-timestamp">${formatTimeAgo(post.timestamp)} ${post.location ? '• 📍 ' + post.location : ''}</div>
                        </div>
                        <span class="forum-post-type ${post.type}">${getPostTypeLabel(post.type)}</span>
                    </div>
                    <div class="forum-post-content">${post.content}</div>
                    ${post.photos && post.photos.length > 0 ? `
                        <div class="forum-photos">
                            ${post.photos.map((photo, idx) => `
                                <div class="forum-photo" onclick="viewForumPhoto('${post.id}', ${idx})">
                                    ${photo === 'sunset_placeholder' 
                                        ? '<div style="width:100%;height:100%;background:linear-gradient(135deg,#f97316,#dc2626,#7c3aed);display:flex;align-items:center;justify-content:center;font-size:2rem;">🌅</div>'
                                        : `<img src="${photo}" alt="Photo">`
                                    }
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    <div class="forum-post-actions">
                        <div class="forum-action ${isPostLiked(post.id) ? 'liked' : ''}" onclick="togglePostLike('${tripId}', '${post.id}')">
                            ❤️ ${post.likes}
                        </div>
                        <div class="forum-action" onclick="viewPostComments('${post.id}')">
                            💬 ${post.comments} comments
                        </div>
                        <div class="forum-action" onclick="sharePost('${post.id}')">
                            🔗 Share
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Format timestamp as "time ago"
        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((new Date() - new Date(timestamp)) / 1000);
            if (seconds < 60) return 'just now';
            if (seconds < 3600) return Math.floor(seconds / 60) + ' min ago';
            if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
            if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
            return new Date(timestamp).toLocaleDateString();
        }

        // Get post type label
        function getPostTypeLabel(type) {
            const labels = {
                tip: '💡 Tip',
                photo: '📸 Photo',
                question: '❓ Question',
                warning: '⚠️ Warning',
                campsite: '🏕️ Campsite'
            };
            return labels[type] || type;
        }

        // Filter forum posts
        function filterForumPosts(filter, element) {
            currentForumFilter = filter;
            
            document.querySelectorAll('.forum-filter').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
            
            if (currentDetailTrip) {
                renderForumPosts(currentDetailTrip.id);
            }
        }

        // Toggle post like
        function togglePostLike(tripId, postId) {
            const likedPosts = JSON.parse(localStorage.getItem('srndipity_liked_posts') || '[]');
            const index = likedPosts.indexOf(postId);
            
            if (index === -1) {
                likedPosts.push(postId);
                // Increment like count
                const post = forumPosts[tripId]?.find(p => p.id === postId);
                if (post) post.likes++;
            } else {
                likedPosts.splice(index, 1);
                const post = forumPosts[tripId]?.find(p => p.id === postId);
                if (post) post.likes--;
            }
            
            localStorage.setItem('srndipity_liked_posts', JSON.stringify(likedPosts));
            saveForumPosts();
            renderForumPosts(tripId);
        }

        // Check if post is liked
        function isPostLiked(postId) {
            const likedPosts = JSON.parse(localStorage.getItem('srndipity_liked_posts') || '[]');
            return likedPosts.includes(postId);
        }

        // Open create post modal
        function openCreatePostModal() {
            document.getElementById('createPostModal').classList.add('active');
            document.getElementById('postContent').value = '';
            document.getElementById('postLocation').value = '';
            forumPhotos = [];
            resetPhotoSlots();
        }

        // Close create post modal
        function closeCreatePostModal() {
            document.getElementById('createPostModal').classList.remove('active');
        }

        // Select post type
        function selectPostType(type, element) {
            currentPostType = type;
            document.querySelectorAll('.post-type-option').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        // Trigger photo upload
        function triggerPhotoUpload(index) {
            document.getElementById('forumPhotoInput').click();
        }

        // Handle forum photo upload
        function handleForumPhotoUpload(event) {
            const files = Array.from(event.target.files);
            
            files.forEach((file, idx) => {
                if (forumPhotos.length >= 4) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    forumPhotos.push(e.target.result);
                    updatePhotoSlots();
                };
                reader.readAsDataURL(file);
            });
        }

        // Update photo upload slots
        function updatePhotoSlots() {
            const slots = document.querySelectorAll('.photo-upload-slot');
            slots.forEach((slot, idx) => {
                if (forumPhotos[idx]) {
                    slot.innerHTML = `<img src="${forumPhotos[idx]}" alt="Photo ${idx + 1}">`;
                } else {
                    slot.innerHTML = '<span class="add-icon">+</span>';
                }
            });
        }

        // Reset photo slots
        function resetPhotoSlots() {
            const slots = document.querySelectorAll('.photo-upload-slot');
            slots.forEach(slot => {
                slot.innerHTML = '<span class="add-icon">+</span>';
            });
        }

        // Submit forum post
        function submitForumPost() {
            const content = document.getElementById('postContent').value.trim();
            if (!content) {
                showToast('Please write something to post');
                return;
            }
            
            const location = document.getElementById('postLocation').value.trim();
            const tripId = currentDetailTrip?.id;
            
            if (!tripId) return;
            
            if (!forumPosts[tripId]) {
                forumPosts[tripId] = [];
            }
            
            const newPost = {
                id: 'post_' + Date.now(),
                type: currentPostType,
                user: userName || 'Anonymous Traveler',
                avatar: '🚐',
                badge: null,
                content: content,
                location: location,
                timestamp: new Date().toISOString(),
                likes: 0,
                comments: 0,
                photos: forumPhotos
            };
            
            forumPosts[tripId].unshift(newPost);
            saveForumPosts();
            
            closeCreatePostModal();
            renderForumPosts(tripId);
            showToast('Post shared! Thanks for contributing 🙌');
        }

        // ==================== OFFLINE MAP DOWNLOAD ====================
        
        let offlineMaps = {};

        // Load offline maps from storage
        function loadOfflineMaps() {
            const saved = localStorage.getItem('srndipity_offline_maps');
            if (saved) {
                offlineMaps = JSON.parse(saved);
            }
        }

        // Save offline maps
        function saveOfflineMaps() {
            localStorage.setItem('srndipity_offline_maps', JSON.stringify(offlineMaps));
        }

        // Download offline map for current trip
        function downloadOfflineMap() {
            const tripId = currentDetailTrip?.id;
            if (!tripId) return;
            
            const btn = document.getElementById('downloadOfflineBtn');
            const progress = document.getElementById('downloadProgress');
            const progressBar = document.getElementById('downloadProgressBar');
            
            // Show progress
            btn.disabled = true;
            btn.innerHTML = '<span>⏳</span> Downloading...';
            progress.style.display = 'block';
            
            // Simulate download progress
            let percent = 0;
            const interval = setInterval(() => {
                percent += Math.random() * 15;
                if (percent >= 100) {
                    percent = 100;
                    clearInterval(interval);
                    
                    // Save offline data
                    const trip = currentDetailTrip;
                    const guide = roadTripGuides[tripId];
                    
                    offlineMaps[tripId] = {
                        tripId: tripId,
                        name: trip.name,
                        icon: trip.icon,
                        downloadDate: new Date().toISOString(),
                        data: {
                            trip: trip,
                            guide: guide,
                            pois: getPoiDataForTrip(tripId)
                        }
                    };
                    
                    saveOfflineMaps();
                    
                    // Update UI
                    btn.classList.add('downloaded');
                    btn.innerHTML = '<span>✅</span> Downloaded! Available Offline';
                    btn.disabled = false;
                    
                    setTimeout(() => {
                        progress.style.display = 'none';
                    }, 1000);
                    
                    displaySavedMaps();
                    showToast('Map downloaded for offline use! 📥');
                }
                progressBar.style.width = percent + '%';
            }, 200);
        }

        // Get POI data for a trip
        function getPoiDataForTrip(tripId) {
            // Get relevant POIs near trip waypoints
            const trip = getAllTrips().find(t => t.id === tripId);
            if (!trip || !trip.waypoints) return {};
            
            const relevantPois = {};
            Object.keys(poiDatabase).forEach(type => {
                relevantPois[type] = poiDatabase[type].filter(poi => {
                    // Check if POI is near any waypoint
                    return trip.waypoints.some(wp => {
                        const dist = getDistanceKm(poi.lat, poi.lng, wp[0], wp[1]);
                        return dist < 100; // Within 100km of a waypoint
                    });
                });
            });
            
            return relevantPois;
        }

        // Display saved offline maps
        function displaySavedMaps() {
            loadOfflineMaps();
            const container = document.getElementById('savedOfflineMaps');
            if (!container) return;
            
            const maps = Object.values(offlineMaps);
            
            if (maps.length === 0) {
                container.innerHTML = '<p style="color: var(--text-muted); font-size: 0.8rem;">No maps downloaded yet</p>';
                return;
            }
            
            container.innerHTML = maps.map(map => `
                <div class="saved-map-item">
                    <div class="saved-map-icon">${map.icon}</div>
                    <div class="saved-map-info">
                        <div class="saved-map-name">${map.name}</div>
                        <div class="saved-map-meta">Downloaded ${formatTimeAgo(map.downloadDate)}</div>
                    </div>
                    <div class="saved-map-actions">
                        <button class="saved-map-btn" onclick="viewOfflineMap('${map.tripId}')">View</button>
                        <button class="saved-map-btn delete" onclick="deleteOfflineMap('${map.tripId}')">🗑️</button>
                    </div>
                </div>
            `).join('');
            
            // Update download button if current trip is downloaded
            if (currentDetailTrip && offlineMaps[currentDetailTrip.id]) {
                const btn = document.getElementById('downloadOfflineBtn');
                if (btn) {
                    btn.classList.add('downloaded');
                    btn.innerHTML = '<span>✅</span> Downloaded! Available Offline';
                }
            }
        }

        // View offline map
        function viewOfflineMap(tripId) {
            closeTripDetailModal();
            openTripDetail(tripId);
            showToast('Viewing offline map data');
        }

        // Delete offline map
        function deleteOfflineMap(tripId) {
            if (confirm('Delete this offline map?')) {
                delete offlineMaps[tripId];
                saveOfflineMaps();
                displaySavedMaps();
                showToast('Offline map deleted');
            }
        }

        // ==================== CAMPSITE BOOKING ====================
        
        // Sample campsites data for trips
        const tripCampsites = {
            'route66': [
                { name: 'KOA Flagstaff', type: 'RV Park', price: '$45-65/night', features: ['Hookups', 'WiFi', 'Pool', 'Laundry'], bookingUrl: 'https://koa.com/campgrounds/flagstaff/', rating: 4.2 },
                { name: 'Grand Canyon Trailer Village', type: 'RV Park', price: '$56/night', features: ['Full Hookups', 'Near South Rim'], bookingUrl: 'https://www.nps.gov/grca', rating: 4.0 },
                { name: 'Mather Campground', type: 'Campground', price: '$18/night', features: ['Tent Sites', 'No Hookups', 'Scenic'], bookingUrl: 'https://www.recreation.gov', rating: 4.5 }
            ],
            'iceland-ring': [
                { name: 'Reykjavik Campsite', type: 'Campground', price: '2500 ISK', features: ['Hot Showers', 'Central', 'Bus Stop'], bookingUrl: 'https://reykjavikcampsite.is', rating: 4.1 },
                { name: 'Akureyri Camping', type: 'Campground', price: '2000 ISK', features: ['Near Town', 'Kitchen', 'WiFi'], bookingUrl: '', rating: 4.3 }
            ],
            'nc500': [
                { name: 'Inverness Camping & Caravanning', type: 'Campground', price: '£25/night', features: ['Hookups', 'Shop', 'WiFi'], bookingUrl: 'https://www.campingandcaravanningclub.co.uk', rating: 4.2 },
                { name: 'Applecross Campsite', type: 'Wild', price: '£10/night', features: ['Sea Views', 'Basic Facilities'], bookingUrl: '', rating: 4.7 }
            ]
        };

        // Populate campsites for a trip
        function populateCampsites(tripId) {
            const container = document.getElementById('guideCampsites');
            if (!container) return;
            
            const campsites = tripCampsites[tripId] || [];
            
            if (campsites.length === 0) {
                container.innerHTML = `
                    <p style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 12px;">
                        No curated campsites yet for this route.
                    </p>
                `;
                return;
            }
            
            container.innerHTML = campsites.map(camp => `
                <div class="campsite-booking-card">
                    <div class="campsite-image">🏕️</div>
                    <div class="campsite-info">
                        <div class="campsite-name">${camp.name}</div>
                        <div class="campsite-location">${camp.type} • ⭐ ${camp.rating}</div>
                        <div class="campsite-features">
                            ${camp.features.map(f => `<span class="campsite-feature">${f}</span>`).join('')}
                        </div>
                        <div class="campsite-price">
                            <span class="campsite-price-value">${camp.price}</span>
                            ${camp.bookingUrl ? 
                                `<a href="${camp.bookingUrl}" target="_blank" class="campsite-book-btn">Book Now</a>` :
                                `<span style="font-size: 0.7rem; color: var(--text-muted);">Walk-in only</span>`
                            }
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Search nearby campsites
        function searchNearbyCampsites() {
            document.getElementById('campsiteSearchModal').classList.add('active');
        }

        // Close campsite search
        function closeCampsiteSearch() {
            document.getElementById('campsiteSearchModal').classList.remove('active');
        }

        // Set campsite type filter
        function setCampsiteType(type, element) {
            document.querySelectorAll('#campsiteSearchModal .filter-chip').forEach(btn => {
                btn.classList.remove('active');
            });
            element.classList.add('active');
        }

        // Initialize on load
        loadOfflineMaps();
        loadForumPostsFromStorage();

        // Trip Selection Modal Functions
        function showTripSelection(trips, lat, lng) {
            const list = document.getElementById('tripSelectionList');
            list.innerHTML = trips.map(trip => `
                <div class="trip-selection-item" onclick="selectTripFromList('${trip.id}')">
                    <span class="trip-selection-icon">${trip.icon}</span>
                    <div class="trip-selection-info">
                        <h4>${trip.name}</h4>
                        <p>${trip.country} • ${trip.distance}</p>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('tripSelectionOverlay').classList.add('active');
        }

        function closeTripSelection() {
            document.getElementById('tripSelectionOverlay').classList.remove('active');
        }

        function selectTripFromList(tripId) {
            closeTripSelection();
            openTripDetail(tripId);
        }

        // Find trips near a clicked location
        function findTripsNearLocation(lat, lng, radius = 50) {
            const allTrips = getAllTrips();
            const nearbyTrips = [];
            
            allTrips.forEach(trip => {
                if (trip.waypoints) {
                    for (let wp of trip.waypoints) {
                        const dist = getDistanceKm(lat, lng, wp[0], wp[1]);
                        if (dist < radius) {
                            if (!nearbyTrips.find(t => t.id === trip.id)) {
                                nearbyTrips.push(trip);
                            }
                            break;
                        }
                    }
                }
            });
            
            return nearbyTrips;
        }

        // Calculate distance between two points in km
        function getDistanceKm(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Handle click on map to find nearby trips
        function handleMapClick(lat, lng) {
            const nearbyTrips = findTripsNearLocation(lat, lng);
            
            if (nearbyTrips.length === 0) {
                return; // No trips nearby
            } else if (nearbyTrips.length === 1) {
                openTripDetail(nearbyTrips[0].id);
            } else {
                showTripSelection(nearbyTrips, lat, lng);
            }
        }

        function renderTripReviews(trip) {
            const reviewsList = document.getElementById('tripDetailReviews');
            
            if (trip.reviews && trip.reviews.length > 0) {
                reviewsList.innerHTML = trip.reviews.map(review => `
                    <div class="review-item ${review.isOwner ? 'owner-review' : ''}">
                        <div class="review-header">
                            <span class="review-user">${review.isOwner ? '👤 ' : ''}${review.user}</span>
                            <span class="review-rating">${'⭐'.repeat(review.rating)}</span>
                        </div>
                        <div class="review-text">${review.text}</div>
                        <div class="review-date">${review.date}</div>
                    </div>
                `).join('');
            } else {
                reviewsList.innerHTML = '<p style="color: var(--text-muted); text-align: center; padding: 20px;">No reviews yet. Be the first!</p>';
            }
        }

        function updateRatingStars() {
            document.querySelectorAll('.rating-star').forEach((star, idx) => {
                star.textContent = idx < userRating ? '★' : '☆';
                star.classList.toggle('active', idx < userRating);
            });
        }

        // Rating star click handler
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('rating-star')) {
                userRating = parseInt(e.target.dataset.rating);
                updateRatingStars();
            }
        });

        function submitTripReview() {
            if (!currentDetailTrip) return;
            
            const reviewText = document.getElementById('newReviewText').value.trim();
            if (!reviewText) {
                alert('Please write a review');
                return;
            }
            if (userRating === 0) {
                alert('Please select a rating');
                return;
            }

            const newReview = {
                user: userName,
                rating: userRating,
                text: reviewText,
                date: 'Just now'
            };

            // Add to trip's reviews
            if (!currentDetailTrip.reviews) {
                currentDetailTrip.reviews = [];
            }
            currentDetailTrip.reviews.unshift(newReview);

            // Update average rating
            const avgRating = currentDetailTrip.reviews.reduce((acc, r) => acc + r.rating, 0) / currentDetailTrip.reviews.length;
            currentDetailTrip.rating = Math.round(avgRating * 10) / 10;

            // Refresh display
            renderTripReviews(currentDetailTrip);
            document.getElementById('tripDetailRating').textContent = currentDetailTrip.rating.toFixed(1);
            renderRoadTrips();
            saveToStorage();

            // Clear form
            document.getElementById('newReviewText').value = '';
            userRating = 0;
            updateRatingStars();

            alert('Thank you for your review! 🙏');
        }

        function viewTripOnMap() {
            if (!currentDetailTrip) return;
            closeTripDetailModal();
            selectRoute(currentDetailTrip.id);
        }

        function markCurrentTripCompleted() {
            if (!currentDetailTrip) return;
            markTripCompleted(currentDetailTrip.id);
            closeTripDetailModal();
        }

        function shareTripLink() {
            if (!currentDetailTrip) return;
            const shareText = `Check out this road trip: ${currentDetailTrip.name} (${currentDetailTrip.distance}) - ${currentDetailTrip.description}`;
            
            if (navigator.share) {
                navigator.share({
                    title: currentDetailTrip.name,
                    text: shareText,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    alert('Trip details copied to clipboard! 📋');
                });
            }
        }

        // ==================== TRIP COMMUNITY CHAT ====================
        let tripChatMessages = JSON.parse(localStorage.getItem('tripChatMessages')) || {};
        let currentChatType = 'question';

        // Pre-populated chat messages for key trips
        const defaultChatMessages = {
            'route66': [
                { id: 1, user: 'RoadWarrior88', badge: 'verified', type: 'tip', text: 'Pro tip: Don\'t skip Seligman, AZ - it\'s the inspiration for the movie Cars and has amazing diners! The Angel\'s barber shop is a must-visit.', time: '2 hours ago', reactions: { '👍': 12, '❤️': 5 }, replies: [
                    { user: 'TravelJunkie', text: 'Second this! Best pie on the whole route.', time: '1 hour ago' }
                ]},
                { id: 2, user: 'DesertExplorer', badge: 'expert', type: 'experience', text: 'Just finished the route last week! The Painted Desert blew my mind. Make sure you have at least 2-3 hours there - sunset is incredible.', time: '5 hours ago', reactions: { '👍': 8, '🔥': 3 }, replies: [] },
                { id: 3, user: 'FirstTimer2024', badge: null, type: 'question', text: 'Planning to do this in March - is the weather good? Also, any recommendations for a reliable car rental in Chicago?', time: '1 day ago', reactions: { '👍': 2 }, replies: [
                    { user: 'RoadWarrior88', text: 'March is perfect! Not too hot yet. Budget or Enterprise are reliable in Chicago.', time: '20 hours ago' },
                    { user: 'LocalGuide', text: 'Watch for wind in New Mexico/Arizona in March. Can be dusty!', time: '18 hours ago' }
                ]},
                { id: 4, user: 'VanlifeKing', badge: 'verified', type: 'tip', text: '⛽ IMPORTANT: Between Kingman and Needles, gas stations are 100+ miles apart. Fill up every chance you get in the desert sections!', time: '2 days ago', reactions: { '👍': 24, '⚠️': 8 }, replies: [] }
            ],
            'wildatlantic': [
                { id: 1, user: 'IrishRoads', badge: 'expert', type: 'tip', text: 'Drive CLOCKWISE! This keeps you on the ocean side and the views are 10x better. Trust me on this one.', time: '3 hours ago', reactions: { '👍': 18, '❤️': 7 }, replies: [
                    { user: 'WanderlustSara', text: 'This is THE best advice. Counter-clockwise means you\'re looking at hedges instead of cliffs!', time: '2 hours ago' }
                ]},
                { id: 2, user: 'CamperVanDan', badge: 'verified', type: 'experience', text: 'Wild camped at Malin Head last night - the most northwestern point of Ireland. Northern lights appeared at 2am! Magical experience.', time: '1 day ago', reactions: { '👍': 15, '🔥': 12, '❤️': 8 }, replies: [] },
                { id: 3, user: 'TravelNewbie', badge: null, type: 'question', text: 'Is it true you need to book Skellig Michael months in advance? We\'re going in July...', time: '2 days ago', reactions: { '👍': 3 }, replies: [
                    { user: 'IrishRoads', text: 'Yes! Boats are limited and weather-dependent. Book 3-4 months ahead for summer. Check skelligs.com', time: '1 day ago' },
                    { user: 'StarWarsFan', text: 'We got lucky with a cancellation. Check daily for openings!', time: '1 day ago' }
                ]},
                { id: 4, user: 'PhotoNomad', badge: 'expert', type: 'tip', text: '📸 Golden hour at Cliffs of Moher is around 8-9pm in summer. Stay after the crowds leave - totally different experience!', time: '3 days ago', reactions: { '👍': 22, '📸': 15 }, replies: [] }
            ],
            'namibia_highlights': [
                { id: 1, user: 'SafariSol', badge: 'verified', type: 'experience', text: 'Just did this exact route! Dune 45 at sunrise was the highlight. Get there by 5:30am - the colors changing on the dunes are unreal. Worth the early wake up!', time: '1 week ago', reactions: { '👍': 20, '❤️': 12, '🔥': 8 }, replies: [
                    { user: 'OverlandAfrica', text: 'The climb is harder than it looks! Bring water and go slow.', time: '6 days ago' }
                ]},
                { id: 2, user: 'DesertNomad', badge: 'expert', type: 'tip', text: '⚠️ CRITICAL: Download Tracks4Africa app before you go. Cell service is non-existent in most of Namibia. This app saved us multiple times!', time: '2 weeks ago', reactions: { '👍': 35, '⚠️': 12 }, replies: [
                    { user: 'SafariSol', text: 'Can confirm - this is essential! Also has all campsites marked.', time: '1 week ago' }
                ]},
                { id: 3, user: 'CoupleAdventure', badge: null, type: 'question', text: 'First time doing a rooftop tent trip. Any tips for setting up camp? We\'re a bit nervous about wild camping...', time: '3 days ago', reactions: { '👍': 5 }, replies: [
                    { user: 'DesertNomad', text: 'It\'s super safe! Just pick official campsites. NWR camps have fences. Set up before dark and you\'ll be fine!', time: '2 days ago' },
                    { user: 'SafariSol', text: 'The rooftop tent is actually easy - practice at the rental place first. Most animals ignore you up there!', time: '2 days ago' },
                    { user: 'WildlifeWatcher', text: 'Bring a headlamp! Essential for nighttime bathroom trips. And enjoy the stars - they\'re incredible.', time: '1 day ago' }
                ]},
                { id: 4, user: 'BudgetTraveler', badge: null, type: 'question', text: 'How much should I budget for fuel? The distances look massive...', time: '4 days ago', reactions: { '👍': 8 }, replies: [
                    { user: 'DesertNomad', text: 'Budget about €350-400 for the full route. Fill up EVERY station - some are 300km apart! Toyota Hilux uses about 12L/100km on gravel.', time: '3 days ago' }
                ]}
            ]
        };

        function loadTripChat(tripId) {
            // Merge default messages with user messages
            const defaultMsgs = defaultChatMessages[tripId] || [];
            const userMsgs = tripChatMessages[tripId] || [];
            
            const allMessages = [...defaultMsgs, ...userMsgs].sort((a, b) => {
                // Keep order, but user messages at the end
                if (a.id > 100 && b.id <= 100) return 1;
                if (b.id > 100 && a.id <= 100) return -1;
                return 0;
            });
            
            return allMessages;
        }

        function renderTripChat(tripId) {
            const container = document.getElementById('tripChatMessages');
            const messages = loadTripChat(tripId);
            
            // Simulate online count
            const onlineCount = Math.floor(Math.random() * 15) + 5;
            document.getElementById('chatOnlineCount').textContent = `👥 ${onlineCount} online`;
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-muted);">
                        <div style="font-size: 2rem; margin-bottom: 10px;">💬</div>
                        <p>Be the first to start a conversation about this trip!</p>
                        <p style="font-size: 0.8rem;">Ask questions, share tips, or tell us about your experience.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = messages.map(msg => `
                <div class="chat-message ${msg.type} ${msg.own ? 'own' : ''}" data-msg-id="${msg.id}">
                    <div class="chat-msg-header">
                        <span class="chat-msg-user">${msg.user}</span>
                        ${msg.badge ? `<span class="chat-msg-badge ${msg.badge}">${msg.badge === 'verified' ? '✓ Verified' : '⭐ Expert'}</span>` : ''}
                    </div>
                    <div class="chat-msg-text">${msg.text}</div>
                    <div class="chat-msg-footer">
                        <div class="chat-msg-reactions">
                            ${Object.entries(msg.reactions || {}).map(([emoji, count]) => `
                                <span class="chat-reaction" onclick="reactToMessage(${msg.id}, '${emoji}')">${emoji} ${count}</span>
                            `).join('')}
                            <span class="chat-reaction" onclick="reactToMessage(${msg.id}, '👍')">+</span>
                        </div>
                        <span>${msg.time}</span>
                    </div>
                    ${msg.replies && msg.replies.length > 0 ? `
                        <div class="chat-replies">
                            ${msg.replies.map(reply => `
                                <div class="chat-reply">
                                    <strong>${reply.user}:</strong> ${reply.text}
                                    <span style="color: var(--text-muted); margin-left: 8px;">${reply.time}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    <span class="chat-reply-btn" onclick="replyToMessage(${msg.id})">↩️ Reply</span>
                </div>
            `).join('');
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
        }

        function setChatType(type) {
            currentChatType = type;
            // Handle both old and new class names
            document.querySelectorAll('.chat-type-btn, .chat-pill').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
            
            const input = document.getElementById('chatMessageInput');
            if (input) {
                const placeholders = {
                    'question': 'Ask the community...',
                    'tip': 'Share a helpful tip...',
                    'experience': 'Tell your story...'
                };
                input.placeholder = placeholders[type] || 'Type a message...';
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatMessageInput');
            const text = input.value.trim();
            if (!text || !currentDetailTrip) return;

            const tripId = currentDetailTrip.id;
            if (!tripChatMessages[tripId]) {
                tripChatMessages[tripId] = [];
            }

            const newMessage = {
                id: Date.now(),
                user: userName || 'Anonymous Traveler',
                badge: null,
                type: currentChatType,
                text: text,
                time: 'Just now',
                reactions: {},
                replies: [],
                own: true
            };

            tripChatMessages[tripId].push(newMessage);
            localStorage.setItem('tripChatMessages', JSON.stringify(tripChatMessages));

            input.value = '';
            renderTripChat(tripId);

            // Show confirmation
            showToast('Message posted! 💬');
        }

        function reactToMessage(msgId, emoji) {
            if (!currentDetailTrip) return;
            const tripId = currentDetailTrip.id;
            
            // Find message in user messages
            if (tripChatMessages[tripId]) {
                const msg = tripChatMessages[tripId].find(m => m.id === msgId);
                if (msg) {
                    if (!msg.reactions) msg.reactions = {};
                    msg.reactions[emoji] = (msg.reactions[emoji] || 0) + 1;
                    localStorage.setItem('tripChatMessages', JSON.stringify(tripChatMessages));
                }
            }
            
            renderTripChat(tripId);
        }

        function replyToMessage(msgId) {
            const input = document.getElementById('chatMessageInput');
            input.focus();
            input.placeholder = `Reply to message...`;
            input.dataset.replyTo = msgId;
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--accent-primary);
                color: white;
                padding: 12px 24px;
                border-radius: 25px;
                font-size: 0.9rem;
                z-index: 10001;
                animation: fadeInUp 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Add Enter key listener for chat
        document.addEventListener('DOMContentLoaded', function() {
            const chatInput = document.getElementById('chatMessageInput');
            if (chatInput) {
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }
        });

        function renderRouteDetails(trip) {
            // Render rental providers
            const rentalContainer = document.getElementById('rentalProvidersList');
            if (trip.rentalProviders && trip.rentalProviders.length > 0) {
                rentalContainer.innerHTML = trip.rentalProviders.map(r => `
                    <div class="rental-card">
                        <div class="rental-header">
                            <span class="rental-name"><a href="${r.url}" target="_blank">🚙 ${r.name}</a></span>
                            <span class="rental-rating">${r.rating}</span>
                        </div>
                        <div class="rental-note">${r.note}</div>
                    </div>
                `).join('');
            } else {
                rentalContainer.innerHTML = '<p style="color: var(--text-muted); font-size: 0.8rem;">Pas d\'info disponible</p>';
            }

            // Render camping sites
            const campingContainer = document.getElementById('campingSitesList');
            if (trip.campingSites && trip.campingSites.length > 0) {
                campingContainer.innerHTML = trip.campingSites.map(c => `
                    <div class="camping-card" onclick="focusOnCamping(${c.coords[0]}, ${c.coords[1]}, '${c.name}')">
                        <div class="camping-header">
                            <span class="camping-name">🏕️ ${c.name}</span>
                            <span class="camping-type ${c.type.toLowerCase()}">${c.type}</span>
                        </div>
                        <div class="camping-location">📍 ${c.location}</div>
                        <div class="camping-info">
                            <span class="camping-price">💰 ${c.price}/nuit</span>
                            <span class="camping-facilities">${c.facilities}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                campingContainer.innerHTML = '<p style="color: var(--text-muted); font-size: 0.8rem;">Pas d\'info disponible</p>';
            }
        }

        function focusOnCamping(lat, lng, name) {
            if (roadMap) {
                roadMap.setView([lat, lng], 12);
                L.popup()
                    .setLatLng([lat, lng])
                    .setContent(`<div class="route-popup"><h4>🏕️ ${name}</h4></div>`)
                    .openOn(roadMap);
            }
        }

        // ==================== LEAGUE SYSTEM ====================
        function markTripCompleted(tripId) {
            if (!completedTrips.includes(tripId)) {
                completedTrips.push(tripId);
                saveToStorage();
                renderRoadTrips();
                updateLeagueStats();
                
                // Show celebration
                const allTrips = getAllTrips();
                const trip = allTrips.find(t => t.id === tripId);
                if (trip) {
                    alert(`🎉 Congratulations! You completed "${trip.name}"!\n\n+${parseInt(trip.distance) || 0} km added to your total!`);
                }
            }
        }

        function updateLeagueStats() {
            const allTrips = getAllTrips();
            const completedCount = completedTrips.length;
            
            // Calculate total km
            let totalKm = 0;
            completedTrips.forEach(tripId => {
                const trip = allTrips.find(t => t.id === tripId);
                if (trip) {
                    const km = parseInt(trip.distance.replace(/[^\d]/g, '')) || 0;
                    totalKm += km;
                }
            });
            
            // Update UI
            document.getElementById('completedTripsCount').textContent = completedCount;
            document.getElementById('totalKmCount').textContent = totalKm.toLocaleString();
            
            // Calculate rank and badge
            const { badge, title, rank } = calculateLeagueBadge(completedCount);
            document.getElementById('leagueBadge').innerHTML = `
                <span class="badge-icon">${badge}</span>
                <span class="badge-title">${title}</span>
            `;
            document.getElementById('userRank').textContent = rank;
        }

        function calculateLeagueBadge(completedCount) {
            if (completedCount >= 16) return { badge: '👑', title: 'Legendary Explorer', rank: '👑' };
            if (completedCount >= 11) return { badge: '🌍', title: 'World Traveler', rank: '#1' };
            if (completedCount >= 6) return { badge: '🏔️', title: 'Adventure Seeker', rank: '#2' };
            if (completedCount >= 3) return { badge: '🚗', title: 'Road Warrior', rank: '#3' };
            return { badge: '🌱', title: 'Beginner Explorer', rank: '-' };
        }

        // ==================== LEADERBOARD ====================
        function openLeaderboardModal() {
            document.getElementById('leaderboardModal').classList.add('active');
            renderLeaderboard();
        }

        function closeLeaderboardModal() {
            document.getElementById('leaderboardModal').classList.remove('active');
        }

        // ==================== PRINT POSTER FUNCTIONS ====================
        let selectedPosterOption = 'digital';
        let isPremiumUser = localStorage.getItem('srndipity_premium') === 'true';

        function openPrintPosterModal() {
            document.getElementById('printPosterModal').classList.add('active');
            updatePosterPreview();
        }

        function closePrintPosterModal() {
            document.getElementById('printPosterModal').classList.remove('active');
        }

        function updatePosterPreview() {
            // Update user name
            document.getElementById('posterUserName').textContent = userName + "'s Travel Map";
            
            // Update stats
            const countriesCount = Object.keys(countryColors).length;
            document.getElementById('posterCountries').textContent = countriesCount;
            document.getElementById('posterTrips').textContent = completedTrips.length;
            
            // Calculate total km
            let totalKm = 0;
            const allTrips = getAllTrips();
            completedTrips.forEach(tripId => {
                const trip = allTrips.find(t => t.id === tripId);
                if (trip) {
                    const km = parseInt(trip.distance.replace(/[^\d]/g, '')) || 0;
                    totalKm += km;
                }
            });
            document.getElementById('posterKm').textContent = totalKm.toLocaleString();
            
            // Update completed trips list
            const tripsContainer = document.getElementById('posterTripsList');
            if (completedTrips.length > 0) {
                tripsContainer.innerHTML = completedTrips.slice(0, 5).map(tripId => {
                    const trip = allTrips.find(t => t.id === tripId);
                    if (!trip) return '';
                    return `
                        <div class="poster-trip-item">
                            <span class="poster-trip-icon">${trip.icon}</span>
                            <div class="poster-trip-info">
                                <div class="poster-trip-name">${trip.name}</div>
                                <div class="poster-trip-meta">${trip.country} • ${trip.distance}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                if (completedTrips.length > 5) {
                    tripsContainer.innerHTML += `<div style="text-align: center; color: #8b7355; font-size: 0.8rem;">+${completedTrips.length - 5} more trips...</div>`;
                }
            } else {
                tripsContainer.innerHTML = '<div style="text-align: center; color: #8b7355; font-style: italic; padding: 20px;">Complete road trips to see them here!</div>';
            }
            
            // Update countries list
            const countriesContainer = document.getElementById('posterCountriesList');
            const visitedCountries = [];
            document.querySelectorAll('#worldMap path').forEach(path => {
                const id = path.getAttribute('data-id');
                if (countryColors[id]) {
                    const name = path.getAttribute('data-name');
                    if (name && name !== 'Unknown') {
                        visitedCountries.push(name);
                    }
                }
            });
            
            if (visitedCountries.length > 0) {
                countriesContainer.innerHTML = visitedCountries.slice(0, 12).map(country => 
                    `<span class="poster-country-tag">${country}</span>`
                ).join('');
                if (visitedCountries.length > 12) {
                    countriesContainer.innerHTML += `<span class="poster-country-tag">+${visitedCountries.length - 12} more</span>`;
                }
            } else {
                countriesContainer.innerHTML = '<div style="color: #8b7355; font-style: italic;">Mark countries as visited to see them here</div>';
            }
        }

        function selectPosterOption(element, option) {
            document.querySelectorAll('.poster-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedPosterOption = option;
            
            const downloadBtn = document.getElementById('posterDownloadBtn');
            if (option === 'digital') {
                downloadBtn.textContent = '📥 Download Free (with watermark)';
            } else if (option === 'hd') {
                downloadBtn.textContent = isPremiumUser ? '📥 Download HD' : '📥 Download HD - $2.99';
            } else if (option === 'print') {
                downloadBtn.textContent = '🖨️ Order Print - From $14.99';
            }
        }

        function downloadPoster() {
            if (selectedPosterOption === 'digital') {
                // Generate and download free version with watermark
                generatePosterImage(false);
            } else if (selectedPosterOption === 'hd') {
                if (isPremiumUser) {
                    generatePosterImage(true);
                } else {
                    showPremiumUpgrade();
                }
            } else if (selectedPosterOption === 'print') {
                // Redirect to print service
                showPrintOptions();
            }
        }

        function generatePosterImage(isHD) {
            const posterCanvas = document.getElementById('posterCanvas');
            
            // Use html2canvas if available, otherwise show instructions
            if (typeof html2canvas !== 'undefined') {
                html2canvas(posterCanvas, {
                    scale: isHD ? 3 : 1.5,
                    backgroundColor: '#f5f0e6',
                    useCORS: true
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = `my-travel-poster${isHD ? '-hd' : ''}.png`;
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                });
            } else {
                // Fallback: show print dialog
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>My Travel Poster</title>
                        <style>
                            body { margin: 0; padding: 20px; font-family: Georgia, serif; }
                            ${!isHD ? '.watermark { position: fixed; bottom: 20px; right: 20px; opacity: 0.3; font-size: 12px; }' : ''}
                        </style>
                    </head>
                    <body>
                        ${posterCanvas.outerHTML}
                        ${!isHD ? '<div class="watermark">Srndipity - For those with eyes to see</div>' : ''}
                        <script>window.print();<\/script>
                    </body>
                    </html>
                `);
            }
            
            // Track conversion
            console.log('Poster downloaded:', isHD ? 'HD' : 'Free');
        }

        function showPrintOptions() {
            alert('🖨️ Print Service Coming Soon!\n\nWe are partnering with print-on-demand services to deliver high-quality posters directly to your door.\n\nOptions will include:\n• A3 Poster ($14.99)\n• A2 Large Poster ($24.99)\n• Framed Print ($39.99)\n• Scratch Map Style ($29.99)\n\nJoin our waitlist to be notified!');
        }

        function showPremiumUpgrade() {
            document.getElementById('premiumModal').classList.add('active');
        }

        function closePremiumModal() {
            document.getElementById('premiumModal').classList.remove('active');
        }

        function processPremiumPurchase() {
            // In production, this would integrate with Stripe
            alert('💳 Payment Integration\n\nIn production, this would redirect to Stripe checkout.\n\nFor demo purposes, we will activate premium features now!');
            
            isPremiumUser = true;
            localStorage.setItem('srndipity_premium', 'true');
            
            // Hide ads
            const adBanners = document.querySelectorAll('.ad-banner');
            adBanners.forEach(ad => ad.style.display = 'none');
            
            closePremiumModal();
            alert('⭐ Premium Activated!\n\nYou now have access to:\n• Ad-free experience\n• HD poster downloads\n• Photo uploads\n• Print-ready exports\n\nThank you for your support!');
        }

        // Check premium status on load
        function checkPremiumStatus() {
            if (isPremiumUser) {
                // Hide all ad elements for premium users
                document.querySelectorAll('.ad-banner, .partner-recommendation, .sponsored-tip, .toolkit-section, .sponsored-badge').forEach(ad => {
                    ad.style.display = 'none';
                });
                // Remove sponsored trips
                document.querySelectorAll('.road-trip-card.sponsored').forEach(card => {
                    card.style.display = 'none';
                });
            }
        }

        // ==================== NATIVE ADVERTISING SYSTEM ====================
        
        // Advertiser Database - In production, this would come from an API
        const advertisers = {
            partners: [
                {
                    id: 'ioverlander',
                    name: 'iOverlander',
                    icon: '🏕️',
                    category: 'camping',
                    title: 'Find Free Campsites',
                    desc: 'Discover campsites, water & fuel worldwide',
                    url: 'https://www.ioverlander.com',
                    tip: 'Planning an overlanding trip? Find free campsites, water points, and fuel stations worldwide.',
                    regions: ['all']
                },
                {
                    id: 'worldnomads',
                    name: 'World Nomads',
                    icon: '🛡️',
                    category: 'insurance',
                    title: 'Travel Insurance',
                    desc: 'Adventure travel insurance for road trippers',
                    url: 'https://www.worldnomads.com',
                    tip: 'Don\'t forget travel insurance! Covers medical evacuation, trip cancellation & adventure activities.',
                    regions: ['all']
                },
                {
                    id: 'rentalcars',
                    name: 'RentalCars',
                    icon: '🚗',
                    category: 'rental',
                    title: 'Compare Car Rentals',
                    desc: 'Best prices on rental cars worldwide',
                    url: 'https://www.rentalcars.com',
                    tip: 'Compare prices from 900+ companies to find the best deal on your road trip vehicle.',
                    regions: ['all']
                },
                {
                    id: 'park4night',
                    name: 'Park4Night',
                    icon: '🚐',
                    category: 'camping',
                    title: 'Vanlife Spots',
                    desc: 'Best overnight parking for campervans',
                    url: 'https://park4night.com',
                    tip: 'Traveling by campervan? Find the best overnight spots reviewed by the vanlife community.',
                    regions: ['europe']
                },
                {
                    id: 'tracks4africa',
                    name: 'Tracks4Africa',
                    icon: '🗺️',
                    category: 'navigation',
                    title: 'Offline Maps for Africa',
                    desc: 'Essential GPS maps for African adventures',
                    url: 'https://tracks4africa.co.za',
                    tip: 'Driving in Africa? Tracks4Africa has the most accurate offline GPS maps with campsites & fuel.',
                    regions: ['africa']
                },
                {
                    id: 'osmand',
                    name: 'OsmAnd',
                    icon: '📍',
                    category: 'navigation',
                    title: 'Offline Navigation',
                    desc: 'Free offline maps for road trips',
                    url: 'https://osmand.net',
                    tip: 'Download offline maps before your trip - essential for areas with poor cell coverage!',
                    regions: ['all']
                },
                {
                    id: 'booking',
                    name: 'Booking.com',
                    icon: '🏨',
                    category: 'accommodation',
                    title: 'Book Accommodations',
                    desc: 'Hotels, apartments & unique stays',
                    url: 'https://www.booking.com',
                    tip: 'Mix camping with occasional hotel stays for a hot shower and comfortable bed.',
                    regions: ['all']
                },
                {
                    id: 'hostelworld',
                    name: 'Hostelworld',
                    icon: '🛏️',
                    category: 'accommodation',
                    title: 'Budget Stays',
                    desc: 'Hostels for budget road trippers',
                    url: 'https://www.hostelworld.com',
                    tip: 'Solo traveling? Hostels are great for meeting other travelers and sharing road trip tips.',
                    regions: ['all']
                }
            ],
            
            // Sponsored Road Trips (Tourism Boards)
            sponsoredTrips: [
                {
                    id: 'sponsored_norway_fjords',
                    name: 'Norwegian Fjords Explorer',
                    icon: '🇳🇴',
                    country: 'Norway',
                    distance: '1200 km',
                    duration: '7-10 days',
                    sponsor: 'Visit Norway',
                    sponsorUrl: 'https://www.visitnorway.com',
                    description: 'Discover Norway\'s stunning fjords, from Geirangerfjord to Sognefjord.',
                    tags: ['scenic', 'epic'],
                    featured: true
                }
            ]
        };

        // Dismissed ads tracking
        let dismissedAds = JSON.parse(localStorage.getItem('srndipity_dismissedAds') || '[]');

        // Initialize Toolkit with Partner Products
        function initializeToolkit() {
            if (isPremiumUser) return;
            
            const container = document.getElementById('toolkitItems');
            if (!container) return;
            
            // Get 3 random partners
            const shuffled = [...advertisers.partners].sort(() => 0.5 - Math.random());
            const selected = shuffled.slice(0, 3);
            
            container.innerHTML = selected.map(partner => `
                <a href="${partner.url}" target="_blank" rel="noopener sponsored" class="toolkit-item" data-ad-id="${partner.id}" onclick="trackAdClick('${partner.id}', 'toolkit')">
                    <span class="toolkit-item-icon">${partner.icon}</span>
                    <div class="toolkit-item-info">
                        <div class="toolkit-item-name">${partner.title}</div>
                        <div class="toolkit-item-desc">${partner.desc}</div>
                    </div>
                    <span class="toolkit-item-arrow">→</span>
                </a>
            `).join('');
        }

        // Get Contextual Recommendations based on viewed content
        function getContextualRecommendations(context) {
            if (isPremiumUser) return [];
            
            let recommendations = [];
            const region = context.region || 'all';
            const tripType = context.tripType || [];
            
            // Filter partners by region and category
            advertisers.partners.forEach(partner => {
                if (partner.regions.includes('all') || partner.regions.includes(region)) {
                    // Prioritize relevant categories
                    if (tripType.includes('camping') && partner.category === 'camping') {
                        recommendations.unshift(partner);
                    } else if (tripType.includes('fourx4') && partner.category === 'navigation') {
                        recommendations.unshift(partner);
                    } else {
                        recommendations.push(partner);
                    }
                }
            });
            
            return recommendations.slice(0, 2);
        }

        // Rotate Sponsored Tips
        function rotateSponsoredTip() {
            if (isPremiumUser) return;
            
            const tipContainer = document.getElementById('sponsoredTip1');
            if (!tipContainer) return;
            
            // Get random partner tip
            const availablePartners = advertisers.partners.filter(p => !dismissedAds.includes(p.id));
            if (availablePartners.length === 0) return;
            
            const partner = availablePartners[Math.floor(Math.random() * availablePartners.length)];
            
            tipContainer.innerHTML = `
                <span class="sponsored-tip-icon">💡</span>
                <div class="sponsored-tip-content">
                    <div class="sponsored-tip-text">${partner.tip}</div>
                    <div class="sponsored-tip-source">
                        <span class="sponsored-badge">Ad</span>
                        Tip from <a href="${partner.url}" target="_blank" rel="noopener sponsored" onclick="trackAdClick('${partner.id}', 'tip')">${partner.name}</a>
                    </div>
                </div>
            `;
        }

        // Dismiss Partner Recommendation
        function dismissPartnerRec(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.opacity = '0';
                element.style.transform = 'translateX(-10px)';
                setTimeout(() => {
                    element.style.display = 'none';
                }, 300);
            }
        }

        // Track Ad Clicks (for analytics)
        function trackAdClick(adId, placement) {
            console.log(`Ad Click: ${adId} from ${placement}`);
            // In production, send to analytics
            // fetch('/api/track-click', { method: 'POST', body: JSON.stringify({ adId, placement }) });
        }

        // Track Ad Impressions
        function trackAdImpression(adId, placement) {
            console.log(`Ad Impression: ${adId} at ${placement}`);
            // In production, send to analytics
        }

        // Insert Contextual Ad in Trip Detail
        function insertTripDetailAd(trip) {
            if (isPremiumUser) return '';
            
            // Determine context
            const isAfrica = ['Namibia', 'Botswana', 'South Africa', 'Tanzania', 'Morocco', 'Kenya'].includes(trip.country);
            const isCamping = trip.tags && (trip.tags.includes('camping') || trip.tags.includes('fourx4'));
            
            let partner;
            if (isAfrica) {
                partner = advertisers.partners.find(p => p.id === 'tracks4africa') || advertisers.partners[0];
            } else if (isCamping) {
                partner = advertisers.partners.find(p => p.id === 'ioverlander') || advertisers.partners[0];
            } else {
                partner = advertisers.partners.find(p => p.id === 'rentalcars') || advertisers.partners[0];
            }
            
            return `
                <div class="native-ad-inline">
                    <div class="native-ad-inline-icon">${partner.icon}</div>
                    <div class="native-ad-inline-content">
                        <div class="native-ad-inline-title">${partner.title}</div>
                        <div class="native-ad-inline-text">${partner.desc}</div>
                        <div class="native-ad-inline-label"><span class="sponsored-badge">Ad</span> ${partner.name}</div>
                    </div>
                    <a href="${partner.url}" target="_blank" rel="noopener sponsored" class="native-ad-inline-btn" onclick="trackAdClick('${partner.id}', 'trip-detail')">Learn More</a>
                </div>
            `;
        }

        // Add Sponsored Road Trip to List
        function addSponsoredTripsToList() {
            if (isPremiumUser) return;
            
            // This would be called in renderRoadTrips to inject sponsored content
            // For now, we'll add it through the normal trip rendering with a sponsored flag
        }

        // Initialize ads on page load
        function initializeAds() {
            if (isPremiumUser) {
                checkPremiumStatus();
                return;
            }
            
            initializeToolkit();
            rotateSponsoredTip();
            
            // Rotate tips every 60 seconds
            setInterval(rotateSponsoredTip, 60000);
        }

        function renderLeaderboard() {
            const container = document.getElementById('leaderboardList');
            
            // Simulated leaderboard data (in real app, would come from a server)
            const allTrips = getAllTrips();
            let userTotalKm = 0;
            completedTrips.forEach(tripId => {
                const trip = allTrips.find(t => t.id === tripId);
                if (trip) userTotalKm += parseInt(trip.distance.replace(/[^\d]/g, '')) || 0;
            });
            
            const leaderboard = [
                { name: 'NomadKing', trips: 23, km: 45000, badge: '👑' },
                { name: 'WanderlustQueen', trips: 18, km: 38000, badge: '👑' },
                { name: 'RoadWarrior2000', trips: 14, km: 28000, badge: '🌍' },
                { name: 'VanlifeVibes', trips: 11, km: 22000, badge: '🌍' },
                { name: userName, trips: completedTrips.length, km: userTotalKm, badge: calculateLeagueBadge(completedTrips.length).badge, isCurrentUser: true },
                { name: 'AdventureAlex', trips: 8, km: 15000, badge: '🏔️' },
                { name: 'SunsetChaser', trips: 5, km: 9500, badge: '🚗' },
                { name: 'MountainMike', trips: 3, km: 5200, badge: '🚗' }
            ].sort((a, b) => b.trips - a.trips || b.km - a.km);
            
            container.innerHTML = leaderboard.map((user, idx) => {
                const rankClass = idx === 0 ? 'gold' : idx === 1 ? 'silver' : idx === 2 ? 'bronze' : '';
                return `
                    <div class="leaderboard-item ${user.isCurrentUser ? 'current-user' : ''}">
                        <div class="leaderboard-rank ${rankClass}">${idx + 1}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${user.name} ${user.isCurrentUser ? '(You)' : ''}</div>
                            <div class="leaderboard-stats">${user.trips} trips • ${user.km.toLocaleString()} km</div>
                        </div>
                        <div class="leaderboard-badge">${user.badge}</div>
                    </div>
                `;
            }).join('');
        }

        // ==================== CREATE ROAD TRIP ====================
        function openCreateTripModal() {
            document.getElementById('createTripModal').classList.add('active');
        }

        function closeCreateTripModal() {
            document.getElementById('createTripModal').classList.remove('active');
        }

        function addWaypoint() {
            const container = document.getElementById('waypointsList');
            const newRow = document.createElement('div');
            newRow.className = 'waypoint-row';
            newRow.innerHTML = `
                <input type="text" class="form-input waypoint-name" placeholder="Place name">
                <input type="number" class="form-input waypoint-lat" placeholder="Latitude" step="0.0001">
                <input type="number" class="form-input waypoint-lng" placeholder="Longitude" step="0.0001">
                <button class="btn-icon" onclick="removeWaypoint(this)" title="Remove">×</button>
            `;
            container.appendChild(newRow);
        }

        function removeWaypoint(btn) {
            const rows = document.querySelectorAll('.waypoint-row');
            if (rows.length > 2) {
                btn.parentElement.remove();
            } else {
                alert('Minimum 2 waypoints required');
            }
        }

        function submitNewTrip() {
            const name = document.getElementById('newTripName').value.trim();
            const country = document.getElementById('newTripCountry').value.trim();
            const distance = document.getElementById('newTripDistance').value;
            const duration = document.getElementById('newTripDuration').value.trim();
            const icon = document.getElementById('newTripIcon').value.trim() || '🚗';
            const description = document.getElementById('newTripDescription').value.trim();
            const tips = document.getElementById('newTripTips').value.trim();
            
            // Get selected tags
            const tags = Array.from(document.querySelectorAll('.tag-selector input:checked')).map(cb => cb.value);
            
            // Get waypoints
            const waypointRows = document.querySelectorAll('.waypoint-row');
            const waypoints = [];
            waypointRows.forEach(row => {
                const placeName = row.querySelector('.waypoint-name').value.trim();
                const lat = parseFloat(row.querySelector('.waypoint-lat').value);
                const lng = parseFloat(row.querySelector('.waypoint-lng').value);
                if (placeName && !isNaN(lat) && !isNaN(lng)) {
                    waypoints.push([lat, lng, placeName]);
                }
            });
            
            // Validation
            if (!name || !country || !distance || !duration || !description) {
                alert('Please fill in all required fields (*)');
                return;
            }
            if (waypoints.length < 2) {
                alert('Please add at least 2 valid waypoints with coordinates');
                return;
            }
            
            // Create new trip
            const newTrip = {
                id: 'user_' + Date.now(),
                name: name,
                icon: icon,
                country: country,
                distance: distance + ' km',
                duration: duration,
                coordinates: [waypoints[0].slice(0, 2), waypoints[waypoints.length - 1].slice(0, 2)],
                waypoints: waypoints,
                tags: tags,
                description: description,
                tips: tips,
                userCreated: true,
                createdBy: userName,
                createdAt: new Date().toISOString()
            };
            
            userCreatedTrips.push(newTrip);
            saveToStorage();
            renderRoadTrips();
            
            // Add to map
            if (roadMap) {
                addTripToMap(newTrip);
            }
            
            closeCreateTripModal();
            alert(`🎉 Your road trip "${name}" has been added!\n\nIt's now available for everyone in the community.`);
            
            // Reset form
            document.getElementById('newTripName').value = '';
            document.getElementById('newTripCountry').value = '';
            document.getElementById('newTripDistance').value = '';
            document.getElementById('newTripDuration').value = '';
            document.getElementById('newTripIcon').value = '';
            document.getElementById('newTripDescription').value = '';
            document.getElementById('newTripTips').value = '';
            document.querySelectorAll('.tag-selector input').forEach(cb => cb.checked = false);
        }

        function addTripToMap(trip) {
            if (!roadMap || !trip.waypoints) return;
            
            const coords = trip.waypoints.map(w => [w[0], w[1]]);
            const routeLine = L.polyline(coords, {
                color: '#a855f7', // Purple for user-created
                weight: 3,
                opacity: 0.8,
                dashArray: '5, 10'
            }).addTo(roadMap);

            // Double-click on route line opens trip detail
            routeLine.on('dblclick', function(e) {
                L.DomEvent.stopPropagation(e);
                openTripDetail(trip.id);
            });

            // Hover effect for route lines
            routeLine.on('mouseover', function() {
                this.setStyle({ weight: 6, opacity: 1 });
            });
            routeLine.on('mouseout', function() {
                this.setStyle({ weight: 3, opacity: 0.8 });
            });

            // Add tooltip on hover
            routeLine.bindTooltip(`<strong>✨ ${trip.name}</strong><br>Double-click for details`, {
                sticky: true,
                className: 'route-tooltip'
            });

            trip.waypoints.forEach((wp, idx) => {
                const marker = L.marker([wp[0], wp[1]], {
                    icon: L.divIcon({
                        className: 'custom-marker poi-marker',
                        html: idx === 0 ? '🚗' : (idx === trip.waypoints.length - 1 ? '🏁' : '📍'),
                        iconSize: [30, 30]
                    })
                }).addTo(roadMap);

                marker.bindPopup(`
                    <div class="route-popup">
                        <h4>${wp[2]}</h4>
                        <p>${trip.name}</p>
                        <div style="font-size: 0.8rem; color: #a855f7;">✨ Community Trip</div>
                    </div>
                `);
            });
        }

        // ==================== COUNTRY ROAD VIEWER ====================
        function zoomToCountryRoads(countryName) {
            if (!roadMap || currentMode !== 'serendipity') return;
            
            const coords = countryCoordinates[countryName];
            if (coords) {
                roadMap.setView([coords[0], coords[1]], coords[2]);
                
                // Update UI
                document.getElementById('countryRoadsInfo').style.display = 'block';
                document.getElementById('selectedRoadsCountry').textContent = `🗺️ ${countryName} - Main Roads`;
            }
        }

        function resetRoadMapView() {
            if (roadMap) {
                roadMap.setView([30, 0], 2);
                document.getElementById('countryRoadsInfo').style.display = 'none';
            }
        }

        // ==================== TRIP PLANNER (DIARY MODE) ====================
        function openTripPlannerModal() {
            if (!currentCountryName || currentCountryName === 'Unknown') {
                alert('Please select a country first!');
                return;
            }
            
            document.getElementById('tripPlannerModal').classList.add('active');
            document.getElementById('plannerCountryName').textContent = currentCountryName;
            
            // Initialize planner map
            setTimeout(() => {
                initTripPlannerMap();
            }, 100);
        }

        function closeTripPlannerModal() {
            document.getElementById('tripPlannerModal').classList.remove('active');
        }

        function initTripPlannerMap() {
            if (tripPlannerMap) {
                tripPlannerMap.remove();
            }

            const coords = countryCoordinates[currentCountryName] || [30, 0, 3];
            
            tripPlannerMap = L.map('tripPlannerMap', {
                center: [coords[0], coords[1]],
                zoom: coords[2] || 6,
                zoomControl: true
            });

            // Add OpenStreetMap tiles (shows roads clearly)
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(tripPlannerMap);

            // Click handler to add stops - with city snap
            tripPlannerMap.on('click', function(e) {
                const nearestCity = findNearestCity(e.latlng.lat, e.latlng.lng);
                if (nearestCity) {
                    addPlannerStop(nearestCity.lat, nearestCity.lng, nearestCity.name, nearestCity.country);
                } else {
                    addPlannerStop(e.latlng.lat, e.latlng.lng);
                }
            });

            // Add city markers to the planner map
            addCityMarkersToPlanner();

            // Clear previous session
            plannerMarkers = [];
            plannerStops = [];
            if (plannerRoute) {
                plannerRoute.remove();
                plannerRoute = null;
            }
            updatePlannerUI();
        }

        function setStopType(type) {
            currentStopType = type;
            document.querySelectorAll('.stop-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
        }

        function getStopIcon(type) {
            const icons = {
                'waypoint': '📍',
                'camping': '🏕️',
                'fuel': '⛽',
                'hotel': '🏨',
                'atm': '🏧',
                'viewpoint': '📸',
                'restaurant': '🍽️',
                'city': '🏙️'
            };
            return icons[type] || '📍';
        }

        // Find nearest city within snap radius
        function findNearestCity(lat, lng) {
            let nearest = null;
            let minDist = CITY_SNAP_RADIUS;

            majorCities.forEach(city => {
                const dist = calculateDistance(lat, lng, city.lat, city.lng);
                if (dist < minDist) {
                    minDist = dist;
                    nearest = city;
                }
            });

            return nearest;
        }

        // Add clickable city markers to planner map
        let cityMarkerLayer = null;
        function addCityMarkersToPlanner() {
            if (cityMarkerLayer) {
                tripPlannerMap.removeLayer(cityMarkerLayer);
            }

            cityMarkerLayer = L.layerGroup();

            majorCities.forEach(city => {
                const marker = L.circleMarker([city.lat, city.lng], {
                    radius: Math.min(8, Math.max(4, city.pop / 2000000)),
                    fillColor: '#6366f1',
                    color: '#4f46e5',
                    weight: 2,
                    opacity: 0.8,
                    fillOpacity: 0.4
                });

                marker.bindTooltip(`<strong>🏙️ ${city.name}</strong><br><span style="color: #9ca3af;">${city.country}</span>`, {
                    className: 'city-tooltip',
                    direction: 'top'
                });

                marker.on('click', function(e) {
                    L.DomEvent.stopPropagation(e);
                    addPlannerStop(city.lat, city.lng, city.name, city.country);
                });

                cityMarkerLayer.addLayer(marker);
            });

            cityMarkerLayer.addTo(tripPlannerMap);
        }

        function addPlannerStop(lat, lng, cityName = null, cityCountry = null) {
            const stopId = Date.now();
            const isCity = cityName !== null;
            const stopName = isCity 
                ? `🏙️ ${cityName}` 
                : `${getStopIcon(currentStopType)} Stop ${plannerStops.length + 1}`;
            
            const stop = {
                id: stopId,
                type: isCity ? 'city' : currentStopType,
                lat: lat,
                lng: lng,
                name: stopName,
                cityName: cityName,
                cityCountry: cityCountry
            };
            
            plannerStops.push(stop);

            // Add marker
            const markerIcon = isCity ? '🏙️' : getStopIcon(currentStopType);
            const marker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: `planner-marker ${isCity ? 'city-stop' : ''}`,
                    html: `<div style="font-size: 1.5rem; text-shadow: 0 2px 4px rgba(0,0,0,0.5);">${markerIcon}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                }),
                draggable: true
            }).addTo(tripPlannerMap);

            marker.stopId = stopId;
            marker.on('dragend', function(e) {
                const newPos = e.target.getLatLng();
                const stopIdx = plannerStops.findIndex(s => s.id === stopId);
                if (stopIdx >= 0) {
                    // Check if dragged near another city
                    const nearCity = findNearestCity(newPos.lat, newPos.lng);
                    if (nearCity) {
                        plannerStops[stopIdx].lat = nearCity.lat;
                        plannerStops[stopIdx].lng = nearCity.lng;
                        plannerStops[stopIdx].name = `🏙️ ${nearCity.name}`;
                        plannerStops[stopIdx].cityName = nearCity.name;
                        plannerStops[stopIdx].cityCountry = nearCity.country;
                        plannerStops[stopIdx].type = 'city';
                        e.target.setLatLng([nearCity.lat, nearCity.lng]);
                        showToast(`📍 Snapped to ${nearCity.name}`);
                    } else {
                        plannerStops[stopIdx].lat = newPos.lat;
                        plannerStops[stopIdx].lng = newPos.lng;
                        plannerStops[stopIdx].cityName = null;
                        plannerStops[stopIdx].cityCountry = null;
                    }
                    updatePlannerRoute();
                    updatePlannerUI();
                }
            });

            const popupContent = isCity 
                ? `<div style="text-align: center;">
                    <strong>🏙️ ${cityName}</strong><br>
                    <span style="color: #9ca3af;">${cityCountry}</span>
                   </div>`
                : `<div style="text-align: center;">
                    <strong>${markerIcon} ${currentStopType}</strong><br>
                    <small>${lat.toFixed(4)}, ${lng.toFixed(4)}</small>
                   </div>`;

            marker.bindPopup(popupContent);

            // Show toast for city snap
            if (isCity) {
                showToast(`📍 Added ${cityName} to route`);
            }

            plannerMarkers.push(marker);
            updatePlannerRoute();
            updatePlannerUI();
        }

        function removePlannerStop(stopId) {
            const stopIdx = plannerStops.findIndex(s => s.id === stopId);
            if (stopIdx >= 0) {
                plannerStops.splice(stopIdx, 1);
                
                // Remove marker
                const markerIdx = plannerMarkers.findIndex(m => m.stopId === stopId);
                if (markerIdx >= 0) {
                    tripPlannerMap.removeLayer(plannerMarkers[markerIdx]);
                    plannerMarkers.splice(markerIdx, 1);
                }
                
                updatePlannerRoute();
                updatePlannerUI();
            }
        }

        let routingInProgress = false;

        async function updatePlannerRoute() {
            if (plannerRoute) {
                tripPlannerMap.removeLayer(plannerRoute);
                plannerRoute = null;
            }

            if (plannerStops.length < 2) return;

            // Build coordinates string for OSRM (lng,lat format)
            const coordsStr = plannerStops.map(s => `${s.lng},${s.lat}`).join(';');
            
            // Show loading state
            routingInProgress = true;
            const distDisplay = document.getElementById('plannerDistance');
            distDisplay.innerHTML = '<span style="color: var(--accent-primary);">⏳ Calculating...</span>';

            try {
                // Call OSRM routing API
                const response = await fetch(
                    `https://router.project-osrm.org/route/v1/driving/${coordsStr}?overview=full&geometries=geojson`
                );
                const data = await response.json();

                if (data.code === 'Ok' && data.routes && data.routes[0]) {
                    const route = data.routes[0];
                    const routeCoords = route.geometry.coordinates.map(c => [c[1], c[0]]); // GeoJSON is [lng, lat], Leaflet needs [lat, lng]
                    
                    // Draw the actual road route
                    plannerRoute = L.polyline(routeCoords, {
                        color: '#6366f1',
                        weight: 5,
                        opacity: 0.9
                    }).addTo(tripPlannerMap);

                    // Update distance with actual road distance
                    const distKm = (route.distance / 1000).toFixed(0);
                    const duration = formatDuration(route.duration);
                    distDisplay.innerHTML = `${distKm} km <span style="color: var(--text-muted);">(${duration})</span>`;
                    
                    // Store actual distance for later use
                    plannerActualDistance = route.distance / 1000;
                } else {
                    // Fallback to straight line if routing fails
                    drawStraightRoute();
                    console.warn('OSRM routing failed, using straight line');
                }
            } catch (error) {
                console.error('Routing error:', error);
                // Fallback to straight line
                drawStraightRoute();
            }
            
            routingInProgress = false;
        }

        // Fallback for when routing API fails
        function drawStraightRoute() {
            const coords = plannerStops.map(s => [s.lat, s.lng]);
            plannerRoute = L.polyline(coords, {
                color: '#6366f1',
                weight: 4,
                opacity: 0.6,
                dashArray: '10, 10'
            }).addTo(tripPlannerMap);
            
            // Calculate straight-line distance
            let totalDist = 0;
            for (let i = 1; i < plannerStops.length; i++) {
                totalDist += calculateDistance(
                    plannerStops[i-1].lat, plannerStops[i-1].lng,
                    plannerStops[i].lat, plannerStops[i].lng
                );
            }
            document.getElementById('plannerDistance').textContent = `~${Math.round(totalDist)} km (straight)`;
        }

        // Format duration from seconds to readable string
        function formatDuration(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            if (hours > 0) {
                return `${hours}h ${minutes}min`;
            }
            return `${minutes}min`;
        }

        let plannerActualDistance = 0;

        function updatePlannerUI() {
            const listContainer = document.getElementById('routeStopsList');
            
            if (plannerStops.length === 0) {
                listContainer.innerHTML = '<p class="empty-hint">Click on map to add stops...</p>';
            } else {
                listContainer.innerHTML = plannerStops.map((stop, idx) => {
                    const isCity = stop.cityName !== null && stop.cityName !== undefined;
                    const displayName = isCity ? stop.cityName : stop.type;
                    const subtitle = isCity ? stop.cityCountry : `${stop.lat.toFixed(2)}, ${stop.lng.toFixed(2)}`;
                    
                    return `
                        <div class="route-stop-item ${isCity ? 'city-stop' : ''}">
                            <span class="stop-number">${idx + 1}</span>
                            <span class="stop-icon">${getStopIcon(stop.type)}</span>
                            <div class="stop-details">
                                <span class="stop-name">${displayName}</span>
                                <span class="stop-subtitle">${subtitle}</span>
                            </div>
                            <button class="stop-delete" onclick="removePlannerStop(${stop.id})">×</button>
                        </div>
                    `;
                }).join('');
            }

            document.getElementById('plannerStopsCount').textContent = plannerStops.length;
            
            // Calculate approximate distance
            let totalDist = 0;
            for (let i = 1; i < plannerStops.length; i++) {
                totalDist += calculateDistance(
                    plannerStops[i-1].lat, plannerStops[i-1].lng,
                    plannerStops[i].lat, plannerStops[i].lng
                );
            }
            document.getElementById('plannerDistance').textContent = Math.round(totalDist) + ' km';
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        function clearPlannerRoute() {
            if (confirm('Clear all stops?')) {
                plannerStops = [];
                plannerMarkers.forEach(m => tripPlannerMap.removeLayer(m));
                plannerMarkers = [];
                if (plannerRoute) {
                    tripPlannerMap.removeLayer(plannerRoute);
                    plannerRoute = null;
                }
                updatePlannerUI();
            }
        }

        function savePlannedTrip() {
            if (plannerStops.length < 2) {
                alert('Please add at least 2 stops to save a trip');
                return;
            }

            const tripName = document.getElementById('plannedTripName').value.trim() || 
                             `${currentCountryName} Trip ${plannedTrips.length + 1}`;
            const tripNotes = document.getElementById('plannedTripNotes').value.trim();

            let totalDist = 0;
            for (let i = 1; i < plannerStops.length; i++) {
                totalDist += calculateDistance(
                    plannerStops[i-1].lat, plannerStops[i-1].lng,
                    plannerStops[i].lat, plannerStops[i].lng
                );
            }

            const newTrip = {
                id: 'planned_' + Date.now(),
                name: tripName,
                country: currentCountryName,
                stops: [...plannerStops],
                distance: Math.round(totalDist),
                notes: tripNotes,
                createdAt: new Date().toISOString()
            };

            plannedTrips.push(newTrip);
            saveToStorage();
            renderPlannedTrips();
            
            alert(`✅ Trip "${tripName}" saved!\n\n${plannerStops.length} stops • ${Math.round(totalDist)} km`);
            closeTripPlannerModal();
        }

        function shareToCommunnity() {
            if (plannerStops.length < 2) {
                alert('Please add at least 2 stops to share');
                return;
            }

            const tripName = document.getElementById('plannedTripName').value.trim();
            if (!tripName) {
                alert('Please give your trip a name first');
                return;
            }

            // Convert to community format
            let totalDist = 0;
            for (let i = 1; i < plannerStops.length; i++) {
                totalDist += calculateDistance(
                    plannerStops[i-1].lat, plannerStops[i-1].lng,
                    plannerStops[i].lat, plannerStops[i].lng
                );
            }

            const communityTrip = {
                id: 'user_' + Date.now(),
                name: tripName,
                icon: '✨',
                country: currentCountryName,
                distance: Math.round(totalDist) + ' km',
                duration: 'Varies',
                coordinates: [[plannerStops[0].lat, plannerStops[0].lng], [plannerStops[plannerStops.length-1].lat, plannerStops[plannerStops.length-1].lng]],
                waypoints: plannerStops.map(s => [s.lat, s.lng, `${getStopIcon(s.type)} ${s.type}`]),
                tags: ['community'],
                description: document.getElementById('plannedTripNotes').value.trim() || `Community trip in ${currentCountryName}`,
                tips: '',
                userCreated: true,
                createdBy: userName,
                createdAt: new Date().toISOString()
            };

            userCreatedTrips.push(communityTrip);
            saveToStorage();
            renderRoadTrips();
            
            alert(`🌍 Trip "${tripName}" shared with the community!\n\nIt's now available in Serendipity mode for everyone.`);
            closeTripPlannerModal();
        }

        function renderPlannedTrips() {
            const container = document.getElementById('plannedTripsList');
            
            if (plannedTrips.length === 0) {
                container.innerHTML = '<p style="font-size: 0.7rem; color: var(--text-muted); text-align: center; padding: 10px;">No trips planned yet</p>';
                return;
            }

            container.innerHTML = plannedTrips.map(trip => `
                <div class="planned-trip-item" onclick="viewPlannedTrip('${trip.id}')">
                    <span class="trip-icon">🗺️</span>
                    <div class="trip-info">
                        <div class="trip-name">${trip.name}</div>
                        <div class="trip-meta">${trip.country} • ${trip.stops.length} stops • ${trip.distance} km</div>
                    </div>
                </div>
            `).join('');
        }

        function viewPlannedTrip(tripId) {
            const trip = plannedTrips.find(t => t.id === tripId);
            if (!trip) return;

            // Open planner modal and load the trip
            currentCountryName = trip.country;
            openTripPlannerModal();
            
            setTimeout(() => {
                // Load stops
                trip.stops.forEach(stop => {
                    currentStopType = stop.type;
                    addPlannerStop(stop.lat, stop.lng);
                });
                
                document.getElementById('plannedTripName').value = trip.name;
                document.getElementById('plannedTripNotes').value = trip.notes || '';
                
                // Fit bounds
                if (plannerStops.length > 0) {
                    const bounds = L.latLngBounds(plannerStops.map(s => [s.lat, s.lng]));
                    tripPlannerMap.fitBounds(bounds, { padding: [50, 50] });
                }
            }, 300);
        }

        function searchNearby(type) {
            if (!tripPlannerMap) return;
            
            const center = tripPlannerMap.getCenter();
            const query = encodeURIComponent(`${type} near ${center.lat},${center.lng}`);
            
            // Open Google Maps search
            window.open(`https://www.google.com/maps/search/${query}`, '_blank');
        }

        // Enable/disable plan trip button based on country selection
        function updatePlanTripButton() {
            const btn = document.getElementById('planTripBtn');
            if (btn) {
                btn.disabled = !currentCountryName || currentCountryName === 'Unknown' || currentCountryName === '';
            }
        }

        // ==================== SATELLITE VIEW (DOUBLE-CLICK) ====================
        function openCountrySatelliteView(countryName) {
            document.getElementById('satelliteViewModal').classList.add('active');
            document.getElementById('satelliteCountryName').textContent = countryName;
            
            // Initialize satellite map
            setTimeout(() => {
                initSatelliteMap(countryName);
                populateCountryInfo(countryName);
            }, 100);
        }

        function closeSatelliteViewModal() {
            document.getElementById('satelliteViewModal').classList.remove('active');
            if (satelliteMap) {
                satelliteMap.remove();
                satelliteMap = null;
            }
        }

        function initSatelliteMap(countryName) {
            if (satelliteMap) {
                satelliteMap.remove();
            }

            const coords = countryCoordinates[countryName] || [30, 0, 4];
            
            satelliteMap = L.map('satelliteMap', {
                center: [coords[0], coords[1]],
                zoom: coords[2] || 6,
                zoomControl: true
            });

            // Create all layer options
            // Esri World Imagery - FREE satellite imagery
            satelliteLayers.satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '© Esri, Maxar, Earthstar Geographics',
                maxZoom: 19
            });

            // Stamen Terrain - Shows terrain features
            satelliteLayers.terrain = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_terrain/{z}/{x}/{y}{r}.png', {
                attribution: '© Stadia Maps, © OpenStreetMap',
                maxZoom: 18
            });

            // OpenStreetMap - Shows roads clearly
            satelliteLayers.roads = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                maxZoom: 19
            });

            // Hybrid - Satellite with road labels
            satelliteLayers.hybrid = L.layerGroup([
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    maxZoom: 19
                }),
                L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/toner-lines/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    opacity: 0.5
                }),
                L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}.png', {
                    maxZoom: 19
                })
            ]);

            // Add default satellite layer
            satelliteLayers.satellite.addTo(satelliteMap);
            currentSatelliteLayer = 'satellite';
            updateLayerButtons();

            // Add landmarks for this country
            addCountryLandmarks(countryName);
            
            // Add scale control
            L.control.scale({ imperial: false }).addTo(satelliteMap);
        }

        function setSatelliteLayer(layerType) {
            if (!satelliteMap) return;

            // Remove current layer
            Object.values(satelliteLayers).forEach(layer => {
                if (satelliteMap.hasLayer(layer)) {
                    satelliteMap.removeLayer(layer);
                }
            });

            // Add new layer
            satelliteLayers[layerType].addTo(satelliteMap);
            currentSatelliteLayer = layerType;
            updateLayerButtons();
        }

        function updateLayerButtons() {
            document.querySelectorAll('.layer-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.layer === currentSatelliteLayer);
            });
        }

        function addCountryLandmarks(countryName) {
            // Filter viewpoints for this country
            const landmarks = worldViewpoints.filter(v => v.country === countryName);
            
            landmarks.forEach(landmark => {
                const marker = L.marker([landmark.lat, landmark.lng], {
                    icon: L.divIcon({
                        className: 'landmark-marker',
                        html: `<div style="font-size: 1.5rem; text-shadow: 0 2px 8px rgba(0,0,0,0.8);">${landmark.icon}</div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    })
                }).addTo(satelliteMap);

                marker.bindPopup(`
                    <div style="min-width: 200px;">
                        <h4 style="margin: 0 0 8px 0;">${landmark.icon} ${landmark.name}</h4>
                        <p style="margin: 0; font-size: 0.85rem; color: #666;">
                            ${landmark.unesco ? '🏛️ UNESCO World Heritage' : landmark.type}
                        </p>
                        <a href="https://www.google.com/search?q=${encodeURIComponent(landmark.name)}" target="_blank" 
                           style="display: inline-block; margin-top: 8px; font-size: 0.8rem; color: #6366f1;">
                            Learn more →
                        </a>
                    </div>
                `);
            });
        }

        function populateCountryInfo(countryName) {
            // Quick facts
            const quickFactsContainer = document.getElementById('countryQuickFacts');
            const info = vanliferInfo[countryName] || defaultVanliferInfo;
            
            quickFactsContainer.innerHTML = `
                <div class="quick-fact-item">
                    <span class="fact-label">🛣️ Tolls</span>
                    <span class="fact-value">${info.tolls}</span>
                </div>
                <div class="quick-fact-item">
                    <span class="fact-label">⛺ Camping</span>
                    <span class="fact-value">${info.camping}</span>
                </div>
                <div class="quick-fact-item">
                    <span class="fact-label">⛽ Fuel</span>
                    <span class="fact-value">${info.fuel}</span>
                </div>
                <div class="quick-fact-item">
                    <span class="fact-label">📋 Visa</span>
                    <span class="fact-value">${info.visa}</span>
                </div>
                <div class="quick-fact-item">
                    <span class="fact-label">🚗 Roads</span>
                    <span class="fact-value">${info.roadQuality}</span>
                </div>
            `;

            // Landmarks
            const landmarksContainer = document.getElementById('countryLandmarks');
            const landmarks = worldViewpoints.filter(v => v.country === countryName);
            
            if (landmarks.length > 0) {
                landmarksContainer.innerHTML = landmarks.map(l => `
                    <div class="landmark-item" onclick="flyToLandmark(${l.lat}, ${l.lng}, '${l.name}')">
                        <span class="landmark-icon">${l.icon}</span>
                        <div>
                            <div class="landmark-name">${l.name}</div>
                            <div class="landmark-type">${l.unesco ? 'UNESCO' : l.type}</div>
                        </div>
                    </div>
                `).join('');
            } else {
                landmarksContainer.innerHTML = '<p style="font-size: 0.8rem; color: var(--text-muted);">No landmarks data yet</p>';
            }
        }

        function flyToLandmark(lat, lng, name) {
            if (satelliteMap) {
                satelliteMap.flyTo([lat, lng], 14, { duration: 1.5 });
            }
        }

        function planTripFromSatellite() {
            const countryName = document.getElementById('satelliteCountryName').textContent;
            closeSatelliteViewModal();
            currentCountryName = countryName;
            openTripPlannerModal();
        }

        function openInGoogleEarth() {
            const countryName = document.getElementById('satelliteCountryName').textContent;
            const coords = countryCoordinates[countryName];
            if (coords) {
                window.open(`https://earth.google.com/web/@${coords[0]},${coords[1]},0a,1000000d,35y,0h,0t,0r`, '_blank');
            } else {
                window.open(`https://earth.google.com/web/search/${encodeURIComponent(countryName)}`, '_blank');
            }
        }

        // ==================== COMMUNITY ALERTS ====================
        function renderAlerts() {
            const container = document.getElementById('alertsList');
            
            // Default sample alerts
            if (communityAlerts.length === 0) {
                communityAlerts = [
                    { id: 1, type: 'tip', title: 'Dune 45 Lever du soleil', description: 'Arrivez avant 5h30 pour le lever de soleil sur Dune 45. Magique! Prévoir lampe frontale.', location: 'Sossusvlei, Namibie', date: '1 semaine', lat: -24.7275, lng: 15.4739 },
                    { id: 2, type: 'camping', title: 'Sesriem = Accès prioritaire', description: 'Dormir au camp NWR Sesriem permet d\'entrer dans le parc 1h avant les autres visiteurs!', location: 'Sesriem, Namibie', date: '2 semaines', lat: -24.4800, lng: 15.8300 },
                    { id: 3, type: 'hazard', title: 'Piste sableuse D707', description: 'Route très sableuse entre Solitaire et Walvis Bay. 4x4 indispensable, réduire pression pneus.', location: 'D707, Namibie', date: '3 semaines', lat: -23.5500, lng: 15.2000 },
                    { id: 4, type: 'fuel', title: 'Dernière station avant Sossusvlei', description: 'Faites le plein à Solitaire! Prochaine station à 200km.', location: 'Solitaire, Namibie', date: '1 mois', lat: -23.8900, lng: 16.0100 },
                    { id: 5, type: 'tip', title: 'Éléphants du désert à Palmwag', description: 'Game drive matinal à Palmwag = quasi garanti de voir les éléphants du désert!', location: 'Palmwag, Namibie', date: '1 mois', lat: -19.8800, lng: 13.9500 },
                    { id: 6, type: 'camping', title: 'Okaukuejo Waterhole', description: 'Le waterhole d\'Okaukuejo est illuminé la nuit. Rhinos noirs réguliers après 22h!', location: 'Etosha, Namibie', date: '1 mois', lat: -18.9000, lng: 15.9200 },
                    { id: 7, type: 'road_work', title: 'Road Construction', description: 'I-40 near Flagstaff, expect delays', location: 'Route 66, Arizona', date: '2 hours ago', lat: 35.2, lng: -111.6 },
                    { id: 8, type: 'hazard', title: 'Pothole Warning', description: 'Large potholes after km marker 245', location: 'Transfăgărășan, Romania', date: '3 days ago', lat: 45.6, lng: 24.6 }
                ];
            }

            container.innerHTML = communityAlerts.map(alert => `
                <div class="alert-item ${alert.type === 'hazard' ? 'danger' : (alert.type === 'camping' || alert.type === 'tip' ? 'success' : '')}">
                    <span class="alert-icon">${getAlertIcon(alert.type)}</span>
                    <div class="alert-content">
                        <div class="alert-title">${alert.title}</div>
                        <div class="alert-desc">${alert.description}</div>
                        <div class="alert-meta">📍 ${alert.location} • ${alert.date}</div>
                    </div>
                </div>
            `).join('');
        }

        function getAlertIcon(type) {
            const icons = {
                'road_work': '🚧',
                'hazard': '⚠️',
                'police': '👮',
                'fuel': '⛽',
                'camping': '🏕️',
                'tip': '💡'
            };
            return icons[type] || '📍';
        }

        function openAlertModal() {
            document.getElementById('alertModal').classList.add('active');
        }

        function closeAlertModal() {
            document.getElementById('alertModal').classList.remove('active');
        }

        function submitAlert() {
            const type = document.getElementById('alertType').value;
            const location = document.getElementById('alertLocation').value;
            const description = document.getElementById('alertDescription').value;

            if (!location || !description) {
                alert('Please fill in all fields');
                return;
            }

            const newAlert = {
                id: Date.now(),
                type: type,
                title: document.getElementById('alertType').options[document.getElementById('alertType').selectedIndex].text.replace(/[^\w\s]/g, '').trim(),
                description: description,
                location: location,
                date: 'Just now'
            };

            communityAlerts.unshift(newAlert);
            renderAlerts();
            closeAlertModal();
            saveToStorage();

            // Clear form
            document.getElementById('alertLocation').value = '';
            document.getElementById('alertDescription').value = '';
        }

        // ==================== MAP ACTIONS ====================
        function markAsVisited() {
            if (!selectedCountry) {
                alert('Please select a country first');
                return;
            }
            d3.select(selectedCountry).style('fill', VISITED_COLOR);
            countryColors[currentCountryId] = VISITED_COLOR;
            saveToStorage();
            updateStats();
        }

        function resetMap() {
            if (confirm('Reset all progress?')) {
                g.selectAll("path").style('fill', DEFAULT_COLOR);
                countryColors = {};
                selectedCountry = null;
                const sn = document.getElementById('selectedCountryName');
                const sd = document.getElementById('selectedDisplay');
                const cs = document.getElementById('countrySearch');
                if (sn) sn.textContent = 'Click a country';
                if (sd) sd.classList.remove('has-selection');
                if (cs) cs.value = '';
                saveToStorage();
                updateStats();
            }
        }

        function updateStats() {
            const visited = Object.keys(countryColors).length;
            document.getElementById('countriesVisited').textContent = visited;

            const continents = new Set();
            Object.keys(countryColors).forEach(id => {
                if (continentMapping[id]) continents.add(continentMapping[id]);
            });
            document.getElementById('continentsExplored').textContent = continents.size;

            // Update serendipity stats
            document.getElementById('routesExplored').textContent = activeRoute ? 1 : 0;
            document.getElementById('kmTraveled').textContent = activeRoute ? 
                roadTrips.find(r => r.id === activeRoute)?.distance.replace(' km', '') || '0' : '0';
        }

        // ==================== ZOOM ====================
        let zoom;

        function setupZoom() {
            zoom = d3.zoom()
                .scaleExtent([1, 8])
                .on("zoom", (event) => g.attr("transform", event.transform));
            svg.call(zoom);
        }

        function zoomIn() {
            if (currentMode === 'serendipity' && roadMap) {
                roadMap.zoomIn();
            } else {
                svg.transition().call(zoom.scaleBy, 1.5);
            }
        }

        function zoomOut() {
            if (currentMode === 'serendipity' && roadMap) {
                roadMap.zoomOut();
            } else {
                svg.transition().call(zoom.scaleBy, 0.67);
            }
        }

        function resetZoom() {
            if (currentMode === 'serendipity' && roadMap) {
                roadMap.setView([30, 0], 2);
            } else {
                svg.transition().call(zoom.transform, d3.zoomIdentity);
            }
        }

        // Minimalist world map: countries with road trips highlighted (green + yellow-orange outline)
        var tripCountryToGeoJSON = {
            'USA': ['United States of America'],
            'United States': ['United States of America'],
            'UK': ['United Kingdom'],
            'United Kingdom': ['United Kingdom'],
            'Scotland': ['United Kingdom'],
            'Ireland': ['Ireland'],
            'France': ['France'],
            'Spain': ['Spain'],
            'Italy': ['Italy'],
            'Germany': ['Germany'],
            'Switzerland': ['Switzerland'],
            'Portugal': ['Portugal'],
            'Romania': ['Romania'],
            'Norway': ['Norway'],
            'Iceland': ['Iceland'],
            'Morocco': ['Morocco'],
            'South Africa': ['South Africa'],
            'Namibia': ['Namibia'],
            'Botswana': ['Botswana'],
            'Tanzania': ['Tanzania'],
            'Kenya': ['Kenya'],
            'Egypt': ['Egypt'],
            'Jordan': ['Jordan'],
            'Oman': ['Oman'],
            'UAE': ['United Arab Emirates'],
            'India': ['India'],
            'Japan': ['Japan'],
            'Vietnam': ['Viet Nam'],
            'Sri Lanka': ['Sri Lanka'],
            'Taiwan': ['Taiwan'],
            'China': ['China'],
            'Australia': ['Australia'],
            'New Zealand': ['New Zealand'],
            'Chile': ['Chile'],
            'Argentina': ['Argentina'],
            'Mexico': ['Mexico'],
            'Canada': ['Canada'],
            'Brazil': ['Brazil'],
            'Peru': ['Peru'],
            'Colombia': ['Colombia'],
            'South Korea': ['Korea, Republic of'],
            'North Korea': ['Korea, Democratic People\'s Republic of'],
            'Russia': ['Russian Federation'],
            'Turkey': ['Turkey'],
            'Greece': ['Greece'],
            'Netherlands': ['Netherlands'],
            'Belgium': ['Belgium'],
            'Austria': ['Austria'],
            'Czech Republic': ['Czech Republic'],
            'Poland': ['Poland'],
            'Croatia': ['Croatia'],
            'Slovenia': ['Slovenia'],
            'Hungary': ['Hungary'],
            'Serbia': ['Serbia'],
            'Bulgaria': ['Bulgaria'],
            'Algeria': ['Algeria'],
            'Tunisia': ['Tunisia'],
            'Ethiopia': ['Ethiopia'],
            'Kenya': ['Kenya'],
            'Uganda': ['Uganda'],
            'Rwanda': ['Rwanda'],
            'Zambia': ['Zambia'],
            'Zimbabwe': ['Zimbabwe'],
            'Mozambique': ['Mozambique'],
            'Madagascar': ['Madagascar'],
            'Thailand': ['Thailand'],
            'Malaysia': ['Malaysia'],
            'Indonesia': ['Indonesia'],
            'Philippines': ['Philippines'],
            'Nepal': ['Nepal'],
            'Mongolia': ['Mongolia'],
            'Iran': ['Iran, Islamic Republic of'],
            'Pakistan': ['Pakistan'],
            'Bangladesh': ['Bangladesh'],
            'Myanmar': ['Myanmar'],
            'Cambodia': ['Cambodia'],
            'Laos': ['Lao People\'s Democratic Republic'],
            'Singapore': ['Singapore'],
            'Hong Kong': ['Hong Kong'],
            'Israel': ['Israel'],
            'Lebanon': ['Lebanon'],
            'Syria': ['Syrian Arab Republic'],
            'Iraq': ['Iraq'],
            'Saudi Arabia': ['Saudi Arabia'],
            'Yemen': ['Yemen'],
            'Kuwait': ['Kuwait'],
            'Qatar': ['Qatar'],
            'Bahrain': ['Bahrain'],
            'Georgia': ['Georgia'],
            'Armenia': ['Armenia'],
            'Azerbaijan': ['Azerbaijan'],
            'Kazakhstan': ['Kazakhstan'],
            'Uzbekistan': ['Uzbekistan'],
            'Turkmenistan': ['Turkmenistan'],
            'Kyrgyzstan': ['Kyrgyzstan'],
            'Tajikistan': ['Tajikistan'],
            'Afghanistan': ['Afghanistan'],
            'Ecuador': ['Ecuador'],
            'Bolivia': ['Bolivia'],
            'Paraguay': ['Paraguay'],
            'Uruguay': ['Uruguay'],
            'Venezuela': ['Venezuela, Bolivarian Republic of'],
            'Costa Rica': ['Costa Rica'],
            'Panama': ['Panama'],
            'Nicaragua': ['Nicaragua'],
            'Honduras': ['Honduras'],
            'Guatemala': ['Guatemala'],
            'Belize': ['Belize'],
            'El Salvador': ['El Salvador'],
            'Cuba': ['Cuba'],
            'Jamaica': ['Jamaica'],
            'Dominican Republic': ['Dominican Republic'],
            'Puerto Rico': ['Puerto Rico'],
            'Trinidad and Tobago': ['Trinidad and Tobago'],
            'South Sudan': ['South Sudan'],
            'Sudan': ['Sudan'],
            'Libya': ['Libya'],
            'Mali': ['Mali'],
            'Niger': ['Niger'],
            'Chad': ['Chad'],
            'Mauritania': ['Mauritania'],
            'Senegal': ['Senegal'],
            'Ivory Coast': ['Côte d\'Ivoire'],
            'Ghana': ['Ghana'],
            'Nigeria': ['Nigeria'],
            'Cameroon': ['Cameroon'],
            'DRC': ['Congo, Democratic Republic of the'],
            'Angola': ['Angola'],
            'Malawi': ['Malawi'],
            'Lesotho': ['Lesotho'],
            'Swaziland': ['Eswatini'],
            'Eswatini': ['Eswatini']
        };

        function getRoadTripCountryNames() {
            var set = new Set();
            try {
                var all = getAllTrips ? getAllTrips() : (roadTrips || []);
                all.forEach(function(t) {
                    var c = (t.country || '').trim();
                    if (!c) return;
                    var geoNames = tripCountryToGeoJSON[c] || [c];
                    geoNames.forEach(function(g) { set.add(g); });
                    set.add(c);
                });
            } catch (e) {}
            return set;
        }

        function applyWorldMapHighlights() {
            if (!g || !countriesData || !countriesData.length) return;
            var roadTripNames = getRoadTripCountryNames();
            g.selectAll('path').each(function(d) {
                var el = this;
                var id = d.id;
                var name = (d.properties && d.properties.name) ? d.properties.name : '';
                var isRoadTrip = roadTripNames.has(name);
                var visitedColor = countryColors[id];
                d3.select(el).classed('road-trip-country', isRoadTrip);
                if (isRoadTrip) {
                    d3.select(el).style('fill', ROAD_TRIP_FILL).style('stroke', ROAD_TRIP_STROKE).style('stroke-width', '1.2px');
                } else if (visitedColor) {
                    d3.select(el).style('fill', visitedColor).style('stroke', 'rgba(100,100,120,0.4)').style('stroke-width', '0.5px');
                } else {
                    d3.select(el).style('fill', DEFAULT_COLOR).style('stroke', 'rgba(100,100,120,0.4)').style('stroke-width', '0.5px');
                }
            });
        }

        // ==================== STORAGE ====================
        function saveToStorage() {
            const data = {
                countryColors,
                communityAlerts,
                activeRoute,
                completedTrips,
                userCreatedTrips,
                plannedTrips,
                userName
            };
            localStorage.setItem('travelDiarySerendipity', JSON.stringify(data));
        }

        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('travelDiarySerendipity');
                if (saved) {
                    const data = JSON.parse(saved);
                    if (data.countryColors) {
                        countryColors = data.countryColors;
                        Object.keys(countryColors).forEach(id => {
                            const el = document.querySelector(`[data-id="${id}"]`);
                            if (el) d3.select(el).style('fill', countryColors[id]);
                        });
                    }
                    if (data.communityAlerts) communityAlerts = data.communityAlerts;
                    if (data.activeRoute) activeRoute = data.activeRoute;
                    if (data.completedTrips) completedTrips = data.completedTrips;
                    if (data.userCreatedTrips) userCreatedTrips = data.userCreatedTrips;
                    if (data.plannedTrips) plannedTrips = data.plannedTrips;
                    if (data.userName) userName = data.userName;
                    if (data.garageTripIds) garageTripIds = data.garageTripIds;
                }
                const garage = localStorage.getItem('srndipity_garage');
                if (garage) try { garageTripIds = JSON.parse(garage); } catch (e) {}
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // ==================== GPX EXPORT SYSTEM ====================
        function exportRouteGPX() {
            if (!currentDetailTrip) return;
            const trip = currentDetailTrip;
            const wps = trip.waypoints || [];
            if (wps.length < 2) { alert('No waypoints to export.'); return; }

            let gpxContent = `<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="DrawYourMap - Srndipity Inc."
     xmlns="http://www.topografix.com/GPX/1/1"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
  <metadata>
    <name>${escapeXml(trip.name)}</name>
    <desc>${escapeXml(trip.description || '')}</desc>
    <author><name>DrawYourMap</name></author>
    <time>${new Date().toISOString()}</time>
  </metadata>
  <trk>
    <name>${escapeXml(trip.name)}</name>
    <trkseg>
`;
            wps.forEach(wp => {
                if (!Array.isArray(wp)) return;
                gpxContent += `      <trkpt lat="${wp[0]}" lon="${wp[1]}">
        <name>${escapeXml(wp[2] || '')}</name>
      </trkpt>\n`;
            });
            gpxContent += `    </trkseg>
  </trk>
`;
            // Also add waypoints as GPX waypoints for GPS devices
            wps.forEach(wp => {
                if (!Array.isArray(wp)) return;
                gpxContent += `  <wpt lat="${wp[0]}" lon="${wp[1]}">
    <name>${escapeXml(wp[2] || 'Waypoint')}</name>
    ${wp[3] ? '<desc>' + escapeXml(wp[3]) + '</desc>' : ''}
  </wpt>\n`;
            });
            gpxContent += `</gpx>`;

            const blob = new Blob([gpxContent], { type: 'application/gpx+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = (trip.name || 'route').replace(/[^a-zA-Z0-9]/g, '_') + '.gpx';
            a.click();
            URL.revokeObjectURL(url);
        }

        function escapeXml(str) {
            return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&apos;');
        }

        function exportToGoogleMaps(e) {
            e.preventDefault();
            if (!currentDetailTrip) return;
            const wps = currentDetailTrip.waypoints || [];
            if (wps.length < 2) return;
            // Google Maps directions URL (max ~25 waypoints)
            const origin = wps[0][0] + ',' + wps[0][1];
            const dest = wps[wps.length - 1][0] + ',' + wps[wps.length - 1][1];
            const mid = wps.slice(1, -1).slice(0, 23).map(w => w[0] + ',' + w[1]).join('|');
            const url = 'https://www.google.com/maps/dir/?api=1&origin=' + origin + '&destination=' + dest + (mid ? '&waypoints=' + mid : '') + '&travelmode=driving';
            window.open(url, '_blank');
        }

        function exportToAppleMaps(e) {
            e.preventDefault();
            if (!currentDetailTrip) return;
            const wps = currentDetailTrip.waypoints || [];
            if (wps.length < 2) return;
            const dest = wps[wps.length - 1][0] + ',' + wps[wps.length - 1][1];
            const destName = wps[wps.length - 1][2] || 'Destination';
            const url = 'https://maps.apple.com/?daddr=' + dest + '&dirflg=d&t=m';
            window.open(url, '_blank');
        }

        // ==================== INTERACTIVE PACKING CHECKLIST ====================
        let packingCheckedItems = JSON.parse(localStorage.getItem('srndipity_packing_checked') || '{}');

        function renderPackingChecklist(trip) {
            const container = document.getElementById('tripPackingList');
            if (!container) return;

            const tripId = trip.id;
            const checkedKey = 'packing_' + tripId;
            const checkedItems = packingCheckedItems[checkedKey] || [];

            let items = [];
            if (trip.packingList && trip.packingList.length > 0) {
                items = trip.packingList.map((item, i) => ({
                    id: i,
                    label: item.item,
                    essential: item.essential || false
                }));
            } else {
                items = [
                    { id: 0, label: '📱 Offline maps', essential: true },
                    { id: 1, label: '💧 Water bottles', essential: true },
                    { id: 2, label: '📷 Camera', essential: false },
                    { id: 3, label: '🔌 Phone charger', essential: true },
                    { id: 4, label: '🧴 Sunscreen', essential: false },
                    { id: 5, label: '🩹 First aid kit', essential: true }
                ];
            }

            const totalItems = items.length;
            const checkedCount = items.filter(item => checkedItems.includes(item.id)).length;
            const uncheckedItems = items.filter(item => !checkedItems.includes(item.id));
            const pctDone = totalItems > 0 ? Math.round((checkedCount / totalItems) * 100) : 0;

            container.innerHTML = `
                <div class="packing-checklist">
                    ${items.map(item => {
                        const isChecked = checkedItems.includes(item.id);
                        const searchQuery = encodeURIComponent(item.label.replace(/[^\w\s]/g, '').trim());
                        return `<div class="packing-check-item ${isChecked ? 'checked' : ''} ${item.essential ? 'essential' : ''}" onclick="togglePackingItem('${tripId}', ${item.id})">
                            <span class="packing-checkbox">${isChecked ? '✓' : ''}</span>
                            <span class="packing-item-label">${item.label}</span>
                            <a href="https://www.amazon.com/s?k=${searchQuery}" target="_blank" rel="noopener sponsored" class="packing-buy-link" onclick="event.stopPropagation();">Buy</a>
                        </div>`;
                    }).join('')}
                </div>
                <div class="packing-checklist-footer">
                    <div class="packing-progress">
                        <div class="packing-progress-bar">
                            <div class="packing-progress-fill ${pctDone === 100 ? 'complete' : ''}" style="width:${pctDone}%"></div>
                        </div>
                        <span>${checkedCount}/${totalItems} packed</span>
                    </div>
                    ${uncheckedItems.length > 0 ? `<a class="packing-amazon-btn" href="https://www.amazon.com/s?k=${encodeURIComponent(uncheckedItems.map(i => i.label.replace(/[^\w\s]/g, '').trim()).join(' '))}" target="_blank" rel="noopener sponsored" onclick="event.stopPropagation();">
                        <i data-lucide="shopping-cart" style="width:12px;height:12px;"></i> Buy Missing Items
                    </a>` : '<span style="font-size:0.75rem;color:#22c55e;font-weight:600;">✓ All packed!</span>'}
                </div>
            `;
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 60);
        }

        function togglePackingItem(tripId, itemId) {
            const checkedKey = 'packing_' + tripId;
            if (!packingCheckedItems[checkedKey]) packingCheckedItems[checkedKey] = [];
            const idx = packingCheckedItems[checkedKey].indexOf(itemId);
            if (idx > -1) {
                packingCheckedItems[checkedKey].splice(idx, 1);
            } else {
                packingCheckedItems[checkedKey].push(itemId);
            }
            localStorage.setItem('srndipity_packing_checked', JSON.stringify(packingCheckedItems));
            if (currentDetailTrip) renderPackingChecklist(currentDetailTrip);
        }

        // ==================== ENHANCED BOOKING BUTTONS ====================
        function renderRecommendationsWithBooking(trip) {
            const container = document.getElementById('tripRecommendations');
            if (!container) return;

            const recs = trip.recommendations || [];
            if (recs.length === 0) {
                container.innerHTML = '<p style="color: #64748b;">No recommendations yet. Share yours in the community!</p>';
                return;
            }

            const gygQuery = encodeURIComponent((trip.name || '') + ' ' + (trip.country || ''));
            const viatorQuery = encodeURIComponent((trip.country || '') + ' tours');
            const bookingQuery = encodeURIComponent((trip.country || '') + ' hotels');

            container.innerHTML = recs.map(rec => {
                const recQuery = encodeURIComponent((rec.title || '') + ' ' + (trip.country || ''));
                return `<div class="recommendation-item">
                    <div class="rec-icon">${rec.icon}</div>
                    <div style="flex:1;">
                        <div class="rec-title">${rec.title}</div>
                        <div class="rec-desc">${rec.desc}</div>
                        <div class="rec-actions">
                            <a href="https://www.getyourguide.com/s/?q=${recQuery}" target="_blank" rel="noopener sponsored" class="rec-action-btn book-guide">
                                <i data-lucide="users" style="width:12px;height:12px;"></i> Book a Guide
                            </a>
                            <a href="https://www.viator.com/searchResults/all?text=${recQuery}" target="_blank" rel="noopener sponsored" class="rec-action-btn check-avail">
                                <i data-lucide="calendar-check" style="width:12px;height:12px;"></i> Check Availability
                            </a>
                            <a href="https://www.booking.com/searchresults.html?ss=${bookingQuery}" target="_blank" rel="noopener sponsored" class="rec-action-btn book-hotel">
                                <i data-lucide="bed-double" style="width:12px;height:12px;"></i> Nearby Hotels
                            </a>
                        </div>
                        <div class="rec-partner-row">
                            <span class="rec-partner-badge">via GetYourGuide</span>
                            <span class="rec-partner-badge">· Viator</span>
                            <span class="rec-partner-badge">· Booking.com</span>
                        </div>
                    </div>
                </div>`;
            }).join('');
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 60);
        }

        // ==================== USER BADGE SYSTEM ====================
        function getUserBadge(creatorName) {
            // Count total upvotes across all variants by this creator
            let totalUpvotes = 0;
            const allTrips = getAllTrips();
            allTrips.forEach(trip => {
                const userVars = getUserVariants(trip.id);
                userVars.forEach(v => {
                    if (v.creator === creatorName) {
                        totalUpvotes += (v.upvotes || 0);
                    }
                });
            });

            if (totalUpvotes >= 100) {
                return { class: 'badge-expert', label: 'Expert', icon: 'award' };
            } else if (totalUpvotes >= 50) {
                return { class: 'badge-local', label: 'Local', icon: 'map-pin' };
            } else if (totalUpvotes >= 20) {
                return { class: 'badge-explorer', label: 'Explorer', icon: 'compass' };
            } else {
                return { class: 'badge-newcomer', label: 'Newcomer', icon: 'user' };
            }
        }

        function renderUserBadge(creatorName) {
            const badge = getUserBadge(creatorName);
            return `<span class="user-badge ${badge.class}"><i data-lucide="${badge.icon}" style="width:10px;height:10px;"></i> ${badge.label}</span>`;
        }

        // ==================== SEARCH FILTERS (Vehicle, Budget) ====================
        let activeVehicleFilter = 'all';
        let activeBudgetFilter = 'all';

        function setVehicleFilter(type, btn) {
            activeVehicleFilter = type;
            document.querySelectorAll('#vehicleFilters .filter-tag').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderRoadTrips();
        }

        function setBudgetFilter(level, btn) {
            activeBudgetFilter = level;
            document.querySelectorAll('#budgetFilters .budget-chip').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderRoadTrips();
        }

        function classifyTripBudget(trip) {
            const budgetStr = (trip.budget || '').toLowerCase();
            const total = (trip.costs && trip.costs.total) ? trip.costs.total.toLowerCase() : budgetStr;
            // Extract numeric values
            const nums = total.match(/[\d,]+/g);
            if (nums && nums.length > 0) {
                const val = parseInt(nums[0].replace(/,/g, ''));
                if (val <= 500) return 'budget';
                if (val <= 2000) return 'moderate';
                return 'luxury';
            }
            if (budgetStr.includes('budget') || budgetStr.includes('cheap')) return 'budget';
            if (budgetStr.includes('luxury') || budgetStr.includes('premium')) return 'luxury';
            return 'moderate';
        }

        function tripMatchesVehicleFilter(trip) {
            if (activeVehicleFilter === 'all') return true;
            const tags = (trip.tags || []).map(t => t.toLowerCase());
            const desc = ((trip.description || '') + ' ' + (trip.name || '')).toLowerCase();
            switch (activeVehicleFilter) {
                case 'van': return tags.includes('van') || tags.includes('vanlife') || tags.includes('camping') || desc.includes('van') || desc.includes('camper');
                case 'motorcycle': return tags.includes('motorcycle') || tags.includes('moto') || desc.includes('motorcycle') || desc.includes('moto') || desc.includes('bike');
                case 'fourx4': return tags.includes('fourx4') || tags.includes('4x4') || tags.includes('offroad') || (trip.difficulty === 'challenging');
                default: return true;
            }
        }

        function getWeatherIconForTrip(trip) {
            const season = (trip.bestSeason || '').toLowerCase();
            if (season.includes('summer') || season.includes('jun') || season.includes('jul') || season.includes('aug') || season.includes('hot') || season.includes('dry')) {
                return { emoji: '☀️', label: 'Hot', class: 'hot' };
            } else if (season.includes('winter') || season.includes('dec') || season.includes('jan') || season.includes('feb') || season.includes('cold') || season.includes('snow')) {
                return { emoji: '❄️', label: 'Cold', class: 'cold' };
            } else if (season.includes('spring') || season.includes('autumn') || season.includes('fall') || season.includes('year')) {
                return { emoji: '🌤️', label: 'Mild', class: 'mild' };
            }
            return { emoji: '🌤️', label: 'Mild', class: 'mild' };
        }

        // ==================== STRUCTURED ADD POI SYSTEM ====================
        let poiPlaceMode = false;
        let currentPoiType = null;
        let userPlacedPois = [];
        let addPoiSelectedCat = null;
        let addPoiPhotoData = null;
        let addPoiPendingLatLng = null;

        const POI_ICONS = {
            viewpoint: '📸', restaurant: '🍽️', hotel: '🏨', attraction: '⭐', danger: '⚠️',
            campsiteFree: '⛺', fuel: '⛽', grocery: '🛒', water: '💧'
        };

        function openAddPoiModal() {
            const overlay = document.getElementById('addPoiOverlay');
            if (!overlay) return;
            // Reset form
            addPoiSelectedCat = null;
            addPoiPhotoData = null;
            addPoiPendingLatLng = null;
            document.querySelectorAll('.add-poi-cat-btn').forEach(b => b.classList.remove('selected'));
            const nameInput = document.getElementById('addPoiName');
            if (nameInput) nameInput.value = '';
            const tipInput = document.getElementById('addPoiTip');
            if (tipInput) tipInput.value = '';
            const addrText = document.getElementById('addPoiAddressText');
            if (addrText) addrText.textContent = 'Click on the map to set location...';
            document.getElementById('addPoiLat').value = '';
            document.getElementById('addPoiLng').value = '';
            const photoArea = document.getElementById('addPoiPhotoArea');
            if (photoArea) { photoArea.classList.remove('has-photo'); }
            const photoLabel = document.getElementById('addPoiPhotoLabel');
            if (photoLabel) photoLabel.innerHTML = '<i data-lucide="camera" style="width:20px;height:20px;"></i><br>Click to upload a photo';
            const submitBtn = document.getElementById('addPoiSubmitBtn');
            if (submitBtn) submitBtn.disabled = true;
            overlay.classList.add('active');
            // Enable map click for location
            startPoiLocationPick();
            if (typeof lucide !== 'undefined') setTimeout(() => lucide.createIcons(), 50);
        }

        function closeAddPoiModal() {
            const overlay = document.getElementById('addPoiOverlay');
            if (overlay) overlay.classList.remove('active');
            stopPoiLocationPick();
        }

        function selectAddPoiCat(cat, btnEl) {
            addPoiSelectedCat = cat;
            document.querySelectorAll('.add-poi-cat-btn').forEach(b => b.classList.remove('selected'));
            btnEl.classList.add('selected');
            validateAddPoiForm();
            // Update placement indicator
            const iconPreview = document.getElementById('poiPlaceIconPreview');
            const catLabel = document.getElementById('poiPlaceCatLabel');
            if (iconPreview) iconPreview.textContent = POI_ICONS[cat] || '📍';
            if (catLabel) catLabel.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
        }

        function startPoiLocationPick() {
            poiPlaceMode = true;
            if (tripDetailMap) {
                tripDetailMap.getContainer().style.cursor = 'crosshair';
                tripDetailMap.on('click', onAddPoiMapClick);
            }
            const indicator = document.getElementById('poiPlaceIndicator');
            if (indicator) indicator.style.display = 'flex';
        }

        function stopPoiLocationPick() {
            poiPlaceMode = false;
            if (tripDetailMap) {
                tripDetailMap.getContainer().style.cursor = '';
                tripDetailMap.off('click', onAddPoiMapClick);
            }
            const indicator = document.getElementById('poiPlaceIndicator');
            if (indicator) indicator.style.display = 'none';
        }

        function cancelPoiPlacement() {
            closeAddPoiModal();
        }

        async function onAddPoiMapClick(e) {
            if (!poiPlaceMode) return;
            addPoiPendingLatLng = [e.latlng.lat, e.latlng.lng];
            document.getElementById('addPoiLat').value = e.latlng.lat;
            document.getElementById('addPoiLng').value = e.latlng.lng;
            // Reverse geocoding
            const addrText = document.getElementById('addPoiAddressText');
            if (addrText) addrText.textContent = `${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)} (loading address...)`;
            validateAddPoiForm();
            try {
                const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${e.latlng.lat}&lon=${e.latlng.lng}&zoom=16&addressdetails=1`);
                const data = await res.json();
                if (data && data.display_name && addrText) {
                    addrText.textContent = data.display_name;
                }
            } catch (err) {
                if (addrText) addrText.textContent = `${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
            }
        }

        function handlePoiPhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                addPoiPhotoData = e.target.result;
                const photoArea = document.getElementById('addPoiPhotoArea');
                const photoLabel = document.getElementById('addPoiPhotoLabel');
                if (photoArea) photoArea.classList.add('has-photo');
                if (photoLabel) photoLabel.innerHTML = '✓ Photo uploaded: ' + file.name;
            };
            reader.readAsDataURL(file);
        }

        function validateAddPoiForm() {
            const btn = document.getElementById('addPoiSubmitBtn');
            if (!btn) return;
            const hasCategory = !!addPoiSelectedCat;
            const hasLocation = !!document.getElementById('addPoiLat').value;
            const hasName = (document.getElementById('addPoiName')?.value || '').trim().length > 0;
            btn.disabled = !(hasCategory && hasLocation);
        }

        // Attach input listener for name
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('addPoiName');
            if (nameInput) nameInput.addEventListener('input', validateAddPoiForm);
        });

        function submitAddPoi() {
            if (!addPoiSelectedCat || !addPoiPendingLatLng || !tripDetailMap) return;
            const name = (document.getElementById('addPoiName')?.value || '').trim() || (addPoiSelectedCat.charAt(0).toUpperCase() + addPoiSelectedCat.slice(1));
            const tip = (document.getElementById('addPoiTip')?.value || '').trim();
            const lat = addPoiPendingLatLng[0];
            const lng = addPoiPendingLatLng[1];
            const cat = addPoiSelectedCat;

            // Create marker with full V2 popup
            const poiData = { lat, lng, name, tip, region: 'User Added', country: '' };
            const popupHtml = createPoiPopup(poiData, cat);
            const cfg = POI_CONFIG[cat] || { icon: '📍', class: 'viewpoint' };
            const marker = L.marker([lat, lng], {
                icon: L.divIcon({
                    className: 'poi-marker detail-poi',
                    html: '<div class="poi-marker-icon ' + cfg.class + '">' + cfg.icon + '</div>',
                    iconSize: [26, 26], iconAnchor: [13, 13]
                }),
                draggable: true
            }).addTo(tripDetailMap).bindPopup(popupHtml, { maxWidth: 300 });

            userPlacedPois.push({ type: cat, lat, lng, name, tip, marker, photo: addPoiPhotoData });

            // Save to localStorage for persistence
            const saved = JSON.parse(localStorage.getItem('dym_user_pois') || '[]');
            saved.push({ type: cat, lat, lng, name, tip });
            localStorage.setItem('dym_user_pois', JSON.stringify(saved));

            closeAddPoiModal();
            marker.openPopup();
        }

        // ==================== NIGHT MODE FOR MAP ====================
        let nightModeActive = false;
        let nightTileLayer = null;

        function toggleNightMode() {
            nightModeActive = !nightModeActive;
            const toggle = document.getElementById('nightModeToggle');
            const label = document.getElementById('nightModeLabel');
            if (!tripDetailMap) return;

            if (nightModeActive) {
                if (toggle) toggle.classList.add('night-active');
                if (label) label.textContent = 'Day Mode';
                // Apply dark tiles
                nightTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                    attribution: '© CARTO, © OpenStreetMap',
                    maxZoom: 19
                });
                tripDetailMap.eachLayer(l => {
                    if (l instanceof L.TileLayer) tripDetailMap.removeLayer(l);
                });
                nightTileLayer.addTo(tripDetailMap);
            } else {
                if (toggle) toggle.classList.remove('night-active');
                if (label) label.textContent = 'Night Mode';
                if (nightTileLayer) tripDetailMap.removeLayer(nightTileLayer);
                // Restore default tiles
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '© OpenStreetMap',
                    maxZoom: 19
                }).addTo(tripDetailMap);
                nightTileLayer = null;
            }
        }

        // ==================== EXPORT/IMPORT ====================
        function exportData() {
            const data = {
                countryColors,
                communityAlerts,
                activeRoute,
                completedTrips,
                userCreatedTrips,
                plannedTrips,
                userName,
                timestamp: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'travel-diary-' + Date.now() + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.countryColors) {
                        countryColors = data.countryColors;
                        Object.keys(countryColors).forEach(id => {
                            const el = document.querySelector(`[data-id="${id}"]`);
                            if (el) d3.select(el).style('fill', countryColors[id]);
                        });
                    }
                    if (data.communityAlerts) {
                        communityAlerts = data.communityAlerts;
                        renderAlerts();
                    }
                    saveToStorage();
                    updateStats();
                    alert('Data imported successfully!');
                } catch (err) {
                    alert('Error importing file');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ==================== KEYBOARD ====================
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeAlertModal();
                closeLeaderboardModal();
                closeCreateTripModal();
                closeTripPlannerModal();
                closeSatelliteViewModal();
                closeTripDetailModal();
            }
        });

        // ==================== MEMORY BOOK FEATURE ====================
        let travelMemories = {}; // { countryId: [{ id, title, description, date, location, photo }] }
        let currentMemoryCountry = null;
        let currentViewingMemory = null;
        let editingMemoryId = null;

        // Load memories from localStorage
        function loadMemories() {
            const saved = localStorage.getItem('srndipity_memories');
            if (saved) {
                travelMemories = JSON.parse(saved);
            }
        }

        // Save memories to localStorage
        function saveMemoriesToStorage() {
            localStorage.setItem('srndipity_memories', JSON.stringify(travelMemories));
        }

        // Open Memory Book
        function openMemoryBook() {
            loadMemories();
            document.getElementById('memoryBookModal').classList.add('active');
            renderCountriesWithMemories();
            
            // Auto-select first country with memories, or show message
            const countriesWithMems = Object.keys(travelMemories).filter(id => 
                travelMemories[id] && travelMemories[id].length > 0
            );
            
            if (countriesWithMems.length > 0) {
                selectMemoryCountry(countriesWithMems[0]);
                document.getElementById('noMemoriesMessage').style.display = 'none';
            } else {
                document.getElementById('noMemoriesMessage').style.display = 'block';
                document.getElementById('selectedCountryFlag').textContent = '🌍';
                document.getElementById('selectedCountryTitle').textContent = 'No Memories Yet';
                document.getElementById('memoryGrid').innerHTML = '';
            }
        }

        // Close Memory Book
        function closeMemoryBook() {
            document.getElementById('memoryBookModal').classList.remove('active');
        }

        // Get country name by ID
        function getCountryNameById(countryId) {
            const country = countriesData.find(c => c.id == countryId);
            return country ? (country.properties.name || 'Unknown') : 'Unknown';
        }

        // Get country flag emoji (simplified mapping)
        function getCountryFlag(countryName) {
            const flags = {
                'France': '🇫🇷', 'Germany': '🇩🇪', 'Italy': '🇮🇹', 'Spain': '🇪🇸', 'Portugal': '🇵🇹',
                'United Kingdom': '🇬🇧', 'Ireland': '🇮🇪', 'Netherlands': '🇳🇱', 'Belgium': '🇧🇪',
                'Switzerland': '🇨🇭', 'Austria': '🇦🇹', 'Greece': '🇬🇷', 'Sweden': '🇸🇪', 'Norway': '🇳🇴',
                'Denmark': '🇩🇰', 'Finland': '🇫🇮', 'Iceland': '🇮🇸', 'Poland': '🇵🇱', 'Czechia': '🇨🇿',
                'United States of America': '🇺🇸', 'Canada': '🇨🇦', 'Mexico': '🇲🇽',
                'Brazil': '🇧🇷', 'Argentina': '🇦🇷', 'Chile': '🇨🇱', 'Peru': '🇵🇪', 'Colombia': '🇨🇴',
                'Australia': '🇦🇺', 'New Zealand': '🇳🇿', 'Japan': '🇯🇵', 'South Korea': '🇰🇷',
                'China': '🇨🇳', 'Thailand': '🇹🇭', 'Vietnam': '🇻🇳', 'India': '🇮🇳', 'Indonesia': '🇮🇩',
                'South Africa': '🇿🇦', 'Morocco': '🇲🇦', 'Egypt': '🇪🇬', 'Kenya': '🇰🇪',
                'Turkey': '🇹🇷', 'United Arab Emirates': '🇦🇪', 'Croatia': '🇭🇷', 'Hungary': '🇭🇺'
            };
            return flags[countryName] || '🏳️';
        }

        // Render countries with memories in left page
        function renderCountriesWithMemories() {
            const container = document.getElementById('countriesWithMemories');
            
            // Get visited countries (from countryColors)
            const visitedCountries = Object.keys(countryColors).filter(id => countryColors[id] === VISITED_COLOR);
            
            if (visitedCountries.length === 0) {
                container.innerHTML = '<p style="color: #8b7355; text-align: center;">No visited countries yet. Mark countries as visited to add memories!</p>';
                return;
            }

            container.innerHTML = visitedCountries.map(countryId => {
                const name = getCountryNameById(countryId);
                const memories = travelMemories[countryId] || [];
                const flag = getCountryFlag(name);
                const isActive = currentMemoryCountry == countryId ? 'active' : '';
                
                return `
                    <div class="country-memory-chip ${isActive}" onclick="selectMemoryCountry('${countryId}')">
                        ${flag} ${name}
                        ${memories.length > 0 ? `<span class="memory-count">${memories.length}</span>` : ''}
                    </div>
                `;
            }).join('');
        }

        // Select a country to view memories
        function selectMemoryCountry(countryId) {
            currentMemoryCountry = countryId;
            const name = getCountryNameById(countryId);
            const flag = getCountryFlag(name);
            
            document.getElementById('selectedCountryFlag').textContent = flag;
            document.getElementById('selectedCountryTitle').textContent = name;
            
            renderCountriesWithMemories(); // Update active state
            renderMemoryGrid();
        }

        // Render memory grid for selected country
        function renderMemoryGrid() {
            const grid = document.getElementById('memoryGrid');
            const memories = travelMemories[currentMemoryCountry] || [];
            
            let html = memories.map(memory => `
                <div class="memory-card" onclick="viewMemory('${memory.id}')">
                    <div class="memory-card-image">
                        ${memory.photo ? `<img src="${memory.photo}" alt="${memory.title}">` : '📷'}
                    </div>
                    <div class="memory-card-content">
                        <div class="memory-card-title">${memory.title}</div>
                        <div class="memory-card-date">${memory.date ? formatMemoryDate(memory.date) : ''}</div>
                    </div>
                </div>
            `).join('');
            
            // Add "Add Memory" card
            html += `
                <div class="memory-card add-memory-card" onclick="addMemoryToCountry()">
                    <div class="plus-icon">+</div>
                    <div>Add Memory</div>
                </div>
            `;
            
            grid.innerHTML = html;
        }

        // Format date for display
        function formatMemoryDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // View a specific memory
        function viewMemory(memoryId) {
            const memories = travelMemories[currentMemoryCountry] || [];
            const memory = memories.find(m => m.id === memoryId);
            
            if (!memory) return;
            
            currentViewingMemory = memory;
            
            const popup = document.getElementById('memoryPopup');
            const imageDiv = document.getElementById('memoryPopupImage');
            
            if (memory.photo) {
                imageDiv.innerHTML = `<img src="${memory.photo}" style="width: 100%; height: 100%; object-fit: cover;">`;
            } else {
                imageDiv.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; font-size: 4rem;">📷</div>';
            }
            
            document.getElementById('memoryPopupTitle').textContent = memory.title;
            document.getElementById('memoryPopupDate').textContent = memory.date ? 
                `📅 ${formatMemoryDate(memory.date)}${memory.location ? ' • 📍 ' + memory.location : ''}` : 
                (memory.location ? '📍 ' + memory.location : '');
            document.getElementById('memoryPopupDesc').textContent = memory.description || 'No description added.';
            
            popup.classList.add('active');
        }

        // Close memory popup
        function closeMemoryPopup() {
            document.getElementById('memoryPopup').classList.remove('active');
            currentViewingMemory = null;
        }

        // Add memory to current country
        function addMemoryToCountry() {
            if (!currentMemoryCountry) {
                showToast('Please select a country first');
                return;
            }
            
            editingMemoryId = null;
            document.getElementById('memoryFormIcon').textContent = '📸';
            document.getElementById('memoryFormTitle').textContent = 'Add Memory to ' + getCountryNameById(currentMemoryCountry);
            
            // Reset form
            document.getElementById('memoryTitle').value = '';
            document.getElementById('memoryDate').value = '';
            document.getElementById('memoryDescription').value = '';
            document.getElementById('memoryLocation').value = '';
            
            const uploadArea = document.getElementById('photoUploadArea');
            uploadArea.classList.remove('has-photo');
            uploadArea.innerHTML = `
                <div class="photo-upload-icon">📷</div>
                <div class="photo-upload-text">Click to upload a photo</div>
            `;
            uploadArea.dataset.photo = '';
            
            document.getElementById('addMemoryModal').classList.add('active');
        }

        // Handle photo upload
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                showToast('Photo is too large. Please use an image under 5MB.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const uploadArea = document.getElementById('photoUploadArea');
                uploadArea.classList.add('has-photo');
                uploadArea.innerHTML = `<img src="${e.target.result}" alt="Memory photo">`;
                uploadArea.dataset.photo = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Save memory
        function saveMemory() {
            const title = document.getElementById('memoryTitle').value.trim();
            if (!title) {
                showToast('Please enter a memory title');
                return;
            }
            
            const photo = document.getElementById('photoUploadArea').dataset.photo || '';
            const date = document.getElementById('memoryDate').value;
            const description = document.getElementById('memoryDescription').value.trim();
            const location = document.getElementById('memoryLocation').value.trim();
            
            if (!travelMemories[currentMemoryCountry]) {
                travelMemories[currentMemoryCountry] = [];
            }
            
            if (editingMemoryId) {
                // Update existing memory
                const memories = travelMemories[currentMemoryCountry];
                const index = memories.findIndex(m => m.id === editingMemoryId);
                if (index !== -1) {
                    memories[index] = { ...memories[index], title, photo, date, description, location };
                }
            } else {
                // Add new memory
                travelMemories[currentMemoryCountry].push({
                    id: 'mem_' + Date.now(),
                    title,
                    photo,
                    date,
                    description,
                    location,
                    createdAt: new Date().toISOString()
                });
            }
            
            saveMemoriesToStorage();
            closeAddMemoryModal();
            renderMemoryGrid();
            renderCountriesWithMemories();
            
            showToast(editingMemoryId ? 'Memory updated!' : 'Memory added! 📸');
        }

        // Close add memory modal
        function closeAddMemoryModal() {
            document.getElementById('addMemoryModal').classList.remove('active');
            editingMemoryId = null;
        }

        // Edit current memory
        function editCurrentMemory() {
            if (!currentViewingMemory) return;
            
            editingMemoryId = currentViewingMemory.id;
            document.getElementById('memoryFormIcon').textContent = '✏️';
            document.getElementById('memoryFormTitle').textContent = 'Edit Memory';
            
            // Fill form with existing data
            document.getElementById('memoryTitle').value = currentViewingMemory.title || '';
            document.getElementById('memoryDate').value = currentViewingMemory.date || '';
            document.getElementById('memoryDescription').value = currentViewingMemory.description || '';
            document.getElementById('memoryLocation').value = currentViewingMemory.location || '';
            
            const uploadArea = document.getElementById('photoUploadArea');
            if (currentViewingMemory.photo) {
                uploadArea.classList.add('has-photo');
                uploadArea.innerHTML = `<img src="${currentViewingMemory.photo}" alt="Memory photo">`;
                uploadArea.dataset.photo = currentViewingMemory.photo;
            } else {
                uploadArea.classList.remove('has-photo');
                uploadArea.innerHTML = `
                    <div class="photo-upload-icon">📷</div>
                    <div class="photo-upload-text">Click to upload a photo</div>
                `;
                uploadArea.dataset.photo = '';
            }
            
            closeMemoryPopup();
            document.getElementById('addMemoryModal').classList.add('active');
        }

        // Delete current memory
        function deleteCurrentMemory() {
            if (!currentViewingMemory) return;
            
            if (confirm('Are you sure you want to delete this memory?')) {
                const memories = travelMemories[currentMemoryCountry];
                const index = memories.findIndex(m => m.id === currentViewingMemory.id);
                if (index !== -1) {
                    memories.splice(index, 1);
                }
                
                saveMemoriesToStorage();
                closeMemoryPopup();
                renderMemoryGrid();
                renderCountriesWithMemories();
                showToast('Memory deleted');
            }
        }

        // Auto-prompt to add memory when marking a country as visited
        const originalMarkAsVisited = markAsVisited;
        markAsVisited = function() {
            originalMarkAsVisited();
            
            // After marking visited, prompt to add memory
            setTimeout(() => {
                if (currentCountryId && countryColors[currentCountryId] === VISITED_COLOR) {
                    if (confirm(`Would you like to add a memory for ${currentCountryName}?`)) {
                        currentMemoryCountry = currentCountryId;
                        addMemoryToCountry();
                    }
                }
            }, 300);
        };

        // Load memories on startup
        loadMemories();

        // ==================== FILTER ROAD TRIPS BY REGION ====================
        
        // Region bounds for map zoom when user clicks a zone – zoom prononcé pour se focaliser sur le pays/région
        const regionBounds = {
            'all': { center: [35, 10], zoom: 4 },
            'Europe': { bounds: [[35, -12], [72, 42]], center: [52, 10], zoom: 5 },
            'North America': { bounds: [[15, -170], [72, -50]], center: [45, -100], zoom: 5 },
            'South America': { bounds: [[-56, -82], [13, -35]], center: [-15, -60], zoom: 5 },
            'Asia': { bounds: [[10, 60], [55, 150]], center: [35, 100], zoom: 5 },
            'Africa': { bounds: [[-35, -18], [38, 52]], center: [5, 20], zoom: 5 },
            'Oceania': { bounds: [[-48, 110], [0, 180]], center: [-25, 140], zoom: 5 }
        };

        function updateRoadTripsPanelVisibility() {
            const panel = document.getElementById('roadTripsListPanel');
            const placeholder = document.getElementById('roadTripsPlaceholder');
            const backBtn = document.getElementById('backToRegionsBtn');
            const titleEl = document.getElementById('roadTripsListTitle');
            const subtitleEl = document.getElementById('roadTripsListSubtitle');
            const showList = currentRegionFilter || (selectedTravelMonth !== null && selectedTravelMonth !== undefined);
            
            if (panel) panel.style.display = showList ? 'block' : 'none';
            if (placeholder) placeholder.style.display = showList ? 'none' : 'block';
            if (backBtn) backBtn.style.display = currentRegionFilter ? 'inline-block' : 'none';
            
            if (showList && titleEl) {
                if (currentRegionFilter) {
                    titleEl.textContent = '🛣️ Road trips in ' + currentRegionFilter;
                    if (selectedTravelMonth !== null && selectedTravelMonth !== undefined) {
                        const monthName = new Date(2024, selectedTravelMonth).toLocaleString('en', { month: 'long' });
                        if (subtitleEl) subtitleEl.textContent = 'Best in ' + monthName + ' at top';
                    } else if (subtitleEl) subtitleEl.textContent = '';
                } else {
                    const monthName = new Date(2024, selectedTravelMonth).toLocaleString('en', { month: 'long' });
                    titleEl.textContent = '☀️ Recommended for ' + monthName;
                    if (subtitleEl) subtitleEl.textContent = 'Trips that are best this month';
                }
            }
            
            document.querySelectorAll('.region-card').forEach(card => {
                card.classList.toggle('active', card.getAttribute('data-region') === currentRegionFilter);
            });
        }

        function selectRegion(region) {
            currentRegionFilter = region;
            renderRoadTrips();
            if (roadMap && regionBounds[region]) {
                const r = regionBounds[region];
                if (r.bounds) {
                    roadMap.fitBounds(L.latLngBounds(r.bounds[0], r.bounds[1]), { padding: [20, 20], maxZoom: 9 });
                } else if (r.center) {
                    roadMap.flyTo(r.center, r.zoom, { duration: 1.2, easeLinearity: 0.25 });
                }
            }
            if (region) showSeasonalTip(region);
        }

        function backToRegions() {
            currentRegionFilter = null;
            if (selectedTravelMonth !== null && selectedTravelMonth !== undefined) {
                renderRoadTrips();
            } else {
                updateRoadTripsPanelVisibility();
                document.getElementById('roadTripsList').innerHTML = '';
                document.getElementById('roadTripsCount').textContent = '0';
            }
        }

        function filterRoadTrips(region, element) {
            selectRegion(region);
        }

        // Show seasonal tip based on region and current/selected month
        function showSeasonalTip(region) {
            const tips = getSeasonalTips(region, selectedTravelMonth);
            if (tips.best.length > 0 || tips.avoid.length > 0) {
                const monthName = new Date(2024, selectedTravelMonth).toLocaleString('en', { month: 'long' });
                let tipMessage = `📅 For ${monthName}: `;
                
                if (tips.best.length > 0) {
                    tipMessage += `✅ Great time for: ${tips.best.slice(0, 3).join(', ')}`;
                }
                if (tips.avoid.length > 0) {
                    tipMessage += tips.best.length > 0 ? ' | ' : '';
                    tipMessage += `⚠️ Consider avoiding: ${tips.avoid.slice(0, 2).join(', ')}`;
                }
                
                showToast(tipMessage);
            }
        }

        // Get seasonal tips for a region
        function getSeasonalTips(region, month) {
            const tripsInRegion = getAllTrips().filter(t => 
                region === 'all' || t.continent === region
            );
            
            const best = [];
            const avoid = [];
            
            tripsInRegion.forEach(trip => {
                const seasonInfo = tripSeasons[trip.id];
                if (seasonInfo) {
                    if (seasonInfo.best.includes(month)) {
                        best.push(trip.name);
                    }
                    if (seasonInfo.avoid.includes(month)) {
                        avoid.push(trip.name);
                    }
                }
            });
            
            return { best, avoid };
        }

        // Update selected travel month – show recommended trips for that period when no region selected
        function setTravelMonth(month) {
            if (month === '' || month === undefined) {
                selectedTravelMonth = null;
            } else {
                selectedTravelMonth = parseInt(month, 10);
            }
            if (currentRegionFilter || selectedTravelMonth !== null) {
                renderRoadTrips();
            } else {
                updateRoadTripsPanelVisibility();
            }
            if (currentRegionFilter) showSeasonalTip(currentRegionFilter);
        }
        
        // ==================== INITIALIZE APP ====================
        // Initialize travel month selector – default "Any month" so list shows only after user picks region or month
        function initTravelMonthSelector() {
            const select = document.getElementById('travelMonthSelect');
            if (select) {
                select.value = '';
            }
            updateRoadTripsPanelVisibility();
        }
        
        // Wait for DOM to be ready, then initialize
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                initMap();
                initTravelMonthSelector();
            });
        } else {
            initMap();
            initTravelMonthSelector();
        }
    </script>

    <!-- SEO Footer (hidden but crawlable) -->
    <footer class="seo-content" role="contentinfo">
        <nav aria-label="Site links">
            <h2>Srndipity - For Those With Eyes to See</h2>
            <p>The free road trip planning tool for vanlifers, overlanders, and adventure travelers who see what others miss.</p>
            
            <h3>Explore Road Trips</h3>
            <ul>
                <li><a href="#serendipity">All Road Trips</a></li>
                <li><a href="#diary">Travel Diary</a></li>
                <li>Route 66 USA</li>
                <li>Iceland Ring Road</li>
                <li>Great Ocean Road Australia</li>
                <li>North Coast 500 Scotland</li>
                <li>Carretera Austral Chile</li>
                <li>Garden Route South Africa</li>
            </ul>
            
            <h3>Road Trip Categories</h3>
            <ul>
                <li>Scenic Drives</li>
                <li>Vanlife Routes</li>
                <li>Overlanding Adventures</li>
                <li>4x4 Expeditions</li>
                <li>Coastal Road Trips</li>
                <li>Mountain Passes</li>
                <li>Desert Crossings</li>
                <li>Wildlife Safari Routes</li>
            </ul>
            
            <h3>Travel Planning</h3>
            <ul>
                <li>Trip Budget Calculator</li>
                <li>Best Time to Travel</li>
                <li>Difficulty Ratings</li>
                <li>Camping Spots</li>
                <li>Community Reviews</li>
            </ul>
            
            <h3>About Srndipity</h3>
            <p>Srndipity helps thousands of travelers plan their road trip adventures. Our platform features 200+ curated routes across all continents, with detailed information about costs, difficulty, best seasons, and community tips. Whether you're a weekend warrior or a full-time vanlifer, we have the perfect road trip for you.</p>
            
            <p>Keywords: road trip planner, vanlife app, travel diary, overlanding routes, road trip map, campervan travel, van life planning, adventure travel, road trip ideas, travel tracker, world road trips, scenic drives, camping routes, 4x4 routes, overland travel</p>
        </nav>
        
        <p>&copy; 2024-2026 Srndipity. All rights reserved.</p>
        <p><em>For those with eyes to see.</em></p>
        <p>Made with ❤️ for the vanlife and overlanding community.</p>
    </footer>

    <!-- Initialize Lucide Icons -->
    <script>
        // Initialize all Lucide icons on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
        // Also run after a short delay for dynamically loaded content
        setTimeout(function() {
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }, 1500);
    </script>
</body>
</html>
